(function(){const G=document.createElement("link").relList;if(G&&G.supports&&G.supports("modulepreload"))return;for(const nt of document.querySelectorAll('link[rel="modulepreload"]'))ct(nt);new MutationObserver(nt=>{for(const pt of nt)if(pt.type==="childList")for(const mt of pt.addedNodes)mt.tagName==="LINK"&&mt.rel==="modulepreload"&&ct(mt)}).observe(document,{childList:!0,subtree:!0});function q(nt){const pt={};return nt.integrity&&(pt.integrity=nt.integrity),nt.referrerPolicy&&(pt.referrerPolicy=nt.referrerPolicy),nt.crossOrigin==="use-credentials"?pt.credentials="include":nt.crossOrigin==="anonymous"?pt.credentials="omit":pt.credentials="same-origin",pt}function ct(nt){if(nt.ep)return;nt.ep=!0;const pt=q(nt);fetch(nt.href,pt)}})();var bf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Vr={exports:{}};var X0=Vr.exports,xf;function K0(){return xf||(xf=1,(function(V,G){(function(q,ct){ct(G)})(X0,(function(q){var ct=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof bf<"u"?bf:typeof self<"u"?self:{};function nt(t,e){return e={exports:{}},t(e,e.exports),e.exports}var pt=function(t){return t&&t.Math==Math&&t},mt=pt(typeof globalThis=="object"&&globalThis)||pt(typeof window=="object"&&window)||pt(typeof self=="object"&&self)||pt(typeof ct=="object"&&ct)||(function(){return this})()||Function("return this")(),Dt=function(t){try{return!!t()}catch{return!0}},Wt=!Dt(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Xn={}.propertyIsEnumerable,Fr=Object.getOwnPropertyDescriptor,Yi=Fr&&!Xn.call({1:2},1),Of=Yi?function(e){var n=Fr(this,e);return!!n&&n.enumerable}:Xn,Nf={f:Of},Br=function(t,e){return{enumerable:!(t&1),configurable:!(t&2),writable:!(t&4),value:e}},kf={}.toString,ln=function(t){return kf.call(t).slice(8,-1)},If="".split,sa=Dt(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return ln(t)=="String"?If.call(t,""):Object(t)}:Object,Kn=function(t){if(t==null)throw TypeError("Can't call method on "+t);return t},Xi=function(t){return sa(Kn(t))},Ae=function(t){return typeof t=="object"?t!==null:typeof t=="function"},Ki=function(t,e){if(!Ae(t))return t;var n,r;if(e&&typeof(n=t.toString)=="function"&&!Ae(r=n.call(t))||typeof(n=t.valueOf)=="function"&&!Ae(r=n.call(t))||!e&&typeof(n=t.toString)=="function"&&!Ae(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")},Rf={}.hasOwnProperty,$t=function(t,e){return Rf.call(t,e)},Zi=mt.document,Vf=Ae(Zi)&&Ae(Zi.createElement),oa=function(t){return Vf?Zi.createElement(t):{}},aa=!Wt&&!Dt(function(){return Object.defineProperty(oa("div"),"a",{get:function(){return 7}}).a!=7}),la=Object.getOwnPropertyDescriptor,Df=Wt?la:function(e,n){if(e=Xi(e),n=Ki(n,!0),aa)try{return la(e,n)}catch{}if($t(e,n))return Br(!Nf.f.call(e,n),e[n])},Ji={f:Df},$e=function(t){if(!Ae(t))throw TypeError(String(t)+" is not an object");return t},ca=Object.defineProperty,Ff=Wt?ca:function(e,n,r){if($e(e),n=Ki(n,!0),$e(r),aa)try{return ca(e,n,r)}catch{}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[n]=r.value),e},Mn={f:Ff},He=Wt?function(t,e,n){return Mn.f(t,e,Br(1,n))}:function(t,e,n){return t[e]=n,t},Qi=function(t,e){try{He(mt,t,e)}catch{mt[t]=e}return e},ua="__core-js_shared__",Bf=mt[ua]||Qi(ua,{}),cn=Bf,Gf=Function.toString;typeof cn.inspectSource!="function"&&(cn.inspectSource=function(t){return Gf.call(t)});var ha=cn.inspectSource,fa=mt.WeakMap,zf=typeof fa=="function"&&/native code/.test(ha(fa)),da=nt(function(t){(t.exports=function(e,n){return cn[e]||(cn[e]=n!==void 0?n:{})})("versions",[]).push({version:"3.8.3",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"})}),Uf=0,$f=Math.random(),ga=function(t){return"Symbol("+String(t===void 0?"":t)+")_"+(++Uf+$f).toString(36)},pa=da("keys"),ts=function(t){return pa[t]||(pa[t]=ga(t))},es={},Hf=mt.WeakMap,Gr,Zn,zr,qf=function(t){return zr(t)?Zn(t):Gr(t,{})},Wf=function(t){return function(e){var n;if(!Ae(e)||(n=Zn(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}};if(zf){var On=cn.state||(cn.state=new Hf),jf=On.get,Yf=On.has,Xf=On.set;Gr=function(t,e){return e.facade=t,Xf.call(On,t,e),e},Zn=function(t){return jf.call(On,t)||{}},zr=function(t){return Yf.call(On,t)}}else{var Jn=ts("state");es[Jn]=!0,Gr=function(t,e){return e.facade=t,He(t,Jn,e),e},Zn=function(t){return $t(t,Jn)?t[Jn]:{}},zr=function(t){return $t(t,Jn)}}var Ur={set:Gr,get:Zn,has:zr,enforce:qf,getterFor:Wf},Kf=nt(function(t){var e=Ur.get,n=Ur.enforce,r=String(String).split("String");(t.exports=function(i,s,o,l){var a=l?!!l.unsafe:!1,c=l?!!l.enumerable:!1,u=l?!!l.noTargetGet:!1,h;if(typeof o=="function"&&(typeof s=="string"&&!$t(o,"name")&&He(o,"name",s),h=n(o),h.source||(h.source=r.join(typeof s=="string"?s:""))),i===mt){c?i[s]=o:Qi(s,o);return}else a?!u&&i[s]&&(c=!0):delete i[s];c?i[s]=o:He(i,s,o)})(Function.prototype,"toString",function(){return typeof this=="function"&&e(this).source||ha(this)})}),Nn=mt,va=function(t){return typeof t=="function"?t:void 0},ma=function(t,e){return arguments.length<2?va(Nn[t])||va(mt[t]):Nn[t]&&Nn[t][e]||mt[t]&&mt[t][e]},Zf=Math.ceil,Jf=Math.floor,ns=function(t){return isNaN(t=+t)?0:(t>0?Jf:Zf)(t)},Qf=Math.min,$r=function(t){return t>0?Qf(ns(t),9007199254740991):0},td=Math.max,ed=Math.min,nd=function(t,e){var n=ns(t);return n<0?td(n+e,0):ed(n,e)},ya=function(t){return function(e,n,r){var i=Xi(e),s=$r(i.length),o=nd(r,s),l;if(t&&n!=n){for(;s>o;)if(l=i[o++],l!=l)return!0}else for(;s>o;o++)if((t||o in i)&&i[o]===n)return t||o||0;return!t&&-1}},wa={includes:ya(!0),indexOf:ya(!1)},rd=wa.indexOf,ba=function(t,e){var n=Xi(t),r=0,i=[],s;for(s in n)!$t(es,s)&&$t(n,s)&&i.push(s);for(;e.length>r;)$t(n,s=e[r++])&&(~rd(i,s)||i.push(s));return i},Hr=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],id=Hr.concat("length","prototype"),sd=Object.getOwnPropertyNames||function(e){return ba(e,id)},od={f:sd},ad=Object.getOwnPropertySymbols,ld={f:ad},cd=ma("Reflect","ownKeys")||function(e){var n=od.f($e(e)),r=ld.f;return r?n.concat(r(e)):n},ud=function(t,e){for(var n=cd(e),r=Mn.f,i=Ji.f,s=0;s<n.length;s++){var o=n[s];$t(t,o)||r(t,o,i(e,o))}},hd=/#|\.prototype\./,Qn=function(t,e){var n=dd[fd(t)];return n==pd?!0:n==gd?!1:typeof e=="function"?Dt(e):!!e},fd=Qn.normalize=function(t){return String(t).replace(hd,".").toLowerCase()},dd=Qn.data={},gd=Qn.NATIVE="N",pd=Qn.POLYFILL="P",vd=Qn,md=Ji.f,qe=function(t,e){var n=t.target,r=t.global,i=t.stat,s,o,l,a,c,u;if(r?o=mt:i?o=mt[n]||Qi(n,{}):o=(mt[n]||{}).prototype,o)for(l in e){if(c=e[l],t.noTargetGet?(u=md(o,l),a=u&&u.value):a=o[l],s=vd(r?l:n+(i?".":"#")+l,t.forced),!s&&a!==void 0){if(typeof c==typeof a)continue;ud(c,a)}(t.sham||a&&a.sham)&&He(c,"sham",!0),Kf(o,l,c,t)}},xa=!!Object.getOwnPropertySymbols&&!Dt(function(){return!String(Symbol())}),yd=xa&&!Symbol.sham&&typeof Symbol.iterator=="symbol",qr=da("wks"),tr=mt.Symbol,wd=yd?tr:tr&&tr.withoutSetter||ga,fe=function(t){return $t(qr,t)||(xa&&$t(tr,t)?qr[t]=tr[t]:qr[t]=wd("Symbol."+t)),qr[t]},bd=Object.keys||function(e){return ba(e,Hr)},xd=Wt?Object.defineProperties:function(e,n){$e(e);for(var r=bd(n),i=r.length,s=0,o;i>s;)Mn.f(e,o=r[s++],n[o]);return e},Ad=ma("document","documentElement"),Aa=">",Pa="<",rs="prototype",is="script",Ta=ts("IE_PROTO"),ss=function(){},Sa=function(t){return Pa+is+Aa+t+Pa+"/"+is+Aa},Pd=function(t){t.write(Sa("")),t.close();var e=t.parentWindow.Object;return t=null,e},Td=function(){var t=oa("iframe"),e="java"+is+":",n;return t.style.display="none",Ad.appendChild(t),t.src=String(e),n=t.contentWindow.document,n.open(),n.write(Sa("document.F=Object")),n.close(),n.F},os,Wr=function(){try{os=document.domain&&new ActiveXObject("htmlfile")}catch{}Wr=os?Pd(os):Td();for(var t=Hr.length;t--;)delete Wr[rs][Hr[t]];return Wr()};es[Ta]=!0;var Ea=Object.create||function(e,n){var r;return e!==null?(ss[rs]=$e(e),r=new ss,ss[rs]=null,r[Ta]=e):r=Wr(),n===void 0?r:xd(r,n)},as=fe("unscopables"),ls=Array.prototype;ls[as]==null&&Mn.f(ls,as,{configurable:!0,value:Ea(null)});var cs=function(t){ls[as][t]=!0},Sd=Object.defineProperty,us={},Ca=function(t){throw t},hs=function(t,e){if($t(us,t))return us[t];e||(e={});var n=[][t],r=$t(e,"ACCESSORS")?e.ACCESSORS:!1,i=$t(e,0)?e[0]:Ca,s=$t(e,1)?e[1]:void 0;return us[t]=!!n&&!Dt(function(){if(r&&!Wt)return!0;var o={length:-1};r?Sd(o,1,{enumerable:!0,get:Ca}):o[1]=1,n.call(o,i,s)})},Ed=wa.includes,Cd=hs("indexOf",{ACCESSORS:!0,1:0});qe({target:"Array",proto:!0,forced:!Cd},{includes:function(e){return Ed(this,e,arguments.length>1?arguments[1]:void 0)}}),cs("includes");var Ld=function(t){if(typeof t!="function")throw TypeError(String(t)+" is not a function");return t},fs=function(t,e,n){if(Ld(t),e===void 0)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(r){return t.call(e,r)};case 2:return function(r,i){return t.call(e,r,i)};case 3:return function(r,i,s){return t.call(e,r,i,s)}}return function(){return t.apply(e,arguments)}},_d=Function.call,er=function(t,e,n){return fs(_d,mt[t].prototype[e],n)};er("Array","includes");var ds=function(t){return Object(Kn(t))},La=Array.isArray||function(e){return ln(e)=="Array"},Md=fe("species"),Od=function(t,e){var n;return La(t)&&(n=t.constructor,typeof n=="function"&&(n===Array||La(n.prototype))?n=void 0:Ae(n)&&(n=n[Md],n===null&&(n=void 0))),new(n===void 0?Array:n)(e===0?0:e)},_a=[].push,Ma=function(t){var e=t==1,n=t==2,r=t==3,i=t==4,s=t==6,o=t==7,l=t==5||s;return function(a,c,u,h){for(var g=ds(a),d=sa(g),v=fs(c,u,3),y=$r(d.length),x=0,A=h||Od,T=e?A(a,y):n||o?A(a,0):void 0,f,p;y>x;x++)if((l||x in d)&&(f=d[x],p=v(f,x,g),t))if(e)T[x]=p;else if(p)switch(t){case 3:return!0;case 5:return f;case 6:return x;case 2:_a.call(T,f)}else switch(t){case 4:return!1;case 7:_a.call(T,f)}return s?-1:r||i?i:T}},Oa={find:Ma(5),findIndex:Ma(6)},Nd=Oa.find,jr="find",Na=!0,kd=hs(jr);jr in[]&&Array(1)[jr](function(){Na=!1}),qe({target:"Array",proto:!0,forced:Na||!kd},{find:function(e){return Nd(this,e,arguments.length>1?arguments[1]:void 0)}}),cs(jr),er("Array","find");var Id=function(t){return function(e,n){var r=String(Kn(e)),i=ns(n),s=r.length,o,l;return i<0||i>=s?t?"":void 0:(o=r.charCodeAt(i),o<55296||o>56319||i+1===s||(l=r.charCodeAt(i+1))<56320||l>57343?t?r.charAt(i):o:t?r.slice(i,i+2):(o-55296<<10)+(l-56320)+65536)}},Rd={charAt:Id(!0)},Vd=!Dt(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}),ka=ts("IE_PROTO"),Dd=Object.prototype,Yr=Vd?Object.getPrototypeOf:function(t){return t=ds(t),$t(t,ka)?t[ka]:typeof t.constructor=="function"&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?Dd:null},gs=fe("iterator"),Ia=!1,Fd=function(){return this},un,ps,vs;[].keys&&(vs=[].keys(),"next"in vs?(ps=Yr(Yr(vs)),ps!==Object.prototype&&(un=ps)):Ia=!0);var Bd=un==null||Dt(function(){var t={};return un[gs].call(t)!==t});Bd&&(un={}),$t(un,gs)||He(un,gs,Fd);var ms={IteratorPrototype:un,BUGGY_SAFARI_ITERATORS:Ia},Gd=Mn.f,Ra=fe("toStringTag"),Va=function(t,e,n){t&&!$t(t=n?t:t.prototype,Ra)&&Gd(t,Ra,{configurable:!0,value:e})},Xr={},zd=ms.IteratorPrototype,Ud=function(){return this},$d=function(t,e,n){var r=e+" Iterator";return t.prototype=Ea(zd,{next:Br(1,n)}),Va(t,r,!1),Xr[r]=Ud,t},Hd=function(t){if(!Ae(t)&&t!==null)throw TypeError("Can't set "+String(t)+" as a prototype");return t},Da=Object.setPrototypeOf||("__proto__"in{}?(function(){var t=!1,e={},n;try{n=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set,n.call(e,[]),t=e instanceof Array}catch{}return function(i,s){return $e(i),Hd(s),t?n.call(i,s):i.__proto__=s,i}})():void 0),ys=ms.IteratorPrototype,Fa=ms.BUGGY_SAFARI_ITERATORS,nr=fe("iterator"),qd="keys",Wd="values",jd="entries",Yd=function(){return this},Xd=function(t,e,n,r,i,s,o){$d(n,e,r);var l=function(y){if(h)return h;if(!Fa&&y in c)return c[y];switch(y){case qd:return function(){return new n(this,y)};case Wd:return function(){return new n(this,y)};case jd:return function(){return new n(this,y)}}return function(){return new n(this)}},a=e+" Iterator",c=t.prototype,u=c[nr]||c["@@iterator"]||i,h=!Fa&&u||l(i),g=u,d,v;return g&&(d=Yr(g.call(new t)),ys!==Object.prototype&&d.next&&(Yr(d)!==ys&&(Da?Da(d,ys):typeof d[nr]!="function"&&He(d,nr,Yd)),Va(d,a,!0))),c[nr]!==h&&He(c,nr,h),Xr[e]=h,v},Kd=Rd.charAt,Ba="String Iterator",Zd=Ur.set,Jd=Ur.getterFor(Ba);Xd(String,"String",function(t){Zd(this,{type:Ba,string:String(t),index:0})},function(){var e=Jd(this),n=e.string,r=e.index,i;return r>=n.length?{value:void 0,done:!0}:(i=Kd(n,r),e.index+=i.length,{value:i,done:!1})});var Qd=function(t){var e=t.return;if(e!==void 0)return $e(e.call(t)).value},tg=function(t,e,n,r){try{return r?e($e(n)[0],n[1]):e(n)}catch(i){throw Qd(t),i}},eg=fe("iterator"),ng=Array.prototype,rg=function(t){return t!==void 0&&(Xr.Array===t||ng[eg]===t)},Ga=function(t,e,n){var r=Ki(e);r in t?Mn.f(t,r,Br(0,n)):t[r]=n},ig=fe("toStringTag"),za={};za[ig]="z";var sg=String(za)==="[object z]",og=fe("toStringTag"),ag=ln((function(){return arguments})())=="Arguments",lg=function(t,e){try{return t[e]}catch{}},cg=sg?ln:function(t){var e,n,r;return t===void 0?"Undefined":t===null?"Null":typeof(n=lg(e=Object(t),og))=="string"?n:ag?ln(e):(r=ln(e))=="Object"&&typeof e.callee=="function"?"Arguments":r},ug=fe("iterator"),hg=function(t){if(t!=null)return t[ug]||t["@@iterator"]||Xr[cg(t)]},fg=function(e){var n=ds(e),r=typeof this=="function"?this:Array,i=arguments.length,s=i>1?arguments[1]:void 0,o=s!==void 0,l=hg(n),a=0,c,u,h,g,d,v;if(o&&(s=fs(s,i>2?arguments[2]:void 0,2)),l!=null&&!(r==Array&&rg(l)))for(g=l.call(n),d=g.next,u=new r;!(h=d.call(g)).done;a++)v=o?tg(g,s,[h.value,a],!0):h.value,Ga(u,a,v);else for(c=$r(n.length),u=new r(c);c>a;a++)v=o?s(n[a],a):n[a],Ga(u,a,v);return u.length=a,u},Ua=fe("iterator"),$a=!1;try{var dg=0,Ha={next:function(){return{done:!!dg++}},return:function(){$a=!0}};Ha[Ua]=function(){return this},Array.from(Ha,function(){throw 2})}catch{}var gg=function(t,e){if(!$a)return!1;var n=!1;try{var r={};r[Ua]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch{}return n},pg=!gg(function(t){Array.from(t)});qe({target:"Array",stat:!0,forced:pg},{from:fg}),Nn.Array.from;var vg=Oa.findIndex,Kr="findIndex",qa=!0,mg=hs(Kr);Kr in[]&&Array(1)[Kr](function(){qa=!1}),qe({target:"Array",proto:!0,forced:qa||!mg},{findIndex:function(e){return vg(this,e,arguments.length>1?arguments[1]:void 0)}}),cs(Kr),er("Array","findIndex"),nt(function(t,e){(function(){var n=e,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function i(s){this.message=s}i.prototype=new Error,i.prototype.name="InvalidCharacterError",n.btoa||(n.btoa=function(s){for(var o=String(s),l,a,c=0,u=r,h="";o.charAt(c|0)||(u="=",c%1);h+=u.charAt(63&l>>8-c%1*8)){if(a=o.charCodeAt(c+=3/4),a>255)throw new i("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");l=l<<8|a}return h}),n.atob||(n.atob=function(s){var o=String(s).replace(/=+$/,"");if(o.length%4==1)throw new i("'atob' failed: The string to be decoded is not correctly encoded.");for(var l=0,a,c,u=0,h="";c=o.charAt(u++);~c&&(a=l%4?a*64+c:c,l++%4)?h+=String.fromCharCode(255&a>>(-2*l&6)):0)c=r.indexOf(c);return h})})()}),qe({target:"Number",stat:!0},{isNaN:function(e){return e!=e}}),Nn.Number.isNaN;var yg=mt.isFinite,wg=Number.isFinite||function(e){return typeof e=="number"&&yg(e)};qe({target:"Number",stat:!0},{isFinite:wg}),Nn.Number.isFinite;var bg=fe("match"),xg=function(t){var e;return Ae(t)&&((e=t[bg])!==void 0?!!e:ln(t)=="RegExp")},Wa=function(t){if(xg(t))throw TypeError("The method doesn't accept regular expressions");return t},Ag=fe("match"),ja=function(t){var e=/./;try{"/./"[t](e)}catch{try{return e[Ag]=!1,"/./"[t](e)}catch{}}return!1};qe({target:"String",proto:!0,forced:!ja("includes")},{includes:function(e){return!!~String(Kn(this)).indexOf(Wa(e),arguments.length>1?arguments[1]:void 0)}}),er("String","includes");var Pg=Ji.f,Ya="".startsWith,Tg=Math.min,Xa=ja("startsWith"),Sg=!Xa&&!!(function(){var t=Pg(String.prototype,"startsWith");return t&&!t.writable})();qe({target:"String",proto:!0,forced:!Sg&&!Xa},{startsWith:function(e){var n=String(Kn(this));Wa(e);var r=$r(Tg(arguments.length>1?arguments[1]:void 0,n.length)),i=String(e);return Ya?Ya.call(n,i,r):n.slice(r,r+i.length)===i}}),er("String","startsWith"),(function(){if(typeof Uint8Array<"u"||typeof window>"u")return;function t(r,i){return this.slice(r,i)}function e(r,i){arguments.length<2&&(i=0);for(var s=0,o=r.length;s<o;++s,++i)this[i]=r[s]&255}function n(r){var i;if(typeof r=="number"){i=new Array(r);for(var s=0;s<r;++s)i[s]=0}else i=r.slice(0);return i.subarray=t,i.buffer=i,i.byteLength=i.length,i.set=e,typeof r=="object"&&r.buffer&&(i.buffer=r.buffer),i}window.Uint8Array=n,window.Uint32Array=n,window.Int32Array=n})();const{round:Eg,floor:Cg,PI:Ka}=Math,Lg={linear:function(t,e,n){var r=t[1]-t[0],i=e[1]-e[0];return(n-t[0])/r*i+e[0]||0}},de=function(t){return t%360+(t<0?360:0)},hn=function(t,e){return e*Eg(t/e)},Zr=function(t){return 180*t/Ka%360},ee=function(t,e){return e=e||!1,t=e?t:t%360,t*Ka/180},ws=function(t,e){if(e===void 0)e=t===void 0?1:t,t=0;else if(e<t){const n=t;t=e,e=n}return Cg(Math.random()*(e-t+1)+t)},{cos:Jr,sin:bs,atan2:_g}=Math,Za=function(t,e){var n=ee(t.y),r=ee(e.y),i=t.x,s=e.x,o=ee(s-i),l=bs(o)*Jr(r),a=Jr(n)*bs(r)-bs(n)*Jr(r)*Jr(o),c=Zr(_g(l,a)),u=["NE","E","SE","S","SW","W","NW","N"],h=c-22.5;return h<0&&(h+=360),h=parseInt(h/45),u[h]},xs=function(t,e){var n=t.x,r=t.y,i=e.x,s=e.y;return(n-=i)*n+(r-=s)*r},Ja=function(t,e){return Math.sqrt(xs(t,e))},ft={Point:1,Line:2,Ellipse:3,Rect:4,Polyline:5,Polygon:6,Curve:7,Path:8},{abs:Qr,cos:As,sin:Ps,sqrt:Qa,min:tl,max:el,atan2:Mg,round:nl,pow:Og,PI:rl}=Math,S=function(t,e){if(!(this instanceof S))return new S(t,e);if(typeof t=="string"){var n=t.split(t.indexOf("@")===-1?" ":"@");t=parseFloat(n[0]),e=parseFloat(n[1])}else Object(t)===t&&(e=t.y,t=t.x);this.x=t===void 0?0:t,this.y=e===void 0?0:e};S.fromPolar=function(t,e,n){n=new S(n);var r=Qr(t*As(e)),i=Qr(t*Ps(e)),s=de(Zr(e));return s<90?i=-i:s<180?(r=-r,i=-i):s<270&&(r=-r),new S(n.x+r,n.y+i)},S.random=function(t,e,n,r){return new S(ws(t,e),ws(n,r))},S.prototype={type:ft.Point,chooseClosest:function(t){var e=t.length;if(e===1)return new S(t[0]);for(var n=null,r=1/0,i=0;i<e;i++){var s=new S(t[i]),o=this.squaredDistance(s);o<r&&(n=s,r=o)}return n},adhereToRect:function(t){return t.containsPoint(this)?this:(this.x=tl(el(this.x,t.x),t.x+t.width),this.y=tl(el(this.y,t.y),t.y+t.height),this)},angleBetween:function(t,e){var n=this.equals(t)||this.equals(e)?NaN:this.theta(e)-this.theta(t);return n<0&&(n+=360),n},bearing:function(t){return Za(this,t)},changeInAngle:function(t,e,n){return this.clone().offset(-t,-e).theta(n)-this.theta(n)},clone:function(){return new S(this)},cross:function(t,e){return t&&e?(e.x-this.x)*(t.y-this.y)-(e.y-this.y)*(t.x-this.x):NaN},difference:function(t,e){return Object(t)===t&&(e=t.y,t=t.x),new S(this.x-(t||0),this.y-(e||0))},distance:function(t){return Ja(this,t)},dot:function(t){return t?this.x*t.x+this.y*t.y:NaN},equals:function(t){return!!t&&this.x===t.x&&this.y===t.y},lerp:function(t,e){var n=this.x,r=this.y;return new S((1-e)*n+e*t.x,(1-e)*r+e*t.y)},magnitude:function(){return Qa(this.x*this.x+this.y*this.y)||.01},manhattanDistance:function(t){return Qr(t.x-this.x)+Qr(t.y-this.y)},move:function(t,e){var n=ee(new S(t).theta(this)),r=this.offset(As(n)*e,-Ps(n)*e);return r},normalize:function(t){var e=(t||1)/this.magnitude();return this.scale(e,e)},offset:function(t,e){return Object(t)===t&&(e=t.y,t=t.x),this.x+=t||0,this.y+=e||0,this},reflection:function(t){return new S(t).move(this,this.distance(t))},rotate:function(t,e){if(e===0)return this;t=t||new S(0,0),e=ee(de(-e));var n=As(e),r=Ps(e),i=n*(this.x-t.x)-r*(this.y-t.y)+t.x,s=r*(this.x-t.x)+n*(this.y-t.y)+t.y;return this.x=i,this.y=s,this},round:function(t){let e=1;if(t)switch(t){case 1:e=10;break;case 2:e=100;break;case 3:e=1e3;break;default:e=Og(10,t);break}return this.x=nl(this.x*e)/e,this.y=nl(this.y*e)/e,this},scale:function(t,e,n){return n=n&&new S(n)||new S(0,0),this.x=n.x+t*(this.x-n.x),this.y=n.y+e*(this.y-n.y),this},snapToGrid:function(t,e){return this.x=hn(this.x,t),this.y=hn(this.y,e||t),this},squaredDistance:function(t){return xs(this,t)},theta:function(t){t=new S(t);var e=-(t.y-this.y),n=t.x-this.x,r=Mg(e,n);return r<0&&(r=2*rl+r),180*r/rl},toJSON:function(){return{x:this.x,y:this.y}},toPolar:function(t){t=t&&new S(t)||new S(0,0);var e=this.x,n=this.y;return this.x=Qa((e-t.x)*(e-t.x)+(n-t.y)*(n-t.y)),this.y=ee(t.theta(new S(e,n))),this},toString:function(){return this.x+"@"+this.y},serialize:function(){return this.x+","+this.y},update:function(t,e){return Object(t)===t&&(e=t.y,t=t.x),this.x=t||0,this.y=e||0,this},vectorAngle:function(t){var e=new S(0,0);return e.angleBetween(this,t)}},S.prototype.translate=S.prototype.offset;const ti=S,{max:Ts,min:Ss}=Math,W=function(t,e){if(!(this instanceof W))return new W(t,e);if(t instanceof W)return new W(t.start,t.end);this.start=new S(t),this.end=new S(e)};W.prototype={type:ft.Line,angle:function(){var t=new S(this.start.x+1,this.start.y);return this.start.angleBetween(this.end,t)},bbox:function(){var t=Ss(this.start.x,this.end.x),e=Ss(this.start.y,this.end.y),n=Ts(this.start.x,this.end.x),r=Ts(this.start.y,this.end.y);return new U(t,e,n-t,r-e)},bearing:function(){return Za(this.start,this.end)},clone:function(){return new W(this.start,this.end)},closestPoint:function(t){return this.pointAt(this.closestPointNormalizedLength(t))},closestPointLength:function(t){return this.closestPointNormalizedLength(t)*this.length()},closestPointNormalizedLength:function(t){var e=this.vector().dot(new W(this.start,t).vector()),n=Ss(1,Ts(0,e/this.squaredLength()));return n!==n?0:n},closestPointTangent:function(t){return this.tangentAt(this.closestPointNormalizedLength(t))},containsPoint:function(t){var e=this.start,n=this.end;if(e.cross(t,n)!==0)return!1;var r=this.length();return!(new W(e,t).length()>r||new W(t,n).length()>r)},divideAt:function(t){var e=this.pointAt(t);return[new W(this.start,e),new W(e,this.end)]},divideAtLength:function(t){var e=this.pointAtLength(t);return[new W(this.start,e),new W(e,this.end)]},equals:function(t){return!!t&&this.start.x===t.start.x&&this.start.y===t.start.y&&this.end.x===t.end.x&&this.end.y===t.end.y},intersect:function(t,e){if(t&&t.intersectionWithLine){var n=t.intersectionWithLine(this,e);return n&&t instanceof W&&(n=n[0]),n}return null},intersectionWithLine:function(t){var e=new S(this.end.x-this.start.x,this.end.y-this.start.y),n=new S(t.end.x-t.start.x,t.end.y-t.start.y),r=e.x*n.y-e.y*n.x,i=new S(t.start.x-this.start.x,t.start.y-this.start.y),s=i.x*n.y-i.y*n.x,o=i.x*e.y-i.y*e.x;if(r===0||s*r<0||o*r<0)return null;if(r>0){if(s>r||o>r)return null}else if(s<r||o<r)return null;return[new S(this.start.x+s*e.x/r,this.start.y+s*e.y/r)]},isDifferentiable:function(){return!this.start.equals(this.end)},length:function(){return Ja(this.start,this.end)},midpoint:function(){return new S((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)},parallel:function(t){const e=this.clone();if(!this.isDifferentiable())return e;const{start:n,end:r}=e,i=n.clone().rotate(r,270),s=r.clone().rotate(n,90);return n.move(s,t),r.move(i,t),e},pointAt:function(t){var e=this.start,n=this.end;return t<=0?e.clone():t>=1?n.clone():e.lerp(n,t)},pointAtLength:function(t){var e=this.start,n=this.end,r=!0;t<0&&(r=!1,t=-t);var i=this.length();return t>=i?r?n.clone():e.clone():this.pointAt((r?t:i-t)/i)},pointOffset:function(t){t=new S(t);var e=this.start,n=this.end,r=(n.x-e.x)*(t.y-e.y)-(n.y-e.y)*(t.x-e.x);return r/this.length()},rotate:function(t,e){return this.start.rotate(t,e),this.end.rotate(t,e),this},round:function(t){return this.start.round(t),this.end.round(t),this},scale:function(t,e,n){return this.start.scale(t,e,n),this.end.scale(t,e,n),this},setLength:function(t){var e=this.length();if(!e)return this;var n=t/e;return this.scale(n,n,this.start)},squaredLength:function(){return xs(this.start,this.end)},tangentAt:function(t){if(!this.isDifferentiable())return null;var e=this.start,n=this.end,r=this.pointAt(t),i=new W(e,n);return i.translate(r.x-e.x,r.y-e.y),i},tangentAtLength:function(t){if(!this.isDifferentiable())return null;var e=this.start,n=this.end,r=this.pointAtLength(t),i=new W(e,n);return i.translate(r.x-e.x,r.y-e.y),i},toString:function(){return this.start.toString()+" "+this.end.toString()},serialize:function(){return this.start.serialize()+" "+this.end.serialize()},translate:function(t,e){return this.start.translate(t,e),this.end.translate(t,e),this},vector:function(){return new S(this.end.x-this.start.x,this.end.y-this.start.y)}},W.prototype.intersection=W.prototype.intersect;const fn=W,{sqrt:il,round:ei,pow:Ng}=Math,jt=function(t,e,n){if(!(this instanceof jt))return new jt(t,e,n);if(t instanceof jt)return new jt(new S(t.x,t.y),t.a,t.b);t=new S(t),this.x=t.x,this.y=t.y,this.a=e,this.b=n};jt.fromRect=function(t){return t=new U(t),new jt(t.center(),t.width/2,t.height/2)},jt.prototype={type:ft.Ellipse,bbox:function(){return new U(this.x-this.a,this.y-this.b,2*this.a,2*this.b)},center:function(){return new S(this.x,this.y)},clone:function(){return new jt(this)},containsPoint:function(t){return this.normalizedDistance(t)<=1},equals:function(t){return!!t&&t.x===this.x&&t.y===this.y&&t.a===this.a&&t.b===this.b},inflate:function(t,e){return t===void 0&&(t=0),e===void 0&&(e=t),this.a+=2*t,this.b+=2*e,this},intersectionWithLine:function(t){var e=[],n=t.start,r=t.end,i=this.a,s=this.b,o=t.vector(),l=n.difference(new S(this)),a=new S(o.x/(i*i),o.y/(s*s)),c=new S(l.x/(i*i),l.y/(s*s)),u=o.dot(a),h=o.dot(c),g=l.dot(c)-1,d=h*h-u*g;if(d<0)return null;if(d>0){var v=il(d),y=(-h-v)/u,x=(-h+v)/u;if((y<0||1<y)&&(x<0||1<x))return null;0<=y&&y<=1&&e.push(n.lerp(r,y)),0<=x&&x<=1&&e.push(n.lerp(r,x))}else{var A=-h/u;if(0<=A&&A<=1)e.push(n.lerp(r,A));else return null}return e},intersectionWithLineFromCenterToPoint:function(t,e){t=new S(t),e&&t.rotate(new S(this.x,this.y),e);var n=t.x-this.x,r=t.y-this.y,i;if(n===0)return i=this.bbox().pointNearestToPoint(t),e?i.rotate(new S(this.x,this.y),-e):i;var s=r/n,o=s*s,l=this.a*this.a,a=this.b*this.b,c=il(1/(1/l+o/a));c=n<0?-c:c;var u=s*c;return i=new S(this.x+c,this.y+u),e?i.rotate(new S(this.x,this.y),-e):i},normalizedDistance:function(t){var e=t.x,n=t.y,r=this.a,i=this.b,s=this.x,o=this.y;return(e-s)*(e-s)/(r*r)+(n-o)*(n-o)/(i*i)},round:function(t){let e=1;if(t)switch(t){case 1:e=10;break;case 2:e=100;break;case 3:e=1e3;break;default:e=Ng(10,t);break}return this.x=ei(this.x*e)/e,this.y=ei(this.y*e)/e,this.a=ei(this.a*e)/e,this.b=ei(this.b*e)/e,this},tangentTheta:function(t){var e=30,n=t.x,r=t.y,i=this.a,s=this.b,o=this.bbox().center(),l=o.x,a=o.y,c=n>o.x+i/2,u=n<o.x-i/2,h,g;return c||u?(h=n>o.x?r-e:r+e,g=i*i/(n-l)-i*i*(r-a)*(h-a)/(s*s*(n-l))+l):(g=r>o.y?n+e:n-e,h=s*s/(r-a)-s*s*(n-l)*(g-l)/(i*i*(r-a))+a),new S(g,h).theta(t)},toString:function(){return new S(this.x,this.y).toString()+" "+this.a+" "+this.b}};const kg=jt,{abs:sl,cos:Ig,sin:Rg,min:rr,max:ol,round:ni,pow:Vg}=Math,U=function(t,e,n,r){if(!(this instanceof U))return new U(t,e,n,r);Object(t)===t&&(e=t.y,n=t.width,r=t.height,t=t.x),this.x=t===void 0?0:t,this.y=e===void 0?0:e,this.width=n===void 0?0:n,this.height=r===void 0?0:r};U.fromEllipse=function(t){return t=new jt(t),new U(t.x-t.a,t.y-t.b,2*t.a,2*t.b)},U.fromPointUnion=function(...t){if(t.length===0)return null;const e=new S;let n,r,i,s;n=r=1/0,i=s=-1/0;for(let o=0;o<t.length;o++){e.update(t[o]);const l=e.x,a=e.y;l<n&&(n=l),l>i&&(i=l),a<r&&(r=a),a>s&&(s=a)}return new U(n,r,i-n,s-r)},U.fromRectUnion=function(...t){if(t.length===0)return null;const e=new U;let n,r,i,s;n=r=1/0,i=s=-1/0;for(let o=0;o<t.length;o++){e.update(t[o]);const l=e.x,a=e.y,c=l+e.width,u=a+e.height;l<n&&(n=l),c>i&&(i=c),a<r&&(r=a),u>s&&(s=u)}return new U(n,r,i-n,s-r)},U.prototype={type:ft.Rect,bbox:function(t){return this.clone().rotateAroundCenter(t)},rotateAroundCenter:function(t){if(!t)return this;const{width:e,height:n}=this,r=ee(t),i=sl(Rg(r)),s=sl(Ig(r)),o=e*s+n*i,l=e*i+n*s;return this.x+=(e-o)/2,this.y+=(n-l)/2,this.width=o,this.height=l,this},bottomLeft:function(){return new S(this.x,this.y+this.height)},bottomLine:function(){return new W(this.bottomLeft(),this.bottomRight())},bottomMiddle:function(){return new S(this.x+this.width/2,this.y+this.height)},center:function(){return new S(this.x+this.width/2,this.y+this.height/2)},clone:function(){return new U(this)},containsPoint:function(t,e){let n,r;return!t||typeof t=="string"?{x:n,y:r}=new S(t):{x:n=0,y:r=0}=t,e&&e.strict?n>this.x&&n<this.x+this.width&&r>this.y&&r<this.y+this.height:n>=this.x&&n<=this.x+this.width&&r>=this.y&&r<=this.y+this.height},containsRect:function(t){var e=new U(this).normalize(),n=new U(t).normalize(),r=e.width,i=e.height,s=n.width,o=n.height;if(!r||!i||!s||!o)return!1;var l=e.x,a=e.y,c=n.x,u=n.y;return s+=c,r+=l,o+=u,i+=a,l<=c&&s<=r&&a<=u&&o<=i},corner:function(){return new S(this.x+this.width,this.y+this.height)},equals:function(t){var e=new U(this).normalize(),n=new U(t).normalize();return e.x===n.x&&e.y===n.y&&e.width===n.width&&e.height===n.height},inflate:function(t,e){return t===void 0&&(t=0),e===void 0&&(e=t),this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this},intersect:function(t){var e=this.origin(),n=this.corner(),r=t.origin(),i=t.corner();if(i.x<=e.x||i.y<=e.y||r.x>=n.x||r.y>=n.y)return null;var s=ol(e.x,r.x),o=ol(e.y,r.y);return new U(s,o,rr(n.x,i.x)-s,rr(n.y,i.y)-o)},intersectionWithLine:function(t){var e=this,n=[e.topLine(),e.rightLine(),e.bottomLine(),e.leftLine()],r=[],i=[],s,o,l=n.length;for(o=0;o<l;o++)s=t.intersect(n[o]),s!==null&&i.indexOf(s.toString())<0&&(r.push(s),i.push(s.toString()));return r.length>0?r:null},intersectionWithLineFromCenterToPoint:function(t,e){t=new S(t);var n=new S(this.x+this.width/2,this.y+this.height/2),r;e&&t.rotate(n,e);for(var i=[this.topLine(),this.rightLine(),this.bottomLine(),this.leftLine()],s=new W(n,t),o=i.length-1;o>=0;--o){var l=i[o].intersection(s);if(l!==null){r=l;break}}return r&&e&&r.rotate(n,-e),r},leftLine:function(){return new W(this.topLeft(),this.bottomLeft())},leftMiddle:function(){return new S(this.x,this.y+this.height/2)},maxRectScaleToFit:function(t,e){t=new U(t),e||(e=t.center());var n,r,i,s,o,l,a,c,u=e.x,h=e.y;n=r=i=s=o=l=a=c=1/0;var g=t.topLeft();g.x<u&&(n=(this.x-u)/(g.x-u)),g.y<h&&(o=(this.y-h)/(g.y-h));var d=t.bottomRight();d.x>u&&(r=(this.x+this.width-u)/(d.x-u)),d.y>h&&(l=(this.y+this.height-h)/(d.y-h));var v=t.topRight();v.x>u&&(i=(this.x+this.width-u)/(v.x-u)),v.y<h&&(a=(this.y-h)/(v.y-h));var y=t.bottomLeft();return y.x<u&&(s=(this.x-u)/(y.x-u)),y.y>h&&(c=(this.y+this.height-h)/(y.y-h)),{sx:rr(n,r,i,s),sy:rr(o,l,a,c)}},maxRectUniformScaleToFit:function(t,e){var n=this.maxRectScaleToFit(t,e);return rr(n.sx,n.sy)},moveAndExpand:function(t){return this.x+=t.x||0,this.y+=t.y||0,this.width+=t.width||0,this.height+=t.height||0,this},moveAroundPoint:function(t,e){const n=this.center().rotate(t,e);return this.x=n.x-this.width/2,this.y=n.y-this.height/2,this},normalize:function(){var t=this.x,e=this.y,n=this.width,r=this.height;return this.width<0&&(t=this.x+this.width,n=-this.width),this.height<0&&(e=this.y+this.height,r=-this.height),this.x=t,this.y=e,this.width=n,this.height=r,this},offset:function(t,e){return S.prototype.offset.call(this,t,e)},origin:function(){return new S(this.x,this.y)},pointNearestToPoint:function(t){if(t=new S(t),this.containsPoint(t)){var e=this.sideNearestToPoint(t);switch(e){case"right":return new S(this.x+this.width,t.y);case"left":return new S(this.x,t.y);case"bottom":return new S(t.x,this.y+this.height);case"top":return new S(t.x,this.y)}}return t.adhereToRect(this)},rightLine:function(){return new W(this.topRight(),this.bottomRight())},rightMiddle:function(){return new S(this.x+this.width,this.y+this.height/2)},round:function(t){let e=1;if(t)switch(t){case 1:e=10;break;case 2:e=100;break;case 3:e=1e3;break;default:e=Vg(10,t);break}return this.x=ni(this.x*e)/e,this.y=ni(this.y*e)/e,this.width=ni(this.width*e)/e,this.height=ni(this.height*e)/e,this},scale:function(t,e,n){return n=this.origin().scale(t,e,n),this.x=n.x,this.y=n.y,this.width*=t,this.height*=e,this},sideNearestToPoint:function(t){t=new S(t);var e=t.x-this.x,n=this.x+this.width-t.x,r=t.y-this.y,i=this.y+this.height-t.y,s=e,o="left";return n<s&&(s=n,o="right"),r<s&&(s=r,o="top"),i<s&&(o="bottom"),o},snapToGrid:function(t,e){var n=this.origin().snapToGrid(t,e),r=this.corner().snapToGrid(t,e);return this.x=n.x,this.y=n.y,this.width=r.x-n.x,this.height=r.y-n.y,this},toJSON:function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},topLine:function(){return new W(this.topLeft(),this.topRight())},topMiddle:function(){return new S(this.x+this.width/2,this.y)},topRight:function(){return new S(this.x+this.width,this.y)},toString:function(){return this.origin().toString()+" "+this.corner().toString()},union:function(t){return U.fromRectUnion(this,t)},update:function(t,e,n,r){return Object(t)===t&&(e=t.y,n=t.width,r=t.height,t=t.x),this.x=t||0,this.y=e||0,this.width=n||0,this.height=r||0,this}},U.prototype.bottomRight=U.prototype.corner,U.prototype.topLeft=U.prototype.origin,U.prototype.translate=U.prototype.offset;const Dg=U;function al(t){const e=t.trim();if(e==="")return[];const n=[],r=e.split(/\b\s*,\s*|,\s*|\s+/),i=r.length;for(let s=0;s<i;s+=2)n.push({x:+r[s],y:+r[s+1]});return n}function ll(t){const e=t.length;if(e===0)return[];const n=[];for(let r=0;r<e;r++){const i=t[r].clone();n.push(i)}return n}function cl(t){const{abs:e}=Math;var n,r,i=t.length;if(i===0)return[];var s;for(n=0;n<i;n++)(s===void 0||t[n].y<s.y||t[n].y===s.y&&t[n].x>s.x)&&(s=t[n]);var o=[];for(n=0;n<i;n++){var l=s.theta(t[n]);l===0&&(l=360);var a=[t[n],n,l];o.push(a)}if(o.sort(function(D,H){var X=D[2]-H[2];return X===0&&(X=H[1]-D[1]),X}),o.length>2){var c=o[o.length-1];o.unshift(c)}for(var u={},h=[],g,d,v,y,x,A;o.length!==0;)if(g=o.pop(),d=g[0],!u.hasOwnProperty(g[0]+"@@"+g[1]))for(var T=!1;!T;)if(h.length<2)h.push(g),T=!0;else{v=h.pop(),y=v[0],x=h.pop(),A=x[0];var f=A.cross(y,d);if(f<0)h.push(x),h.push(v),h.push(g),T=!0;else if(f===0){var p=1e-10,m=y.angleBetween(A,d);e(m-180)<p||y.equals(d)||A.equals(y)?(u[v[0]+"@@"+v[1]]=y,h.push(x)):e((m+1)%360-1)<p&&(h.push(x),o.push(v))}else u[v[0]+"@@"+v[1]]=y,h.push(x)}h.length>2&&h.pop();var w,b=-1;for(r=h.length,n=0;n<r;n++){var P=h[n][1];(w===void 0||P<w)&&(w=P,b=n)}var E=[];if(b>0){var C=h.slice(b),k=h.slice(0,b);E=C.concat(k)}else E=h;var I=[];for(r=E.length,n=0;n<r;n++)I.push(E[n][0]);return I}const Lt=function(t){if(!(this instanceof Lt))return new Lt(t);if(typeof t=="string")return new Lt.parse(t);this.points=Array.isArray(t)?t.map(S):[]};Lt.parse=function(t){return new Lt(al(t))},Lt.fromRect=function(t){return new Lt([t.topLeft(),t.topRight(),t.bottomRight(),t.bottomLeft(),t.topLeft()])},Lt.prototype={type:ft.Polyline,bbox:function(){var t=1/0,e=-1/0,n=1/0,r=-1/0,i=this.points,s=i.length;if(s===0)return null;for(var o=0;o<s;o++){var l=i[o],a=l.x,c=l.y;a<t&&(t=a),a>e&&(e=a),c<n&&(n=c),c>r&&(r=c)}return new U(t,n,e-t,r-n)},clone:function(){return new Lt(ll(this.points))},closestPoint:function(t){var e=this.closestPointLength(t);return this.pointAtLength(e)},closestPointLength:function(t){var e=this.lengthPoints(),n=e.length;if(n===0||n===1)return 0;for(var r,i=1/0,s=0,o=n-1,l=0;l<o;l++){var a=new W(e[l],e[l+1]),c=a.length(),u=a.closestPointNormalizedLength(t),h=a.pointAt(u),g=h.squaredDistance(t);g<i&&(i=g,r=s+u*c),s+=c}return r},closestPointNormalizedLength:function(t){var e=this.closestPointLength(t);if(e===0)return 0;var n=this.length();return n===0?0:e/n},closestPointTangent:function(t){var e=this.closestPointLength(t);return this.tangentAtLength(e)},containsPoint:function(t){var e=this.points,n=e.length;if(n===0)return!1;for(var r=t.x,i=t.y,s=n-1,o=0,l=0,a=new W,c=new W,u=new S;o<n;o++){var h=e[s],g=e[o];if(t.equals(h)||(a.start=h,a.end=g,a.containsPoint(t)))return!0;if(i<=h.y&&i>g.y||i>h.y&&i<=g.y){var d=h.x-r>g.x-r?h.x-r:g.x-r;d>=0&&(u.x=r+d,u.y=i,c.start=t,c.end=u,a.intersect(c)&&l++)}s=o}return l%2===1},close:function(){const{start:t,end:e,points:n}=this;return t&&e&&!t.equals(e)&&n.push(t.clone()),this},lengthPoints:function(){return this.points},convexHull:function(){return new Lt(cl(this.points))},equals:function(t){if(!t)return!1;var e=this.points,n=t.points,r=e.length;if(n.length!==r)return!1;for(var i=0;i<r;i++){var s=e[i],o=t.points[i];if(!s.equals(o))return!1}return!0},intersectionWithLine:function(t){for(var e=new W(t),n=[],r=this.lengthPoints(),i=new W,s=0,o=r.length-1;s<o;s++){i.start=r[s],i.end=r[s+1];var l=e.intersectionWithLine(i);l&&n.push(l[0])}return n.length>0?n:null},isDifferentiable:function(){var t=this.points,e=t.length;if(e===0)return!1;for(var n=new W,r=e-1,i=0;i<r;i++)if(n.start=t[i],n.end=t[i+1],n.isDifferentiable())return!0;return!1},length:function(){var t=this.lengthPoints(),e=t.length;if(e===0)return 0;for(var n=0,r=e-1,i=0;i<r;i++)n+=t[i].distance(t[i+1]);return n},pointAt:function(t){var e=this.lengthPoints(),n=e.length;if(n===0)return null;if(n===1||t<=0)return e[0].clone();if(t>=1)return e[n-1].clone();var r=this.length(),i=r*t;return this.pointAtLength(i)},pointAtLength:function(t){var e=this.lengthPoints(),n=e.length;if(n===0)return null;if(n===1)return e[0].clone();var r=!0;t<0&&(r=!1,t=-t);for(var i=0,s=n-1,o=0;o<s;o++){var l=r?o:s-1-o,a=e[l],c=e[l+1],u=new W(a,c),h=a.distance(c);if(t<=i+h)return u.pointAtLength((r?1:-1)*(t-i));i+=h}var g=r?e[n-1]:e[0];return g.clone()},round:function(t){for(var e=this.points,n=e.length,r=0;r<n;r++)e[r].round(t);return this},scale:function(t,e,n){for(var r=this.points,i=r.length,s=0;s<i;s++)r[s].scale(t,e,n);return this},simplify:function(t={}){const e=this.points;if(e.length<3)return this;const n=t.threshold||1e-10;let r=0;for(;e[r+2];){const i=r,s=r+1,o=r+2,l=e[i],a=e[s],c=e[o];new W(l,c).closestPoint(a).distance(a)<=n?e.splice(s,1):r+=1}return this},tangentAt:function(t){var e=this.lengthPoints(),n=e.length;if(n===0||n===1)return null;t<0&&(t=0),t>1&&(t=1);var r=this.length(),i=r*t;return this.tangentAtLength(i)},tangentAtLength:function(t){var e=this.lengthPoints(),n=e.length;if(n===0||n===1)return null;var r=!0;t<0&&(r=!1,t=-t);for(var i,s=0,o=n-1,l=0;l<o;l++){var a=r?l:o-1-l,c=e[a],u=e[a+1],h=new W(c,u),g=c.distance(u);if(h.isDifferentiable()){if(t<=s+g)return h.tangentAtLength((r?1:-1)*(t-s));i=h}s+=g}if(i){var d=r?1:0;return i.tangentAt(d)}return null},toString:function(){return this.points+""},translate:function(t,e){for(var n=this.points,r=n.length,i=0;i<r;i++)n[i].translate(t,e);return this},serialize:function(){var t=this.points,e=t.length;if(e===0)return"";for(var n="",r=0;r<e;r++){var i=t[r];n+=i.x+","+i.y+" "}return n.trim()}},Object.defineProperty(Lt.prototype,"start",{configurable:!0,enumerable:!0,get:function(){var t=this.points,e=t.length;return e===0?null:this.points[0]}}),Object.defineProperty(Lt.prototype,"end",{configurable:!0,enumerable:!0,get:function(){var t=this.points,e=t.length;return e===0?null:this.points[e-1]}});const{abs:ri,sqrt:Fg,min:ul,max:hl,pow:Es}=Math,Pt=function(t,e,n,r){if(!(this instanceof Pt))return new Pt(t,e,n,r);if(t instanceof Pt)return new Pt(t.start,t.controlPoint1,t.controlPoint2,t.end);this.start=new S(t),this.controlPoint1=new S(e),this.controlPoint2=new S(n),this.end=new S(r)};Pt.throughPoints=(function(){function t(n){var r=[],i=[],s=n.length-1,o;if(s==1)return r[0]=new S((2*n[0].x+n[1].x)/3,(2*n[0].y+n[1].y)/3),i[0]=new S(2*r[0].x-n[0].x,2*r[0].y-n[0].y),[r,i];var l=[];for(o=1;o<s-1;o++)l[o]=4*n[o].x+2*n[o+1].x;l[0]=n[0].x+2*n[1].x,l[s-1]=(8*n[s-1].x+n[s].x)/2;var a=e(l);for(o=1;o<s-1;++o)l[o]=4*n[o].y+2*n[o+1].y;l[0]=n[0].y+2*n[1].y,l[s-1]=(8*n[s-1].y+n[s].y)/2;var c=e(l);for(o=0;o<s;o++)r.push(new S(a[o],c[o])),o<s-1?i.push(new S(2*n[o+1].x-a[o+1],2*n[o+1].y-c[o+1])):i.push(new S((n[s].x+a[s-1])/2,(n[s].y+c[s-1])/2));return[r,i]}function e(n){var r=n.length,i=[],s=[],o=2;i[0]=n[0]/o;for(var l=1;l<r;l++)s[l]=1/o,o=(l<r-1?4:3.5)-s[l],i[l]=(n[l]-i[l-1])/o;for(l=1;l<r;l++)i[r-l-1]-=s[r-l]*i[r-l];return i}return function(n){if(!n||Array.isArray(n)&&n.length<2)throw new Error("At least 2 points are required");for(var r=t(n),i=[],s=r[0].length,o=0;o<s;o++){var l=new S(r[0][o].x,r[0][o].y),a=new S(r[1][o].x,r[1][o].y);i.push(new Pt(n[o],l,a,n[o+1]))}return i}})(),Pt.prototype={type:ft.Curve,bbox:function(){for(var t=this.start,e=this.controlPoint1,n=this.controlPoint2,r=this.end,i=t.x,s=t.y,o=e.x,l=e.y,a=n.x,c=n.y,u=r.x,h=r.y,g=new Array,d=new Array,v=[new Array,new Array],y,x,A,T,f,p,m,w,b=0;b<2;++b){if(b===0?(x=6*i-12*o+6*a,y=-3*i+9*o-9*a+3*u,A=3*o-3*i):(x=6*s-12*l+6*c,y=-3*s+9*l-9*c+3*h,A=3*l-3*s),ri(y)<1e-12){if(ri(x)<1e-12)continue;T=-A/x,0<T&&T<1&&d.push(T);continue}m=x*x-4*A*y,w=Fg(m),!(m<0)&&(f=(-x+w)/(2*y),0<f&&f<1&&d.push(f),p=(-x-w)/(2*y),0<p&&p<1&&d.push(p))}for(var P=d.length,E=P,C,k,I;P--;)T=d[P],C=1-T,k=C*C*C*i+3*C*C*T*o+3*C*T*T*a+T*T*T*u,v[0][P]=k,I=C*C*C*s+3*C*C*T*l+3*C*T*T*c+T*T*T*h,v[1][P]=I,g[P]={X:k,Y:I};d[E]=0,d[E+1]=1,g[E]={X:i,Y:s},g[E+1]={X:u,Y:h},v[0][E]=i,v[1][E]=s,v[0][E+1]=u,v[1][E+1]=h,d.length=E+2,v[0].length=E+2,v[1].length=E+2,g.length=E+2;var D=ul.apply(null,v[0]),H=ul.apply(null,v[1]),X=hl.apply(null,v[0]),L=hl.apply(null,v[1]);return new U(D,H,X-D,L-H)},clone:function(){return new Pt(this.start,this.controlPoint1,this.controlPoint2,this.end)},closestPoint:function(t,e){return this.pointAtT(this.closestPointT(t,e))},closestPointLength:function(t,e){e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision,r=e.subdivisions===void 0?this.getSubdivisions({precision:n}):e.subdivisions,i={precision:n,subdivisions:r};return this.lengthAtT(this.closestPointT(t,i),i)},closestPointNormalizedLength:function(t,e){e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision,r=e.subdivisions===void 0?this.getSubdivisions({precision:n}):e.subdivisions,i={precision:n,subdivisions:r},s=this.closestPointLength(t,i);if(!s)return 0;var o=this.length(i);return o===0?0:s/o},closestPointT:function(t,e){e=e||{};for(var n=e.precision===void 0?this.PRECISION:e.precision,r=e.subdivisions===void 0?this.getSubdivisions({precision:n}):e.subdivisions,i,s,o,l,a,c,u,h=r.length,g=h?1/h:0,d=0;d<h;d++){var v=r[d],y=v.start.distance(t),x=v.end.distance(t),A=y+x;(!u||A<u)&&(i=v,s=d*g,o=(d+1)*g,l=y,a=x,c=v.start.distance(v.end),u=A)}for(var T=Es(10,-n);;){var f=l?ri(l-a)/l:0,p=a?ri(l-a)/a:0,m=f<T||p<T,w=l?l<c*T:!0,b=a?a<c*T:!0,P=w||b;if(m||P)return l<=a?s:o;var E=i.divide(.5);g/=2;var C=E[0].start.distance(t),k=E[0].end.distance(t),I=C+k,D=E[1].start.distance(t),H=E[1].end.distance(t),X=D+H;I<=X?(i=E[0],o-=g,l=C,a=k):(i=E[1],s+=g,l=D,a=H)}},closestPointTangent:function(t,e){return this.tangentAtT(this.closestPointT(t,e))},containsPoint:function(t,e){var n=this.toPolyline(e);return n.containsPoint(t)},divideAt:function(t,e){if(t<=0)return this.divideAtT(0);if(t>=1)return this.divideAtT(1);var n=this.tAt(t,e);return this.divideAtT(n)},divideAtLength:function(t,e){var n=this.tAtLength(t,e);return this.divideAtT(n)},divideAtT:function(t){var e=this.start,n=this.controlPoint1,r=this.controlPoint2,i=this.end;if(t<=0)return[new Pt(e,e,e,e),new Pt(e,n,r,i)];if(t>=1)return[new Pt(e,n,r,i),new Pt(i,i,i,i)];var s=this.getSkeletonPoints(t),o=s.startControlPoint1,l=s.startControlPoint2,a=s.divider,c=s.dividerControlPoint1,u=s.dividerControlPoint2;return[new Pt(e,o,l,a),new Pt(a,c,u,i)]},endpointDistance:function(){return this.start.distance(this.end)},equals:function(t){return!!t&&this.start.x===t.start.x&&this.start.y===t.start.y&&this.controlPoint1.x===t.controlPoint1.x&&this.controlPoint1.y===t.controlPoint1.y&&this.controlPoint2.x===t.controlPoint2.x&&this.controlPoint2.y===t.controlPoint2.y&&this.end.x===t.end.x&&this.end.y===t.end.y},getSkeletonPoints:function(t){var e=this.start,n=this.controlPoint1,r=this.controlPoint2,i=this.end;if(t<=0)return{startControlPoint1:e.clone(),startControlPoint2:e.clone(),divider:e.clone(),dividerControlPoint1:n.clone(),dividerControlPoint2:r.clone()};if(t>=1)return{startControlPoint1:n.clone(),startControlPoint2:r.clone(),divider:i.clone(),dividerControlPoint1:i.clone(),dividerControlPoint2:i.clone()};var s=new W(e,n).pointAt(t),o=new W(n,r).pointAt(t),l=new W(r,i).pointAt(t),a=new W(s,o).pointAt(t),c=new W(o,l).pointAt(t),u=new W(a,c).pointAt(t),h={startControlPoint1:s,startControlPoint2:a,divider:u,dividerControlPoint1:c,dividerControlPoint2:l};return h},getSubdivisions:function(t){t=t||{};var e=t.precision===void 0?this.PRECISION:t.precision,n=this.start,r=this.controlPoint1,i=this.controlPoint2,s=this.end,o=[new Pt(n,r,i,s)];if(e===0)return o;var l=!this.isDifferentiable();if(l)return o;var a=this.endpointDistance(),c=Es(10,-e),u=2,h=r.cross(n,s)===0&&i.cross(n,s)===0;h&&(u=2*e);for(var g=0;;){g+=1;for(var d=[],v=o.length,y=0;y<v;y++){var x=o[y],A=x.divide(.5);d.push(A[0],A[1])}for(var T=0,f=d.length,p=0;p<f;p++){var m=d[p];T+=m.endpointDistance()}if(g>=u){var w=T!==0?(T-a)/T:0;if(w<c)return d}o=d,a=T}},isDifferentiable:function(){var t=this.start,e=this.controlPoint1,n=this.controlPoint2,r=this.end;return!(t.equals(e)&&e.equals(n)&&n.equals(r))},length:function(t){t=t||{};for(var e=t.precision===void 0?this.PRECISION:t.precision,n=t.subdivisions===void 0?this.getSubdivisions({precision:e}):t.subdivisions,r=0,i=n.length,s=0;s<i;s++){var o=n[s];r+=o.endpointDistance()}return r},lengthAtT:function(t,e){if(t<=0)return 0;e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision,r=this.divide(t)[0],i=r.length({precision:n});return i},pointAt:function(t,e){if(t<=0)return this.start.clone();if(t>=1)return this.end.clone();var n=this.tAt(t,e);return this.pointAtT(n)},pointAtLength:function(t,e){var n=this.tAtLength(t,e);return this.pointAtT(n)},pointAtT:function(t){return t<=0?this.start.clone():t>=1?this.end.clone():this.getSkeletonPoints(t).divider},PRECISION:3,round:function(t){return this.start.round(t),this.controlPoint1.round(t),this.controlPoint2.round(t),this.end.round(t),this},scale:function(t,e,n){return this.start.scale(t,e,n),this.controlPoint1.scale(t,e,n),this.controlPoint2.scale(t,e,n),this.end.scale(t,e,n),this},tangentAt:function(t,e){if(!this.isDifferentiable())return null;t<0?t=0:t>1&&(t=1);var n=this.tAt(t,e);return this.tangentAtT(n)},tangentAtLength:function(t,e){if(!this.isDifferentiable())return null;var n=this.tAtLength(t,e);return this.tangentAtT(n)},tangentAtT:function(t){if(!this.isDifferentiable())return null;t<0?t=0:t>1&&(t=1);var e=this.getSkeletonPoints(t),n=e.startControlPoint2,r=e.dividerControlPoint1,i=e.divider,s=new W(n,r);return s.translate(i.x-n.x,i.y-n.y),s},tAt:function(t,e){if(t<=0)return 0;if(t>=1)return 1;e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision,r=e.subdivisions===void 0?this.getSubdivisions({precision:n}):e.subdivisions,i={precision:n,subdivisions:r},s=this.length(i),o=s*t;return this.tAtLength(o,i)},tAtLength:function(t,e){var n=!0;t<0&&(n=!1,t=-t),e=e||{};for(var r=e.precision===void 0?this.PRECISION:e.precision,i=e.subdivisions===void 0?this.getSubdivisions({precision:r}):e.subdivisions,s={precision:r,subdivisions:i},o,l,a,c,u,h=0,g=i.length,d=1/g,v=0;v<g;v++){var y=n?v:g-1-v,x=i[v],A=x.endpointDistance();if(t<=h+A){o=x,l=y*d,a=(y+1)*d,c=n?t-h:A+h-t,u=n?A+h-t:t-h;break}h+=A}if(!o)return n?1:0;for(var T=this.length(s),f=Es(10,-r);;){var p;if(p=T!==0?c/T:0,p<f)return l;if(p=T!==0?u/T:0,p<f)return a;var m,w,b=o.divide(.5);d/=2;var P=b[0].endpointDistance(),E=b[1].endpointDistance();c<=P?(o=b[0],a-=d,m=c,w=P-m):(o=b[1],l+=d,m=c-P,w=E-m),c=m,u=w}},toPoints:function(t){t=t||{};for(var e=t.precision===void 0?this.PRECISION:t.precision,n=t.subdivisions===void 0?this.getSubdivisions({precision:e}):t.subdivisions,r=[n[0].start.clone()],i=n.length,s=0;s<i;s++){var o=n[s];r.push(o.end.clone())}return r},toPolyline:function(t){return new Lt(this.toPoints(t))},toString:function(){return this.start+" "+this.controlPoint1+" "+this.controlPoint2+" "+this.end},translate:function(t,e){return this.start.translate(t,e),this.controlPoint1.translate(t,e),this.controlPoint2.translate(t,e),this.end.translate(t,e),this}},Pt.prototype.divide=Pt.prototype.divideAtT;function ir(t){var e,n,r=[];for(n=arguments.length,e=1;e<n;e++)r.push(arguments[e]);if(!t)throw new Error("Missing a parent object.");var i=Object.create(t);for(n=r.length,e=0;e<n;e++){var s=r[e],o,l;for(l in s)s.hasOwnProperty(l)&&(delete i[l],o=Object.getOwnPropertyDescriptor(s,l),Object.defineProperty(i,l,o))}return i}const Z=function(t){if(!(this instanceof Z))return new Z(t);if(typeof t=="string")return new Z.parse(t);this.segments=[];var e,n;if(t)if(Array.isArray(t)&&t.length!==0)if(t=t.reduce(function(l,a){return l.concat(a)},[]),n=t.length,t[0].isSegment)for(e=0;e<n;e++){var r=t[e];this.appendSegment(r)}else{var i=null;for(e=0;e<n;e++){var s=t[e];if(!(s instanceof W||s instanceof Pt))throw new Error("Cannot construct a path segment from the provided object.");e===0&&this.appendSegment(Z.createSegment("M",s.start)),i&&!i.end.equals(s.start)&&this.appendSegment(Z.createSegment("M",s.start)),s instanceof W?this.appendSegment(Z.createSegment("L",s.end)):s instanceof Pt&&this.appendSegment(Z.createSegment("C",s.controlPoint1,s.controlPoint2,s.end)),i=s}}else if(t.isSegment)this.appendSegment(t);else if(t instanceof W)this.appendSegment(Z.createSegment("M",t.start)),this.appendSegment(Z.createSegment("L",t.end));else if(t instanceof Pt)this.appendSegment(Z.createSegment("M",t.start)),this.appendSegment(Z.createSegment("C",t.controlPoint1,t.controlPoint2,t.end));else if(t instanceof Lt){if(!(t.points&&t.points.length!==0))return;for(n=t.points.length,e=0;e<n;e++){var o=t.points[e];e===0?this.appendSegment(Z.createSegment("M",o)):this.appendSegment(Z.createSegment("L",o))}}else throw new Error("Cannot construct a path from the provided object.")};Z.parse=function(t){if(!t)return new Z;for(var e=new Z,n=/(?:[a-zA-Z] *)(?:(?:-?\d+(?:\.\d+)?(?:e[-+]?\d+)? *,? *)|(?:-?\.\d+ *,? *))+|(?:[a-zA-Z] *)(?! |\d|-|\.)/g,r=t.match(n),i=r.length,s=0;s<i;s++){var o=r[s],l=/(?:[a-zA-Z])|(?:(?:-?\d+(?:\.\d+)?(?:e[-+]?\d+)?))|(?:(?:-?\.\d+))/g,a=o.match(l),c=Z.createSegment.apply(this,a);e.appendSegment(c)}return e},Z.createSegment=function(t){if(!t)throw new Error("Type must be provided.");var e=Z.segmentTypes[t];if(!e)throw new Error(t+" is not a recognized path segment type.");for(var n=[],r=arguments.length,i=1;i<r;i++)n.push(arguments[i]);return Le(e,n)},Z.prototype={type:ft.Path,appendSegment:function(t){var e=this.segments,n=e.length,r,i=n!==0?e[n-1]:null,s=null;if(Array.isArray(t)){if(t=t.reduce(function(c,u){return c.concat(u)},[]),!t[0].isSegment)throw new Error("Segments required.");for(var o=t.length,l=0;l<o;l++){var a=t[l];r=this.prepareSegment(a,i,s),e.push(r),i=r}}else{if(!t||!t.isSegment)throw new Error("Segment required.");r=this.prepareSegment(t,i,s),e.push(r)}},bbox:function(){var t=this.segments,e=t.length;if(e===0)return null;for(var n,r=0;r<e;r++){var i=t[r];if(i.isVisible){var s=i.bbox();n=n?n.union(s):s}}if(n)return n;var o=t[e-1];return new U(o.end.x,o.end.y,0,0)},clone:function(){for(var t=this.segments,e=t.length,n=new Z,r=0;r<e;r++){var i=t[r].clone();n.appendSegment(i)}return n},closestPoint:function(t,e){var n=this.closestPointT(t,e);return n?this.pointAtT(n):null},closestPointLength:function(t,e){e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision,r=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:n}):e.segmentSubdivisions,i={precision:n,segmentSubdivisions:r},s=this.closestPointT(t,i);return s?this.lengthAtT(s,i):0},closestPointNormalizedLength:function(t,e){e=e||{};var n=e.precision===void 0?this.PRECISION:e.precision,r=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:n}):e.segmentSubdivisions,i={precision:n,segmentSubdivisions:r},s=this.closestPointLength(t,i);if(s===0)return 0;var o=this.length(i);return o===0?0:s/o},closestPointT:function(t,e){var n=this.segments,r=n.length;if(r===0)return null;e=e||{};for(var i=e.precision===void 0?this.PRECISION:e.precision,s=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions,o,l=1/0,a=0;a<r;a++){var c=n[a],u=s[a];if(c.isVisible){var h=c.closestPointT(t,{precision:i,subdivisions:u}),g=c.pointAtT(h),d=new W(g,t).squaredLength();d<l&&(o={segmentIndex:a,value:h},l=d)}}return o||{segmentIndex:r-1,value:1}},closestPointTangent:function(t,e){var n=this.segments,r=n.length;if(r===0)return null;e=e||{};for(var i=e.precision===void 0?this.PRECISION:e.precision,s=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions,o,l=1/0,a=0;a<r;a++){var c=n[a],u=s[a];if(c.isDifferentiable()){var h=c.closestPointT(t,{precision:i,subdivisions:u}),g=c.pointAtT(h),d=new W(g,t).squaredLength();d<l&&(o=c.tangentAtT(h),l=d)}}return o||null},containsPoint:function(t,e){var n=this.toPolylines(e);if(!n)return!1;for(var r=n.length,i=0,s=0;s<r;s++){var o=n[s];o.containsPoint(t)&&i++}return i%2===1},divideAt:function(t,e){var n=this.segments,r=n.length;if(r===0)return null;t<0&&(t=0),t>1&&(t=1),e=e||{};var i=e.precision===void 0?this.PRECISION:e.precision,s=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions,o={precision:i,segmentSubdivisions:s},l=this.length(o),a=l*t;return this.divideAtLength(a,o)},divideAtLength:function(t,e){var n=this.segments.length;if(n===0)return null;var r=!0;t<0&&(r=!1,t=-t),e=e||{};var i=e.precision===void 0?this.PRECISION:e.precision,s=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions,o,l,a=0,c,u,h,g,d;for(o=0;o<n;o++){var v=r?o:n-1-o;l=this.getSegment(v);var y=s[v],x=l.length({precision:i,subdivisions:y});if(l.isDifferentiable()&&(h=l,g=v,t<=a+x)){u=v,c=l.divideAtLength((r?1:-1)*(t-a),{precision:i,subdivisions:y});break}a+=x}if(!h)return null;c||(u=g,d=r?1:0,c=h.divideAtT(d));var A=this.clone();A.replaceSegment(u,c);var T=u,f=u+1,p=u+2;c[0].isDifferentiable()||(A.removeSegment(T),f-=1,p-=1);var m=A.getSegment(f).start;A.insertSegment(f,Z.createSegment("M",m)),p+=1,c[1].isDifferentiable()||(A.removeSegment(p-1),p-=1);var w=p-T-1;for(o=p;o<A.segments.length;o++){var b=this.getSegment(o-w);if(l=A.getSegment(o),l.type==="Z"&&!b.subpathStartSegment.end.equals(l.subpathStartSegment.end)){var P=Z.createSegment("L",b.end);A.replaceSegment(o,P)}}var E=new Z(A.segments.slice(0,f)),C=new Z(A.segments.slice(f));return[E,C]},equals:function(t){if(!t)return!1;var e=this.segments,n=t.segments,r=e.length;if(n.length!==r)return!1;for(var i=0;i<r;i++){var s=e[i],o=n[i];if(s.type!==o.type||!s.equals(o))return!1}return!0},getSegment:function(t){var e=this.segments,n=e.length;if(n===0)throw new Error("Path has no segments.");if(t<0&&(t=n+t),t>=n||t<0)throw new Error("Index out of range.");return e[t]},getSegmentSubdivisions:function(t){var e=this.segments,n=e.length;t=t||{};for(var r=t.precision===void 0?this.PRECISION:t.precision,i=[],s=0;s<n;s++){var o=e[s],l=o.getSubdivisions({precision:r});i.push(l)}return i},getSubpaths:function(){const e=this.clone().validate().segments,n=e.length,r=[];for(let i=0;i<n;i++){const s=e[i];s.isSubpathStart?r.push(new Z(s)):r[r.length-1].appendSegment(s)}return r},insertSegment:function(t,e){var n=this.segments,r=n.length;if(t<0&&(t=r+t+1),t>r||t<0)throw new Error("Index out of range.");var i,s=null,o=null;if(r!==0&&(t>=1?(s=n[t-1],o=s.nextSegment):o=n[0]),Array.isArray(e)){if(e=e.reduce(function(u,h){return u.concat(h)},[]),!e[0].isSegment)throw new Error("Segments required.");for(var l=e.length,a=0;a<l;a++){var c=e[a];i=this.prepareSegment(c,s,o),n.splice(t+a,0,i),s=i}}else{if(!e||!e.isSegment)throw new Error("Segment required.");i=this.prepareSegment(e,s,o),n.splice(t,0,i)}},intersectionWithLine:function(t,e){var n=null,r=this.toPolylines(e);if(!r)return null;for(var i=0,s=r.length;i<s;i++){var o=r[i],l=t.intersect(o);l&&(n||(n=[]),Array.isArray(l)?Array.prototype.push.apply(n,l):n.push(l))}return n},isDifferentiable:function(){for(var t=this.segments,e=t.length,n=0;n<e;n++){var r=t[n];if(r.isDifferentiable())return!0}return!1},isValid:function(){var t=this.segments,e=t.length===0||t[0].type==="M";return e},length:function(t){var e=this.segments,n=e.length;if(n===0)return 0;t=t||{};for(var r=t.precision===void 0?this.PRECISION:t.precision,i=t.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:r}):t.segmentSubdivisions,s=0,o=0;o<n;o++){var l=e[o],a=i[o];s+=l.length({subdivisions:a})}return s},lengthAtT:function(t,e){var n=this.segments,r=n.length;if(r===0)return 0;var i=t.segmentIndex;if(i<0)return 0;var s=t.value;i>=r?(i=r-1,s=1):s<0?s=0:s>1&&(s=1),e=e||{};for(var o=e.precision===void 0?this.PRECISION:e.precision,l=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:o}):e.segmentSubdivisions,a,c=0,u=0;u<i;u++){var h=n[u];a=l[u],c+=h.length({precisison:o,subdivisions:a})}return h=n[i],a=l[i],c+=h.lengthAtT(s,{precisison:o,subdivisions:a}),c},pointAt:function(t,e){var n=this.segments,r=n.length;if(r===0)return null;if(t<=0)return this.start.clone();if(t>=1)return this.end.clone();e=e||{};var i=e.precision===void 0?this.PRECISION:e.precision,s=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions,o={precision:i,segmentSubdivisions:s},l=this.length(o),a=l*t;return this.pointAtLength(a,o)},pointAtLength:function(t,e){var n=this.segments,r=n.length;if(r===0)return null;if(t===0)return this.start.clone();var i=!0;t<0&&(i=!1,t=-t),e=e||{};for(var s=e.precision===void 0?this.PRECISION:e.precision,o=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:s}):e.segmentSubdivisions,l,a=0,c=0;c<r;c++){var u=i?c:r-1-c,h=n[u],g=o[u],d=h.length({precision:s,subdivisions:g});if(h.isVisible){if(t<=a+d)return h.pointAtLength((i?1:-1)*(t-a),{precision:s,subdivisions:g});l=h}a+=d}if(l)return i?l.end:l.start;var v=n[r-1];return v.end.clone()},pointAtT:function(t){var e=this.segments,n=e.length;if(n===0)return null;var r=t.segmentIndex;if(r<0)return e[0].pointAtT(0);if(r>=n)return e[n-1].pointAtT(1);var i=t.value;return i<0?i=0:i>1&&(i=1),e[r].pointAtT(i)},PRECISION:3,prepareSegment:function(t,e,n){t.previousSegment=e,t.nextSegment=n,e&&(e.nextSegment=t),n&&(n.previousSegment=t);var r=t;return t.isSubpathStart&&(t.subpathStartSegment=t,r=n),r&&this.updateSubpathStartSegment(r),t},removeSegment:function(t){var e=this.segments,n=e.length;if(n===0)throw new Error("Path has no segments.");if(t<0&&(t=n+t),t>=n||t<0)throw new Error("Index out of range.");var r=e.splice(t,1)[0],i=r.previousSegment,s=r.nextSegment;i&&(i.nextSegment=s),s&&(s.previousSegment=i),r.isSubpathStart&&s&&this.updateSubpathStartSegment(s)},replaceSegment:function(t,e){var n=this.segments,r=n.length;if(r===0)throw new Error("Path has no segments.");if(t<0&&(t=r+t),t>=r||t<0)throw new Error("Index out of range.");var i,s=n[t],o=s.previousSegment,l=s.nextSegment,a=s.isSubpathStart;if(Array.isArray(e)){if(e=e.reduce(function(g,d){return g.concat(d)},[]),!e[0].isSegment)throw new Error("Segments required.");n.splice(t,1);for(var c=e.length,u=0;u<c;u++){var h=e[u];i=this.prepareSegment(h,o,l),n.splice(t+u,0,i),o=i,a&&i.isSubpathStart&&(a=!1)}}else{if(!e||!e.isSegment)throw new Error("Segment required.");i=this.prepareSegment(e,o,l),n.splice(t,1,i),a&&i.isSubpathStart&&(a=!1)}a&&l&&this.updateSubpathStartSegment(l)},round:function(t){for(var e=this.segments,n=e.length,r=0;r<n;r++){var i=e[r];i.round(t)}return this},scale:function(t,e,n){for(var r=this.segments,i=r.length,s=0;s<i;s++){var o=r[s];o.scale(t,e,n)}return this},segmentAt:function(t,e){var n=this.segmentIndexAt(t,e);return n?this.getSegment(n):null},segmentAtLength:function(t,e){var n=this.segmentIndexAtLength(t,e);return n?this.getSegment(n):null},segmentIndexAt:function(t,e){var n=this.segments,r=n.length;if(r===0)return null;t<0&&(t=0),t>1&&(t=1),e=e||{};var i=e.precision===void 0?this.PRECISION:e.precision,s=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions,o={precision:i,segmentSubdivisions:s},l=this.length(o),a=l*t;return this.segmentIndexAtLength(a,o)},segmentIndexAtLength:function(t,e){var n=this.segments,r=n.length;if(r===0)return null;var i=!0;t<0&&(i=!1,t=-t),e=e||{};for(var s=e.precision===void 0?this.PRECISION:e.precision,o=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:s}):e.segmentSubdivisions,l=null,a=0,c=0;c<r;c++){var u=i?c:r-1-c,h=n[u],g=o[u],d=h.length({precision:s,subdivisions:g});if(h.isVisible){if(t<=a+d)return u;l=u}a+=d}return l},serialize:function(){if(!this.isValid())throw new Error("Invalid path segments.");return this.toString()},tangentAt:function(t,e){var n=this.segments,r=n.length;if(r===0)return null;t<0&&(t=0),t>1&&(t=1),e=e||{};var i=e.precision===void 0?this.PRECISION:e.precision,s=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:i}):e.segmentSubdivisions,o={precision:i,segmentSubdivisions:s},l=this.length(o),a=l*t;return this.tangentAtLength(a,o)},tangentAtLength:function(t,e){var n=this.segments,r=n.length;if(r===0)return null;var i=!0;t<0&&(i=!1,t=-t),e=e||{};for(var s=e.precision===void 0?this.PRECISION:e.precision,o=e.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:s}):e.segmentSubdivisions,l,a=0,c=0;c<r;c++){var u=i?c:r-1-c,h=n[u],g=o[u],d=h.length({precision:s,subdivisions:g});if(h.isDifferentiable()){if(t<=a+d)return h.tangentAtLength((i?1:-1)*(t-a),{precision:s,subdivisions:g});l=h}a+=d}if(l){var v=i?1:0;return l.tangentAtT(v)}return null},tangentAtT:function(t){var e=this.segments,n=e.length;if(n===0)return null;var r=t.segmentIndex;if(r<0)return e[0].tangentAtT(0);if(r>=n)return e[n-1].tangentAtT(1);var i=t.value;return i<0?i=0:i>1&&(i=1),e[r].tangentAtT(i)},toPoints:function(t){var e=this.segments,n=e.length;if(n===0)return null;t=t||{};for(var r=t.precision===void 0?this.PRECISION:t.precision,i=t.segmentSubdivisions===void 0?this.getSegmentSubdivisions({precision:r}):t.segmentSubdivisions,s=[],o=[],l=0;l<n;l++){var a=e[l];if(a.isVisible){var c=i[l];if(c.length>0){var u=c.map(function(h){return h.start});Array.prototype.push.apply(o,u)}else o.push(a.start)}else o.length>0&&(o.push(e[l-1].end),s.push(o),o=[])}return o.length>0&&(o.push(this.end),s.push(o)),s},toPolylines:function(t){var e=[],n=this.toPoints(t);if(!n)return null;for(var r=0,i=n.length;r<i;r++)e.push(new Lt(n[r]));return e},toString:function(){for(var t=this.segments,e=t.length,n="",r=0;r<e;r++){var i=t[r];n+=i.serialize()+" "}return n.trim()},translate:function(t,e){for(var n=this.segments,r=n.length,i=0;i<r;i++){var s=n[i];s.translate(t,e)}return this},updateSubpathStartSegment:function(t){for(var e=t.previousSegment;t&&!t.isSubpathStart;)e?t.subpathStartSegment=e.subpathStartSegment:t.subpathStartSegment=null,e=t,t=t.nextSegment},validate:function(){return this.isValid()||this.insertSegment(0,Z.createSegment("M",0,0)),this}},Object.defineProperty(Z.prototype,"start",{configurable:!0,enumerable:!0,get:function(){var t=this.segments,e=t.length;if(e===0)return null;for(var n=0;n<e;n++){var r=t[n];if(r.isVisible)return r.start}return t[e-1].end}}),Object.defineProperty(Z.prototype,"end",{configurable:!0,enumerable:!0,get:function(){var t=this.segments,e=t.length;if(e===0)return null;for(var n=e-1;n>=0;n--){var r=t[n];if(r.isVisible)return r.end}return t[e-1].end}});function Le(t,e){return e.unshift(null),new(Function.prototype.bind.apply(t,e))}var dn={bbox:function(){throw new Error("Declaration missing for virtual function.")},clone:function(){throw new Error("Declaration missing for virtual function.")},closestPoint:function(){throw new Error("Declaration missing for virtual function.")},closestPointLength:function(){throw new Error("Declaration missing for virtual function.")},closestPointNormalizedLength:function(){throw new Error("Declaration missing for virtual function.")},closestPointT:function(t){if(this.closestPointNormalizedLength)return this.closestPointNormalizedLength(t);throw new Error("Neither closestPointT() nor closestPointNormalizedLength() function is implemented.")},closestPointTangent:function(){throw new Error("Declaration missing for virtual function.")},divideAt:function(){throw new Error("Declaration missing for virtual function.")},divideAtLength:function(){throw new Error("Declaration missing for virtual function.")},divideAtT:function(t){if(this.divideAt)return this.divideAt(t);throw new Error("Neither divideAtT() nor divideAt() function is implemented.")},equals:function(){throw new Error("Declaration missing for virtual function.")},getSubdivisions:function(){throw new Error("Declaration missing for virtual function.")},isDifferentiable:function(){throw new Error("Declaration missing for virtual function.")},isSegment:!0,isSubpathStart:!1,isVisible:!0,length:function(){throw new Error("Declaration missing for virtual function.")},lengthAtT:function(t){if(t<=0)return 0;var e=this.length();return t>=1?e:e*t},nextSegment:null,pointAt:function(){throw new Error("Declaration missing for virtual function.")},pointAtLength:function(){throw new Error("Declaration missing for virtual function.")},pointAtT:function(t){if(this.pointAt)return this.pointAt(t);throw new Error("Neither pointAtT() nor pointAt() function is implemented.")},previousSegment:null,round:function(){throw new Error("Declaration missing for virtual function.")},subpathStartSegment:null,scale:function(){throw new Error("Declaration missing for virtual function.")},serialize:function(){throw new Error("Declaration missing for virtual function.")},tangentAt:function(){throw new Error("Declaration missing for virtual function.")},tangentAtLength:function(){throw new Error("Declaration missing for virtual function.")},tangentAtT:function(t){if(this.tangentAt)return this.tangentAt(t);throw new Error("Neither tangentAtT() nor tangentAt() function is implemented.")},toString:function(){throw new Error("Declaration missing for virtual function.")},translate:function(){throw new Error("Declaration missing for virtual function.")}};Object.defineProperty(dn,"end",{configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(dn,"start",{configurable:!0,enumerable:!0,get:function(){if(!this.previousSegment)throw new Error("Missing previous segment. (This segment cannot be the first segment of a path; OR segment has not yet been added to a path.)");return this.previousSegment.end}}),Object.defineProperty(dn,"type",{configurable:!0,enumerable:!0,get:function(){throw new Error("Bad segment declaration. No type specified.")}});var Ht=function(){for(var t=[],e=arguments.length,n=0;n<e;n++)t.push(arguments[n]);if(!(this instanceof Ht))return Le(Ht,t);if(e===0)throw new Error("Lineto constructor expects a line, 1 point, or 2 coordinates (none provided).");var r;if(t[0]instanceof W){if(e===1)return this.end=t[0].end.clone(),this;throw new Error("Lineto constructor expects a line, 1 point, or 2 coordinates ("+e+" lines provided).")}else if(typeof t[0]=="string"||typeof t[0]=="number"){if(e===2)return this.end=new S(+t[0],+t[1]),this;if(e<2)throw new Error("Lineto constructor expects a line, 1 point, or 2 coordinates ("+e+" coordinates provided).");var i;for(r=[],n=0;n<e;n+=2)i=t.slice(n,n+2),r.push(Le(Ht,i));return r}else{if(e===1)return this.end=new S(t[0]),this;var s;for(r=[],n=0;n<e;n+=1)s=t[n],r.push(new Ht(s));return r}},fl={clone:function(){return new Ht(this.end)},divideAt:function(t){var e=new W(this.start,this.end),n=e.divideAt(t);return[new Ht(n[0]),new Ht(n[1])]},divideAtLength:function(t){var e=new W(this.start,this.end),n=e.divideAtLength(t);return[new Ht(n[0]),new Ht(n[1])]},getSubdivisions:function(){return[]},isDifferentiable:function(){return this.previousSegment?!this.start.equals(this.end):!1},round:function(t){return this.end.round(t),this},scale:function(t,e,n){return this.end.scale(t,e,n),this},serialize:function(){var t=this.end;return this.type+" "+t.x+" "+t.y},toString:function(){return this.type+" "+this.start+" "+this.end},translate:function(t,e){return this.end.translate(t,e),this}};Object.defineProperty(fl,"type",{configurable:!0,enumerable:!0,value:"L"}),Ht.prototype=ir(dn,W.prototype,fl);var se=function(){for(var t=[],e=arguments.length,n=0;n<e;n++)t.push(arguments[n]);if(!(this instanceof se))return Le(se,t);if(e===0)throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates (none provided).");var r;if(t[0]instanceof Pt){if(e===1)return this.controlPoint1=t[0].controlPoint1.clone(),this.controlPoint2=t[0].controlPoint2.clone(),this.end=t[0].end.clone(),this;throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates ("+e+" curves provided).")}else if(typeof t[0]=="string"||typeof t[0]=="number"){if(e===6)return this.controlPoint1=new S(+t[0],+t[1]),this.controlPoint2=new S(+t[2],+t[3]),this.end=new S(+t[4],+t[5]),this;if(e<6)throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates ("+e+" coordinates provided).");var i;for(r=[],n=0;n<e;n+=6)i=t.slice(n,n+6),r.push(Le(se,i));return r}else{if(e===3)return this.controlPoint1=new S(t[0]),this.controlPoint2=new S(t[1]),this.end=new S(t[2]),this;if(e<3)throw new Error("Curveto constructor expects a curve, 3 points, or 6 coordinates ("+e+" points provided).");var s;for(r=[],n=0;n<e;n+=3)s=t.slice(n,n+3),r.push(Le(se,s));return r}},dl={clone:function(){return new se(this.controlPoint1,this.controlPoint2,this.end)},divideAt:function(t,e){var n=new Pt(this.start,this.controlPoint1,this.controlPoint2,this.end),r=n.divideAt(t,e);return[new se(r[0]),new se(r[1])]},divideAtLength:function(t,e){var n=new Pt(this.start,this.controlPoint1,this.controlPoint2,this.end),r=n.divideAtLength(t,e);return[new se(r[0]),new se(r[1])]},divideAtT:function(t){var e=new Pt(this.start,this.controlPoint1,this.controlPoint2,this.end),n=e.divideAtT(t);return[new se(n[0]),new se(n[1])]},isDifferentiable:function(){if(!this.previousSegment)return!1;var t=this.start,e=this.controlPoint1,n=this.controlPoint2,r=this.end;return!(t.equals(e)&&e.equals(n)&&n.equals(r))},round:function(t){return this.controlPoint1.round(t),this.controlPoint2.round(t),this.end.round(t),this},scale:function(t,e,n){return this.controlPoint1.scale(t,e,n),this.controlPoint2.scale(t,e,n),this.end.scale(t,e,n),this},serialize:function(){var t=this.controlPoint1,e=this.controlPoint2,n=this.end;return this.type+" "+t.x+" "+t.y+" "+e.x+" "+e.y+" "+n.x+" "+n.y},toString:function(){return this.type+" "+this.start+" "+this.controlPoint1+" "+this.controlPoint2+" "+this.end},translate:function(t,e){return this.controlPoint1.translate(t,e),this.controlPoint2.translate(t,e),this.end.translate(t,e),this}};Object.defineProperty(dl,"type",{configurable:!0,enumerable:!0,value:"C"}),se.prototype=ir(dn,Pt.prototype,dl);var gn=function(){for(var t=[],e=arguments.length,n=0;n<e;n++)t.push(arguments[n]);if(!(this instanceof gn))return Le(gn,t);if(e===0)throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates (none provided).");var r;if(t[0]instanceof W){if(e===1)return this.end=t[0].end.clone(),this;throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates ("+e+" lines provided).")}else if(t[0]instanceof Pt){if(e===1)return this.end=t[0].end.clone(),this;throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates ("+e+" curves provided).")}else if(typeof t[0]=="string"||typeof t[0]=="number"){if(e===2)return this.end=new S(+t[0],+t[1]),this;if(e<2)throw new Error("Moveto constructor expects a line, a curve, 1 point, or 2 coordinates ("+e+" coordinates provided).");var i;for(r=[],n=0;n<e;n+=2)i=t.slice(n,n+2),n===0?r.push(Le(gn,i)):r.push(Le(Ht,i));return r}else{if(e===1)return this.end=new S(t[0]),this;var s;for(r=[],n=0;n<e;n+=1)s=t[n],n===0?r.push(new gn(s)):r.push(new Ht(s));return r}},Cs={bbox:function(){return null},clone:function(){return new gn(this.end)},closestPoint:function(){return this.end.clone()},closestPointNormalizedLength:function(){return 0},closestPointLength:function(){return 0},closestPointT:function(){return 1},closestPointTangent:function(){return null},divideAt:function(){return[this.clone(),this.clone()]},divideAtLength:function(){return[this.clone(),this.clone()]},equals:function(t){return this.end.equals(t.end)},getSubdivisions:function(){return[]},isDifferentiable:function(){return!1},isSubpathStart:!0,isVisible:!1,length:function(){return 0},lengthAtT:function(){return 0},pointAt:function(){return this.end.clone()},pointAtLength:function(){return this.end.clone()},pointAtT:function(){return this.end.clone()},round:function(t){return this.end.round(t),this},scale:function(t,e,n){return this.end.scale(t,e,n),this},serialize:function(){var t=this.end;return this.type+" "+t.x+" "+t.y},tangentAt:function(){return null},tangentAtLength:function(){return null},tangentAtT:function(){return null},toString:function(){return this.type+" "+this.end},translate:function(t,e){return this.end.translate(t,e),this}};Object.defineProperty(Cs,"start",{configurable:!0,enumerable:!0,get:function(){throw new Error("Illegal access. Moveto segments should not need a start property.")}}),Object.defineProperty(Cs,"type",{configurable:!0,enumerable:!0,value:"M"}),gn.prototype=ir(dn,Cs);var kn=function(){for(var t=[],e=arguments.length,n=0;n<e;n++)t.push(arguments[n]);if(!(this instanceof kn))return Le(kn,t);if(e>0)throw new Error("Closepath constructor expects no arguments.");return this},Ls={clone:function(){return new kn},divideAt:function(t){var e=new W(this.start,this.end),n=e.divideAt(t);return[n[1].isDifferentiable()?new Ht(n[0]):this.clone(),new Ht(n[1])]},divideAtLength:function(t){var e=new W(this.start,this.end),n=e.divideAtLength(t);return[n[1].isDifferentiable()?new Ht(n[0]):this.clone(),new Ht(n[1])]},getSubdivisions:function(){return[]},isDifferentiable:function(){return!this.previousSegment||!this.subpathStartSegment?!1:!this.start.equals(this.end)},round:function(){return this},scale:function(){return this},serialize:function(){return this.type},toString:function(){return this.type+" "+this.start+" "+this.end},translate:function(){return this}};Object.defineProperty(Ls,"end",{configurable:!0,enumerable:!0,get:function(){if(!this.subpathStartSegment)throw new Error("Missing subpath start segment. (This segment needs a subpath start segment (e.g. Moveto); OR segment has not yet been added to a path.)");return this.subpathStartSegment.end}}),Object.defineProperty(Ls,"type",{configurable:!0,enumerable:!0,value:"Z"}),kn.prototype=ir(dn,W.prototype,Ls);var Bg=Z.segmentTypes={L:Ht,C:se,M:gn,Z:kn,z:kn};Z.regexSupportedData=new RegExp("^[\\s\\d"+Object.keys(Bg).join("")+",.]*$"),Z.isDataSupported=function(t){return typeof t!="string"?!1:this.regexSupportedData.test(t)};const Gg={curveThroughPoints:function(t){return console.warn("deprecated"),new Z(Pt.throughPoints(t)).serialize()},getCurveControlPoints:function(t){console.warn("deprecated");var e=[],n=[],r=t.length-1,i;if(r==1)return e[0]=new S((2*t[0].x+t[1].x)/3,(2*t[0].y+t[1].y)/3),n[0]=new S(2*e[0].x-t[0].x,2*e[0].y-t[0].y),[e,n];var s=[];for(i=1;i<r-1;i++)s[i]=4*t[i].x+2*t[i+1].x;s[0]=t[0].x+2*t[1].x,s[r-1]=(8*t[r-1].x+t[r].x)/2;var o=this.getFirstControlPoints(s);for(i=1;i<r-1;++i)s[i]=4*t[i].y+2*t[i+1].y;s[0]=t[0].y+2*t[1].y,s[r-1]=(8*t[r-1].y+t[r].y)/2;var l=this.getFirstControlPoints(s);for(i=0;i<r;i++)e.push(new S(o[i],l[i])),i<r-1?n.push(new S(2*t[i+1].x-o[i+1],2*t[i+1].y-l[i+1])):n.push(new S((t[r].x+o[r-1])/2,(t[r].y+l[r-1])/2));return[e,n]},getCurveDivider:function(t,e,n,r){console.warn("deprecated");var i=new Pt(t,e,n,r);return function(o){var l=i.divide(o);return[{p0:l[0].start,p1:l[0].controlPoint1,p2:l[0].controlPoint2,p3:l[0].end},{p0:l[1].start,p1:l[1].controlPoint1,p2:l[1].controlPoint2,p3:l[1].end}]}},getFirstControlPoints:function(t){console.warn("deprecated");var e=t.length,n=[],r=[],i=2;n[0]=t[0]/i;for(var s=1;s<e;s++)r[s]=1/i,i=(s<e-1?4:3.5)-r[s],n[s]=(t[s]-n[s-1])/i;for(s=1;s<e;s++)n[e-s-1]-=r[e-s]*n[e-s];return n},getInversionSolver:function(t,e,n,r){console.warn("deprecated");var i=new Pt(t,e,n,r);return function(o){return i.closestPointT(o)}}},ne=function(t){if(!(this instanceof ne))return new ne(t);if(typeof t=="string")return new ne.parse(t);this.points=Array.isArray(t)?t.map(S):[]};ne.parse=function(t){return new ne(al(t))},ne.fromRect=function(t){return new ne([t.topLeft(),t.topRight(),t.bottomRight(),t.bottomLeft()])},ne.prototype=ir(Lt.prototype,{type:ft.Polygon,clone:function(){return new ne(ll(this.points))},convexHull:function(){return new ne(cl(this.points))},lengthPoints:function(){const{start:t,end:e,points:n}=this;return n.length<=1||t.equals(e)?n:[...n,t.clone()]}});function gl(t,e,n,r){switch(t.type){case ft.Line:{switch(e.type){case ft.Line:return pn(t,e)}break}case ft.Ellipse:{switch(e.type){case ft.Line:return _s(t,e);case ft.Ellipse:return pl(t,e)}break}case ft.Rect:{switch(e.type){case ft.Line:return vl(t,e);case ft.Ellipse:return ml(t,e);case ft.Rect:return Ms(t,e)}break}case ft.Polyline:{switch(e.type){case ft.Line:return ii(t,e);case ft.Ellipse:return Os(t,e);case ft.Rect:return yl(t,e);case ft.Polyline:return wl(t,e)}break}case ft.Polygon:{switch(e.type){case ft.Line:return Ns(t,e);case ft.Ellipse:return si(t,e);case ft.Rect:return bl(t,e);case ft.Polyline:return xl(t,e);case ft.Polygon:return Al(t,e)}break}case ft.Path:{switch(e.type){case ft.Line:return Pl(t,e,n);case ft.Ellipse:return Tl(t,e,n);case ft.Rect:return Sl(t,e,n);case ft.Polyline:return ks(t,e,n);case ft.Polygon:return oi(t,e,n);case ft.Path:return El(t,e,n,r)}break}}switch(e.type){case ft.Ellipse:case ft.Rect:case ft.Polyline:case ft.Polygon:case ft.Path:return gl(e,t,r,n);default:throw Error(`The intersection for ${t} and ${e} could not be found.`)}}function pn(t,e){const n=t.start.x,r=t.start.y,i=t.end.x,s=t.end.y,o=e.start.x,l=e.start.y,a=e.end.x,c=e.end.y,u=i-n,h=s-r,g=a-o,d=c-l,v=n-o,y=r-l,x=u*d-g*h,A=(u*y-h*v)/x,T=(g*y-d*v)/x;return A>=0&&A<=1&&T>=0&&T<=1}function _s(t,e){const n=t.a,r=t.b,i=t.x,s=t.y,o=e.start.x-i,l=e.end.x-i,a=e.start.y-s,c=e.end.y-s,u=n*n,h=r*r,g=l-o,d=c-a,v=g*g/u+d*d/h,y=2*o*g/u+2*a*d/h,x=o*o/u+a*a/h-1,A=y*y-4*v*x;if(A===0){const T=-y/2/v;return T>=0&&T<=1}else if(A>0){const T=Math.sqrt(A),f=(-y+T)/2/v,p=(-y-T)/2/v;return f>=0&&f<=1||p>=0&&p<=1}return!1}function pl(t,e){return zg(t,0,e,0)}function vl(t,e){const{start:n,end:r}=e,{x:i,y:s,width:o,height:l}=t;return n.x>i+o&&r.x>i+o||n.x<i&&r.x<i||n.y>s+l&&r.y>s+l||n.y<s&&r.y<s?!1:t.containsPoint(e.start)||t.containsPoint(e.end)?!0:pn(t.topLine(),e)||pn(t.rightLine(),e)||pn(t.bottomLine(),e)||pn(t.leftLine(),e)}function ml(t,e){return Ms(t,U.fromEllipse(e))?si(ne.fromRect(t),e):!1}function Ms(t,e){return t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.y+t.height>e.y}function ii(t,e){return Cl(t,e,{interior:!1})}function Os(t,e){return Ll(t,e,{interior:!1})}function yl(t,e){return _l(t,e,{interior:!1})}function wl(t,e){return ai(t,e,{interior:!1})}function Ns(t,e){return Cl(t,e,{interior:!0})}function si(t,e){return Ll(t,e,{interior:!0})}function bl(t,e){return _l(t,e,{interior:!0})}function xl(t,e){return ai(t,e,{interior:!0})}function Al(t,e){return Is(t,e,{interior:!0})}function Pl(t,e,n){return t.getSubpaths().some(r=>{const[i]=r.toPolylines(n),{type:s}=r.getSegment(-1);return s==="Z"?Ns(i,e):ii(i,e)})}function Tl(t,e,n){return t.getSubpaths().some(r=>{const[i]=r.toPolylines(n),{type:s}=r.getSegment(-1);return s==="Z"?si(i,e):Os(i,e)})}function Sl(t,e,n){return oi(t,ne.fromRect(e),n)}function ks(t,e,n){return Ml(t,e,n,{interior:!1})}function oi(t,e,n){return Ml(t,e,n,{interior:!0})}function El(t,e,n,r){return t.getSubpaths().some(i=>{const[s]=i.toPolylines(n),{type:o}=i.getSegment(-1);return o==="Z"?oi(e,s,r):ks(e,s,r)})}function Cl(t,e,n={}){const{interior:r=!1}=n;let i;if(r){if(t.containsPoint(e.start))return!0;const{start:l,end:a,points:c}=t;i=a.equals(l)?c:[...c,l]}else i=t.points;const{length:s}=i,o=new W;for(let l=0;l<s-1;l++)if(o.start=i[l],o.end=i[l+1],pn(e,o))return!0;return!1}function Ll(t,e,n={}){const{start:r,end:i,points:s}=t;if(e.containsPoint(r))return!0;let o;const{interior:l=!1}=n;if(l){if(t.containsPoint(e.center()))return!0;o=i.equals(r)?s:[...s,r]}else o=s;const{length:a}=o,c=new W;for(let u=0;u<a-1;u++)if(c.start=o[u],c.end=o[u+1],_s(e,c))return!0;return!1}function _l(t,e,n){const r=ne.fromRect(e);return Is(t,r,n)}function Ml(t,e,n,r){return t.getSubpaths().some(i=>{const[s]=i.toPolylines(n),{type:o}=i.getSegment(-1);return o==="Z"?Is(e,s,r):ai(e,s,r)})}function ai(t,e,n={}){const{interior:r=!1}=n;let i;if(r){const{start:a}=e;if(t.containsPoint(a))return!0;i=t.clone().close()}else i=t;const s=e.points,{length:o}=s,l=new W;for(let a=0;a<o-1;a++)if(l.start=s[a],l.end=s[a+1],ii(i,l))return!0;return!1}function Is(t,e,n){return e.containsPoint(t.start)||ai(t,e.clone().close(),n)}function zg(t,e,n,r){const{cos:i,sin:s}=Math,o=s(e),l=i(e),a=s(r),c=i(r),u=o*o,h=l*l,g=o*l,d=a*a,v=c*c,y=a*c,x=t.a*t.a,A=t.b*t.b,T=n.a*n.a,f=n.b*n.b,p=x*u+A*h,m=T*d+f*v,w=x*h+A*u,b=T*v+f*d;let P=2*(A-x)*g,E=2*(f-T)*y,C=-2*p*t.x-P*t.y,k=-2*m*n.x-E*n.y,I=-P*t.x-2*w*t.y,D=-E*n.x-2*b*n.y;const H=p*t.x*t.x+w*t.y*t.y+P*t.x*t.y-x*A,X=m*n.x*n.x+b*n.y*n.y+E*n.x*n.y-T*f;P=P/2,E=E/2,C=C/2,k=k/2,I=I/2,D=D/2;const L=We([[p,P,C],[P,w,I],[C,I,H]]),_=We([[m,E,k],[E,b,D],[k,D,X]]),M=.33333333*(We([[m,P,C],[E,w,I],[k,I,H]])+We([[p,E,C],[P,b,I],[C,D,H]])+We([[p,P,k],[P,w,D],[C,I,X]])),O=.33333333*(We([[p,E,k],[P,b,D],[C,D,X]])+We([[m,P,k],[E,w,D],[k,I,X]])+We([[m,E,C],[E,b,I],[k,D,H]])),K=li([[L,M],[M,O]]),et=li([[L,O],[M,_]]),Q=li([[M,O],[O,_]]);return!(li([[2*K,et],[et,2*Q]])>0&&(O>0||M>0))}function li(t){return t[0][0]*t[1][1]-t[0][1]*t[1][0]}function We(t){return t[0][0]*t[1][1]*t[2][2]-t[0][0]*t[1][2]*t[2][1]-t[0][1]*t[1][0]*t[2][2]+t[0][1]*t[1][2]*t[2][0]+t[0][2]*t[1][0]*t[2][1]-t[0][2]*t[1][1]*t[2][0]}var Ug={__proto__:null,ellipseWithEllipse:pl,ellipseWithLine:_s,exists:gl,lineWithLine:pn,pathWithEllipse:Tl,pathWithLine:Pl,pathWithPath:El,pathWithPolygon:oi,pathWithPolyline:ks,pathWithRect:Sl,polygonWithEllipse:si,polygonWithLine:Ns,polygonWithPolygon:Al,polygonWithPolyline:xl,polygonWithRect:bl,polylineWithEllipse:Os,polylineWithLine:ii,polylineWithPolyline:wl,polylineWithRect:yl,rectWithEllipse:ml,rectWithLine:vl,rectWithRect:Ms};const vn=Ug;var Ol={__proto__:null,Curve:Pt,Ellipse:jt,Line:W,Path:Z,Point:S,Polygon:ne,Polyline:Lt,Rect:U,bezier:Gg,ellipse:kg,intersection:vn,line:fn,normalizeAngle:de,point:ti,random:ws,rect:Dg,scale:Lg,snapToGrid:hn,toDeg:Zr,toRad:ee,types:ft};const sr="[object Arguments]",Rs="[object Array]",ci="[object Boolean]",Vs="[object Date]",Nl="[object Error]",$g="[object Function]",or="[object Map]",ui="[object Number]",Hg="[object Null]",In="[object Object]",Ds="[object RegExp]",ar="[object Set]",hi="[object String]",fi="[object Symbol]",qg="[object Undefined]",Wg="[object WeakMap]",Fs="[object ArrayBuffer]",Bs="[object DataView]",kl="[object Float32Array]",Il="[object Float64Array]",Rl="[object Int8Array]",Vl="[object Int16Array]",Dl="[object Int32Array]",Fl="[object Uint8Array]",Bl="[object Uint8ClampedArray]",Gl="[object Uint16Array]",zl="[object Uint32Array]",jg={[sr]:!0,[Rs]:!0,[Fs]:!0,[Bs]:!0,[ci]:!0,[Vs]:!0,[kl]:!0,[Il]:!0,[Rl]:!0,[Vl]:!0,[Dl]:!0,[or]:!0,[ui]:!0,[In]:!0,[Ds]:!0,[ar]:!0,[hi]:!0,[fi]:!0,[Fl]:!0,[Bl]:!0,[Gl]:!0,[zl]:!0,[Nl]:!1,[$g]:!1,[Wg]:!1},Gs="\\ud800-\\udfff",Yg="\\u0300-\\u036f"+"\\ufe20-\\ufe2f"+"\\u20d0-\\u20ff"+"\\u1ab0-\\u1aff"+"\\u1dc0-\\u1dff",Ul="\\u2700-\\u27bf",$l="a-z\\xdf-\\xf6\\xf8-\\xff",Xg="\\xac\\xb1\\xd7\\xf7",Kg="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Zg="\\u2000-\\u206f",Jg=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Hl="A-Z\\xc0-\\xd6\\xd8-\\xde",Qg="\\ufe0e\\ufe0f",ql=Xg+Kg+Zg+Jg,Wl="['â]",jl=`[${ql}]`,zs=`[${Yg}]`,Yl="\\d",tp=`[${Ul}]`,Xl=`[${$l}]`,Kl=`[^${Gs}${ql+Yl+Ul+$l+Hl}]`,Us="\\ud83c[\\udffb-\\udfff]",ep=`(?:${zs}|${Us})`,Zl=`[^${Gs}]`,$s="(?:\\ud83c[\\udde6-\\uddff]){2}",Hs="[\\ud800-\\udbff][\\udc00-\\udfff]",Rn=`[${Hl}]`,np="\\u200d",Jl=`(?:${Xl}|${Kl})`,rp=`(?:${Rn}|${Kl})`,Ql=`(?:${Wl}(?:d|ll|m|re|s|t|ve))?`,tc=`(?:${Wl}(?:D|LL|M|RE|S|T|VE))?`,ec=`${ep}?`,nc=`[${Qg}]?`,ip=`(?:${np}(?:${[Zl,$s,Hs].join("|")})${nc+ec})*`,sp="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",op="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",rc=nc+ec+ip,ap=`(?:${[tp,$s,Hs].join("|")})${rc}`,lp=RegExp([`${Rn}?${Xl}+${Ql}(?=${[jl,Rn,"$"].join("|")})`,`${rp}+${tc}(?=${[jl,Rn+Jl,"$"].join("|")})`,`${Rn}?${Jl}+${Ql}`,`${Rn}+${tc}`,op,sp,`${Yl}+`,ap].join("|"),"g"),qs=200,Ws="__hash_undefined__",cp=/^\[object (?:Float(?:32|64)|(?:Int|Uint)(?:8|16|32)|Uint8Clamped)Array\]$/,up=`[${Gs}]`,hp=`(?:${[`${Zl}${zs}?`,zs,$s,Hs,up].join("|")})`,ic=RegExp(`${Us}(?=${Us})|${hp+rc}`,"g"),fp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,dp=/^\w*$/,gp=46,pp=/\\(\\)?/g,vp=RegExp(`[^.[\\]]+|\\[(?:([^"'][^[]*)|(["'])((?:(?!\\2)[^\\\\]|\\\\.)*?)\\2)\\]|(?=(?:\\.|\\[\\])(?:\\.|\\[\\]|$))`,"g"),mp=/^(?:0|[1-9]\d*)$/,yp=RegExp.prototype.test.bind(/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/),wp=4294967294,bp=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,sc=t=>ic.test(t),xp=t=>t.match(ic)||[],Ap=t=>t.split(""),oc=t=>sc(t)?xp(t):Ap(t),Pp=t=>t==null?[]:lr(t).map(e=>t[e]),lr=t=>oe(t)?ac(t):Object.keys(Object(t)),Tp=t=>{if(!pi(t))return Object.keys(t);var e=[];for(var n in Object(t))hasOwnProperty.call(t,n)&&n!="constructor"&&e.push(n);return e},ac=(t,e)=>{const n=Array.isArray(t),r=!n&&ge(t)&&pe(t)===sr,i=!n&&!r&&ur(t),s=n||r||i,o=t.length,l=new Array(s?o:0);let a=s?-1:o;for(;++a<o;)l[a]=`${a}`;for(const c in t)(e||hasOwnProperty.call(t,c))&&!(s&&(c==="length"||Js(c,o)))&&l.push(c);return l},di=(t,e)=>{let{length:n}=t;for(;n--;)if(Vn(t[n][0],e))return n;return-1},Vn=(t,e)=>t===e||t!==t&&e!==e,ge=t=>t!=null&&typeof t=="object",gi=(t,e,n)=>{if(!gt(n))return!1;const r=typeof e;return(r=="number"?oe(n)&&e>-1&&e<n.length:r=="string"&&e in n)?Vn(n[e],t):!1},Sp=t=>ge(t)&&pe(t)==ar,Ep=t=>ge(t)&&pe(t)==or,pi=t=>{const e=t&&t.constructor,n=typeof e=="function"&&e.prototype||Object.prototype;return t===n},mn=(t,e,n)=>{const r=t[e];(!(hasOwnProperty.call(t,e)&&Vn(r,n))||n===void 0&&!(e in t))&&(t[e]=n)},cr=(t,e,n)=>{let r=-1;const i=e.length;for(;++r<i;){const s=e[r];mn(n,s,t[s])}return n},oe=t=>t!=null&&typeof t!="function"&&typeof t.length=="number"&&t.length>-1&&t.length%1===0,Dn=t=>typeof t=="symbol"||ge(t)&&pe(t)===fi,Cp=t=>{const e=t.length;let n=new t.constructor(e);return e&&typeof t[0]=="string"&&hasOwnProperty.call(t,"index")&&(n.index=t.index,n.input=t.input),n},js=(t,e)=>{let n=-1;const r=t.length;for(e||(e=new Array(r));++n<r;)e[n]=t[n];return e},pe=t=>t==null?t===void 0?qg:Hg:Object.prototype.toString.call(t),Ys=t=>{const e=new t.constructor(t.byteLength);return new Uint8Array(e).set(new Uint8Array(t)),e},lc=(t,e)=>{const n=e?Ys(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)},Lp=t=>{const e=new t.constructor(t.source,/\w*$/.exec(t));return e.lastIndex=t.lastIndex,e},cc=t=>typeof t.constructor=="function"&&!pi(t)?Object.create(Object.getPrototypeOf(t)):{},Xs=t=>t==null?[]:(t=Object(t),Object.getOwnPropertySymbols(t).filter(n=>propertyIsEnumerable.call(t,n))),_p=(t,e)=>cr(t,Xs(t),e);function Mp(t,e){const n=e?Ys(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}const Op=(t,e,n)=>{const r=t.constructor;switch(e){case Fs:return Ys(t);case ci:case Vs:return new r(+t);case Bs:return Mp(t,n);case kl:case Il:case Rl:case Vl:case Dl:case Fl:case Bl:case Gl:case zl:return lc(t,n);case or:return new r(t);case ui:case hi:return new r(t);case Ds:return Lp(t);case ar:return new r;case fi:return Symbol.prototype.valueOf?Object(Symbol.prototype.valueOf.call(t)):{}}},ur=t=>ge(t)&&cp.test(pe(t)),Ks=t=>{const e=Object.keys(t);return!Array.isArray(t)&&t!=null&&e.push(...Xs(Object(t))),e},uc=t=>{const e=[];for(;t;)e.push(...Xs(t)),t=Object.getPrototypeOf(Object(t));return e},hc=t=>{const e=[];for(const n in t)e.push(n);return Array.isArray(t)||e.push(...uc(t)),e},vi=({__data__:t},e)=>{const n=t;return Hp(e)?n[typeof e=="string"?"string":"hash"]:n.map},Np=(t,e,n,r)=>{const i=Ks(t),s=i.length,l=Ks(e).length;if(s!=l)return!1;let a,c=s;for(;c--;)if(a=i[c],!hasOwnProperty.call(e,a))return!1;const u=r.get(t),h=r.get(e);if(u&&h)return u==e&&h==t;let g=!0;r.set(t,e),r.set(e,t);let d;for(;++c<s;){a=i[c];const v=t[a],y=e[a];if(!(v===y||n(v,y,r))){g=!1;break}d||(d=a=="constructor")}if(g&&!d){const v=t.constructor,y=e.constructor;v!=y&&"constructor"in t&&"constructor"in e&&!(typeof v=="function"&&v instanceof v&&typeof y=="function"&&y instanceof y)&&(g=!1)}return r.delete(t),r.delete(e),g},mi=(t,e,n)=>t===e?!0:t==null||e==null||!ge(t)&&!ge(e)?t!==t&&e!==e:kp(t,e,mi,n),kp=(t,e,n,r)=>{let i=Array.isArray(t);const s=Array.isArray(e);let o=i?Rs:pe(t),l=s?Rs:pe(e);o=o==sr?In:o,l=l==sr?In:l;let a=o==In;const c=l==In,u=o==l;if(u&&!a)return r||(r=new Fn),i||ur(t)?fc(t,e,!1,n,r):Vp(t,e,o,n,r);const h=a&&hasOwnProperty.call(t,"__wrapped__"),g=c&&hasOwnProperty.call(e,"__wrapped__");if(h||g){const d=h?t.value():t,v=g?e.value():e;return r||(r=new Fn),n(d,v,r)}return u?(r||(r=new Fn),Np(t,e,n,r)):!1},fc=(t,e,n,r,i)=>{const s=t.length,o=e.length;if(s!=o)return!1;const l=i.get(t),a=i.get(e);if(l&&a)return l==e&&a==t;let c=-1,u=!0;const h=n?new Bn:void 0;for(i.set(t,e),i.set(e,t);++c<s;){const g=t[c],d=e[c];if(h){if(!Ip(e,(v,y)=>{if(!Rp(h,y)&&(g===v||r(g,v,i)))return h.push(y)})){u=!1;break}}else if(!(g===d||r(g,d,i))){u=!1;break}}return i.delete(t),i.delete(e),u},Ip=(t,e)=>{let n=-1;const r=t==null?0:t.length;for(;++n<r;)if(e(t[n],n,t))return!0;return!1},Rp=(t,e)=>t.has(e),dc=(t,e,n,r)=>!(t.byteLength!=e.byteLength||!n(new Uint8Array(t),new Uint8Array(e),r)),Vp=(t,e,n,r,i)=>{switch(n){case Bs:return t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset?!1:(t=t.buffer,e=e.buffer,dc(t,e,r,i));case Fs:return dc(t,e,r,i);case ci:case Vs:case ui:return Vn(+t,+e);case Nl:return t.name==e.name&&t.message==e.message;case Ds:case hi:return t==`${e}`;case or:var s=gc;case ar:if(s||(s=yi),t.size!=e.size)return!1;const o=i.get(t);if(o)return o==e;i.set(t,e);const l=fc(s(t),s(e),!0,r,i);return i.delete(t),l;case fi:return Symbol.prototype.valueOf.call(t)==Symbol.prototype.valueOf.call(e)}return!1},gc=t=>{let e=-1,n=Array(t.size);return t.forEach((r,i)=>{n[++e]=[i,r]}),n},yi=t=>{let e=-1;const n=new Array(t.size);return t.forEach(r=>{n[++e]=r}),n},Zs=(t,e)=>{if(Array.isArray(t))return!1;const n=typeof t;return n==="number"||n==="boolean"||t==null||Dn(t)?!0:dp.test(t)||!fp.test(t)||e!=null&&t in Object(e)},Dp=t=>{const e=[];return t.charCodeAt(0)===gp&&e.push(""),t.replace(vp,(n,r,i,s)=>{let o=n;i?o=s.replace(pp,"$1"):r&&(o=r.trim()),e.push(o)}),e},je=(t,e)=>Array.isArray(t)?t:Zs(t,e)?[t]:Dp(`${t}`),hr=(t,e)=>{e=je(e,t);let n=0;const r=e.length;for(;t!=null&&n<r;)t=t[ke(e[n])],n++;return n&&n==r?t:void 0};function Fp(t,e){if(t!==e){const n=t!==void 0,r=t===null,i=t===t,s=Dn(t),o=e!==void 0,l=e===null,a=e===e,c=Dn(e);if(!l&&!c&&!s&&t>e||s&&o&&a&&!l&&!c||r&&o&&a||!n&&a||!i)return 1;if(!r&&!s&&!c&&t<e||c&&n&&i&&!r&&!s||l&&n&&i||!o&&i||!a)return-1}return 0}function Bp(t,e,n){let r=-1;const i=t.criteria,s=e.criteria,o=i.length,l=n.length;for(;++r<o;){const a=r<l?n[r]:null,u=(a&&typeof a=="function"?a:Fp)(i[r],s[r]);if(u)return a&&typeof a!="function"?u*(a=="desc"?-1:1):u}return t.index-e.index}const pc=(t,e)=>{let n=(o,l)=>!!(o==null?0:o.length)&&o.indexOf(l)>-1,r=!0;const i=[],s=e.length;if(!t.length)return i;e.length>=qs&&(n=(o,l)=>o.has(l),r=!1,e=new Bn(e));t:for(let o in t){let l=t[o];const a=l;if(l=l!==0?l:0,r&&a===a){let c=s;for(;c--;)if(e[c]===a)continue t;i.push(l)}else n(e,a)||i.push(l)}return i},Gp=t=>{const e=(g,d)=>!!(g==null?0:g.length)&&g.indexOf(d)>-1,n=(g,d)=>g.has(d),r=t[0].length,i=t.length,s=new Array(i),o=[];let l,a=1/0,c=i;for(;c--;)l=t[c],a=Math.min(l.length,a),s[c]=r>=120&&l.length>=120?new Bn(c&&l):void 0;l=t[0];let u=-1;const h=s[0];t:for(;++u<r&&o.length<a;){let g=l[u];const d=g;if(g=g!==0?g:0,!(h?n(h,d):e(o,d))){for(c=i;--c;){const v=s[c];if(!(v?n(v,d):e(t[c],d)))continue t}h&&h.push(d),o.push(g)}}return o},ke=t=>{if(typeof t=="string"||Dn(t))return t;const e=`${t}`;return e=="0"&&1/t==-1/0?"-0":e},yn=(t,e=!1,n=!1,r=!0,i,s,o,l)=>{let a;if(i&&(a=o?i(t,s,o,l):i(t)),a!==void 0)return a;if(!gt(t))return t;const c=Array.isArray(t),u=pe(t);if(c){if(a=Cp(t),!e)return js(t,a)}else{const v=typeof t=="function";if(u===In||u===sr||v&&!o){if(a=n||v?{}:cc(t),!e)return n?zp(t,cr(t,Object.keys(t),a)):_p(t,Object.assign(a,t))}else{if(v||!jg[u])return o?t:{};a=Op(t,u,e)}}l||(l=new Fn);const h=l.get(t);if(h)return h;if(l.set(t,a),Ep(t))return t.forEach((v,y)=>{a.set(y,yn(v,e,n,r,i,y,t,l))}),a;if(Sp(t))return t.forEach(v=>{a.add(yn(v,e,n,r,i,v,t,l))}),a;if(ur(t))return a;const d=c?void 0:(r?n?hc:Ks:n?mc:lr)(t);return(d||t).forEach((v,y)=>{d&&(y=v,v=t[y]),mn(a,y,yn(v,e,n,r,i,y,t,l))}),a},zp=(t,e)=>cr(t,uc(t),e),vc=(t,e)=>e.length<2?t:hr(t,e.slice(0,-1)),Up=(t,e,n)=>{if(!gt(t))return t;e=je(e,t);const r=e.length,i=r-1;let s=-1,o=t;for(;o!=null&&++s<r;){const l=ke(e[s]);let a=n;if(s!=i){const c=o[l];a=void 0,a===void 0&&(a=gt(c)?c:Js(e[s+1])?[]:{})}mn(o,l,a),o=o[l]}return t},Js=(t,e)=>{const n=typeof t;return e=e??Number.MAX_SAFE_INTEGER,!!e&&(n==="number"||n!=="symbol"&&mp.test(t))&&t>-1&&t%1==0&&t<e},$p=(t,e)=>{e=je(e,t),t=vc(t,e);const n=e[e.length-1];return t==null||delete t[ke(n)]},Hp=t=>{const e=typeof t;return e==="string"||e==="number"||e==="symbol"||e==="boolean"?t!=="__proto__":t===null},mc=t=>{const e=[];for(const n in t)e.push(n);return e},qp=t=>{t=Object(t);const e={};for(const n in t)e[n]=t[n];return e},yc=(t,e)=>{if(!(e==="constructor"&&typeof t[e]=="function")&&e!="__proto__")return t[e]};function wc(t,e=!1){return(n,...r)=>{let i=-1,s=r.length,o=s>1?r[s-1]:void 0;const l=s>2?r[2]:void 0;for(o=t.length>3&&typeof o=="function"?(s--,o):e?(a,c)=>{if(Array.isArray(a)&&!Array.isArray(c))return c}:void 0,l&&gi(r[0],r[1],l)&&(o=s<3?void 0:o,s=1),n=Object(n);++i<s;){const a=r[i];a&&t(n,a,i,o)}return n}}const Qs=(t,e,n,r,i)=>{t!==e&&_e(e,(s,o)=>{if(gt(s))i||(i=new Fn),Wp(t,e,o,n,Qs,r,i);else{let l=r?r(t[o],s,`${o}`,t,e,i):void 0;l===void 0&&(l=s),to(t,o,l)}})},Wp=(t,e,n,r,i,s,o)=>{const l=yc(t,n),a=yc(e,n),c=o.get(a);if(c){to(t,n,c);return}let u=s?s(l,a,`${n}`,t,e,o):void 0,h=u===void 0;if(h){const g=Array.isArray(a),d=!g&&ur(a);u=a,g||d?Array.isArray(l)?u=l:ge(l)&&oe(l)?u=js(l):d?(h=!1,u=lc(a,!0)):u=[]:It(a)||fr(a)?(u=l,fr(l)?u=qp(l):(typeof l=="function"||!gt(l))&&(u=cc(a))):h=!1}h&&(o.set(a,u),i(u,a,r,s,o),o.delete(a)),to(t,n,u)},to=(t,e,n)=>{(n!==void 0&&!Vn(t[e],n)||n===void 0&&!(e in t))&&mn(t,e,n)};function jp(t,e,n){const r=Object(t),i=n(t);let{length:s}=i,o=-1;for(;s--;){const l=i[++o];if(e(r[l],l,r)===!1)break}return t}const Yp=(t,e)=>t&&jp(t,e,lr),eo=(t,e)=>{if(t==null)return t;if(!oe(t))return Yp(t,e);const n=t.length,r=Object(t);let i=-1;for(;++i<n&&e(r[i],i,r)!==!1;);return t};function Xp(t){const e=t==null?0:t.length;return e?t[e-1]:void 0}const Kp=Set&&1/yi(new Set([void 0,-0]))[1]==1/0?t=>new Set(t):()=>{};function bc(t,e,n,r,i,s){return gt(t)&&gt(e)&&(s.set(e,t),Qs(t,e,void 0,bc,s),s.delete(e)),t}function Zp(t,e,n){e.length?e=e.map(o=>Array.isArray(o)?l=>hr(l,o.length===1?o[0]:o):o):e=[o=>o];let r=-1,i=-1;const s=oe(t)?new Array(t.length):[];return eo(t,o=>{const l=e.map(a=>a(o));s[++i]={criteria:l,index:++r,value:o}}),Jp(s,(o,l)=>Bp(o,l,n))}function Jp(t,e){let{length:n}=t;for(t.sort(e);n--;)t[n]=t[n].value;return t}function xc(t){return t===t&&!gt(t)}function Ac(t,e){return n=>n==null?!1:n[t]===e&&(e!==void 0||t in Object(n))}function Pc(t,e){return t!=null&&gv(t,e,dv)}function Qp(t,e){return Zs(t)&&xc(e)?Ac(ke(t),e):n=>{const r=hr(n,t);return r===void 0&&r===e?Pc(n,t):mi(e,r)}}function Tc(t){const e=tv(t);return e.length===1&&e[0][2]?Ac(e[0][0],e[0][1]):n=>n===t||ev(n,t,e)}function tv(t){const e=lr(t);let n=e.length;for(;n--;){const r=e[n],i=t[r];e[n]=[r,i,xc(i)]}return e}function ev(t,e,n,r){let i=n.length;const s=i;if(t==null)return!s;let o;for(t=Object(t);i--;)if(o=n[i],o[2]?o[1]!==t[o[0]]:!(o[0]in t))return!1;for(;++i<s;){o=n[i];const l=o[0],a=t[l],c=o[1];if(o[2]){if(a===void 0&&!(l in t))return!1}else{const u=new Fn;if(!mi(c,a,u))return!1}}return!0}function nv(t){return Zs(t)?rv(ke(t)):iv(t)}function rv(t){return e=>e?.[t]}function iv(t){return e=>hr(e,t)}function sv(t){return typeof t=="function"?t:t==null?e=>e:typeof t=="object"?Array.isArray(t)?Qp(t[0],t[1]):Tc(t):nv(t)}function wi(){const t=sv;return arguments.length?t(arguments[0]):t}const ov=(t,e,n,r)=>{let i=-1;const s=t==null?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n},av=(t,e,n,r,i)=>(i(t,(s,o,l)=>{n=r?(r=!1,s):e(n,s,o,l)}),n);function lv(t,e,n){const r=Array.isArray(t)?ov:av,i=arguments.length<3;return r(t,e,n,i,eo)}const cv=t=>Array.isArray(t)||fr(t)||!!(t&&t[Symbol.isConcatSpreadable]);function Sc(t,e,n,r,i){let s=-1;const o=t.length;for(n||(n=cv),i||(i=[]);++s<o;){var l=t[s];e>0&&n(l)?e>1?Sc(l,e-1,n,r,i):i.push(...l):i[i.length]=l}return i}const fr=t=>ge(t)&&pe(t)=="[object Arguments]",uv=(t,e)=>hv(t,e,(n,r)=>Pc(t,r)),hv=(t,e,n)=>{let r=-1;const i=e.length,s={};for(;++r<i;){const o=e[r],l=hr(t,o);n(l,o)&&Up(s,je(o,t),l)}return s},fv=t=>typeof t=="number"&&t>-1&&t%1==0&&t<=Number.MAX_SAFE_INTEGER,dv=(t,e)=>t!=null&&e in Object(t),gv=(t,e,n)=>{e=je(e,t);for(var r=-1,i=e.length,s=!1;++r<i;){var o=ke(e[r]);if(!(s=t!=null&&n(t,o)))break;t=t[o]}return s||++r!=i?s:(i=t==null?0:t.length,!!i&&fv(i)&&Js(o,i)&&(Array.isArray(t)||fr(t)))},pv=t=>t.match(bp),vv=t=>t.match(lp),mv=(t,e)=>(yp(t)?vv(t):pv(t))||[],yv=(t,e,n)=>{const{length:r}=t;return n=n===void 0?r:n,!e&&n>=r?t:t.slice(e,n)},wv=bv("toUpperCase");function bv(t){return e=>{if(!e)return"";const n=sc(e)?oc(e):void 0,r=n?n[0]:e[0],i=n?yv(n,1).join(""):e.slice(1);return r[t]()+i}}function xv(t){return Tc(yn(t,!0))}class Fn{constructor(e){const n=this.__data__=new no(e);this.size=n.size}clear(){this.__data__=new no,this.size=0}delete(e){const n=this.__data__,r=n.delete(e);return this.size=n.size,r}get(e){return this.__data__.get(e)}has(e){return this.__data__.has(e)}set(e,n){let r=this.__data__;if(r instanceof no){const i=r.__data__;if(i.length<qs-1)return i.push([e,n]),this.size=++r.size,this;r=this.__data__=new Ec(i)}return r.set(e,n),this.size=r.size,this}}class no{constructor(e){let n=-1;const r=e==null?0:e.length;for(this.clear();++n<r;){const i=e[n];this.set(i[0],i[1])}}clear(){this.__data__=[],this.size=0}delete(e){const n=this.__data__,r=di(n,e);if(r<0)return!1;const i=n.length-1;return r==i?n.pop():n.splice(r,1),--this.size,!0}get(e){const n=this.__data__,r=di(n,e);return r<0?void 0:n[r][1]}has(e){return di(this.__data__,e)>-1}set(e,n){const r=this.__data__,i=di(r,e);return i<0?(++this.size,r.push([e,n])):r[i][1]=n,this}}class Ec{constructor(e){let n=-1;const r=e==null?0:e.length;for(this.clear();++n<r;){const i=e[n];this.set(i[0],i[1])}}clear(){this.size=0,this.__data__={hash:new Cc,map:new Map,string:new Cc}}delete(e){const n=vi(this,e).delete(e);return this.size-=n?1:0,n}get(e){return vi(this,e).get(e)}has(e){return vi(this,e).has(e)}set(e,n){const r=vi(this,e),i=r.size;return r.set(e,n),this.size+=r.size==i?0:1,this}}class Cc{constructor(e){let n=-1;const r=e==null?0:e.length;for(this.clear();++n<r;){const i=e[n];this.set(i[0],i[1])}}clear(){this.__data__=Object.create(null),this.size=0}delete(e){const n=this.has(e)&&delete this.__data__[e];return this.size-=n?1:0,n}get(e){const r=this.__data__[e];return r===Ws?void 0:r}has(e){return this.__data__[e]!==void 0}set(e,n){const r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=n===void 0?Ws:n,this}}class Bn{constructor(e){let n=-1;const r=e==null?0:e.length;for(this.__data__=new Ec;++n<r;)this.add(e[n])}add(e){return this.__data__.set(e,Ws),this}has(e){return this.__data__.has(e)}}Bn.prototype.push=Bn.prototype.add;const Lc=function(t){var e=Object.prototype.toString;return t===!0||t===!1||!!t&&typeof t=="object"&&e.call(t)===ci},gt=function(t){return!!t&&(typeof t=="object"||typeof t=="function")},qt=function(t){var e=Object.prototype.toString;return typeof t=="number"||!!t&&typeof t=="object"&&e.call(t)===ui},Mt=function(t){var e=Object.prototype.toString;return typeof t=="string"||!!t&&typeof t=="object"&&e.call(t)===hi},j=wc((t,e)=>{if(pi(e)||oe(e)){cr(e,lr(e),t);return}for(var n in e)hasOwnProperty.call(e,n)&&mn(t,n,e[n])}),_c=j,Av=_c,Mc=(t,...e)=>{let n=-1,r=e.length;const i=r>2?e[2]:void 0;for(i&&gi(e[0],e[1],i)&&(r=1);++n<r;){const s=e[n];if(s==null)continue;const o=Object.keys(s),l=o.length;let a=-1;for(;++a<l;){const c=o[a],u=t[c];(u===void 0||Vn(u,Object.prototype[c])&&!hasOwnProperty.call(t,c))&&(t[c]=s[c])}}return t},Yt=Mc,Oc=function(...e){return e.push(void 0,bc),Nt.apply(void 0,e)},dr=Oc,Ie=(t,e,...n)=>{let r=-1;const i=typeof e=="function",s=oe(t)?new Array(t.length):[];return eo(t,o=>{s[++r]=i?e.apply(o,n):Nc(o,e,...n)}),s},Nc=(t,e,...n)=>{e=je(e,t),t=vc(t,e);const r=t==null?t:t[ke(Xp(e))];return r?.apply(t,n)},ro=(t,e,n)=>{let r=0,i=t==null?0:t.length;if(i==0)return 0;n=wi(n,2),e=n(e);const s=e!==e,o=e===null,l=Dn(e),a=e===void 0;for(;r<i;){let c;const u=Math.floor((r+i)/2),h=n(t[u]),g=h!==void 0,d=h===null,v=h===h,y=Dn(h);s?c=v:a?c=v&&g:o?c=v&&g&&!d:l?c=v&&g&&!d&&!y:d||y?c=!1:c=h<e,c?r=u+1:i=u}return Math.min(i,wp)},Ye=(t,e)=>{let n=-1,r=(a,c)=>!!(a==null?0:a.length)&&a.indexOf(c)>-1;e=wi(e,2);let i=!0;const{length:s}=t,o=[];let l=o;if(s>=qs){const a=e?null:Kp(t);if(a)return yi(a);i=!1,r=(c,u)=>c.has(u),l=new Bn}else l=e?[]:o;t:for(;++n<s;){let a=t[n];const c=e?e(a):a;if(a=a!==0?a:0,i&&c===c){let u=l.length;for(;u--;)if(l[u]===c)continue t;e&&l.push(c),o.push(a)}else r(l,c)||(l!==o&&l.push(c),o.push(a))}return o},kt=t=>yn(t),zt=t=>yn(t,!0),re=t=>{if(t==null)return!0;if(oe(t)&&(Array.isArray(t)||typeof t=="string"||typeof t.splice=="function"||ur(t)||fr(t)))return!t.length;const e=pe(t);if(e=="[object Map]"||e=="[object Set]")return!t.size;if(pi(t))return!Tp(t).length;for(const n in t)if(hasOwnProperty.call(t,n))return!1;return!0},Re=(t,e)=>mi(t,e),bt=t=>typeof t=="function",It=t=>{if(!ge(t)||pe(t)!="[object Object]")return!1;if(Object.getPrototypeOf(t)===null)return!0;let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e},xt=t=>{if(!t)return[];if(oe(t))return Mt(t)?oc(t):js(t);if(Symbol.iterator&&Symbol.iterator in Object(t)){const r=t[Symbol.iterator]();let i;const s=[];for(;!(i=r.next()).done;)s.push(i.value);return s}const e=pe(t);return(e==or?gc:e==ar?yi:Pp)(t)};function kc(t,e,n){if(typeof t!="function")throw new TypeError("Expected a function");let r,i,s,o,l,a,c=0,u=!1,h=!1,g=!0;const d=!e&&e!==0&&window&&typeof window.requestAnimationFrame=="function";e=+e||0,gt(n)&&(u=!!n.leading,h="maxWait"in n,s=h?Math.max(+n.maxWait||0,e):s,g="trailing"in n?!!n.trailing:g);function v(b){const P=r,E=i;return r=i=void 0,c=b,o=t.apply(E,P),o}function y(b,P){return d?(window.cancelAnimationFrame(l),window.requestAnimationFrame(b)):setTimeout(b,P)}function x(b){if(d)return window.cancelAnimationFrame(b);clearTimeout(b)}function A(b){return c=b,l=y(p,e),u?v(b):o}function T(b){const P=b-a,E=b-c,C=e-P;return h?Math.min(C,s-E):C}function f(b){const P=b-a,E=b-c;return a===void 0||P>=e||P<0||h&&E>=s}function p(){const b=Date.now();if(f(b))return m(b);l=y(p,T(b))}function m(b){return l=void 0,g&&r?v(b):(r=i=void 0,o)}function w(...b){const P=Date.now(),E=f(P);if(r=b,i=this,a=P,E){if(l===void 0)return A(a);if(h)return l=y(p,e),v(a)}return l===void 0&&(l=y(p,e)),o}return w.cancel=()=>{l!==void 0&&x(l),c=0,r=a=i=l=void 0},w.flush=()=>l===void 0?o:m(Date.now()),w.pending=()=>l!==void 0,w}const Ic=(t,e)=>(e=wi(e,2),lv(t,(n,r)=>{const i=e(r);return hasOwnProperty.call(n,i)?n[i].push(r):mn(n,i,[r]),n},{})),Gn=(t,e=[])=>{if(t==null)return[];const n=e.length;return n>1&&gi(t,e[0],e[1])?e=[]:n>2&&gi(e[0],e[1],e[2])&&(e=[e[0]]),Array.isArray(e)||(e=[wi(e,2)]),Zp(t,e.flat(1),[])},Rc=t=>(t==null?0:t.length)?Sc(t,1/0):[],io=(t,...e)=>oe(t)?pc(t,e):[],Vc=(t,...e)=>ge(t)&&oe(t)?pc(t,e.flat(1)):[],Pv=(...t)=>{const e=t.map(n=>ge(n)&&oe(n)?n:[]);return e.length&&e[0]===t[0]?Gp(e):[]},bi=(...t)=>{const e=t.flat(1);return Ye(e)},ve=(t,e)=>{if(t==null)return!1;typeof e=="string"&&(e=e.split("."));let n=-1,r=t;for(;++n<e.length;){if(!r||!hasOwnProperty.call(r,e[n]))return!1;r=r[e[n]]}return!0},Ct=(t,e,n)=>{e=je(e,t);let r=-1,i=e.length;for(i||(i=1,t=void 0);++r<i;){let s=t?.[ke(e[r])];s===void 0&&(r=i,s=n),t=typeof s=="function"?s.call(t):s}return t},Xe=(t,...e)=>{let n={};if(t==null)return n;let r=!1;e=e.flat(1).map(s=>(s=je(s,t),r||(r=s.length>1),s)),cr(t,hc(t),n),r&&(n=yn(n,!0,!0,!0,s=>It(s)?void 0:s));let i=e.length;for(;i--;)$p(n,e[i]);return n},Dc=(t,...e)=>t==null?{}:uv(t,e.flat(1/0)),Tv=(t,...e)=>(e.flat(1).forEach(n=>{n=ke(n),mn(t,n,t[n].bind(t))}),t),_e=(t,e=n=>n)=>{let n=-1;const r=Object(t),i=oe(t)?ac(t,!0):mc(t);let s=i.length;for(;s--;){const o=i[++n];if(e(r[o],o,r)===!1)break}},so=(t="")=>mv(`${t}`.replace(/['\u2019]/g,"")).reduce((e,n,r)=>(n=n.toLowerCase(),e+(r?wv(n):n)),"");let Sv=0;const wn=(t="")=>{const e=++Sv;return`${t}`+e},Nt=wc((t,e,n,r)=>{Qs(t,e,n,r)},!0);class oo{constructor(){this.map=new WeakMap}has(e,n){return n===void 0?this.map.has(e):n in this.map.get(e)}create(e){return this.has(e)||this.map.set(e,Object.create(null)),this.get(e)}get(e,n){if(!this.has(e))return;const r=this.map.get(e);return n===void 0?r:r[n]}set(e,n,r){if(n===void 0)return;const i=this.create(e);typeof n=="string"?i[n]=r:Object.assign(i,n)}remove(e,n){if(this.has(e))if(n===void 0)this.map.delete(e);else{const r=this.map.get(e);delete r[n]}}}const Pe=new oo,Fc=new oo,Ke=function(t,e){if(!(this instanceof Ke))return new Ke(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented?xi:Ai,this.target=t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget):this.type=t,e&&Object.assign(this,e),this.timeStamp=t&&t.timeStamp||Date.now(),this.envelope=!0};Ke.prototype={constructor:Ke,isDefaultPrevented:Ai,isPropagationStopped:Ai,isImmediatePropagationStopped:Ai,preventDefault:function(){const t=this.originalEvent;this.isDefaultPrevented=xi,t&&t.preventDefault()},stopPropagation:function(){const t=this.originalEvent;this.isPropagationStopped=xi,t&&t.stopPropagation()},stopImmediatePropagation:function(){const t=this.originalEvent;this.isImmediatePropagationStopped=xi,t&&t.stopImmediatePropagation(),this.stopPropagation()}},["altKey","bubbles","cancelable","changedTouches","ctrlKey","detail","eventPhase","metaKey","pageX","pageY","shiftKey","view","char","code","charCode","key","keyCode","button","buttons","clientX","clientY","offsetX","offsetY","pointerId","pointerType","screenX","screenY","targetTouches","toElement","touches","which"].forEach(t=>Ev(t));function Ev(t){Object.defineProperty(Ke.prototype,t,{enumerable:!0,configurable:!0,get:function(){return this.originalEvent?this.originalEvent[t]:void 0},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})}function xi(){return!0}function Ai(){return!1}const zn=typeof window<"u"?window.document:null,Cv=zn&&zn.documentElement,Bc=/^([^.]*)(?:\.(.+)|)/,Gc=/[^\x20\t\r\n\f]+/g,z=function(t){return new z.Dom(t)};z.fn=z.prototype={constructor:z,length:0},z.guid=1,z.data=Fc,z.merge=function(t,e){let n=+e.length,r=t.length;for(let i=0;i<n;i++)t[r++]=e[i];return t.length=r,t},z.parseHTML=function(t){const e=zn.implementation.createHTMLDocument(),n=e.createElement("base");n.href=zn.location.href,e.head.appendChild(n),e.body.innerHTML=t;const r=e.getElementsByTagName("script");for(let i=0;i<r.length;i++)r[i].remove();return Array.from(e.body.childNodes)},typeof Symbol=="function"&&(z.fn[Symbol.iterator]=Array.prototype[Symbol.iterator]),z.fn.toArray=function(){return Array.from(this)},z.fn.pushStack=function(t){const e=z.merge(this.constructor(),t);return e.prevObject=this,e},z.fn.find=function(t){const[e]=this,n=this.pushStack([]);if(!e)return n;const{nodeType:r}=e;return r!==1&&r!==9&&r!==11||(typeof t!="string"?e!==t&&e.contains(t)&&z.merge(n,[t]):z.merge(n,e.querySelectorAll(t))),n},z.fn.add=function(t){const e=z(t).toArray(),n=this.toArray(),r=this.pushStack([]);return z.merge(r,Ye(n.concat(e))),r},z.fn.addBack=function(){return this.add(this.prevObject)},z.fn.filter=function(t){const e=[];for(let n=0;n<this.length;n++){const r=this[n];r.matches(t)&&e.push(r)}return this.pushStack(e)};const Lv=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;function _v(t){return t[0]==="<"&&t[t.length-1]===">"&&t.length>=3}const zc=function(t){if(!t)return this;if(typeof t=="function")throw new Error("function not supported");if(arguments.length>1)throw new Error("selector with context not supported");if(t.nodeType)return this[0]=t,this.length=1,this;let e;if(_v(t+""))e=[null,t,null];else if(typeof t=="string")e=Lv.exec(t);else return z.merge(this,t);if(!e||!e[1])return Mv.find(t);if(e[1])return z.merge(this,z.parseHTML(e[1])),this;const n=zn.getElementById(e[2]);return n&&(this[0]=n,this.length=1),this};z.Dom=zc,zc.prototype=z.fn,z.Event=Ke,z.event={special:Object.create(null)},z.event.has=function(t,e){const n=Pe.get(t,"events");return n?e?Array.isArray(n[e])&&n[e].length>0:!0:!1},z.event.on=function(t,e,n,r,i,s){if(typeof e=="object"){typeof n!="string"&&(r=r||n,n=void 0);for(let o in e)z.event.on(t,o,n,r,e[o],s);return t}if(r==null&&i==null?(i=n,r=n=void 0):i==null&&(typeof n=="string"?(i=r,r=void 0):(i=r,r=n,n=void 0)),!i)return t;if(s===1){const o=i;i=function(l){return z().off(l),o.apply(this,arguments)},i.guid=o.guid||(o.guid=z.guid++)}for(let o=0;o<t.length;o++)z.event.add(t[o],e,i,r,n)},z.event.add=function(t,e,n,r,i){if(typeof t!="object")return;const s=Pe.create(t);let o;n.handler&&(o=n,n=o.handler,i=o.selector),i&&Cv.matches(i),n.guid||(n.guid=z.guid++);let l;(l=s.events)||(l=s.events=Object.create(null));let a;(a=s.handle)||(a=s.handle=function(h){return typeof z<"u"?z.event.dispatch.apply(t,arguments):void 0});const c=(e||"").match(Gc)||[""];let u=c.length;for(;u--;){const[,h,g=""]=Bc.exec(c[u]);if(!h)continue;const d=g.split(".").sort();let v=z.event.special[h];const y=v&&(i?v.delegateType:v.bindType)||h;v=z.event.special[y];const x=Object.assign({type:y,origType:h,data:r,handler:n,guid:n.guid,selector:i,namespace:d.join(".")},o);let A;(A=l[y])||(A=l[y]=[],A.delegateCount=0,(!v||!v.setup||v.setup.call(t,r,d,a)===!1)&&t.addEventListener&&t.addEventListener(y,a)),v&&v.add&&(v.add.call(t,x),x.handler.guid||(x.handler.guid=n.guid)),i?A.splice(A.delegateCount++,0,x):A.push(x)}},z.event.remove=function(t,e,n,r,i){const s=Pe.get(t);if(!s||!s.events)return;const o=s.events,l=(e||"").match(Gc)||[""];let a=l.length;for(;a--;){const[,c,u=""]=Bc.exec(l[a]);if(!c){for(const T in o)z.event.remove(t,T+l[a],n,r,!0);continue}const h=z.event.special[c],g=h&&(r?h.delegateType:h.bindType)||c,d=o[g];if(!d||d.length===0)continue;const v=u.split(".").sort(),y=u?new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,x=d.length;let A=x;for(;A--;){const T=d[A];(i||c===T.origType)&&(!n||n.guid===T.guid)&&(!y||y.test(T.namespace))&&(!r||r===T.selector||r==="**"&&T.selector)&&(d.splice(A,1),T.selector&&d.delegateCount--,h&&h.remove&&h.remove.call(t,T))}x&&d.length===0&&((!h||!h.teardown||h.teardown.call(t,v,s.handle)===!1)&&t.removeEventListener&&t.removeEventListener(g,s.handle),delete o[g])}re(o)&&(Pe.remove(t,"handle"),Pe.remove(t,"events"))},z.event.dispatch=function(t){const e=this,n=z.event.fix(t);n.delegateTarget=e;const r=Array.from(arguments);r[0]=n;const i=Pe.get(e,"events"),s=i&&i[n.type]||[],o=z.event.special[n.type];if(o&&o.preDispatch&&o.preDispatch.call(e,n)===!1)return;const l=z.event.handlers.call(e,n,s);let a=0,c;for(;(c=l[a++])&&!n.isPropagationStopped();){n.currentTarget=c.elem;let u=0,h;for(;(h=c.handlers[u++])&&!n.isImmediatePropagationStopped();){n.handleObj=h,n.data=h.data;const g=z.event.special[h.origType];let d;g&&g.handle?d=g.handle:d=h.handler;const v=d.apply(c.elem,r);v!==void 0&&(n.result=v)===!1&&(n.preventDefault(),n.stopPropagation())}}return o&&o.postDispatch&&o.postDispatch.call(e,n),n.result},z.event.handlers=function(t,e){const n=e.delegateCount,r=[];if(n&&!(t.type==="click"&&t.button>=1)){for(let i=t.target;i!==this;i=i.parentNode||this)if(i.nodeType===1&&!(t.type==="click"&&i.disabled===!0)){const s=[],o={};for(let l=0;l<n;l++){const a=e[l],c=a.selector+" ";o[c]===void 0&&(o[c]=i.matches(c)),o[c]&&s.push(a)}s.length&&r.push({elem:i,handlers:s})}}return n<e.length&&r.push({elem:this,handlers:e.slice(n)}),r},z.event.fix=function(t){return t.envelope?t:new Ke(t)};const Mv=z(zn),Pi="http://www.w3.org/2000/svg",Uc="http://www.w3.org/2000/xmlns/",Ov="http://www.w3.org/XML/1998/namespace",ao="http://www.w3.org/1999/xlink";var $c={__proto__:null,svg:Pi,xhtml:"http://www.w3.org/1999/xhtml",xlink:ao,xml:Ov,xmlns:Uc};const lo=typeof window=="object"&&!!window.SVGAngle,Hc="1.1",bn=lo?Wc():null,qc=lo?co("g"):null;function Wc(){const t=co("svg");return t.setAttributeNS(Uc,"xmlns:xlink",ao),t.setAttribute("version",Hc),t}function co(t){return document.createElementNS(Pi,t)}function jc(t,e){let n=t;do{if(n.contains(e))return n;n=n.parentNode}while(n);return null}function gr(){return bn.createSVGMatrix()}function uo(t={}){const e=bn.createSVGMatrix();return t&&("a"in t&&(e.a=t.a),"b"in t&&(e.b=t.b),"c"in t&&(e.c=t.c),"d"in t&&(e.d=t.d),"e"in t&&(e.e=t.e),"f"in t&&(e.f=t.f)),e}function Nv(){return bn.createSVGTransform()}function ho(t){const e=t.transform.baseVal.consolidate();return e?e.matrix:null}function kv(t){return qc.setAttribute("transform",t),ho(qc)}function Iv(t,e){t.setAttribute("transform",fo(e))}function Rv(t,e){const n=Nv(),r=Yc(e)?e:uo(e);n.setMatrix(r),t.transform.baseVal.appendItem(n)}const Vv="[object SVGMatrix]";function Yc(t){return Object.prototype.toString.call(t)===Vv}function fo(t={}){const{a:e=1,b:n=0,c:r=0,d:i=1,e:s=0,f:o=0}=t;return`matrix(${e},${n},${r},${i},${s},${o})`}function Dv(t,e){if((t.ownerSVGElement||t)!==(e.ownerSVGElement||e))return null;const n=e.getScreenCTM();if(!n)return null;const r=t.getScreenCTM();return r?n.inverse().multiply(r):null}function Fv(t,e){if(t===e)return gr();const n=t.compareDocumentPosition(e);if(n&Node.DOCUMENT_POSITION_CONTAINED_BY)return Ti(t,e).inverse();if(n&Node.DOCUMENT_POSITION_CONTAINS)return Ti(e,t);const r=jc(t,e);if(!r)return null;const i=Ti(r,t);return Ti(r,e).inverse().multiply(i)}function Ti(t,e){const n=[];let r=e;for(;r&&r.nodeType===Node.ELEMENT_NODE&&r!==t;){const i=ho(r);i&&n.unshift(i),r=r.parentNode}return n.reduce((i,s)=>i.multiply(s),gr())}const N=(function(){if(!lo)return function(){throw new Error("SVG is required to use Vectorizer.")};var t=Math,e=t.PI,n=t.atan2,r=t.sqrt,i=t.min,s=t.max,o=t.cos,l=t.sin,a=function(f,p,m){if(!(this instanceof a))return a.apply(Object.create(a.prototype),arguments);if(f){if(a.isV(f)&&(f=f.node),p=p||{},a.isString(f)){if(f=f.trim(),f.toLowerCase()==="svg")f=a.createSvgDocument();else if(f[0]==="<"){var w=a.createSvgDocument(f);if(w.childNodes.length>1){var b=[],P,E;for(P=0,E=w.childNodes.length;P<E;P++){var C=w.childNodes[P];b.push(new a(document.importNode(C,!0)))}return b}f=document.importNode(w.firstChild,!0)}else f=co(f);a.ensureId(f)}return this.node=f,this.setAttributes(p),m&&this.append(m),this}},c=a.prototype;Object.defineProperty(c,"id",{enumerable:!0,get:function(){return this.node.id},set:function(f){this.node.id=f}}),c.getTransformToElement=function(f,p){const m=this.node,w=a.toNode(f);let b;return a.isSVGGraphicsElement(w)&&a.isSVGGraphicsElement(m)&&(p&&p.safe?b=Fv(m,w):b=Dv(m,w)),b||gr()},c.transform=function(f,p){const m=this.node;return a.isUndefined(f)?ho(m)||gr():(p&&p.absolute?Iv(m,f):Rv(m,f),this)},c.translate=function(f,p,m){m=m||{},p=p||0;var w=this.attr("transform")||"",b=a.parseTransformString(w);if(w=b.value,a.isUndefined(f))return b.translate;w=w.replace(/translate\([^)]*\)/g,"").trim();var P=m.absolute?f:b.translate.tx+f,E=m.absolute?p:b.translate.ty+p,C="translate("+P+","+E+")";return this.attr("transform",(C+" "+w).trim()),this},c.rotate=function(f,p,m,w){w=w||{};var b=this.attr("transform")||"",P=a.parseTransformString(b);if(b=P.value,a.isUndefined(f))return P.rotate;b=b.replace(/rotate\([^)]*\)/g,"").trim(),f%=360;var E=w.absolute?f:P.rotate.angle+f,C=p!==void 0&&m!==void 0?","+p+","+m:"",k="rotate("+E+C+")";return this.attr("transform",(b+" "+k).trim()),this},c.scale=function(f,p){p=a.isUndefined(p)?f:p;var m=this.attr("transform")||"",w=a.parseTransformString(m);if(m=w.value,a.isUndefined(f))return w.scale;m=m.replace(/scale\([^)]*\)/g,"").trim();var b="scale("+f+","+p+")";return this.attr("transform",(m+" "+b).trim()),this},c.bbox=function(f,p){var m,w=this.node,b=w.ownerSVGElement;if(!b)return new U(0,0,0,0);try{m=w.getBBox()}catch{m={x:w.clientLeft,y:w.clientTop,width:w.clientWidth,height:w.clientHeight}}if(f)return new U(m);var P=this.getTransformToElement(p||b);return a.transformRect(m,P)},c.getBBox=function(f){var p={},m,w=this.node,b=w.ownerSVGElement;if(!b||!a.isSVGGraphicsElement(w))return new U(0,0,0,0);if(f&&(f.target&&(p.target=a.toNode(f.target)),f.recursive&&(p.recursive=f.recursive)),p.recursive){var E=this.children(),C=E.length;if(C===0)return this.getBBox({target:p.target,recursive:!1});p.target||(p.target=this);for(var k=0;k<C;k++){var I=E[k],D;I.children().length===0?D=I.getBBox({target:p.target,recursive:!1}):D=I.getBBox({target:p.target,recursive:!0}),m?m=m.union(D):m=D}return m}else{try{m=w.getBBox()}catch{m={x:w.clientLeft,y:w.clientTop,width:w.clientWidth,height:w.clientHeight}}if(p.target){var P=this.getTransformToElement(p.target);return a.transformRect(m,P)}else return new U(m)}};function u(f,p){f||(f={});var m=a("textPath"),w=f.d;if(w&&f["xlink:href"]===void 0){var b=a("path").attr("d",w).appendTo(p.defs());m.attr("xlink:href","#"+b.id)}return a.isObject(f)&&m.attr(f),m.node}function h(f,p,m){m||(m={});for(var w=m.includeAnnotationIndices,b=m.eol,P=m.lineHeight,E=m.baseSize,C=0,k={},I=p.length-1,D=0;D<=I;D++){var H=p[D],X=null;if(a.isObject(H)){var L=H.attrs,_=a("tspan",L),M=_.node,O=H.t;b&&D===I&&(O+=b),M.textContent=O;var K=L.class;K&&_.addClass(K),w&&_.attr("annotations",H.annotations),X=parseFloat(L["font-size"]),isFinite(X)||(X=E),X&&X>C&&(C=X)}else b&&D===I&&(H+=b),M=document.createTextNode(H||" "),E&&E>C&&(C=E);f.appendChild(M)}return C&&(k.maxFontSize=C),P?k.lineHeight=P:C&&(k.lineHeight=C*1.2),k}var g=/em$/;function d(f,p){var m=parseFloat(f);return g.test(f)?m*p:m}function v(f,p,m,w){if(!Array.isArray(p))return 0;var b=p.length;if(!b)return 0;for(var P=p[0],E=d(P.maxFontSize,m)||m,C=0,k=d(w,m),I=1;I<b;I++){P=p[I];var D=d(P.lineHeight,m)||k;C+=D}var H=d(P.maxFontSize,m)||m,X;switch(f){case"middle":X=E/2-.15*H-C/2;break;case"bottom":X=-(.25*H)-C;break;case"top":default:X=.8*E;break}return X}c.text=function(f,p){if(f&&typeof f!="string")throw new Error("Vectorizer: text() expects the first argument to be a string.");p||(p={}),f==null&&(f=""),p.useNoBreakSpace&&(f=a.sanitizeText(f));var m=p.displayEmpty,w=p.eol,b=p.textPath,P=p.textVerticalAnchor,E=P==="middle"||P==="bottom"||P==="top",C=p.x;C===void 0&&(C=this.attr("x")||0);var k=p.includeAnnotationIndices,I=p.annotations;I&&!a.isArray(I)&&(I=[I]);var D=p.lineHeight,H=D==="auto",X=H?"1.5em":D||"1em";this.empty(),this.attr({"xml:space":"preserve",display:f||m?null:"none"});var L=parseFloat(this.attr("font-size"));L||(L=16,(E||I)&&this.attr("font-size",L));var _=document,M;b?(typeof b=="string"&&(b={d:b}),M=u(b,this)):M=_.createDocumentFragment();for(var O=0,K=f.split(`
`),et=[],Q,tt=0,st=K.length-1;tt<=st;tt++){var ht=X,Tt="v-line",at=_.createElementNS(Pi,"tspan"),rt=K[tt],ot;if(rt)if(I){var it=a.annotateString(rt,I,{offset:-O,includeAnnotationIndices:k});ot=h(at,it,{includeAnnotationIndices:k,eol:tt!==st&&w,lineHeight:H?null:X,baseSize:L});var dt=ot.lineHeight;dt&&H&&tt!==0&&(ht=dt),tt===0&&(Q=ot.maxFontSize*.8)}else w&&tt!==st&&(rt+=w),at.textContent=rt;else{at.textContent="-",Tt+=" v-empty-line";var J=at.style;if(J.fillOpacity=0,J.strokeOpacity=0,I){ot={},it=a.findAnnotationsAtIndex(I,O);let Et=L;for(let _t=it.length;_t>0;_t--){const At=it[_t-1].attrs;if(!At||!("font-size"in At))continue;const $=parseFloat(At["font-size"]);if(isFinite($)){Et=$;break}}H&&(tt>0?ht=Et*1.2:Q=Et*.8),at.setAttribute("font-size",Et),ot.maxFontSize=Et}}ot&&et.push(ot),tt>0&&at.setAttribute("dy",ht),(tt>0||b)&&at.setAttribute("x",C),at.className.baseVal=Tt,M.appendChild(at),O+=rt.length+1}if(E)if(I)ht=v(P,et,L,X);else if(P==="top")ht="0.8em";else{var Y;switch(st>0?(Y=parseFloat(X)||1,Y*=st,g.test(X)||(Y/=L)):Y=0,P){case"middle":ht=.3-Y/2+"em";break;case"bottom":ht=-Y-.3+"em";break}}else P===0?ht="0em":P?ht=P:(ht=0,this.attr("y")===null&&this.attr("y",Q||"0.8em"));return M.firstChild.setAttribute("dy",ht),this.append(M),this},c.removeAttr=function(f){const p=T[f],{ns:m,local:w}=a.qualifyAttr(p),b=this.node;return m?b.hasAttributeNS(m,w)&&b.removeAttributeNS(m,w):b.hasAttribute(p)&&b.removeAttribute(p),this},c.attr=function(f,p){if(a.isUndefined(f)){for(var m=this.node.attributes,w={},b=0;b<m.length;b++)w[m[b].name]=m[b].value;return w}if(a.isString(f)&&a.isUndefined(p))return this.node.getAttribute(T[f]);if(typeof f=="object")for(var P in f)f.hasOwnProperty(P)&&this.setAttribute(P,f[P]);else this.setAttribute(f,p);return this},c.normalizePath=function(){var f=this.tagName();return f==="PATH"&&this.attr("d",a.normalizePathData(this.attr("d"))),this},c.remove=function(){return this.node.parentNode&&this.node.parentNode.removeChild(this.node),this},c.empty=function(){for(;this.node.firstChild;)this.node.removeChild(this.node.firstChild);return this},c.setAttributes=function(f){for(var p in f)f.hasOwnProperty(p)&&this.setAttribute(p,f[p]);return this},c.append=function(f){a.isArray(f)||(f=[f]);for(var p=0,m=f.length;p<m;p++)this.node.appendChild(a.toNode(f[p]));return this},c.prepend=function(f){var p=this.node.firstChild;return p?a(p).before(f):this.append(f)},c.before=function(f){var p=this.node,m=p.parentNode;if(m){a.isArray(f)||(f=[f]);for(var w=0,b=f.length;w<b;w++)m.insertBefore(a.toNode(f[w]),p)}return this},c.appendTo=function(f){return a.toNode(f).appendChild(this.node),this},c.svg=function(){return this.node instanceof window.SVGSVGElement?this:a(this.node.ownerSVGElement)},c.tagName=function(){return this.node.tagName.toUpperCase()},c.defs=function(){var f=this.svg()||this,p=f.node.getElementsByTagName("defs")[0];return p?a(p):a("defs").appendTo(f)},c.clone=function(){var f=a(this.node.cloneNode(!0));return f.node.id=a.uniqueId(),f},c.findOne=function(f){var p=this.node.querySelector(f);return p?a(p):void 0},c.find=function(f){var p=[],m=this.node.querySelectorAll(f);if(m)for(var w=0;w<m.length;w++)p.push(a(m[w]));return p},c.children=function(){for(var f=this.node.childNodes,p=[],m=0;m<f.length;m++){var w=f[m];w.nodeType===1&&p.push(a(f[m]))}return p},c.parent=function(){return a(this.node.parentNode)||null},c.index=function(){for(var f=0,p=this.node.previousSibling;p;)p.nodeType===1&&f++,p=p.previousSibling;return f},c.findParentByClass=function(f,p){for(var m=this.node.ownerSVGElement,w=this.node.parentNode;w&&w!==p&&w!==m;){var b=a(w);if(b.hasClass(f))return b;w=w.parentNode}return null},c.contains=function(f){var p=this.node,m=a.toNode(f),w=m&&m.parentNode;return p===w||!!(w&&w.nodeType===1&&p.compareDocumentPosition(w)&16)},c.toLocalPoint=function(f,p){var m=this.svg().node,w=m.createSVGPoint();w.x=f,w.y=p;try{var b=w.matrixTransform(m.getScreenCTM().inverse()),P=this.getTransformToElement(m).inverse()}catch{return w}return b.matrixTransform(P)},c.translateCenterToPoint=function(f){var p=this.getBBox({target:this.svg()}),m=p.center();return this.translate(f.x-m.x,f.y-m.y),this},c.translateAndAutoOrient=function(f,p,m){f=new S(f),p=new S(p),m||(m=this.svg());var w=this.scale();this.attr("transform","");var b=this.getBBox({target:m}).scale(w.sx,w.sy),P=a.createSVGTransform();P.setTranslate(-b.x-b.width/2,-b.y-b.height/2);var E=a.createSVGTransform(),C=f.angleBetween(p,f.clone().offset(1,0));C&&E.setRotate(C,0,0);var k=a.createSVGTransform(),I=f.clone().move(p,b.width/2);k.setTranslate(2*f.x-I.x,2*f.y-I.y);var D=this.getTransformToElement(m),H=a.createSVGTransform();return H.setMatrix(k.matrix.multiply(E.matrix.multiply(P.matrix.multiply(D.scale(w.sx,w.sy))))),this.attr("transform",fo(H.matrix)),this},c.animateAlongPath=function(f,p){p=a.toNode(p);var m=a.ensureId(p),w=a("animateMotion",f),b=a("mpath",{"xlink:href":"#"+m});w.append(b),this.append(w);try{w.node.beginElement()}catch{if(document.documentElement.getAttribute("smiling")==="fake"){var P=w.node;P.animators=[];var E=P.getAttribute("id");E&&(id2anim[E]=P);for(var C=getTargets(P),k=0,I=C.length;k<I;k++){var D=C[k],H=new Animator(P,D,k);animators.push(H),P.animators[k]=H,H.register()}}}return this};const y=/[^\x20\t\r\n\f]+/g;function x(f){return a.isString(f)?f.trim().match(y)||[]:[]}c.hasClass=function(f){return a.isString(f)?this.node.classList.contains(f.trim()):!1},c.addClass=function(f){return this.node.classList.add(...x(f)),this},c.removeClass=function(f){return this.node.classList.remove(...x(f)),this},c.toggleClass=function(f,p){const m=x(f);for(let w=0;w<m.length;w++)this.node.classList.toggle(m[w],p);return this},c.sample=function(f){f=f||1;for(var p=this.node,m=p.getTotalLength(),w=[],b=0,P;b<m;)P=p.getPointAtLength(b),w.push({x:P.x,y:P.y,distance:b}),b+=f;return w},c.convertToPath=function(){var f=a("path");f.attr(this.attr());var p=this.convertToPathData();return p&&f.attr("d",p),f},c.convertToPathData=function(){var f=this.tagName();switch(f){case"PATH":return this.attr("d");case"LINE":return a.convertLineToPathData(this.node);case"POLYGON":return a.convertPolygonToPathData(this.node);case"POLYLINE":return a.convertPolylineToPathData(this.node);case"ELLIPSE":return a.convertEllipseToPathData(this.node);case"CIRCLE":return a.convertCircleToPathData(this.node);case"RECT":return a.convertRectToPathData(this.node)}throw new Error(f+" cannot be converted to PATH.")},a.prototype.toGeometryShape=function(){var f,p,m,w,b,P,E,C,k,I,D,H,X,L,_;switch(this.tagName()){case"RECT":return f=parseFloat(this.attr("x"))||0,p=parseFloat(this.attr("y"))||0,m=parseFloat(this.attr("width"))||0,w=parseFloat(this.attr("height"))||0,new U(f,p,m,w);case"CIRCLE":return b=parseFloat(this.attr("cx"))||0,P=parseFloat(this.attr("cy"))||0,E=parseFloat(this.attr("r"))||0,new jt({x:b,y:P},E,E);case"ELLIPSE":return b=parseFloat(this.attr("cx"))||0,P=parseFloat(this.attr("cy"))||0,C=parseFloat(this.attr("rx"))||0,k=parseFloat(this.attr("ry"))||0,new jt({x:b,y:P},C,k);case"POLYLINE":return I=a.getPointsFromSvgNode(this),new Lt(I);case"POLYGON":return I=a.getPointsFromSvgNode(this),I.length>1&&I.push(I[0]),new Lt(I);case"PATH":return D=this.attr("d"),Z.isDataSupported(D)||(D=a.normalizePathData(D)),new Z(D);case"LINE":return H=parseFloat(this.attr("x1"))||0,L=parseFloat(this.attr("y1"))||0,X=parseFloat(this.attr("x2"))||0,_=parseFloat(this.attr("y2"))||0,new W({x:H,y:L},{x:X,y:_})}return this.getBBox()},c.findIntersection=function(f,p){var m=this.svg().node;p=p||m;var w=this.getBBox({target:p}),b=w.center();if(w.intersectionWithLineFromCenterToPoint(f)){var P,E=this.tagName();if(E==="RECT"){var C=new U(parseFloat(this.attr("x")||0),parseFloat(this.attr("y")||0),parseFloat(this.attr("width")),parseFloat(this.attr("height"))),k=this.getTransformToElement(p),I=a.decomposeMatrix(k),D=m.createSVGTransform();D.setRotate(-I.rotation,b.x,b.y);var H=a.transformRect(C,D.matrix.multiply(k));P=new U(H).intersectionWithLineFromCenterToPoint(f,I.rotation)}else if(E==="PATH"||E==="POLYGON"||E==="POLYLINE"||E==="CIRCLE"||E==="ELLIPSE"){var X=E==="PATH"?this:this.convertToPath(),L=X.sample(),_=1/0,M=[],O,K,et,Q,tt,st;for(O=0;O<L.length;O++)K=L[O],et=a.createSVGPoint(K.x,K.y),et=et.matrixTransform(this.getTransformToElement(p)),K=new S(et),Q=K.distance(b),tt=K.distance(f)*1.1,st=Q+tt,st<_?(_=st,M=[{sample:K,refDistance:tt}]):st<_+1&&M.push({sample:K,refDistance:tt});M.sort(function(ht,Tt){return ht.refDistance-Tt.refDistance}),M[0]&&(P=M[0].sample)}return P}},c.setAttribute=function(f,p){const m=this.node;if(p===null)return this.removeAttr(f),this;const w=T[f],{ns:b}=a.qualifyAttr(w);return b?m.setAttributeNS(b,w,p):w==="id"?m.id=p:m.setAttribute(w,p),this},a.createSvgDocument=function(f){if(f){const p=`<svg xmlns="${Pi}" xmlns:xlink="${ao}" version="${Hc}">${f}</svg>`,{documentElement:m}=a.parseXML(p,{async:!1});return m}return Wc()},a.createSVGStyle=function(f){const{node:p}=a("style",{type:"text/css"},[a.createCDATASection(f)]);return p},a.createCDATASection=function(f=""){return document.implementation.createDocument(null,"xml",null).createCDATASection(f)},a.idCounter=0,a.uniqueId=function(){return"v-"+ ++a.idCounter},a.toNode=function(f){return a.isV(f)?f.node:f.nodeName&&f||f[0]},a.ensureId=function(f){return f=a.toNode(f),f.id||(f.id=a.uniqueId())},a.sanitizeText=function(f){return(f||"").replace(/ /g,"Â ")},a.isUndefined=function(f){return typeof f>"u"},a.isString=function(f){return typeof f=="string"},a.isObject=function(f){return f&&typeof f=="object"},a.isArray=Array.isArray,a.parseXML=function(f,p){p=p||{};var m;try{var w=new DOMParser;a.isUndefined(p.async)||(w.async=p.async),m=w.parseFromString(f,"text/xml")}catch{m=void 0}if(!m||m.getElementsByTagName("parsererror").length)throw new Error("Invalid XML: "+f);return m};const A=Object.create(null);["attributeName","baseFrequency","baseProfile","clipPathUnits","contentScriptType","contentStyleType","diffuseConstant","edgeMode","externalResourcesRequired","filterRes","filterUnits","gradientTransform","gradientUnits","kernelMatrix","kernelUnitLength","keyPoints","lengthAdjust","limitingConeAngle","markerHeight","markerUnits","markerWidth","maskContentUnits","maskUnits","numOctaves","pathLength","patternContentUnits","patternTransform","patternUnits","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","refX","refY","requiredExtensions","requiredFeatures","repeatCount","specularConstant","specularExponent","spreadMethod","startOffset","stdDeviation","stitchTiles","surfaceScale","systemLanguage","tableValues","targetX","targetY","textLength","viewBox","viewTarget","xChannelSelector","yChannelSelector","zoomAndPan"].forEach(f=>A[f]=f),A.xlinkShow="xlink:show",A.xlinkRole="xlink:role",A.xlinkActuate="xlink:actuate",A.xlinkHref="xlink:href",A.xlinkType="xlink:type",A.xlinkTitle="xlink:title",A.xmlBase="xml:base",A.xmlLang="xml:lang",A.xmlSpace="xml:space";const T=new Proxy(A,{get(f,p){return a.supportCamelCaseAttributes?p in f?f[p]:f[p]=p.replace(/[A-Z]/g,"-$&").toLowerCase():p}});return Object.defineProperty(a,"attributeNames",{enumerable:!0,value:T,writable:!1}),Object.defineProperty(a,"supportCamelCaseAttributes",{enumerable:!0,value:!0,writable:!0}),a.qualifyAttr=function(f){if(f.indexOf(":")!==-1){var p=f.split(":");return{ns:$c[p[0]],local:p[1]}}return{ns:null,local:f}},a.transformSeparatorRegex=/[ ,]+/,a.transformFunctionRegex=/\b(\w+)\(([^()]+)\)/,a.transformTranslateRegex=/\btranslate\(([^()]+)\)/,a.transformRotateRegex=/\brotate\(([^()]+)\)/,a.transformScaleRegex=/\bscale\(([^()]+)\)/,a.transformStringToMatrix=function(f){let p;return a.isString(f)&&(p=kv(f)),p||gr()},a.matrixToTransformString=fo,a.parseTransformString=function(f){var p,m,w;if(f){var b=a.transformSeparatorRegex;if(f.trim().indexOf("matrix")>=0){var P=a.transformStringToMatrix(f),E=a.decomposeMatrix(P);p=[E.translateX,E.translateY],w=[E.scaleX,E.scaleY],m=[E.rotation];var C=[];(p[0]!==0||p[1]!==0)&&C.push("translate("+p+")"),(w[0]!==1||w[1]!==1)&&C.push("scale("+w+")"),m[0]!==0&&C.push("rotate("+m+")"),f=C.join(" ")}else{const I=f.match(a.transformTranslateRegex);I&&(p=I[1].split(b));const D=f.match(a.transformRotateRegex);D&&(m=D[1].split(b));const H=f.match(a.transformScaleRegex);H&&(w=H[1].split(b))}}var k=w&&w[0]?parseFloat(w[0]):1;return{value:f,translate:{tx:p&&p[0]?parseInt(p[0],10):0,ty:p&&p[1]?parseInt(p[1],10):0},rotate:{angle:m&&m[0]?parseInt(m[0],10):0,cx:m&&m[1]?parseInt(m[1],10):void 0,cy:m&&m[2]?parseInt(m[2],10):void 0},scale:{sx:k,sy:w&&w[1]?parseFloat(w[1]):k}}},a.deltaTransformPoint=function(f,p){var m=p.x*f.a+p.y*f.c+0,w=p.x*f.b+p.y*f.d+0;return{x:m,y:w}},a.decomposeMatrix=function(f){var p=a.deltaTransformPoint(f,{x:0,y:1}),m=a.deltaTransformPoint(f,{x:1,y:0}),w=180/e*n(p.y,p.x)-90,b=180/e*n(m.y,m.x);return{translateX:f.e,translateY:f.f,scaleX:r(f.a*f.a+f.b*f.b),scaleY:r(f.c*f.c+f.d*f.d),skewX:w,skewY:b,rotation:w}},a.matrixToScale=function(f){var p,m,w,b;return f?(p=a.isUndefined(f.a)?1:f.a,b=a.isUndefined(f.d)?1:f.d,m=f.b,w=f.c):p=b=1,{sx:m?r(p*p+m*m):p,sy:w?r(w*w+b*b):b}},a.matrixToRotate=function(f){var p={x:0,y:1};return f&&(p=a.deltaTransformPoint(f,p)),{angle:de(Zr(n(p.y,p.x))-90)}},a.matrixToTranslate=function(f){return{tx:f&&f.e||0,ty:f&&f.f||0}},a.isV=function(f){return f instanceof a},a.isVElement=a.isV,a.isSVGGraphicsElement=function(f){return f?(f=a.toNode(f),f instanceof SVGElement&&typeof f.getScreenCTM=="function"):!1},a.createSVGMatrix=uo,a.createSVGTransform=function(f){return a.isUndefined(f)?bn.createSVGTransform():(Yc(f)||(f=uo(f)),bn.createSVGTransformFromMatrix(f))},a.createSVGPoint=function(f,p){var m=bn.createSVGPoint();return m.x=f,m.y=p,m},a.transformRect=function(f,p){var m=bn.createSVGPoint();m.x=f.x,m.y=f.y;var w=m.matrixTransform(p);m.x=f.x+f.width,m.y=f.y;var b=m.matrixTransform(p);m.x=f.x+f.width,m.y=f.y+f.height;var P=m.matrixTransform(p);m.x=f.x,m.y=f.y+f.height;var E=m.matrixTransform(p),C=i(w.x,b.x,P.x,E.x),k=s(w.x,b.x,P.x,E.x),I=i(w.y,b.y,P.y,E.y),D=s(w.y,b.y,P.y,E.y);return new U(C,I,k-C,D-I)},a.transformPoint=function(f,p){return new S(a.createSVGPoint(f.x,f.y).matrixTransform(p))},a.transformLine=function(f,p){return new W(a.transformPoint(f.start,p),a.transformPoint(f.end,p))},a.transformPolyline=function(f,p){var m=f instanceof Lt?f.points:f;a.isArray(m)||(m=[]);for(var w=[],b=0,P=m.length;b<P;b++)w[b]=a.transformPoint(m[b],p);return new Lt(w)},a.styleToObject=function(f){for(var p={},m=f.split(";"),w=0;w<m.length;w++){var b=m[w],P=b.split("=");p[P[0].trim()]=P[1].trim()}return p},a.createSlicePathData=function(f,p,m,w){var b=2*e-1e-6,P=f,E=p,C=m,k=w,I=(k<C&&(I=C,C=k,k=I),k-C),D=I<e?"0":"1",H=o(C),X=l(C),L=o(k),_=l(k);return I>=b?P?"M0,"+E+"A"+E+","+E+" 0 1,1 0,"+-E+"A"+E+","+E+" 0 1,1 0,"+E+"M0,"+P+"A"+P+","+P+" 0 1,0 0,"+-P+"A"+P+","+P+" 0 1,0 0,"+P+"Z":"M0,"+E+"A"+E+","+E+" 0 1,1 0,"+-E+"A"+E+","+E+" 0 1,1 0,"+E+"Z":P?"M"+E*H+","+E*X+"A"+E+","+E+" 0 "+D+",1 "+E*L+","+E*_+"L"+P*L+","+P*_+"A"+P+","+P+" 0 "+D+",0 "+P*H+","+P*X+"Z":"M"+E*H+","+E*X+"A"+E+","+E+" 0 "+D+",1 "+E*L+","+E*_+"L0,0Z"},a.mergeAttrs=function(f,p){for(var m in p)m==="class"?f[m]=f[m]?f[m]+" "+p[m]:p[m]:m==="style"?a.isObject(f[m])&&a.isObject(p[m])?f[m]=a.mergeAttrs(f[m],p[m]):a.isObject(f[m])?f[m]=a.mergeAttrs(f[m],a.styleToObject(p[m])):a.isObject(p[m])?f[m]=a.mergeAttrs(a.styleToObject(f[m]),p[m]):f[m]=a.mergeAttrs(a.styleToObject(f[m]),a.styleToObject(p[m])):f[m]=p[m];return f},a.annotateString=function(f,p,m){p=p||[],m=m||{};for(var w=m.offset||0,b=[],P,E=[],C,k,I=0;I<f.length;I++){C=E[I]=f[I];for(var D=0;D<p.length;D++){var H=p[D],X=H.start+w,L=H.end+w;I>=X&&I<L&&(a.isObject(C)?C.attrs=a.mergeAttrs(a.mergeAttrs({},C.attrs),H.attrs):C=E[I]={t:f[I],attrs:H.attrs},m.includeAnnotationIndices&&(C.annotations||(C.annotations=[])).push(D))}k=E[I-1],k?a.isObject(C)&&a.isObject(k)?JSON.stringify(C.attrs)===JSON.stringify(k.attrs)?P.t+=C.t:(b.push(P),P=C):a.isObject(C)||a.isObject(k)?(b.push(P),P=C):P=(P||"")+C:P=C}return P&&b.push(P),b},a.findAnnotationsAtIndex=function(f,p){var m=[];return f&&f.forEach(function(w){w.start<p&&p<=w.end&&m.push(w)}),m},a.findAnnotationsBetweenIndexes=function(f,p,m){var w=[];return f&&f.forEach(function(b){(p>=b.start&&p<b.end||m>b.start&&m<=b.end||b.start>=p&&b.end<m)&&w.push(b)}),w},a.shiftAnnotations=function(f,p,m){return f&&f.forEach(function(w){w.start<p&&w.end>=p?w.end+=m:w.start>=p&&(w.start+=m,w.end+=m)}),f},a.convertLineToPathData=function(f){f=a(f);var p=["M",f.attr("x1")||"0",f.attr("y1")||"0","L",f.attr("x2")||"0",f.attr("y2")||"0"].join(" ");return p},a.convertPolygonToPathData=function(f){var p=a.getPointsFromSvgNode(f);return p.length===0?null:a.svgPointsToPath(p)+" Z"},a.convertPolylineToPathData=function(f){var p=a.getPointsFromSvgNode(f);return p.length===0?null:a.svgPointsToPath(p)},a.svgPointsToPath=function(f){for(var p=0,m=f.length;p<m;p++)f[p]=f[p].x+" "+f[p].y;return"M "+f.join(" L")},a.getPointsFromSvgNode=function(f){f=a.toNode(f);var p=[],m=f.points;if(m)for(var w=0,b=m.numberOfItems;w<b;w++)p.push(m.getItem(w));return p},a.KAPPA=.551784,a.convertCircleToPathData=function(f){f=a(f);var p=parseFloat(f.attr("cx"))||0,m=parseFloat(f.attr("cy"))||0,w=parseFloat(f.attr("r")),b=w*a.KAPPA,P=["M",p,m-w,"C",p+b,m-w,p+w,m-b,p+w,m,"C",p+w,m+b,p+b,m+w,p,m+w,"C",p-b,m+w,p-w,m+b,p-w,m,"C",p-w,m-b,p-b,m-w,p,m-w,"Z"].join(" ");return P},a.convertEllipseToPathData=function(f){f=a(f);var p=parseFloat(f.attr("cx"))||0,m=parseFloat(f.attr("cy"))||0,w=parseFloat(f.attr("rx")),b=parseFloat(f.attr("ry"))||w,P=w*a.KAPPA,E=b*a.KAPPA,C=["M",p,m-b,"C",p+P,m-b,p+w,m-E,p+w,m,"C",p+w,m+E,p+P,m+b,p,m+b,"C",p-P,m+b,p-w,m+E,p-w,m,"C",p-w,m-E,p-P,m-b,p,m-b,"Z"].join(" ");return C},a.convertRectToPathData=function(f){return f=a(f),a.rectToPath({x:parseFloat(f.attr("x"))||0,y:parseFloat(f.attr("y"))||0,width:parseFloat(f.attr("width"))||0,height:parseFloat(f.attr("height"))||0,rx:parseFloat(f.attr("rx"))||0,ry:parseFloat(f.attr("ry"))||0})},a.rectToPath=function(f){var p,m=f.x,w=f.y,b=f.width,P=f.height,E=i(f.rx||f["top-rx"]||0,b/2),C=i(f.rx||f["bottom-rx"]||0,b/2),k=i(f.ry||f["top-ry"]||0,P/2),I=i(f.ry||f["bottom-ry"]||0,P/2);return E||C||k||I?p=["M",m,w+k,"v",P-k-I,"a",C,I,0,0,0,C,I,"h",b-2*C,"a",C,I,0,0,0,C,-I,"v",-(P-I-k),"a",E,k,0,0,0,-E,-k,"h",-(b-2*E),"a",E,k,0,0,0,-E,k,"Z"]:p=["M",m,w,"H",m+b,"V",w+P,"H",m,"V",w,"Z"],p.join(" ")},a.normalizePathData=(function(){var f=`	
\v\f\r Â áá ââââââââââââ¯âã\u2028\u2029`,p=new RegExp("([a-z])["+f+",]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?["+f+"]*,?["+f+"]*)+)","ig"),m=new RegExp("(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)["+f+"]*,?["+f+"]*","ig"),w=Math,b=w.PI,P=w.sin,E=w.cos,C=w.tan,k=w.asin,I=w.sqrt,D=w.abs;function H(K,et,Q,tt,st,ht){var Tt=.3333333333333333,at=2/3;return[Tt*K+at*Q,Tt*et+at*tt,Tt*st+at*Q,Tt*ht+at*tt,st,ht]}function X(K,et,Q){var tt=K*E(Q)-et*P(Q),st=K*P(Q)+et*E(Q);return{x:tt,y:st}}function L(K,et,Q,tt,st,ht,Tt,at,rt,ot){var it=b*120/180,dt=b/180*(+st||0),J=[],Y;if(ot)ut=ot[0],Ft=ot[1],lt=ot[2],Ot=ot[3];else{Y=X(K,et,-dt),K=Y.x,et=Y.y,Y=X(at,rt,-dt),at=Y.x,rt=Y.y;var Et=(K-at)/2,_t=(et-rt)/2,At=Et*Et/(Q*Q)+_t*_t/(tt*tt);At>1&&(At=I(At),Q=At*Q,tt=At*tt);var $=Q*Q,B=tt*tt,F=(ht==Tt?-1:1)*I(D(($*B-$*_t*_t-B*Et*Et)/($*_t*_t+B*Et*Et)));if(!Number.isFinite(F))return[K,et,at,rt,at,rt];var lt=F*Q*_t/tt+(K+at)/2,Ot=F*-tt*Et/Q+(et+rt)/2,ut=k(((et-Ot)/tt).toFixed(9)),Ft=k(((rt-Ot)/tt).toFixed(9));ut=K<lt?b-ut:ut,Ft=at<lt?b-Ft:Ft,ut<0&&(ut=b*2+ut),Ft<0&&(Ft=b*2+Ft),Tt&&ut>Ft&&(ut=ut-b*2),!Tt&&Ft>ut&&(Ft=Ft-b*2)}var ea=Ft-ut;if(D(ea)>it){var z0=Ft,U0=at,$0=rt;Ft=ut+it*(Tt&&Ft>ut?1:-1),at=lt+Q*E(Ft),rt=Ot+tt*P(Ft),J=L(at,rt,Q,tt,st,0,Tt,U0,$0,[Ft,z0,lt,Ot])}ea=Ft-ut;var H0=E(ut),q0=P(ut),W0=E(Ft),j0=P(Ft),df=C(ea/4),gf=4/3*(Q*df),pf=4/3*(tt*df),vf=[K,et],Yn=[K+gf*q0,et-pf*H0],mf=[at+gf*j0,rt-pf*W0],yf=[at,rt];if(Yn[0]=2*vf[0]-Yn[0],Yn[1]=2*vf[1]-Yn[1],ot)return[Yn,mf,yf].concat(J);J=[Yn,mf,yf].concat(J).join().split(",");for(var wf=[],Y0=J.length,an=0;an<Y0;an++)wf[an]=an%2?X(J[an-1],J[an],dt).y:X(J[an],J[an+1],dt).x;return wf}function _(K){if(!K)return null;var et={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},Q=[];return String(K).replace(p,function(tt,st,ht){var Tt=[],at=st.toLowerCase();for(ht.replace(m,function(rt,ot){ot&&Tt.push(+ot)}),at==="m"&&Tt.length>2&&(Q.push([st].concat(Tt.splice(0,2))),at="l",st=st==="m"?"l":"L");Tt.length>=et[at]&&(Q.push([st].concat(Tt.splice(0,et[at]))),!!et[at]););}),Q}function M(K){if((!Array.isArray(K)||!Array.isArray(K&&K[0]))&&(K=_(K)),!K||!K.length)return[["M",0,0]];for(var et=[],Q=0,tt=0,st=0,ht=0,Tt=0,at,rt=K.length,ot=Tt;ot<rt;ot++){var it=[];et.push(it);var dt=K[ot];if(at=dt[0],at!=at.toUpperCase()){it[0]=at.toUpperCase();var J,Y;switch(it[0]){case"A":it[1]=dt[1],it[2]=dt[2],it[3]=dt[3],it[4]=dt[4],it[5]=dt[5],it[6]=+dt[6]+Q,it[7]=+dt[7]+tt;break;case"V":it[1]=+dt[1]+tt;break;case"H":it[1]=+dt[1]+Q;break;case"M":for(st=+dt[1]+Q,ht=+dt[2]+tt,J=dt.length,Y=1;Y<J;Y++)it[Y]=+dt[Y]+(Y%2?Q:tt);break;default:for(J=dt.length,Y=1;Y<J;Y++)it[Y]=+dt[Y]+(Y%2?Q:tt);break}}else for(var Et=dt.length,_t=0;_t<Et;_t++)it[_t]=dt[_t];switch(it[0]){case"Z":Q=+st,tt=+ht;break;case"H":Q=it[1];break;case"V":tt=it[1];break;case"M":st=it[it.length-2],ht=it[it.length-1],Q=it[it.length-2],tt=it[it.length-1];break;default:Q=it[it.length-2],tt=it[it.length-1];break}}return et}function O(K){var et=M(K),Q={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null};function tt(J,Y,Et){var _t,At;if(!J)return["C",Y.x,Y.y,Y.x,Y.y,Y.x,Y.y];switch(J[0]in{T:1,Q:1}||(Y.qx=null,Y.qy=null),J[0]){case"M":Y.X=J[1],Y.Y=J[2];break;case"A":parseFloat(J[1])===0||parseFloat(J[2])===0?J=["L",J[6],J[7]]:J=["C"].concat(L.apply(0,[Y.x,Y.y].concat(J.slice(1))));break;case"S":Et==="C"||Et==="S"?(_t=Y.x*2-Y.bx,At=Y.y*2-Y.by):(_t=Y.x,At=Y.y),J=["C",_t,At].concat(J.slice(1));break;case"T":Et==="Q"||Et==="T"?(Y.qx=Y.x*2-Y.qx,Y.qy=Y.y*2-Y.qy):(Y.qx=Y.x,Y.qy=Y.y),J=["C"].concat(H(Y.x,Y.y,Y.qx,Y.qy,J[1],J[2]));break;case"Q":Y.qx=J[1],Y.qy=J[2],J=["C"].concat(H(Y.x,Y.y,J[1],J[2],J[3],J[4]));break;case"H":J=["L"].concat(J[1],Y.y);break;case"V":J=["L"].concat(Y.x,J[1]);break}return J}function st(J,Y){if(J[Y].length>7){J[Y].shift();for(var Et=J[Y];Et.length;)ht[Y]="A",J.splice(Y++,0,["C"].concat(Et.splice(0,6)));J.splice(Y,1),rt=et.length}}for(var ht=[],Tt="",at="",rt=et.length,ot=0;ot<rt;ot++){et[ot]&&(Tt=et[ot][0]),Tt!=="C"&&(ht[ot]=Tt,ot>0&&(at=ht[ot-1])),et[ot]=tt(et[ot],Q,at),ht[ot]!=="A"&&Tt==="C"&&(ht[ot]="C"),st(et,ot);var it=et[ot],dt=it.length;Q.x=it[dt-2],Q.y=it[dt-1],Q.bx=parseFloat(it[dt-4])||Q.x,Q.by=parseFloat(it[dt-3])||Q.y}return(!et[0][0]||et[0][0]!=="M")&&et.unshift(["M",0,0]),et}return function(K){return O(K).join(",").split(",").join(" ")}})(),a.getCommonAncestor=function(f,p){return!f||!p?null:jc(a.toNode(f),a.toNode(p))},a.namespace={...$c},a.g=Ol,a})();function go(t){let e=t.length;for(;e--;)Xc(t[e])}function Xc(t){z.event.remove(t),Pe.remove(t),Fc.remove(t)}function Kc(t){for(let e=0;e<t.length;e++){const n=t[e];n.parentNode&&n.parentNode.removeChild(n)}}function Bv(){for(let t=0;t<this.length;t++){const e=this[t];Xc(e),go(e.getElementsByTagName("*"))}return Kc(this),this}function Gv(){return Kc(this),this}function zv(){for(let t=0;t<this.length;t++){const e=this[t];e.nodeType===1&&(go(e.getElementsByTagName("*")),e.textContent="")}return this}function Uv(){const t=[];for(let e=0;e<this.length;e++)t.push(this[e].cloneNode(!0));return this.pushStack(t)}function $v(t){const[e]=this;if(!e)return null;if(arguments.length===0)return e.innerHTML;if(t===void 0)return this;if(go(e.getElementsByTagName("*")),typeof t=="string"||typeof t=="number")e.innerHTML=t;else return e.innerHTML="",this.append(t);return this}function Hv(...t){const[e]=this;return e?(t.forEach(n=>{n&&(typeof n=="string"?e.append(...z.parseHTML(n)):n.toString()==="[object Object]"?this.append(...Array.from(n)):Array.isArray(n)?this.append(...n):e.appendChild(n))}),this):this}function qv(...t){const[e]=this;return e?(t.forEach(n=>{n&&(typeof n=="string"?e.prepend(...z.parseHTML(n)):n.toString()==="[object Object]"?this.prepend(...Array.from(n)):Array.isArray(n)?this.prepend(...n):e.insertBefore(n,e.firstChild))}),this):this}function Wv(t){return z(t).append(this),this}function jv(t){return z(t).prepend(this),this}const Zc={};["width","height","top","bottom","left","right","padding","paddingTop","paddingBottom","paddingLeft","paddingRight","margin","marginTop","marginBottom","marginLeft","marginRight"].forEach(t=>{Zc[t]=!0});function Yv(t,e,n){typeof n=="number"&&Zc[so(e)]&&(n+="px"),t.style[e]=n}function Xv(t,e){let n;if(typeof t=="string")if(e===void 0){const[r]=this;return r?r.style[t]:null}else n={[t]:e};else if(t)n=t;else throw new Error("no styles provided");for(let r in n)if(n.hasOwnProperty(r))for(let i=0;i<this.length;i++)Yv(this[i],r,n[r]);return this}function Kv(t,e){if(arguments.length<2){const[n]=this;return n?t===void 0?n.dataset:n.dataset[t]:null}for(let n=0;n<this.length;n++)this[n].dataset[t]=e;return this}function po(t,e,n){for(let r=0;r<e.length;r++){const i=e[r];N.prototype[t].apply({node:i},n)}}function Zv(){return po("removeClass",this,arguments),this}function Jv(){return po("addClass",this,arguments),this}function Qv(){return po("toggleClass",this,arguments),this}function tm(){const[t]=this;return t?N.prototype.hasClass.apply({node:t},arguments):!1}function em(t){const e=[];for(let n=0;n<this.length;n++){const r=this[n];let i=Array.from(r.children);typeof t=="string"&&(i=i.filter(s=>s.matches(t))),e.push(...i)}return this.pushStack(e)}function nm(t){const e=[];for(let n=0;n<this.length;n++){const r=this[n];if(typeof t=="string"){const i=r.closest(t);i&&e.push(i)}else{const[i]=z(t);i&&i.contains(r)&&e.push(i)}}return this.pushStack(e)}function rm(t,e,n,r){return z.event.on(this,t,e,n,r),this}function im(t,e,n,r){return z.event.on(this,t,e,n,r,1),this}function sm(t,e,n){if(t&&t.preventDefault&&t.handleObj){const r=t.handleObj;return z(t.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this}if(typeof t=="object"){for(let r in t)this.off(r,e,t[r]);return this}(e===!1||typeof e=="function")&&(n=e,e=void 0);for(let r=0;r<this.length;r++)z.event.remove(this[r],t,n,e);return this}function om(){const[t]=this;if(t===window)return t.document.documentElement.clientWidth;if(!t)return;const e=window.getComputedStyle(t),n=t.offsetWidth,r=parseFloat(e.borderTopWidth),i=parseFloat(e.borderBottomWidth),s=parseFloat(e.paddingTop),o=parseFloat(e.paddingBottom);return n-i-r-s-o}function am(){const[t]=this;if(t===window)return t.document.documentElement.clientHeight;if(!t)return;const e=window.getComputedStyle(t),n=t.offsetHeight,r=parseFloat(e.borderLeftWidth),i=parseFloat(e.borderRightWidth),s=parseFloat(e.paddingLeft),o=parseFloat(e.paddingRight);return n-r-i-s-o}function lm(){const[t]=this;if(!t)return;let e=z(t),n,r,i,s={top:0,left:0};if(e.css("position")==="fixed")r=t.getBoundingClientRect();else{r=e.offset(),i=t.ownerDocument,n=t.offsetParent||i.documentElement;const a=c=>{const{position:u}=getComputedStyle(c);return u==="static"};for(;n&&n!==i.documentElement&&a(n);)n=n.offsetParent||i.documentElement;if(n&&n!==t&&n.nodeType===1&&!a(n)){const c=window.getComputedStyle(n),u=parseFloat(c.borderTopWidth)||0,h=parseFloat(c.borderLeftWidth)||0;s=z(n).offset(),s.top+=u,s.left+=h}}const o=parseFloat(window.getComputedStyle(t).marginTop)||0,l=parseFloat(window.getComputedStyle(t).marginLeft)||0;return{top:r.top-s.top-o,left:r.left-s.left-l}}function cm(t){const[e]=this;if(t===void 0){if(!e)return null;if(!e.getClientRects().length)return{top:0,left:0};const o=e.getBoundingClientRect();return{top:o.top+window.scrollY,left:o.left+window.scrollX}}if(!e)return this;const n=window.getComputedStyle(e);n.position==="static"&&this.css("position","relative");const r=this.offset(),i=t.top-r.top,s=t.left-r.left;return this.css({top:(parseFloat(n.top)||0)+i+"px",left:(parseFloat(n.left)||0)+s+"px"}),this}var um={__proto__:null,addClass:Jv,append:Hv,appendTo:Wv,children:em,clone:Uv,closest:nm,css:Xv,data:Kv,detach:Gv,empty:zv,hasClass:tm,height:am,html:$v,off:sm,offset:cm,on:rm,one:im,position:lm,prepend:qv,prependTo:jv,remove:Bv,removeClass:Zv,toggleClass:Qv,width:om};const Si="animationFrameId",Me={};Me["transition-property"]=Me["transition-duration"]=Me["transition-delay"]=Me["transition-timing-function"]=Me["animation-name"]=Me["animation-duration"]=Me["animation-delay"]=Me["animation-timing-function"]="";function hm(t,e={}){this.stop();for(let n=0;n<this.length;n++)fm(this[n],t,e);return this}function fm(t,e,n={}){let{duration:r=400,easing:i="ease-in-out",delay:s=0,complete:o}=n;const l=setTimeout(function(){const a=z(t);let c=!1,u="transitionend";r=r/1e3,s=s/1e3;const h={};if(typeof e=="string")h["animation-name"]=e,h["animation-duration"]=r+"s",h["animation-delay"]=s+"s",h["animation-timing-function"]=i,u="animationend";else{const v=[];for(var g in e)e.hasOwnProperty(g)&&(h[g]=e[g],v.push(g));r>0&&(h["transition-property"]=v.join(", "),h["transition-duration"]=r+"s",h["transition-delay"]=s+"s",h["transition-timing-function"]=i)}const d=function(v){if(v){if(v.target!==v.currentTarget)return;v.target.removeEventListener(u,d)}else t.removeEventListener(u,d);c=!0,a.css(Me),o&&o.call(t)};if(r>0){t.addEventListener(u,d);const v=setTimeout(function(){c||d(null)},(r+s)*1e3+25);Pe.set(t,Si,{id:v,stop:()=>{clearTimeout(v),t.removeEventListener(u,d)}})}a.css(h),r<=0&&d(null)});Pe.set(t,Si,{stop:()=>clearTimeout(l)})}function dm(){for(let t=0;t<this.length;t++){const e=this[t],n=Pe.get(e,Si);n&&(n.stop(),Pe.remove(e,Si))}return this.css(Me),this}var gm={__proto__:null,animate:hm,stop:dm};const Jc={outerWidth:"offsetWidth",outerHeight:"offsetHeight",innerWidth:"clientWidth",innerHeight:"clientHeight",scrollLeft:"scrollLeft",scrollTop:"scrollTop",val:"value",text:"textContent"},Qc={disabled:"disabled",value:"value",text:"textContent"};function pm(t,e){if(!t)throw new Error("no property provided");if(arguments.length===1){const[n]=this;return n?n[t]:null}if(e===void 0)return this;for(let n=0;n<this.length;n++)this[n][t]=e;return this}function vm(t,e){let n;if(typeof t=="string")if(e===void 0){const[r]=this;return r?r.getAttribute(t):null}else n={[t]:e};else if(t)n=t;else throw new Error("no attributes provided");for(let r in n)if(n.hasOwnProperty(r)){const i=n[r];if(Qc[r]){this.prop(Qc[r],i);continue}for(let s=0;s<this.length;s++)i===null?this[s].removeAttribute(r):this[s].setAttribute(r,i)}return this}const tu={prop:pm,attr:vm};Object.keys(Jc).forEach(t=>{tu[t]=function(...e){return this.prop(Jc[t],...e)}});const Bt={cellMergeStrategy:null,cellDefaultsMergeStrategy:null,useCSSSelectors:!1,classNamePrefix:"joint-",defaultTheme:"default",doubleTapInterval:300,layerAttribute:"layer"},Ei=Object.create(null);Ei.load={noBubble:!0},[["mouseenter","mouseover"],["mouseleave","mouseout"],["pointerenter","pointerover"],["pointerleave","pointerout"]].forEach(([t,e])=>{Ei[t]={delegateType:e,bindType:e,handle:function(n){const r=this,i=n.relatedTarget,s=n.handleObj;let o;return(!i||!r.contains(i))&&(n.type=s.origType,o=s.handler.apply(r,arguments),n.type=e),o}}});const mm=Bt.doubleTapInterval,ym=30;Ei.dbltap={bindType:"touchend",delegateType:"touchend",handle:function(t,...e){const{handleObj:n,target:r}=t,i=z.data.create(r),s=new Date().getTime(),o="lastTouch"in i?s-i.lastTouch:0;o<mm&&o>ym?(i.lastTouch=null,t.type=n.origType,n.handler.call(this,t,...e)):i.lastTouch=s}},Object.assign(z.fn,um),Object.assign(z.fn,gm),Object.assign(z.fn,tu),Object.assign(z.event.special,Ei);const me=function(t){return t&&t.toString().split(" ").map(function(e){return e.substr(0,Bt.classNamePrefix.length)!==Bt.classNamePrefix&&(e=Bt.classNamePrefix+e),e}).join(" ")},wm=function(t){return t&&t.toString().split(" ").map(function(e){return e.substr(0,Bt.classNamePrefix.length)===Bt.classNamePrefix&&(e=e.substr(Bt.classNamePrefix.length)),e}).join(" ")},pr=function(t,e){const n={},r={},i=N.namespace.svg,s=e||i,o=document.createDocumentFragment(),l=function(a,c,u){for(let h=0;h<a.length;h++){const g=a[h];if(typeof g=="string"){const m=document.createTextNode(g);c.appendChild(m);continue}if(!g.hasOwnProperty("tagName"))throw new Error("json-dom-parser: missing tagName");const d=g.tagName;let v;const y=g.hasOwnProperty("namespaceURI")?g.namespaceURI:u;v=document.createElementNS(y,d);const x=y===i,A=x?N(v):z(v),T=g.attributes;T&&A.attr(T);const f=g.style;if(f&&z(v).css(f),g.hasOwnProperty("className")){const m=g.className;x?v.className.baseVal=m:v.className=m}if(g.hasOwnProperty("textContent")&&(v.textContent=g.textContent),g.hasOwnProperty("selector")){const m=g.selector;if(n[m])throw new Error("json-dom-parser: selector must be unique");n[m]=v,A.attr("joint-selector",m)}if(g.hasOwnProperty("groupSelector")){let m=g.groupSelector;Array.isArray(m)||(m=[m]);for(let w=0;w<m.length;w++){const b=m[w];let P=r[b];P||(P=r[b]=[]),P.push(v)}}c.appendChild(v);const p=g.children;Array.isArray(p)&&l(p,v,y)}};return l(t,o,s),{fragment:o,selectors:n,groupSelectors:r}},vr=function(t){let e=0;if(t.length===0)return e;for(let n=0;n<t.length;n++){const r=t.charCodeAt(n);e=(e<<5)-e+r,e=e&e}return e},Ze=function(t,e,n){for(var r=Array.isArray(e)?e:e.split(n||"/"),i,s=0,o=r.length;s<o;)if(i=r[s++],Object(t)===t&&i in t)t=t[i];else return;return t},eu=function(t,e){return typeof e!="string"&&typeof e!="number"&&(e=String(e)),!(e==="constructor"&&typeof t[e]=="function"||e==="__proto__")},vo=function(t,e,n,r){const i=Array.isArray(e)?e:e.split(r||"/"),s=i.length-1;let o=t,l=0;for(;l<s;l++){const a=i[l];if(!eu(o,a))return t;o=o[a]||(o[a]={})}return o[i[s]]=n,t},mo=function(t,e,n){const r=Array.isArray(e)?e:e.split(n||"/"),i=r.length-1;let s=t,o=0;for(;o<i;o++){const l=r[o];if(!eu(s,l))return t;const a=s[l];if(!a)return t;s=a}return delete s[r[i]],t},nu=function(t,e,n){e=e||"/";var r={};for(var i in t)if(t.hasOwnProperty(i)){var s=typeof t[i]=="object";if(s&&n&&n(t[i])&&(s=!1),s){var o=nu(t[i],e,n);for(var l in o)o.hasOwnProperty(l)&&(r[i+e+l]=o[l])}else r[i]=t[i]}return r},ru=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=Math.random()*16|0,n=t==="x"?e:e&3|8;return n.toString(16)})},xn=function(t){return xn.id=xn.id||1,t===void 0?"j_"+xn.id++:(t.id=t.id===void 0?"j_"+xn.id++:t.id,t.id)},bm=function(t){return t.replace(/[A-Z]/g,"-$&").toLowerCase()},St=function(t){if(t.normalized)return t;const{originalEvent:e,target:n}=t,r=e&&e.changedTouches&&e.changedTouches[0];if(r)for(let i in r)t[i]===void 0&&(t[i]=r[i]);if(n){const i=n.correspondingUseElement;i&&(t.target=i)}return t.normalized=!0,t},iu=function(t){let i=0,s=0,o=0,l=0;return"detail"in t&&(s=t.detail),"wheelDelta"in t&&(s=-t.wheelDelta/120),"wheelDeltaY"in t&&(s=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(i=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(i=s,s=0),o="deltaX"in t?t.deltaX:i*10,l="deltaY"in t?t.deltaY:s*10,(o||l)&&t.deltaMode&&(t.deltaMode==1?(o*=40,l*=40):(o*=800,l*=800)),t.deltaX===0&&t.deltaY!==0&&t.shiftKey&&(o=l,l=0,i=s,s=0),o&&!i&&(i=o<1?-1:1),l&&!s&&(s=l<1?-1:1),{spinX:i,spinY:s,deltaX:o,deltaY:l}},su=function(t,e){return t>e?e:t<-e?-e:t},Ci=(function(){var t;if(typeof window<"u"&&(t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame),!t){var e=0;t=function(n){var r=new Date().getTime(),i=Math.max(0,16-(r-e)),s=setTimeout(function(){n(r+i)},i);return e=r+i,s}}return function(n,r,...i){return t(r!==void 0?n.bind(r,...i):n)}})(),mr=(function(){var t,e=typeof window<"u";return e&&(t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.msCancelRequestAnimationFrame||window.oCancelAnimationFrame||window.oCancelRequestAnimationFrame||window.mozCancelAnimationFrame||window.mozCancelRequestAnimationFrame),t=t||clearTimeout,e?t.bind(window):t})(),Ut=function(t){return Mt(t)&&t.slice(-1)==="%"},ou=function(t,e){function n(l){var a=new RegExp("(?:\\d+(?:\\.\\d+)*)("+l+")$").exec(t);return a?a[1]:null}var r=parseFloat(t);if(Number.isNaN(r))return null;var i={};i.value=r;var s;if(e==null)s="[A-Za-z]*";else if(Array.isArray(e)){if(e.length===0)return null;s=e.join("|")}else Mt(e)&&(s=e);var o=n(s);return o===null?null:(i.unit=o,i)},yr=0;function xm(t,e){const n=t.split(e);let r=1;for(let i=0,s=n.length-1;i<s;i++){const o=[];(i>0||n[0]!=="")&&o.push(yr),o.push(e),(i<s-1||n[s]!=="")&&o.push(yr),n.splice(r,0,...o),r+=o.length+1}return n.filter(i=>i!=="")}function au(t,e){if(t===null)return e.getBBox().height;switch(t.unit){case"em":return e.getBBox().height*t.value;case"px":case"":return t.value}}const lu=function(t,e,n={},r={}){var i=e.width,s=e.height,o=r.svgDocument||N("svg").node,l=N("tspan").node,a=N("text").attr(n).append(l).node,c=document.createTextNode("");a.style.opacity=0,a.style.display="block",l.style.display="block",l.appendChild(c),o.appendChild(a),r.svgDocument||document.body.appendChild(o);const u=r.preserveSpaces,h=" ",g=r.separator||r.separator===""?r.separator:h,d=typeof g=="string"?g:h;var v=r.eol||`
`,y=r.hyphen?new RegExp(r.hyphen):/[^\w\d\u00C0-\u1FFF\u2800-\uFFFD]/,x=r.maxLineCount;qt(x)||(x=1/0);var A=t.split(g),T=[],f=[],p,m,w;u&&N(l).attr("xml:space","preserve");for(var b=0,P=0,E=A.length;b<E;b++){var C=A[b];if(!(!C&&!u)&&typeof C=="string"){var k=!1;if(C.indexOf(v)>=0)if(C.length>1){const K=xm(A[b],v);A.splice(b,1,...K),b--,E=A.length;continue}else{if(u&&typeof A[b-1]=="string"){A.splice(b,yr,"",yr),E+=2,b--;continue}f[++P]=!u||typeof A[b+1]=="string"?"":void 0,k=!0}if(!k){let K;if(u?K=f[P]!==void 0?f[P]+d+C:C:K=f[P]?f[P]+d+C:C,c.data=K,l.getComputedTextLength()<=i)f[P]=K,(p||m)&&(T[P++]=!0,p=0,m=0);else{if(!f[P]||p){var I=!!p;if(p=C.length-1,I||!p){if(!p){if(!f[P]){f=[];break}A.splice(b,2,C+A[b+1]),E--,T[P++]=!0,b--;continue}A[b]=C.substring(0,p);const et=A[b+1];A[b+1]=C.substring(p)+(et===void 0||et===yr?"":et)}else{if(m)A.splice(b,2,A[b]+A[b+1]),m=0;else{var D=C.search(y);D>-1&&D!==C.length-1&&D!==0&&(m=D+1,p=0),A.splice(b,1,C.substring(0,m||p),C.substring(m||p)),E++}P&&!T[P-1]&&P--}(!u||f[P]!=="")&&b--;continue}P++,b--}}var H=null;if(f.length>x)H=x-1;else if(s!==void 0){if(w===void 0&&c.data!=="")if(n.lineHeight==="auto")w=au({value:1.5,unit:"em"},a);else{const K=ou(n.lineHeight,["em","px",""]);w=au(K,a)}w*f.length>s&&(H=Math.floor(s/w)-1)}if(H!==null){f.splice(H+1);var X=r.ellipsis;if(!X||H<0)break;typeof X!="string"&&(X="â¦");var L=f[H];if(!L&&!k)break;var _=L.length,M,O;do{if(O=L[_],M=L.substring(0,_),O?O.match(g)&&(M+=O):M+=d,M+=X,c.data=M,l.getComputedTextLength()<=i){f[H]=M;break}_--}while(_>=0);break}}}return r.svgDocument?o.removeChild(a):document.body.removeChild(o),f.join(v)},Am=function(t){const[e]=z.parseHTML("<div>"+t+"</div>");return Array.from(e.getElementsByTagName("*")).forEach(function(n){n.getAttributeNames().forEach(function(i){const s=n.getAttribute(i);(i.startsWith("on")||s.startsWith("javascript:")||s.startsWith("data:")||s.startsWith("vbscript:"))&&n.removeAttribute(i)})}),e.innerHTML},cu=function(t,e){if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(t,e);else{var n=window.URL.createObjectURL(t),r=document.createElement("a");r.href=n,r.download=e,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(n)}},Pm=function(t,e){const n=uu(t);cu(n,e)},uu=function(t){t=t.replace(/\s/g,""),t=decodeURIComponent(t);var e=t.indexOf(","),n=t.slice(0,e),r=n.split(":")[1].split(";")[0],i=t.slice(e+1),s;n.indexOf("base64")>=0?s=atob(i):s=unescape(encodeURIComponent(i));for(var o=new Uint8Array(s.length),l=0;l<s.length;l++)o[l]=s.charCodeAt(l);return new Blob([o],{type:r})},Tm=function(t,e){if(!t||t.substr(0,5)==="data:")return setTimeout(function(){e(null,t)},0);var n=function(s,o){if(s.status===200){var l=new FileReader;l.onload=function(a){var c=a.target.result;o(null,c)},l.onerror=function(){o(new Error("Failed to load image "+t))},l.readAsDataURL(s.response)}else o(new Error("Failed to load image "+t))},r=function(s,o){var l=function(d){for(var v=32768,y=[],x=0;x<d.length;x+=v)y.push(String.fromCharCode.apply(null,d.subarray(x,x+v)));return y.join("")};if(s.status===200){var a=new Uint8Array(s.response),c=t.split(".").pop()||"png",u={svg:"svg+xml"},h="data:image/"+(u[c]||c)+";base64,",g=h+btoa(l(a));o(null,g)}else o(new Error("Failed to load image "+t))},i=new XMLHttpRequest;i.open("GET",t,!0),i.addEventListener("error",function(){e(new Error("Failed to load image "+t))}),i.responseType=window.FileReader?"blob":"arraybuffer",i.addEventListener("load",function(){window.FileReader?n(i,e):r(i,e)}),i.send()},Sm=function(t){var e=z(t);if(e.length===0)throw new Error("Element not found");var n=e[0],r=n.ownerDocument,i=n.getBoundingClientRect(),s=0,o=0;if(n.ownerSVGElement){var l=N(n),a=l.getBBox({target:l.svg()});s=i.width-a.width,o=i.height-a.height}return{x:i.left+window.pageXOffset-r.documentElement.offsetLeft+s/2,y:i.top+window.pageYOffset-r.documentElement.offsetTop+o/2,width:i.width-s,height:i.height-o}},hu=function(t,e){t=z(t).toArray();var n=t.map(function(i){var s=i.parentNode,o=s.insertBefore(document.createTextNode(""),i.nextSibling);return function(){if(s===this)throw new Error("You can't sort elements if any one is a descendant of another.");s.insertBefore(this,o),s.removeChild(o)}});t.sort(e);for(var r=0;r<n.length;r++)n[r].call(t[r]);return t},Em=function(t,e){var n=z(t);_e(e,function(r,i){var s=n.find(i).addBack().filter(i);ve(r,"class")&&(s.addClass(r.class),r=Xe(r,"class")),s.attr(r)})},Te=function(t){if(Object(t)!==t){var e=0;return isFinite(t)&&(e=+t),{top:e,right:e,bottom:e,left:e}}var n,r,i,s;return n=r=i=s=0,isFinite(t.vertical)&&(n=i=+t.vertical),isFinite(t.horizontal)&&(r=s=+t.horizontal),isFinite(t.top)&&(n=+t.top),isFinite(t.right)&&(r=+t.right),isFinite(t.bottom)&&(i=+t.bottom),isFinite(t.left)&&(s=+t.left),{top:n,right:r,bottom:i,left:s}},fu={linear:function(t){return t},quad:function(t){return t*t},cubic:function(t){return t*t*t},inout:function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)},exponential:function(t){return Math.pow(2,10*(t-1))},bounce:function(t){for(var e=0,n=1;;e+=n,n/=2)if(t>=(7-4*e)/11){var r=(11-6*e-11*t)/4;return-r*r+n*n}},reverse:function(t){return function(e){return 1-t(1-e)}},reflect:function(t){return function(e){return .5*(e<.5?t(2*e):2-t(2-2*e))}},clamp:function(t,e,n){return e=e||0,n=n||1,function(r){var i=t(r);return i<e?e:i>n?n:i}},back:function(t){return t||(t=1.70158),function(e){return e*e*((t+1)*e-t)}},elastic:function(t){return t||(t=1.5),function(e){return Math.pow(2,10*(e-1))*Math.cos(20*Math.PI*t/3*e)}}},yo={number:function(t,e){var n=e-t;return function(r){return t+n*r}},object:function(t,e){var n=Object.keys(t);return function(r){var i,s,o={};for(i=n.length-1;i!=-1;i--)s=n[i],o[s]=t[s]+(e[s]-t[s])*r;return o}},hexColor:function(t,e){var n=parseInt(t.slice(1),16),r=parseInt(e.slice(1),16),i=n&255,s=(r&255)-i,o=n&65280,l=(r&65280)-o,a=n&16711680,c=(r&16711680)-a;return function(u){var h=i+s*u&255,g=o+l*u&65280,d=a+c*u&16711680;return"#"+(1<<24|h|g|d).toString(16).slice(1)}},unit:function(t,e){var n=/(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/,r=n.exec(t),i=n.exec(e),s=i[1].indexOf("."),o=s>0?i[1].length-s-1:0;t=+r[1];var l=+i[1]-t,a=r[2];return function(c){return(t+l*c).toFixed(o)+a}}},du={outline:function(t){var e='<filter><feFlood flood-color="${color}" flood-opacity="${opacity}" result="colored"/><feMorphology in="SourceAlpha" result="morphedOuter" operator="dilate" radius="${outerRadius}" /><feMorphology in="SourceAlpha" result="morphedInner" operator="dilate" radius="${innerRadius}" /><feComposite result="morphedOuterColored" in="colored" in2="morphedOuter" operator="in"/><feComposite operator="xor" in="morphedOuterColored" in2="morphedInner" result="outline"/><feMerge><feMergeNode in="outline"/><feMergeNode in="SourceGraphic"/></feMerge></filter>',n=Number.isFinite(t.margin)?t.margin:2,r=Number.isFinite(t.width)?t.width:1;return ye(e)({color:t.color||"blue",opacity:Number.isFinite(t.opacity)?t.opacity:1,outerRadius:n+r,innerRadius:n})},highlight:function(t){var e='<filter><feFlood flood-color="${color}" flood-opacity="${opacity}" result="colored"/><feMorphology result="morphed" in="SourceGraphic" operator="dilate" radius="${width}"/><feComposite result="composed" in="colored" in2="morphed" operator="in"/><feGaussianBlur result="blured" in="composed" stdDeviation="${blur}"/><feBlend in="SourceGraphic" in2="blured" mode="normal"/></filter>';return ye(e)({color:t.color||"red",width:Number.isFinite(t.width)?t.width:1,blur:Number.isFinite(t.blur)?t.blur:0,opacity:Number.isFinite(t.opacity)?t.opacity:1})},blur:function(t){var e=Number.isFinite(t.x)?t.x:2;return ye('<filter><feGaussianBlur stdDeviation="${stdDeviation}"/></filter>')({stdDeviation:Number.isFinite(t.y)?[e,t.y]:e})},dropShadow:function(t){var e="SVGFEDropShadowElement"in window?'<filter><feDropShadow stdDeviation="${blur}" dx="${dx}" dy="${dy}" flood-color="${color}" flood-opacity="${opacity}"/></filter>':'<filter><feGaussianBlur in="SourceAlpha" stdDeviation="${blur}"/><feOffset dx="${dx}" dy="${dy}" result="offsetblur"/><feFlood flood-color="${color}"/><feComposite in2="offsetblur" operator="in"/><feComponentTransfer><feFuncA type="linear" slope="${opacity}"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter>';return ye(e)({dx:t.dx||0,dy:t.dy||0,opacity:Number.isFinite(t.opacity)?t.opacity:1,color:t.color||"black",blur:Number.isFinite(t.blur)?t.blur:4})},grayscale:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return ye('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${b} ${h} 0 0 0 0 0 1 0"/></filter>')({a:.2126+.7874*(1-e),b:.7152-.7152*(1-e),c:.0722-.0722*(1-e),d:.2126-.2126*(1-e),e:.7152+.2848*(1-e),f:.0722-.0722*(1-e),g:.2126-.2126*(1-e),h:.0722+.9278*(1-e)})},sepia:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return ye('<filter><feColorMatrix type="matrix" values="${a} ${b} ${c} 0 0 ${d} ${e} ${f} 0 0 ${g} ${h} ${i} 0 0 0 0 0 1 0"/></filter>')({a:.393+.607*(1-e),b:.769-.769*(1-e),c:.189-.189*(1-e),d:.349-.349*(1-e),e:.686+.314*(1-e),f:.168-.168*(1-e),g:.272-.272*(1-e),h:.534-.534*(1-e),i:.131+.869*(1-e)})},saturate:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return ye('<filter><feColorMatrix type="saturate" values="${amount}"/></filter>')({amount:1-e})},hueRotate:function(t){return ye('<filter><feColorMatrix type="hueRotate" values="${angle}"/></filter>')({angle:t.angle||0})},invert:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return ye('<filter><feComponentTransfer><feFuncR type="table" tableValues="${amount} ${amount2}"/><feFuncG type="table" tableValues="${amount} ${amount2}"/><feFuncB type="table" tableValues="${amount} ${amount2}"/></feComponentTransfer></filter>')({amount:e,amount2:1-e})},brightness:function(t){return ye('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}"/><feFuncG type="linear" slope="${amount}"/><feFuncB type="linear" slope="${amount}"/></feComponentTransfer></filter>')({amount:Number.isFinite(t.amount)?t.amount:1})},contrast:function(t){var e=Number.isFinite(t.amount)?t.amount:1;return ye('<filter><feComponentTransfer><feFuncR type="linear" slope="${amount}" intercept="${amount2}"/><feFuncG type="linear" slope="${amount}" intercept="${amount2}"/><feFuncB type="linear" slope="${amount}" intercept="${amount2}"/></feComponentTransfer></filter>')({amount:e,amount2:.5-e/2})}},Cm={number:function(t,e,n){n=n||{currency:["$",""],decimal:".",thousands:",",grouping:[3]};var r=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,i=r.exec(t),s=i[1]||" ",o=i[2]||">",l=i[3]||"",a=i[4]||"",c=i[5],u=+i[6],h=i[7],g=i[8],d=i[9],v=1,y="",x="",A=!1;switch(g&&(g=+g.substring(1)),(c||s==="0"&&o==="=")&&(c=s="0",o="=",h&&(u-=Math.floor((u-1)/4))),d){case"n":h=!0,d="g";break;case"%":v=100,x="%",d="f";break;case"p":v=100,x="%",d="r";break;case"b":case"o":case"x":case"X":a==="#"&&(y="0"+d.toLowerCase());break;case"c":case"d":A=!0,g=0;break;case"s":v=-1,d="r";break}a==="$"&&(y=n.currency[0],x=n.currency[1]),d=="r"&&!g&&(d="g"),g!=null&&(d=="g"?g=Math.max(1,Math.min(21,g)):(d=="e"||d=="f")&&(g=Math.max(0,Math.min(20,g))));var T=c&&h;if(A&&e%1)return"";var f=e<0||e===0&&1/e<0?(e=-e,"-"):l,p=x;if(v<0){var m=this.prefix(e,g);e=m.scale(e),p=m.symbol+x}else e*=v;e=this.convert(d,e,g);var w=e.lastIndexOf("."),b=w<0?e:e.substring(0,w),P=w<0?"":n.decimal+e.substring(w+1);function E(I){for(var D=I.length,H=[],X=0,L=n.grouping[0];D>0&&L>0;)H.push(I.substring(D-=L,D+L)),L=n.grouping[X=(X+1)%n.grouping.length];return H.reverse().join(n.thousands)}!c&&h&&n.grouping&&(b=E(b));var C=y.length+b.length+P.length+(T?0:f.length),k=C<u?new Array(C=u-C+1).join(s):"";return T&&(b=E(k+b)),f+=y,e=b+P,(o==="<"?f+e+k:o===">"?k+f+e:o==="^"?k.substring(0,C>>=1)+f+e+k.substring(C):f+(T?e:k+e))+p},string:function(t,e){for(var n,r="{",i=!1,s=[];(n=t.indexOf(r))!==-1;){var o,l,a;if(o=t.slice(0,n),i){l=o.split(":"),a=l.shift().split("."),o=e;for(var c=0;c<a.length;c++)o=o[a[c]];l.length&&(o=this.number(l,o))}s.push(o),t=t.slice(n+1),i=!i,r=i?"}":"{"}return s.push(t),s.join("")},convert:function(t,e,n){switch(t){case"b":return e.toString(2);case"c":return String.fromCharCode(e);case"o":return e.toString(8);case"x":return e.toString(16);case"X":return e.toString(16).toUpperCase();case"g":return e.toPrecision(n);case"e":return e.toExponential(n);case"f":return e.toFixed(n);case"r":return(e=this.round(e,this.precision(e,n))).toFixed(Math.max(0,Math.min(20,this.precision(e*(1+1e-15),n))));default:return e+""}},round:function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)},precision:function(t,e){return e-(t?Math.ceil(Math.log(t)/Math.LN10):1)},prefix:function(t,e){var n=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"].map(function(i,s){var o=Math.pow(10,Math.abs(8-s)*3);return{scale:s>8?function(l){return l/o}:function(l){return l*o},symbol:i}}),r=0;return t&&(t<0&&(t*=-1),e&&(t=this.round(t,this.precision(t,e))),r=1+Math.floor(1e-12+Math.log(t)/Math.LN10),r=Math.max(-24,Math.min(24,Math.floor((r<=0?r+1:r-1)/3)*3))),n[8+r/3]}},ye=function(t){var e=/<%= ([^ ]+) %>|\$\{ ?([^{} ]+) ?\}|\{\{([^{} ]+)\}\}/g;return function(n){return n=n||{},t.replace(e,function(r){for(var i=Array.from(arguments),s=i.slice(1,4).find(function(a){return!!a}),o=s.split("."),l=n[o.shift()];l!==void 0&&o.length;)l=l[o.shift()];return l!==void 0?l:""})}},Lm=function(t){var e=window.top.document;t=t||e.body;function n(r,i){for(var s=["webkit","moz","ms","o",""],o=0;o<s.length;o++){var l=s[o],a=l?l+i:i.substr(0,1).toLowerCase()+i.substr(1);if(r[a]!==void 0)return bt(r[a])?r[a]():r[a]}}n(e,"FullscreenElement")||n(e,"FullScreenElement")?n(e,"ExitFullscreen")||n(e,"CancelFullScreen"):n(t,"RequestFullscreen")||n(t,"RequestFullScreen")};function gu(t,e,n,r){if(n===r)return{};const i={};return Object.keys(t).forEach(s=>{const o=t[s],l=e[s];if(!Array.isArray(o)&&!Array.isArray(l)&&gt(o)&&gt(l)){const a=n+1,c=gu(o,l,a,r);Object.keys(c).length>0?i[s]=c:(n===0||a===r)&&(i[s]={})}else Re(o,l)||(i[s]=o)}),i}function pu(t,e,n){const{maxDepth:r=Number.POSITIVE_INFINITY}=n||{};return gu(t,e,0,r)}const vu=function(){};var Gt={},mu=/\s+/,Je,An=function(t,e,n,r,i){var s=0,o;if(n&&typeof n=="object")for(r!==void 0&&("context"in i)&&i.context===void 0&&(i.context=r),o=Object.keys(n);s<o.length;s++)e=An(t,e,o[s],n[o[s]],i);else if(n&&mu.test(n))for(o=n.split(mu);s<o.length;s++)e=t(e,o[s],r,i);else e=t(e,n,r,i);return e};Gt.on=function(t,e,n){if(this._events=An(_m,this._events||{},t,e,{context:n,ctx:this,listening:Je}),Je){var r=this._listeners||(this._listeners={});r[Je.id]=Je,Je.interop=!1}return this},Gt.listenTo=function(t,e,n){if(!t)return this;var r=t._listenId||(t._listenId=wn("l")),i=this._listeningTo||(this._listeningTo={}),s=Je=i[r];s||(this._listenId||(this._listenId=wn("l")),s=Je=i[r]=new Li(this,t));var o=Mm(t,e,n,this);if(Je=void 0,o)throw o;return s.interop&&s.on(e,n),this};var _m=function(t,e,n,r){if(n){var i=t[e]||(t[e]=[]),s=r.context,o=r.ctx,l=r.listening;l&&l.count++,i.push({callback:n,context:s,ctx:s||o,listening:l})}return t},Mm=function(t,e,n,r){try{t.on(e,n,r)}catch(i){return i}};Gt.off=function(t,e,n){return this._events?(this._events=An(yu,this._events,t,e,{context:n,listeners:this._listeners}),this):this},Gt.stopListening=function(t,e,n){var r=this._listeningTo;if(!r)return this;for(var i=t?[t._listenId]:Object.keys(r),s=0;s<i.length;s++){var o=r[i[s]];if(!o)break;o.obj.off(e,n,this),o.interop&&o.off(e,n)}return re(r)&&(this._listeningTo=void 0),this};var yu=function(t,e,n,r){if(t){var i=r.context,s=r.listeners,o=0,l;if(!e&&!i&&!n){if(s!=null)for(l=Object.keys(s);o<l.length;o++)s[l[o]].cleanup();return}for(l=e?[e]:Object.keys(t);o<l.length;o++){e=l[o];var a=t[e];if(!a)break;for(var c=[],u=0;u<a.length;u++){var h=a[u];if(n&&n!==h.callback&&n!==h.callback._callback||i&&i!==h.context)c.push(h);else{var g=h.listening;g&&g.off(e,n)}}c.length?t[e]=c:delete t[e]}return t}};Gt.once=function(t,e,n){var r=An(wu,{},t,e,this.off.bind(this));return typeof t=="string"&&n==null&&(e=void 0),this.on(r,e,n)},Gt.listenToOnce=function(t,e,n){var r=An(wu,{},e,n,this.stopListening.bind(this,t));return this.listenTo(t,r)};var wu=function(t,e,n,r){if(n){var i=t[e]=Om(function(){r(e,i),n.apply(this,arguments)});i._callback=n}return t},Om=function(t){var e;if(typeof t!="function")throw new TypeError("Expected a function");var n=2;return function(){return--n>0&&(e=t.apply(this,arguments)),n<=1&&(t=void 0),e}};Gt.trigger=function(t){if(!this._events)return this;for(var e=Math.max(0,arguments.length-1),n=Array(e),r=0;r<e;r++)n[r]=arguments[r+1];return An(Nm,this._events,t,void 0,n),this};var Nm=function(t,e,n,r){if(t){var i=t[e],s=t.all;i&&s&&(s=s.slice()),i&&bu(i,r),s&&bu(s,[e].concat(r))}return t},bu=function(t,e){var n,r=-1,i=t.length,s=e[0],o=e[1],l=e[2];switch(e.length){case 0:for(;++r<i;)(n=t[r]).callback.call(n.ctx);return;case 1:for(;++r<i;)(n=t[r]).callback.call(n.ctx,s);return;case 2:for(;++r<i;)(n=t[r]).callback.call(n.ctx,s,o);return;case 3:for(;++r<i;)(n=t[r]).callback.call(n.ctx,s,o,l);return;default:for(;++r<i;)(n=t[r]).callback.apply(n.ctx,e);return}},Li=function(t,e){this.id=t._listenId,this.listener=t,this.obj=e,this.interop=!0,this.count=0,this._events=void 0};Li.prototype.on=Gt.on,Li.prototype.off=function(t,e){var n;this.interop?(this._events=An(yu,this._events,t,e,{context:void 0,listeners:void 0}),n=!this._events):(this.count--,n=this.count===0),n&&this.cleanup()},Li.prototype.cleanup=function(){delete this.listener._listeningTo[this.obj._listenId],this.interop||delete this.obj._listeners[this.id]},Gt.bind=Gt.on,Gt.unbind=Gt.off;var wo=function(t,e){var n=this,r;return t&&ve(t,"constructor")?r=t.constructor:r=function(){return n.apply(this,arguments)},j(r,n,e),r.prototype=Object.assign(Object.create(n.prototype),t),r.prototype.constructor=r,r.__super__=n.prototype,r},km=function(t,e,n,r){switch(e){case 1:return function(){return t[n](this[r])};case 2:return function(i){return t[n](this[r],i)};case 3:return function(i,s){return t[n](this[r],xu(i,this),s)};case 4:return function(i,s,o){return t[n](this[r],xu(i,this),s,o)};default:return function(){var i=Array.prototype.slice.call(arguments);return i.unshift(this[r]),t[n].apply(t,i)}}},Im=function(t,e,n,r){_e(n,function(i,s){e[s]&&(t.prototype[s]=km(e,i,s,r))})},xu=function(t,e){return bt(t)?t:gt(t)&&!e._isModel(t)?Rm(t):Mt(t)?function(n){return n.get(t)}:t},Rm=function(t){var e=xv(t);return function(n){return e(n.attributes)}},Ve=function(t,e){var n=t||{};e||(e={}),this.eventPrefix=e.eventPrefix||"",this.preinitialize.apply(this,arguments),this.cid=wn(this.cidPrefix),this.attributes={},e.collection&&(this.collection=e.collection),this._setDefaults(n,e),this.changed={},this.initialize.apply(this,arguments)};j(Ve.prototype,Gt,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(t){return kt(this.attributes)},get:function(t){return this.attributes[t]},has:function(t){return this.get(t)!=null},set:function(t,e,n){if(t==null)return this;var r;if(typeof t=="object"?(r=t,n=e):(r={})[t]=e,n||(n={}),!this._validate(r,n))return!1;var i=n.unset,s=n.silent,o=[],l=this._changing;this._changing=!0,l||(this._previousAttributes=kt(this.attributes),this.changed={});var a=this.attributes,c=this.changed,u=this._previousAttributes;for(var h in r)e=r[h],Re(a[h],e)||o.push(h),Re(u[h],e)?delete c[h]:c[h]=e,i?delete a[h]:a[h]=e;if(this.idAttribute in r){var g=this.id;this.id=this.get(this.idAttribute),this.trigger(this.eventPrefix+"changeId",this,g,n)}if(!s){o.length&&(this._pending=n);for(var d=0;d<o.length;d++)this.trigger(this.eventPrefix+"change:"+o[d],this,a[o[d]],n)}if(l)return this;if(!s)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger(this.eventPrefix+"change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(t,e){return this.set(t,void 0,j({},e,{unset:!0}))},clear:function(t){var e={};for(var n in this.attributes)e[n]=void 0;return this.set(e,j({},t,{unset:!0}))},hasChanged:function(t){return t==null?!re(this.changed):ve(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?kt(this.changed):!1;var e=this._changing?this._previousAttributes:this.attributes,n={},r;for(var i in t){var s=t[i];Re(e[i],s)||(n[i]=s,r=!0)}return r?n:!1},previous:function(t){return t==null||!this._previousAttributes?null:this._previousAttributes[t]},previousAttributes:function(){return kt(this._previousAttributes)},clone:function(){return new this.constructor(this.attributes)},isValid:function(t){return this._validate({},j({},t,{validate:!0}))},_validate:function(t,e){if(!e.validate||!this.validate)return!0;t=j({},this.attributes,t);var n=this.validationError=this.validate(t,e)||null;return n?(this.trigger("invalid",this,n,j(e,{validationError:n})),!1):!0},_setDefaults:function(t,e){const n=Ct(this,"defaults"),r=Yt(j({},n,t),n);this.set(r,e)}}),Ve.extend=wo;function bo(t){t=Ye(t);const e=xt(t).reduce(function(n,r){return n[r.id]=r.clone(),n},{});return xt(t).forEach(function(n){const r=e[n.id];if(r.isLink()){const o=r.source(),l=r.target();o.id&&e[o.id]&&r.prop("source/id",e[o.id].id),l.id&&e[l.id]&&r.prop("target/id",e[l.id].id)}const i=n.get("parent");i&&e[i]&&r.set("parent",e[i].id);const s=xt(n.get("embeds")).reduce(function(o,l){return e[l]&&o.push(e[l].id),o},[]);re(s)||r.set("embeds",s)}),e}const Vm=["checked","selected","disabled","readOnly","contentEditable","value","indeterminate"].reduce((t,e)=>(t[e]=!0,t),{}),Dm={qualify:function(t){return It(t)},set:function(t,e,n){Object.keys(t).forEach(function(r){if(Vm[r]&&r in n){const i=t[r];n.tagName==="SELECT"&&Array.isArray(i)?Array.from(n.options).forEach(function(s,o){s.selected=i.includes(s.value)}):n[r]=i}})}};function _i(t,e,n){return function(r,i){var s=Ut(r);r=parseFloat(r),s&&(r/=100);var o;if(isFinite(r)){var l=i[n]();s||r>0&&r<1?o=l[t]+i[e]*r:o=l[t]+r}var a=S();return a[t]=o||0,a}}function Qe(t,e){return function(n,r){var i=Ut(n);n=parseFloat(n),i&&(n/=100);var s={};if(isFinite(n)){var o=i||n>=0&&n<=1?n*r[e]:Math.max(n+r[e],0);s[t]=o}return s}}const Xt={"ref-x":{position:_i("x","width","origin")},"ref-y":{position:_i("y","height","origin")},"ref-dx":{position:_i("x","width","corner")},"ref-dy":{position:_i("y","height","corner")},"ref-width":{set:Qe("width","width")},"ref-height":{set:Qe("height","height")},"ref-rx":{set:Qe("rx","width")},"ref-ry":{set:Qe("ry","height")},"ref-cx":{set:Qe("cx","width")},"ref-cy":{set:Qe("cy","height")},"ref-r-inscribed":{set:(function(t){var e=Qe(t,"width"),n=Qe(t,"height");return function(r,i){var s=i.height>i.width?e:n;return s(r,i)}})("r")},"ref-r-circumscribed":{set:function(t,e){var n=Ut(t);t=parseFloat(t),n&&(t/=100);var r=Math.sqrt(e.height*e.height+e.width*e.width),i;return isFinite(t)&&(n||t>=0&&t<=1?i=t*r:i=Math.max(t+r,0)),{r:i}}}};Xt.refX=Xt["ref-x"],Xt.refY=Xt["ref-y"],Xt["ref-x2"]=Xt["ref-x"],Xt["ref-y2"]=Xt["ref-y"],Xt["ref-width2"]=Xt["ref-width"],Xt["ref-height2"]=Xt["ref-height"],Xt["ref-r"]=Xt["ref-r-inscribed"];const De={x:"x",y:"y",width:"w",height:"h",minimum:"s",maximum:"l",diagonal:"d"},Fm=Object.keys(De).map(t=>De[t]).join(""),xo="[-+]?[0-9]*\\.?[0-9]+(?:[eE][-+]?[0-9]+)?",Bm=/\s/g,Au=new RegExp(`^(${xo}\\*)?([${Fm}])(/${xo})?([-+]{1,2}${xo})?$`,"g");function Pu(t){throw new Error(`Invalid calc() expression: ${t}`)}function Tu(t,e){const n=Au.exec(t.replace(Bm,""));n||Pu(t),Au.lastIndex=0;const[,r,i,s,o]=n,{x:l,y:a,width:c,height:u}=e;let h=0;switch(i){case De.width:{h=c;break}case De.height:{h=u;break}case De.x:{h=l;break}case De.y:{h=a;break}case De.minimum:{h=Math.min(u,c);break}case De.maximum:{h=Math.max(u,c);break}case De.diagonal:{h=Math.sqrt(u*u+c*c);break}}return r&&(h*=parseFloat(r)),s&&(h/=parseFloat(s.slice(1))),o&&(h+=Gm(o)),h}function Gm(t){if(!t)return 0;const[e]=t;switch(e){case"+":return parseFloat(t.substr(1));case"-":return-parseFloat(t.substr(1))}return parseFloat(t)}function Se(t){return typeof t=="string"&&t.includes("calc")}const Su="calc(",Eu=Su.length;function Ee(t,e){let n=t,r=0;do{let i=n.indexOf(Su,r);if(i===-1)return n;let s=i+Eu,o=1;t:do{switch(n[s]){case"(":{o++;break}case")":{if(o--,o===0)break t;break}case void 0:Pu(n)}s++}while(!0);let l=n.slice(i+Eu,s);Se(l)&&(l=Ee(l,e));const a=String(Tu(l,e));n=n.slice(0,i)+a+n.slice(s+1),r=i+a.length}while(!0)}function Un(t,e,n){return n.text!==void 0}const Ao=["font-weight","font-family","font-size","letter-spacing","text-transform"],Cu={"line-height":{qualify:Un},"text-vertical-anchor":{qualify:Un},"text-path":{qualify:Un},annotations:{qualify:Un},eol:{qualify:Un},"display-empty":{qualify:Un},text:{qualify:function(t,e,n){const r=n["text-wrap"];return!r||!It(r)},unset:function(t){t.textContent=""},set:function(t,e,n,r){const i="joint-text",s=z.data.get(n,i),o=r["line-height"],l=r["text-vertical-anchor"],a=r["display-empty"],c=r["font-size"],u=r.annotations,h=r.eol,g=r.x;let d=r["text-path"];const v=r["use-no-break-space"]===!0,y=JSON.stringify([t,o,u,l,h,a,d,g,c,v]);if(s===void 0||s!==y){if(c&&n.setAttribute("font-size",c),gt(d)){const x=d.selector;if(typeof x=="string"){const A=this.findNode(x);A instanceof SVGPathElement&&(d=j({"xlink:href":"#"+A.id},d))}}N(n).text(""+t,{lineHeight:o,annotations:u,textPath:d,x:g,textVerticalAnchor:l,eol:h,displayEmpty:a,useNoBreakSpace:v}),z.data.set(n,i,y)}}},"text-wrap":{qualify:It,set:function(t,e,n,r){var i={},s=t.width||0;Ut(s)?i.width=e.width*parseFloat(s)/100:Se(s)?i.width=Number(Ee(s,e)):t.width===null?i.width=1/0:s<=0?i.width=e.width+s:i.width=s;var o=t.height||0;Ut(o)?i.height=e.height*parseFloat(o)/100:Se(o)?i.height=Number(Ee(o,e)):t.height===null||(o<=0?i.height=e.height+o:i.height=o);var l,a=t.text;if(a===void 0&&(a=r.text),a!==void 0){const c=t.breakText||lu,u=getComputedStyle(n),h={};for(let d=0;d<Ao.length;d++){const v=Ao[d];v in r&&n.setAttribute(v,r[v]),h[v]=u[v]}h.lineHeight=r["line-height"];let g=this.paper.svg;g.checkVisibility()||(g=null),l=c(""+a,i,h,{svgDocument:g,ellipsis:t.ellipsis,hyphen:t.hyphen,separator:t.separator,maxLineCount:t.maxLineCount,preserveSpaces:t.preserveSpaces})}else l="";Cu.text.set.call(this,l,e,n,r)},FONT_ATTRIBUTES:Ao},title:{qualify:function(t,e){return e instanceof SVGElement},unset:function(t){z.data.remove(t,"joint-title");const e=t.firstElementChild;e&&e.remove()},set:function(t,e,n){var r="joint-title",i=z.data.get(n,r);if(i===void 0||i!==t){if(z.data.set(n,r,t),n.tagName==="title"){n.textContent=t;return}var s=n.firstElementChild;if(s&&s.tagName==="title")s.textContent=t;else{var o=document.createElementNS(n.namespaceURI,"title");o.textContent=t,n.insertBefore(o,s)}}}}};function Mi(t,e){var n=new S(1,0);return function(r){var i,s,o=this[t](r);return o?(s=e.rotate?o.vector().vectorAngle(n):0,i=o.start):(i=this.path.start,s=0),s===0?{transform:"translate("+i.x+","+i.y+")"}:{transform:"translate("+i.x+","+i.y+") rotate("+s+")"}}}function wr(){return this.model.isLink()}const br={connection:{qualify:wr,unset:"d",set:function({stubs:t=0}){let e;if(isFinite(t)&&t!==0){let n;t<0?n=(this.getConnectionLength()+t)/2:n=t;const r=this.getConnection(),i=this.getConnectionSubdivisions(),s=r.divideAtLength(n,{segmentSubdivisions:i}),o=r.divideAtLength(-n,{segmentSubdivisions:i});s&&o&&(e=`${s[0].serialize()} ${o[1].serialize()}`)}return{d:e||this.getSerializedConnection()}}},"at-connection-length-keep-gradient":{qualify:wr,unset:"transform",set:Mi("getTangentAtLength",{rotate:!0})},"at-connection-length-ignore-gradient":{qualify:wr,unset:"transform",set:Mi("getTangentAtLength",{rotate:!1})},"at-connection-ratio-keep-gradient":{qualify:wr,unset:"transform",set:Mi("getTangentAtRatio",{rotate:!0})},"at-connection-ratio-ignore-gradient":{qualify:wr,unset:"transform",set:Mi("getTangentAtRatio",{rotate:!1})}};br["at-connection-length"]=br["at-connection-length-keep-gradient"],br["at-connection-ratio"]=br["at-connection-ratio-keep-gradient"];function Lu(t,e){var n="joint-shape",r=e&&e.resetOffset;return function(i,s,o){var l=z.data.get(o,n);if(!l||l.value!==i){var a=t(i);l={value:i,shape:a,shapeBBox:a.bbox()},z.data.set(o,n,l)}var c=l.shape.clone(),u=l.shapeBBox.clone(),h=u.origin(),g=s.origin();u.x=g.x,u.y=g.y;var d=s.maxRectScaleToFit(u,g),v=u.width===0||s.width===0?1:d.sx,y=u.height===0||s.height===0?1:d.sy;return c.scale(v,y,h),r&&c.translate(-h.x,-h.y),c}}function _u(t){function e(r){return new Z(N.normalizePathData(r))}var n=Lu(e,t);return function(r,i,s){var o=n(r,i,s);return{d:o.serialize()}}}function Mu(t){var e=Lu(Lt,t);return function(n,r,i){var s=e(n,r,i);return{points:s.serialize()}}}const xr={"ref-d-reset-offset":{unset:"d",set:_u({resetOffset:!0})},"ref-d-keep-offset":{unset:"d",set:_u({resetOffset:!1})},"ref-points-reset-offset":{unset:"points",set:Mu({resetOffset:!0})},"ref-points-keep-offset":{unset:"points",set:Mu({resetOffset:!1})}};xr["ref-d"]=xr["ref-d-reset-offset"],xr["ref-points"]=xr["ref-points-reset-offset"];function Po(t){var e={},n=t.stroke;typeof n=="string"&&(e.stroke=n,e.fill=n);var r=t["stroke-opacity"];return r===void 0&&(r=t.opacity),r!==void 0&&(e["stroke-opacity"]=r,e["fill-opacity"]=r),e}function Ou(t){const{paper:e}=this;return`url(#${t.type==="pattern"?e.definePattern(t):e.defineGradient(t)})`}const zm={"source-marker":{qualify:It,unset:"marker-start",set:function(t,e,n,r){return t=j(Po(r),t),{"marker-start":"url(#"+this.paper.defineMarker(t)+")"}}},"target-marker":{qualify:It,unset:"marker-end",set:function(t,e,n,r){return t=j(Po(r),{transform:"rotate(180)"},t),{"marker-end":"url(#"+this.paper.defineMarker(t)+")"}}},"vertex-marker":{qualify:It,unset:"marker-mid",set:function(t,e,n,r){return t=j(Po(r),t),{"marker-mid":"url(#"+this.paper.defineMarker(t)+")"}}},fill:{qualify:It,set:Ou},stroke:{qualify:It,set:Ou},filter:{qualify:It,set:function(t){return"url(#"+this.paper.defineFilter(t)+")"}}};function Nu(t,e,n){return function(r,i){var s;r==="middle"?s=i[e]/2:r===n?s=i[e]:isFinite(r)?s=r>-1&&r<1?-i[e]*r:-r:Ut(r)?s=i[e]*parseFloat(r)/100:s=0;var o=new S;return o[t]=-(i[t]+s),o}}const Um={"x-alignment":{offset:Nu("x","width","right")},"y-alignment":{offset:Nu("y","height","bottom")},"reset-offset":{offset:function(t,e){return t?{x:-e.x,y:-e.y}:{x:0,y:0}}}};function ku(t){return function(n,r,i){const s=N(i);s.attr(t)!==n&&s.attr(t,n)}}const Pn={ref:{},href:{set:ku("href")},"xlink:href":{set:ku("xlink:href")},port:{set:function(t){return t===null||t.id===void 0?t:t.id}},style:{qualify:It,set:function(t,e,n){z(n).css(t)}},html:{unset:function(t){z(t).empty()},set:function(t,e,n){z(n).html(t+"")}},props:Dm};j(Pn,Xt),j(Pn,Cu),j(Pn,br),j(Pn,xr),j(Pn,zm),j(Pn,Um);const To=Pn,ae=Symbol("joint.cellMarker"),Iu=Symbol("joint.cellCollectionMarker"),So=Symbol("joint.graphLayerMarker"),Ru=Symbol("joint.graphLayerCollectionMarker"),tn=Symbol("joint.cellViewMarker"),Vu=Symbol("joint.layerViewMarker"),Eo=Symbol("joint.graphLayerViewMarker"),$m=function(t,e){if(Array.isArray(t))return zt(e)};function Du(t){for(const e in t){const n=t[e];gt(n)&&!Array.isArray(n)&&re(n)&&delete t[e]}}const Ce=Ve.extend({cidPrefix:"c",_setDefaults:function(t,e){let n;const r=Ct(this,"defaults");if(r){const i=e&&e.mergeArrays===!0?!1:Bt.cellDefaultsMergeStrategy||$m;n=Nt({},r,t,i)}else n=t;this.set(n,e)},translate:function(t,e,n){throw new Error("Must define a translate() method.")},toJSON:function(t){const{ignoreDefaults:e,ignoreEmptyAttributes:n=!1}=t||{},r=Ct(this.constructor.prototype,"defaults");if(e===!1){const l=zt(this.attributes);return n&&Du(l),l}let i={},s=zt(this.attributes);e===!0?i=r:(Array.isArray(e)?e:["attrs"]).forEach(a=>{i[a]=r[a]||{}});const o=pu(s,Xe(i,"id","type"),{maxDepth:4});return n&&Du(o),o},initialize:function(t){const e=this.getIdAttribute();(!t||t[e]===void 0)&&this.set(e,this.generateId(),{silent:!0}),this._transitionIds={},this._scheduledTransitionIds={},this.processPorts(),this.on("change:attrs",this.processPorts,this)},getIdAttribute:function(){return this.idAttribute||"id"},generateId:function(){return ru()},processPorts:function(){var t=this.ports,e={};_e(this.get("attrs"),function(s,o){s&&s.port&&(s.port.id!==void 0?e[s.port.id]=s.port:e[s.port]={id:s.port})});var n={};if(_e(t,function(s,o){e[o]||(n[o]=!0)}),this.graph&&!re(n)){var r=this.graph.getConnectedLinks(this,{inbound:!0});r.forEach(function(s){n[s.get("target").port]&&s.remove()});var i=this.graph.getConnectedLinks(this,{outbound:!0});i.forEach(function(s){n[s.get("source").port]&&s.remove()})}this.ports=e},remove:function(t={}){const{graph:e,collection:n}=this;return e?e.removeCell(this,t):n&&n.remove(this,t),this},toFront:function(t){const{graph:e}=this;if(e){t=Yt(t||{},{foregroundEmbeds:!0});let n;t.deep?(n=this.getEmbeddedCells({deep:!0,breadthFirst:t.breadthFirst!==!1,sortSiblings:t.foregroundEmbeds}),n.unshift(this)):n=[this];const r=t.foregroundEmbeds?n:Gn(n,c=>c.z()),i=e.getCellLayerId(this);let o=e.maxZIndex(i)-n.length+1;const l=e.getLayer(i).cellCollection.toArray();let a=l.indexOf(r[0])!==l.length-n.length;a||(a=r.some(function(c,u){return c.z()!==o+u})),a&&(this.startBatch("to-front"),o=o+n.length,r.forEach(function(c,u){c.set("z",o+u,t)}),this.stopBatch("to-front"))}return this},toBack:function(t){const{graph:e}=this;if(e){t=Yt(t||{},{foregroundEmbeds:!0});let n;t.deep?(n=this.getEmbeddedCells({deep:!0,breadthFirst:t.breadthFirst!==!1,sortSiblings:t.foregroundEmbeds}),n.unshift(this)):n=[this];const r=t.foregroundEmbeds?n:Gn(n,a=>a.z()),i=e.getCellLayerId(this);let s=e.minZIndex(i),l=e.getLayer(i).cellCollection.toArray().indexOf(r[0])!==0;l||(l=r.some(function(a,c){return a.z()!==s+c})),l&&(this.startBatch("to-back"),s-=n.length,r.forEach(function(a,c){a.set("z",s+c,t)}),this.stopBatch("to-back"))}return this},parent:function(t,e){return t===void 0?this.get("parent"):this.set("parent",t,e)},embed:function(t,e={}){const n=Array.isArray(t)?t:[t];if(!this.canEmbed(n))throw new Error("Recursive embedding not allowed.");if(e.reparent)Ye(n.map(i=>i.getParentCell())).forEach(i=>{i&&i._unembedCells(n,e)});else if(n.some(r=>r.isEmbedded()&&this.id!==r.parent()))throw new Error("Embedding of already embedded cells is not allowed.");return this._embedCells(n,e),this},unembed:function(t,e){const n=Array.isArray(t)?t:[t];return this._unembedCells(n,e),this},canEmbed:function(t){return(Array.isArray(t)?t:[t]).every(n=>this!==n&&!this.isEmbeddedIn(n))},_embedCells:function(t,e){const n="embed";this.startBatch(n);const r=j([],this.get("embeds"));t.forEach(i=>{r[i.isLink()?"unshift":"push"](i.id),i.parent(this.id,e)}),this.set("embeds",Ye(r),e),this.stopBatch(n)},_unembedCells:function(t,e){const n="unembed";this.startBatch(n),t.forEach(r=>r.unset("parent",e)),this.set("embeds",io(this.get("embeds"),...t.map(r=>r.id)),e),this.stopBatch(n)},getParentCell:function(){var t=this.parent(),e=this.graph;return t&&e&&e.getCell(t)||null},getAncestors:function(){var t=[];if(!this.graph)return t;for(var e=this.getParentCell();e;)t.push(e),e=e.getParentCell();return t},getEmbeddedCells:function(t){if(t=t||{},!this.graph)return[];if(t.deep)return t.breadthFirst?this._getEmbeddedCellsBfs(t.sortSiblings):this._getEmbeddedCellsDfs(t.sortSiblings);const e=this.get("embeds");if(re(e))return[];let n=e.map(this.graph.getCell,this.graph);return t.sortSiblings&&(n=Gn(n,r=>r.z())),n},_getEmbeddedCellsBfs:function(t){const e=[],n=[];for(n.push(this);n.length>0;){const r=n.shift();e.push(r);const i=r.getEmbeddedCells({sortSiblings:t});n.push(...i)}return e.shift(),e},_getEmbeddedCellsDfs:function(t){const e=[],n=[];for(n.push(this);n.length>0;){const r=n.pop();e.push(r);const i=r.getEmbeddedCells({sortSiblings:t});for(let s=i.length-1;s>=0;--s)n.push(i[s])}return e.shift(),e},isEmbeddedIn:function(t,e){var n=Mt(t)?t:t.id,r=this.parent();if(e=j({deep:!0},e),this.graph&&e.deep){for(;r;){if(r===n)return!0;r=this.graph.getCell(r).parent()}return!1}else return r===n},isEmbedded:function(){return!!this.parent()},clone:function(t){if(t=t||{},t.deep)return xt(bo([this].concat(this.getEmbeddedCells({deep:!0}))));{const e=new this.constructor(this.attributes,{portLayoutNamespace:this.portLayoutNamespace,portLabelLayoutNamespace:this.portLabelLayoutNamespace});return e.set(this.getIdAttribute(),this.generateId()),e.unset("embeds"),e.unset("parent"),e}},prop:function(t,e,n){var r="/",i=Mt(t);if(i||Array.isArray(t))if(arguments.length>1){var s,o;i?(s=t,o=s.split("/")):(s=t.join(r),o=t.slice());var l=o[0],a=o.length;const f=n||{};f.propertyPath=s,f.propertyValue=e,f.propertyPathArray=o,"rewrite"in f||(f.rewrite=!1);for(var c={},u=c,h=l,g=1;g<a;g++){var d=o[g],v=Number.isFinite(i?Number(d):d);u=u[h]=v?[]:{},h=d}c=vo(c,o,e,"/");var y=Nt({},this.attributes);f.rewrite&&mo(y,s,"/");var x=Nt(y,c,Bt.cellMergeStrategy);return this.set(l,x[l],f)}else return Ze(this.attributes,t,r);const A=e||{};A.propertyPath=null,A.propertyValue=t,A.propertyPathArray=[],"rewrite"in A||(A.rewrite=!1);const T={};for(const f in t){const{changedValue:p}=Nt(Nt({},{changedValue:this.attributes[f]}),{changedValue:t[f]},Bt.cellMergeStrategy);T[f]=p}return this.set(T,A)},removeProp:function(t,e){e=e||{};var n=Array.isArray(t)?t:t.split("/"),r=n[0];if(r==="attrs"&&(e.dirty=!0),n.length===1)return this.unset(t,e);var i=n.slice(1),s=this.get(r);return s==null?this:(s=zt(s),mo(s,i,"/"),this.set(r,s,e))},attr:function(t,e,n){var r=Array.from(arguments);return r.length===0?this.get("attrs"):(Array.isArray(t)?r[0]=["attrs"].concat(t):Mt(t)?r[0]="attrs/"+t:r[0]={attrs:t},this.prop.apply(this,r))},removeAttr:function(t,e){return Array.isArray(t)?this.removeProp(["attrs"].concat(t)):this.removeProp("attrs/"+t,e)},transition:function(t,e,n,r){r=r||"/";var i={duration:100,delay:10,timingFunction:fu.linear,valueFunction:yo.number};n=j(i,n);var s=0,o;const l=Array.isArray(t)?t.join(r):t;var a=(function(g){var d,v,y;s=s||g,g-=s,v=g/n.duration,v<1?this._transitionIds[l]=d=Ci(a):(v=1,delete this._transitionIds[l]),y=o(n.timingFunction(v)),n.transitionId=d,this.prop(t,y,n),d||this.trigger("transition:end",this,l)}).bind(this);const{_scheduledTransitionIds:c}=this;let u;var h=g=>{c[l]&&(c[l]=io(c[l],u),c[l].length===0&&delete c[l]),this.stopPendingTransitions(t,r),o=n.valueFunction(Ze(this.attributes,t,r),e),this._transitionIds[l]=Ci(g),this.trigger("transition:start",this,l)};return u=setTimeout(h,n.delay,a),c[l]||(c[l]=[]),c[l].push(u),u},getTransitions:function(){return bi(Object.keys(this._transitionIds),Object.keys(this._scheduledTransitionIds))},stopScheduledTransitions:function(t,e="/"){const{_scheduledTransitionIds:n={}}=this;let r=Object.keys(n);if(t){const i=Array.isArray(t)?t.map(s=>String(s)):t.split(e);r=r.filter(s=>Re(i,s.split(e).slice(0,i.length)))}return r.forEach(i=>{n[i].forEach(o=>clearTimeout(o)),delete n[i]}),this},stopPendingTransitions(t,e="/"){const{_transitionIds:n={}}=this;let r=Object.keys(n);if(t){const i=Array.isArray(t)?t.map(s=>String(s)):t.split(e);r=r.filter(s=>Re(i,s.split(e).slice(0,i.length)))}r.forEach(i=>{const s=n[i];mr(s),delete n[i],this.trigger("transition:end",this,i)})},stopTransitions:function(t,e="/"){return this.stopScheduledTransitions(t,e),this.stopPendingTransitions(t,e),this},addTo:function(t,e){return t.addCell(this,e),this},findView:function(t){return t.findViewByModel(this)},isElement:function(){return!1},isLink:function(){return!1},startBatch:function(t,e){return this.graph&&this.graph.startBatch(t,j({},e,{cell:this})),this},stopBatch:function(t,e){return this.graph&&this.graph.stopBatch(t,j({},e,{cell:this})),this},getChangeFlag:function(t){var e=0;if(!t)return e;for(var n in t)!t.hasOwnProperty(n)||!this.hasChanged(n)||(e|=t[n]);return e},angle:function(){return 0},position:function(){return new S(0,0)},z:function(){return this.get("z")||0},getPointFromConnectedLink:function(){return new S},getBBox:function(){return new U(0,0,0,0)},getCenter:function(){return this.getBBox().center()},getPointRotatedAroundCenter(t,e,n){const r=new S(e,n);return t&&r.rotate(this.getCenter(),t),r},getAbsolutePointFromRelative(t,e){return this.getPointRotatedAroundCenter(-this.angle(),this.position().offset(t,e))},getRelativePointFromAbsolute(t,e){return this.getPointRotatedAroundCenter(this.angle(),t,e).difference(this.position())},layer:function(t,e){const n=Bt.layerAttribute;if(t===void 0)return this.get(n)||null;if(t===null)return this.unset(n,e);if(!Mt(t))throw new Error("dia.Cell: Layer id must be a string.");return this.set(n,t,e)}},{getAttributeDefinition:function(t){const e=this.attributes,n=To,r=e&&e[t]||n[t];return r!==void 0?r:null},define:function(t,e,n,r){n=j({defaults:dr({type:t},e,this.prototype.defaults)},n);var i=this.extend(n,r);return typeof joint<"u"&&ve(joint,"shapes")&&vo(joint.shapes,t,i,"."),i}});Object.defineProperty(Ce.prototype,ae,{value:!0});const Fu=function(t,e,n){if(Mt(n)){if(!Oi[n])throw new Error('Unknown wrapper: "'+n+'"');n=Oi[n]}if(!bt(n))throw new Error("Wrapper must be a function.");xt(e).forEach(function(r){t[r]=n(t[r])})},Oi={cells:function(t){return function(){var e=Array.from(arguments),n=e.length,r=n>0&&e[0]||[],i=n>1&&e[n-1]||{};return Array.isArray(r)||(i instanceof Ce?r=e:r instanceof Ce&&(e.length>1&&e.pop(),r=e)),i instanceof Ce&&(i={}),t.call(this,r,i)}}};function Hm(t,...e){const n=[];return t.forEach((i,s)=>{n.push(i),s in e&&n.push(e[s])}),qm(n.join(""))}function qm(t){const e=new DOMParser,n=`<svg>${t.trim()}</svg>`;if(e.parseFromString(n.replace(/@/g,""),"application/xml").getElementsByTagName("parsererror")[0])throw new Error("Invalid SVG markup");const s=e.parseFromString(n,"text/html").querySelector("svg");return Wm(s)}function Bu(t){const e={},{tagName:n,attributes:r,namespaceURI:i,style:s,childNodes:o}=t;e.namespaceURI=i,e.tagName=i===N.namespace.xhtml?n.toLowerCase():n;const l={};for(var a=s.length;a--;){var c=s[a];l[c]=s.getPropertyValue(c)}e.style=l;const u=r.getNamedItem("@selector");u&&(e.selector=u.value,r.removeNamedItem("@selector"));const h=r.getNamedItem("@group-selector");if(h){const y=h.value.split(",");e.groupSelector=y.map(x=>x.trim()),r.removeNamedItem("@group-selector")}const g=r.getNamedItem("class");g&&(e.className=g.value);const d=[];o.forEach(y=>{switch(y.nodeType){case Node.TEXT_NODE:{const x=y.data.replace(/\s\s+/g," ");x.trim()&&d.push(x);break}case Node.ELEMENT_NODE:{d.push(Bu(y));break}}}),d.length&&(e.children=d);const v={};return Array.from(r).forEach(y=>{const{name:x,value:A}=y;v[x]=A}),Object.keys(v).length>0&&(e.attributes=v),e}function Wm(t){const e=[];return Array.from(t.children).forEach(n=>{e.push(Bu(n))}),e}const Rt={TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left",TOP_LEFT:"top-left",TOP_RIGHT:"top-right",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",CENTER:"center"};function Co(t,e){const n=new U(t);switch(e){case void 0:throw new Error("Position required");case Rt.LEFT:case"leftMiddle":return n.leftMiddle();case Rt.RIGHT:case"rightMiddle":return n.rightMiddle();case Rt.TOP:case"topMiddle":return n.topMiddle();case Rt.BOTTOM:case"bottomMiddle":return n.bottomMiddle();case Rt.TOP_LEFT:case"topLeft":case"origin":return n.topLeft();case Rt.TOP_RIGHT:case"topRight":return n.topRight();case Rt.BOTTOM_LEFT:case"bottomLeft":return n.bottomLeft();case Rt.BOTTOM_RIGHT:case"bottomRight":case"corner":return n.bottomRight();case Rt.CENTER:return n.center();default:throw new Error(`Unknown position: ${e}`)}}var jm={__proto__:null,addClassNamePrefix:me,assign:j,bindAll:Tv,breakText:lu,camelCase:so,cancelFrame:mr,cap:su,clone:kt,cloneCells:bo,cloneDeep:zt,dataUriToBlob:uu,debounce:kc,deepMixin:Av,deepSupplement:Oc,defaults:Yt,defaultsDeep:dr,difference:Vc,downloadBlob:cu,downloadDataUri:Pm,evalCalcExpression:Ee,evalCalcFormula:Tu,filter:du,flattenDeep:Rc,flattenObject:nu,forIn:_e,format:Cm,getByPath:Ze,getElementBBox:Sm,getRectPoint:Co,groupBy:Ic,guid:xn,has:ve,hashCode:vr,imageToDataUri:Tm,interpolate:yo,intersection:Pv,invoke:Ie,invokeProperty:Nc,isBoolean:Lc,isCalcExpression:Se,isEmpty:re,isEqual:Re,isFunction:bt,isNumber:qt,isObject:gt,isPercentage:Ut,isPlainObject:It,isString:Mt,merge:Nt,mixin:_c,nextFrame:Ci,noop:vu,normalizeEvent:St,normalizeSides:Te,normalizeWheel:iu,objectDifference:pu,omit:Xe,parseCssNumeric:ou,parseDOMJSON:pr,pick:Dc,removeClassNamePrefix:wm,result:Ct,sanitizeHTML:Am,setAttributesBySelector:Em,setByPath:vo,sortBy:Gn,sortElements:hu,sortedIndex:ro,supplement:Mc,svg:Hm,template:ye,timing:fu,toArray:xt,toKebabCase:bm,toggleFullScreen:Lm,union:bi,uniq:Ye,uniqueId:wn,unsetByPath:mo,uuid:ru,without:io,wrapWith:Fu,wrappers:Oi};function Gu(t,e,n,r){if(Ut(r))return parseFloat(r)/100*n[e];if(Se(r))return Number(Ee(r,n));if(typeof r=="string"){const i=Number(r);if(isNaN(i))throw new TypeError(`Cannot convert port coordinate ${t}: "${r}" to a number`);return i}return r}function zu(t,e,n){var r=t.toJSON();return r.angle=e||0,Yt({},n,r)}function Ar(t,e,n,r){return t.map(function(i,s,o){var l=this.pointAt((s+.5)/o.length);return(i.dx||i.dy)&&l.offset(i.dx||0,i.dy||0),zu(l.round(),0,Lo(r,i))},fn(e,n))}function Uu(t,e,n,r){var i=e.center(),s=e.width/e.height,o=e.topMiddle(),l=jt.fromRect(e);return t.map(function(a,c,u){var h=n+r(c,u.length),g=o.clone().rotate(i,-h).scale(s,1,i),d=a.compensateRotation?-l.tangentTheta(g):0;return(a.dx||a.dy)&&g.offset(a.dx||0,a.dy||0),a.dr&&g.move(i,a.dr),zu(g.round(),d,Lo(e,a))})}function Lo(t,e){let{x:n,y:r,angle:i}=e;return{x:Gu("x","width",t,n),y:Gu("y","height",t,r),angle:i}}function _o(t,e){const{x:n,y:r}=Lo(t,e);return new S(n||0,r||0)}var $u={__proto__:null,absolute:function(t,e,n){return t.map(r=>{const i=_o(e,r).round().toJSON();return i.angle=r.angle||0,i})},bottom:function(t,e,n){return Ar(t,e.bottomLeft(),e.corner(),e)},ellipse:function(t,e,n){var r=n.startAngle||0,i=n.step||20;return Uu(t,e,r,function(s,o){return(s+.5-o/2)*i})},ellipseSpread:function(t,e,n){var r=n.startAngle||0,i=n.step||360/t.length;return Uu(t,e,r,function(s){return s*i})},fn:function(t,e,n){return n.fn(t,e,n)},left:function(t,e,n){return Ar(t,e.origin(),e.bottomLeft(),e)},line:function(t,e,n){var r=_o(e,n.start||e.origin()),i=_o(e,n.end||e.corner());return Ar(t,r,i,e)},right:function(t,e,n){return Ar(t,e.topRight(),e.corner(),e)},top:function(t,e,n){return Ar(t,e.origin(),e.topRight(),e)}};function en(t,e){return dr({},t,e,{x:0,y:0,angle:0,attrs:{}})}function Hu(t){var e=t.center(),n=e.theta(t.origin()),r=e.theta(t.bottomLeft()),i=e.theta(t.corner()),s=e.theta(t.topRight());return[n,s,i,r]}function qu(t,e,n,r){r=Yt({},r,{offset:15});var i=e.center().theta(t),s,o,l,a,c=r.offset,u=0;const[h,g,d,v]=Hu(e);i<g||i>d?(l=".3em",s=c,o=0,a="start"):i<h?(s=0,o=-c,n?(u=-90,a="start",l=".3em"):(a="middle",l="0")):i<v?(l=".3em",s=-c,o=0,a="end"):(s=0,o=c,n?(u=90,a="start",l=".3em"):(a="middle",l=".6em"));var y=Math.round;return en(r,{x:y(s),y:y(o),angle:u,attrs:{labelText:{y:l,textAnchor:a}}})}function Wu(t,e,n,r){r=Yt({},r,{offset:15});var i=e.center().theta(t),s,o,l,a,c=r.offset,u=0;const[h,g,d,v]=Hu(e);i<g||i>d?(l=".3em",s=-c,o=0,a="end"):i<h?(s=0,o=c,n?(u=90,a="start",l=".3em"):(a="middle",l=".6em")):i<v?(l=".3em",s=c,o=0,a="start"):(s=0,o=-c,n?(u=-90,a="start",l=".3em"):(a="middle",l="0"));var y=Math.round;return en(r,{x:y(s),y:y(o),angle:u,attrs:{labelText:{y:l,textAnchor:a}}})}function ju(t,e,n){n=Yt({},n,{offset:20});var r=ti(0,0),i=-t.theta(r),s=i,o=t.clone().move(r,n.offset).difference(t).round(),l=".3em",a;(i+90)%180===0?(a=e?"end":"middle",!e&&i===-270&&(l="0em")):i>-270&&i<-90?(a="start",s=i-180):a="end";var c=Math.round;return en(n,{x:c(o.x),y:c(o.y),angle:e?s:0,attrs:{labelText:{y:l,textAnchor:a}}})}var Yu={__proto__:null,bottom:function(t,e,n){return en(n,{y:15,attrs:{labelText:{y:".6em",textAnchor:"middle"}}})},inside:function(t,e,n){return Wu(t,e,!1,n)},insideOriented:function(t,e,n){return Wu(t,e,!0,n)},left:function(t,e,n){return en(n,{x:-15,attrs:{labelText:{y:".3em",textAnchor:"end"}}})},manual:function(t,e,n){return en(n)},outside:function(t,e,n){return qu(t,e,!1,n)},outsideOriented:function(t,e,n){return qu(t,e,!0,n)},radial:function(t,e,n){return ju(t.difference(e.center()),!1,n)},radialOriented:function(t,e,n){return ju(t.difference(e.center()),!0,n)},right:function(t,e,n){return en(n,{x:15,attrs:{labelText:{y:".3em",textAnchor:"start"}}})},top:function(t,e,n){return en(n,{y:-15,attrs:{labelText:{y:"0",textAnchor:"middle"}}})}};const Xu="left",Ym="absolute",Ku="left",Zu=function(t){const{portLayoutNamespace:e=$u,portLabelLayoutNamespace:n=Yu}=t,r=zt(t.get("ports"))||{};this.ports=[],this.portsMap={},this.groups={},this.portLayoutNamespace=e,this.portLabelLayoutNamespace=n,this.metrics={},this.metricsKey=null,this._init(r)};Zu.prototype={hasPort:function(t){return t in this.portsMap},getPort:function(t){const e=this.portsMap[t];if(e)return e;throw new Error("Element: unable to find port with id "+t)},getPorts:function(){return this.ports},getGroup:function(t){return this.groups[t]||{}},getPortsByGroup:function(t){return this.ports.filter(function(e){return e.group===t})},getGroupPortsMetrics:function(t,e){const{x:n=0,y:r=0,width:i=0,height:s=0}=e,o=`${n}:${r}:${i}:${s}`;this.metricsKey!==o&&(this.metrics={},this.metricsKey=o);let l=this.metrics[t];return l||(l=this.resolveGroupPortsMetrics(t,new U(n,r,i,s)),this.metrics[t]=l,l)},resolveGroupPortsMetrics:function(t,e){const n=t===void 0,r=this.getGroup(t),i=this.getPortsByGroup(t),s=i.map(function(a){return a&&a.position&&a.position.args});let o;if(n){const a=this._evaluateGroup({});o=this._getGroupPortTransformations(a,s,e)}else o=this._getGroupPortTransformations(r,s,e);let l={ports:i,result:{}};return xt(o).reduce((a,c,u)=>{const h=a.ports[u],g=h.id;return a.result[g]={index:u,portId:g,portTransformation:c,labelTransformation:this._getPortLabelTransformation(h,S(c),e),portAttrs:h.attrs,portSize:h.size,labelSize:h.label.size},a},l),l.result},_getGroupPortTransformations:function(t,e,n){const r=t.position||{},i=r.args||{},s=r.layoutCallback;return s(e,n,i)},_getPortLabelTransformation:function(t,e,n){const r=t.label.position||{},i=r.args||{},s=r.layoutCallback;return s?s(e,n,i):null},_init:function(t){if(gt(t.groups))for(var e=Object.keys(t.groups),n=0,r=e.length;n<r;n++){var i=e[n];this.groups[i]=this._evaluateGroup(t.groups[i])}for(var s=xt(t.items),o=0,l=s.length;o<l;o++){const a=this._evaluatePort(s[o]);this.ports.push(a),this.portsMap[a.id]=a}},_evaluateGroup:function(t){return Nt({},t,{position:this._evaluateGroupPositionProperty(t),label:this._evaluateGroupLabelProperty(t)})},_evaluateGroupPositionProperty:function(t){const e=this.portLayoutNamespace,n=t.position;if(n===void 0)return{layoutCallback:this._resolveLayoutCallbackOrThrow(e,Xu,"Default port group")};if(bt(n))return{layoutCallback:n};if(gt(n))return n.name?{layoutCallback:this._resolveLayoutCallbackOrThrow(e,n.name,"Provided port group"),args:n.args}:{layoutCallback:this._resolveLayoutCallbackOrThrow(e,Xu,"Default port group"),args:n.args};if(Mt(n))return{layoutCallback:this._resolveLayoutCallbackOrThrow(e,n,"Provided port group")};if(Array.isArray(n))return{layoutCallback:this._resolveLayoutCallbackOrThrow(e,Ym,"Default absolute port group"),args:{x:n[0],y:n[1]}};throw new Error("dia.Element: Provided port group position value has an invalid type.")},_evaluateGroupLabelProperty:function(t){const e=t.label;return e?Nt({},e,{position:this._evaluateGroupLabelPositionProperty(e)}):{position:this._evaluateGroupLabelPositionProperty({})}},_evaluateGroupLabelPositionProperty:function(t){const e=this.portLabelLayoutNamespace,n=t.position;if(n===void 0)return{layoutCallback:this._resolveLayoutCallbackOrThrow(e,Ku,"Default port group label")};if(bt(n))return{layoutCallback:n};if(gt(n))return n.name?{layoutCallback:this._resolveLayoutCallbackOrThrow(e,n.name,"Provided port group label"),args:n.args}:{layoutCallback:this._resolveLayoutCallbackOrThrow(e,Ku,"Default port group label"),args:n.args};throw new Error("dia.Element: Provided port group label position value has an invalid type.")},_evaluatePort:function(t){const e=this.getGroup(t.group),n=j({},t);return n.markup=n.markup||e.markup,n.attrs=Nt({},e.attrs,n.attrs),n.position=this._evaluatePortPositionProperty(e,n),n.label=this._evaluatePortLabelProperty(e,n),n.z=this._evaluatePortZProperty(e,n),n.size=j({},e.size,n.size),n},_evaluatePortPositionProperty:function(t,e){return{args:Nt({},t.position!=null?t.position.args:{},e.position!=null&&e.position.args!=null?e.position.args:e.args)}},_evaluatePortLabelProperty:function(t,e){const n=t.label,r=e.label;return r?Nt({},n,Nt({},r,{position:this._evaluatePortLabelPositionProperty(r)})):j({},n)},_evaluatePortLabelPositionProperty:function(t){const e=this.portLabelLayoutNamespace,n=t.position;if(n===void 0)return{};if(bt(n))return{layoutCallback:n};if(gt(n))return n.name?{layoutCallback:this._resolveLayoutCallbackOrThrow(e,n.name,"Provided port label"),args:n.args}:{args:n.args};throw new Error("dia.Element: Provided port label position value has an invalid type.")},_evaluatePortZProperty:function(t,e){return qt(e.z)?e.z:qt(t.z)||t.z==="auto"?t.z:"auto"},_resolveLayoutCallbackOrThrow:function(t,e,n){const r=t[e];if(!r)throw new Error(`dia.Element: ${n} layout name is not recognized.`);return r}};const Xm={_initializePorts:function(t){t&&(t.portLayoutNamespace&&(this.portLayoutNamespace=t.portLayoutNamespace),t.portLabelLayoutNamespace&&(this.portLabelLayoutNamespace=t.portLabelLayoutNamespace)),this._createPortData(),this.on("change:ports",function(){this._processRemovedPort(),this._createPortData()},this)},_processRemovedPort:function(){var t=this.get("ports")||{},e={};xt(t.items).forEach(function(l){e[l.id]=!0});var n=this.previous("ports")||{},r={};xt(n.items).forEach(function(l){e[l.id]||(r[l.id]=!0)});var i=this.graph;if(i&&!re(r)){var s=i.getConnectedLinks(this,{inbound:!0});s.forEach(function(l){r[l.get("target").port]&&l.remove()});var o=i.getConnectedLinks(this,{outbound:!0});o.forEach(function(l){r[l.get("source").port]&&l.remove()})}},hasPorts:function(){return this._portSettingsData.getPorts().length>0},hasPort:function(t){return this._portSettingsData.hasPort(t)},getPorts:function(){return zt(this.prop("ports/items"))||[]},getGroupPorts:function(t){const e=xt(this.prop(["ports","items"])).filter(n=>n.group===t);return zt(e)},getPort:function(t){const e=xt(this.prop("ports/items")).find(n=>n.id&&n.id===t);return zt(e)},getPortGroupNames:function(){return Object.keys(this._portSettingsData.groups)},getPortsPositions:function(t){const e=this.getGroupPortsMetrics(t),n={};for(const r in e){const{portTransformation:{x:i,y:s,angle:o}}=e[r];n[r]={x:i,y:s,angle:o}}return n},getPortMetrics:function(t){const e=this._portSettingsData.getPort(t);return this.getGroupPortsMetrics(e.group)[t]},getGroupPortsMetrics:function(t){return this._portSettingsData.getGroupPortsMetrics(t,this.size())},getPortRelativePosition:function(t){const{portTransformation:{x:e,y:n,angle:r}}=this.getPortMetrics(t);return{x:e,y:n,angle:r}},getPortRelativeRect(t){const{portTransformation:{x:e,y:n,angle:r},portSize:{width:i,height:s}}=this.getPortMetrics(t);return{x:e-i/2,y:n-s/2,width:i,height:s,angle:r}},getPortCenter(t){const e=this.getBBox(),n=this.getPortRelativePosition(t),r=new S(n).offset(e.x,e.y),i=this.angle();return i&&r.rotate(e.center(),-i),r},getPortBBox:function(t,e){const n=this.getPortRelativeRect(t),r=this.getBBox(),i=new U(n);i.offset(r.x,r.y);const s=this.angle();return s&&i.moveAroundPoint(r.center(),-s),e&&e.rotate&&i.rotateAroundCenter(s),i},getPortIndex:function(t){var e=gt(t)?t.id:t;return this._isValidPortId(e)?xt(this.prop("ports/items")).findIndex(function(n){return n.id===e}):-1},addPort:function(t,e){if(!gt(t)||Array.isArray(t))throw new Error("Element: addPort requires an object.");var n=j([],this.prop("ports/items"));return n.push(t),this.prop("ports/items",n,e),this},insertPort:function(t,e,n){const r=typeof t=="number"?t:this.getPortIndex(t);if(!gt(e)||Array.isArray(e))throw new Error("dia.Element: insertPort requires an object.");const i=j([],this.prop("ports/items"));return i.splice(r,0,e),this.prop("ports/items",i,n),this},portProp:function(t,e,n,r){var i=this.getPortIndex(t);if(i===-1)throw new Error("Element: unable to find port with id "+t);var s=Array.prototype.slice.call(arguments,1);return Array.isArray(e)?s[0]=["ports","items",i].concat(e):Mt(e)?s[0]=["ports/items/",i,"/",e].join(""):(s=["ports/items/"+i],It(e)&&(s.push(e),s.push(n))),this.prop.apply(this,s)},_validatePorts:function(){var t=this.get("ports")||{},e=[];t=t||{};var n=xt(t.items);return n.forEach(function(r){typeof r!="object"&&e.push("Element: invalid port ",r),this._isValidPortId(r.id)||(r.id=this.generatePortId())},this),Ye(n,"id").length!==n.length&&e.push("Element: found id duplicities in ports."),e},generatePortId:function(){return this.generateId()},_isValidPortId:function(t){return t!=null&&!gt(t)},addPorts:function(t,e){return t.length&&this.prop("ports/items",j([],this.prop("ports/items")).concat(t),e),this},removePort:function(t,e){const n=e||{},r=this.getPortIndex(t);if(r!==-1){const i=j([],this.prop(["ports","items"]));i.splice(r,1),n.rewrite=!0,this.startBatch("port-remove"),this.prop(["ports","items"],i,n),this.stopBatch("port-remove")}return this},removePorts:function(t,e){let n,r;if(Array.isArray(t)){if(n=e||{},t.length===0)return this.this;r=j([],this.prop(["ports","items"])).filter(function(s){return!t.some(function(o){const l=gt(o)?o.id:o;return s.id===l})})}else n=t||{},r=[];return this.startBatch("port-remove"),n.rewrite=!0,this.prop(["ports","items"],r,n),this.stopBatch("port-remove"),this},_createPortData:function(){var t=this._validatePorts();if(t.length>0)throw this.set("ports",this.previous("ports")),new Error(t.join(" "));var e;this._portSettingsData&&(e=this._portSettingsData.getPorts()),this._portSettingsData=new Zu(this);var n=this._portSettingsData.getPorts();if(e){var r=n.filter(function(s){if(!e.find(function(o){return o.id===s.id}))return s}),i=e.filter(function(s){if(!n.find(function(o){return o.id===s.id}))return s});i.length>0&&this.trigger("ports:remove",this,i),r.length>0&&this.trigger("ports:add",this,r)}}},Km={portContainerMarkup:"g",portMarkup:[{tagName:"circle",selector:"circle",attributes:{r:10,fill:"#FFFFFF",stroke:"#000000"}}],portLabelMarkup:[{tagName:"text",selector:"text",attributes:{fill:"#000000"}}],_portElementsCache:null,_initializePorts:function(){this._cleanPortsCache()},_refreshPorts:function(){this._removePorts(),this._cleanPortsCache(),this._renderPorts()},_cleanPortsCache:function(){this._portElementsCache={}},_renderPorts:function(){for(var t=[],e=this._getContainerElement(),n=0,r=e.node.childNodes.length;n<r;n++)t.push(e.node.childNodes[n]);var i=Ic(this.model._portSettingsData.getPorts(),"z"),s="auto";xt(i[s]).forEach(function(u){var h=this._getPortElement(u);e.append(h),t.push(h)},this);for(var o=Object.keys(i),l=0;l<o.length;l++){var a=o[l];if(a!==s){var c=parseInt(a,10);this._appendPorts(i[a],c,t)}}this._updatePorts()},_getContainerElement:function(){return this.rotatableNode||this.vel},_appendPorts:function(t,e,n){var r=this._getContainerElement(),i=xt(t).map(this._getPortElement,this);n[e]||e<0?N(n[Math.max(e,0)]).before(i):r.append(i)},_getPortElement:function(t){return this._portElementsCache[t.id]?this._portElementsCache[t.id].portElement:this._createPortElement(t)},findPortNodes:function(t,e){const n=this._portElementsCache[t];if(!n)return[];if(!e)return[n.portContentElement.node];const r=n.portElement.node,i=n.portSelectors;return this.findBySelector(e,r,i)},findPortNode:function(t,e){const[n=null]=this.findPortNodes(t,e);return n},_updatePorts:function(){this._updatePortGroup(void 0);var t=Object.keys(this.model._portSettingsData.groups);t.forEach(this._updatePortGroup,this)},_removePorts:function(){Ie(this._portElementsCache,"portElement.remove")},_createPortElement:function(t){let e,n,r,i;var s=N(this.portContainerMarkup).addClass("joint-port"),o=this._getPortMarkup(t);if(Array.isArray(o)){var l=this.parseDOMJSON(o,s.node),a=l.fragment;a.childNodes.length>1?e=N("g").append(a):e=N(a.firstChild),i=l.selectors}else e=N(o),Array.isArray(e)&&(e=N("g").append(e));if(!e)throw new Error("ElementView: Invalid port markup.");e.attr({port:t.id,"port-group":t.group}),qt(t.id)&&e.attr("port-id-type","number");const c=this._getPortLabelMarkup(t.label);if(Array.isArray(c)){const{fragment:y,selectors:x}=this.parseDOMJSON(c,s.node),A=y.childNodes.length;A>0&&(r=x,n=A===1?N(y.firstChild):N("g").append(y))}else n=N(c),Array.isArray(n)&&(n=N("g").append(n));var u;if(i&&r){for(var h in r)if(i[h]&&h!==this.selector)throw new Error("ElementView: selectors within port must be unique.");u=j({},i,r)}else u=i||r||{};const g="portRoot",d="labelRoot",v="labelText";if(g in u||(u[g]=e.node),n){const y=n.node;if(d in u||(u[d]=y),!(v in u)){const x=n.tagName()==="TEXT"?y:Array.from(y.querySelectorAll("text"));u[v]=x,r||(r={}),r[v]=x}}return s.append(e.addClass("joint-port-body")),n&&s.append(n.addClass("joint-port-label")),this._portElementsCache[t.id]={portElement:s,portLabelElement:n,portSelectors:u,portLabelSelectors:r,portContentElement:e,portContentSelectors:i},s},_updatePortGroup:function(t){const e=this.model.getGroupPortsMetrics(t),n=Object.keys(e);for(let r=0,i=n.length;r<i;r++){const s=n[r],o=e[s],l=this._portElementsCache[s]||{},a=o.portTransformation,c=o.labelTransformation;c&&l.portLabelElement&&(this.updateDOMSubtreeAttributes(l.portLabelElement.node,c.attrs,{rootBBox:new U(o.labelSize),selectors:l.portLabelSelectors}),this.applyPortTransform(l.portLabelElement,c,-a.angle||0)),this.updateDOMSubtreeAttributes(l.portElement.node,o.portAttrs,{rootBBox:new U(o.portSize),selectors:l.portSelectors}),this.applyPortTransform(l.portElement,a)}},applyPortTransform:function(t,e,n){var r=N.createSVGMatrix().rotate(n||0).translate(e.x||0,e.y||0).rotate(e.angle||0);t.transform(r,{absolute:!0})},_getPortMarkup:function(t){return t.markup||this.model.get("portMarkup")||this.model.portMarkup||this.portMarkup},_getPortLabelMarkup:function(t){return t.markup||this.model.get("portLabelMarkup")||this.model.portLabelMarkup||this.portLabelMarkup}},Kt=Ce.extend({defaults:{position:{x:0,y:0},size:{width:1,height:1},angle:0},initialize:function(t,e){this._initializePorts(e),Ce.prototype.initialize.apply(this,arguments)},_initializePorts:function(){},_refreshPorts:function(){},isElement:function(){return!0},position:function(t,e,n){const r=qt(e);n=(r?n:t)||{};const{parentRelative:i,deep:s,restrictedArea:o}=n;let l;if(i){if(!this.graph)throw new Error("Element must be part of a graph.");const a=this.getParentCell();a&&!a.isLink()&&(l=a.get("position"))}if(r){if(l&&(t+=l.x,e+=l.y),s||o){const{x:a,y:c}=this.get("position");this.translate(t-a,e-c,n)}else this.set("position",{x:t,y:e},n);return this}else{const a=S(this.get("position"));return i?a.difference(l):a}},translate:function(t,e,n){if(t=t||0,e=e||0,t===0&&e===0)return this;n=n||{},n.translateBy=n.translateBy||this.id;var r=this.get("position")||{x:0,y:0},i=n.restrictedArea;if(i&&n.translateBy===this.id)if(typeof i=="function"){var s=i.call(this,r.x+t,r.y+e,n);t=s.x-r.x,e=s.y-r.y}else{var o=this.getBBox({deep:!0}),l=r.x-o.x,a=r.y-o.y,c=Math.max(i.x+l,Math.min(i.x+i.width+l-o.width,r.x+t)),u=Math.max(i.y+a,Math.min(i.y+i.height+a-o.height,r.y+e));t=c-r.x,e=u-r.y}var h={x:r.x+t,y:r.y+e};return n.tx=t,n.ty=e,n.transition?(gt(n.transition)||(n.transition={}),this.transition("position",h,j({},n.transition,{valueFunction:yo.object})),Ie(this.getEmbeddedCells(),"translate",t,e,n)):(this.startBatch("translate",n),this.set("position",h,n),Ie(this.getEmbeddedCells(),"translate",t,e,n),this.stopBatch("translate",n)),this},size:function(t,e,n){var r=this.get("size");return t===void 0?{width:r.width,height:r.height}:(gt(t)&&(n=e,e=qt(t.height)?t.height:r.height,t=qt(t.width)?t.width:r.width),this.resize(t,e,n))},resize:function(t,e,n){if(n=n||{},this.startBatch("resize",n),n.direction){var r=this.get("size");switch(n.direction){case"left":case"right":e=r.height;break;case"top":case"bottom":t=r.width;break}var i=de(this.get("angle")||0),s=this.getBBox(),o;if(i){var l={"top-right":0,right:0,"top-left":1,top:1,"bottom-left":2,left:2,"bottom-right":3,bottom:3}[n.direction];n.absolute&&(l+=Math.floor((i+45)/90),l%=4);var a=s[["bottomLeft","corner","topRight","origin"][l]](),c=S(a).rotate(s.center(),-i),u=Math.sqrt(t*t+e*e)/2,h=l*Math.PI/2;h+=Math.atan(l%2==0?e/t:t/e),h-=ee(i);var g=S.fromPolar(u,h,c);o=S(g).offset(t/-2,e/-2)}else switch(o=s.topLeft(),n.direction){case"top":case"top-right":o.offset(0,s.height-e);break;case"left":case"bottom-left":o.offset(s.width-t,0);break;case"top-left":o.offset(s.width-t,s.height-e);break}this.set("size",{width:t,height:e},n),this.position(o.x,o.y,n)}else this.set("size",{width:t,height:e},n);return this.stopBatch("resize",n),this},scale:function(t,e,n,r){var i=this.getBBox().scale(t,e,n);return this.startBatch("scale",r),this.position(i.x,i.y,r),this.resize(i.width,i.height,r),this.stopBatch("scale"),this},fitEmbeds:function(t){return this.fitToChildren(t)},fitToChildren:function(t={}){const{graph:e}=this;if(!e)throw new Error("Element must be part of a graph.");const n=this._getFilteredChildElements(t.filter);return this.startBatch("fit-embeds",t),t.deep&&Ie(n,"fitToChildren",Xe(t,"minRect")),this._fitToElements(Object.assign({elements:n},t)),this.stopBatch("fit-embeds"),this},fitParent:function(t={}){const{graph:e}=this;if(!e)throw new Error("Element must be part of a graph.");if(t.deep&&t.terminator&&(t.terminator===this||t.terminator===this.id))return this;const n=this.getParentCell();if(!n||!n.isElement())return this;const r=n._getFilteredChildElements(t.filter);return this.startBatch("fit-parent",t),n._fitToElements(Object.assign({elements:r},t)),t.deep&&n.fitParent(Xe(t,"minRect")),this.stopBatch("fit-parent"),this},_getFilteredChildElements:function(t){let e;return typeof t=="function"?e=n=>n.isElement()&&t(n):e=n=>n.isElement(),this.getEmbeddedCells().filter(e)},_fitToElements:function(t={}){let e=null;if(t.minRect){const y=j(this.getBBox(),t.minRect);e=new U(y)}const n=this.graph.getCellsBBox(t.elements);if(!n){this._setBBox(e,t);return}const{expandOnly:r,shrinkOnly:i}=t;if(r&&i){this._setBBox(e,t);return}let{x:s,y:o,width:l,height:a}=n;const{left:c,right:u,top:h,bottom:g}=Te(t.padding);s-=c,o-=h,l+=c+u,a+=g+h;let d=new U(s,o,l,a);if(r)d=this.getBBox().union(d);else if(i){const y=this.getBBox().intersect(d);if(!y){this._setBBox(e,t);return}d=y}let v=d;e&&(v=v.union(e)),this._setBBox(v,t)},_setBBox:function(t,e){if(!t)return;const{x:n,y:r,width:i,height:s}=t;this.set({position:{x:n,y:r},size:{width:i,height:s}},e)},rotate:function(t,e,n,r){if(n){var i=this.getCenter(),s=this.get("size"),o=this.get("position");i.rotate(n,this.get("angle")-t);var l=i.x-s.width/2-o.x,a=i.y-s.height/2-o.y;this.startBatch("rotate",{angle:t,absolute:e,origin:n}),this.position(o.x+l,o.y+a,r),this.rotate(t,e,null,r),this.stopBatch("rotate")}else this.set("angle",e?t:(this.get("angle")+t)%360,r);return this},angle:function(){return de(this.get("angle")||0)},getBBox:function(t={}){const{graph:e,attributes:n}=this,{deep:r,rotate:i}=t;if(r&&e){const h=this.getEmbeddedCells({deep:!0,breadthFirst:!0});return h.push(this),e.getCellsBBox(h,t)}const{angle:s=0,position:{x:o,y:l},size:{width:a,height:c}}=n,u=new U(o,l,a,c);return i&&u.rotateAroundCenter(s),u},getCenter:function(){const{position:{x:t,y:e},size:{width:n,height:r}}=this.attributes;return new S(t+n/2,e+r/2)},getPointFromConnectedLink:function(t,e){var n=this.getBBox(),r=n.center(),i=t.get(e);if(!i)return r;var s=i.port;return!s||!this.hasPort(s)?r:this.getPortCenter(s)}});j(Kt.prototype,Xm);const Pr=Ce.extend({defaultLabel:void 0,labelMarkup:void 0,_builtins:{defaultLabel:{markup:[{tagName:"rect",selector:"rect"},{tagName:"text",selector:"text"}],attrs:{text:{fill:"#000000",fontSize:14,textAnchor:"middle",textVerticalAnchor:"middle",pointerEvents:"none"},rect:{ref:"text",fill:"#ffffff",rx:3,ry:3,x:"calc(x)",y:"calc(y)",width:"calc(w)",height:"calc(h)"}},position:{distance:.5}}},defaults:{source:{},target:{}},isLink:function(){return!0},disconnect:function(t){return this.set({source:{x:0,y:0},target:{x:0,y:0}},t)},source:function(t,e,n){if(t===void 0)return kt(this.get("source"));var r,i,s=t instanceof Ce;if(s)return r=kt(e)||{},r.id=t.id,i=n,this.set("source",r,i);var o=!It(t);return o?(r=kt(e)||{},r.x=t.x,r.y=t.y,i=n,this.set("source",r,i)):(r=t,i=e,this.set("source",r,i))},target:function(t,e,n){if(t===void 0)return kt(this.get("target"));var r,i,s=t instanceof Ce;if(s)return r=kt(e)||{},r.id=t.id,i=n,this.set("target",r,i);var o=!It(t);return o?(r=kt(e)||{},r.x=t.x,r.y=t.y,i=n,this.set("target",r,i)):(r=t,i=e,this.set("target",r,i))},router:function(t,e,n){if(t===void 0){var r=this.get("router");return r?typeof r=="object"?kt(r):r:null}var i=typeof t=="object"||typeof t=="function",s=i?t:{name:t,args:e},o=i?e:n;return this.set("router",s,o)},connector:function(t,e,n){if(t===void 0){var r=this.get("connector");return r?typeof r=="object"?kt(r):r:null}var i=typeof t=="object"||typeof t=="function",s=i?t:{name:t,args:e},o=i?e:n;return this.set("connector",s,o)},label:function(t,e,n){var r=this.labels();return t=isFinite(t)&&t!==null?t|0:0,t<0&&(t=r.length+t),arguments.length<=1?this.prop(["labels",t]):this.prop(["labels",t],e,n)},labels:function(t,e){return arguments.length===0?(t=this.get("labels"),Array.isArray(t)?t.slice():[]):(Array.isArray(t)||(t=[]),this.set("labels",t,e))},hasLabels:function(){const{labels:t}=this.attributes;return Array.isArray(t)&&t.length>0},insertLabel:function(t,e,n){if(!e)throw new Error("dia.Link: no label provided");var r=this.labels(),i=r.length;return t=isFinite(t)&&t!==null?t|0:i,t<0&&(t=i+t+1),r.splice(t,0,e),this.labels(r,n)},appendLabel:function(t,e){return this.insertLabel(-1,t,e)},removeLabel:function(t,e){var n=this.labels();return t=isFinite(t)&&t!==null?t|0:-1,n.splice(t,1),this.labels(n,e)},vertex:function(t,e,n){var r=this.vertices();if(t=isFinite(t)&&t!==null?t|0:0,t<0&&(t=r.length+t),arguments.length<=1)return this.prop(["vertices",t]);var i=this._normalizeVertex(e);return this.prop(["vertices",t],i,n)},vertices:function(t,e){if(arguments.length===0)return t=this.get("vertices"),Array.isArray(t)?t.slice():[];Array.isArray(t)||(t=[]);for(var n=[],r=0;r<t.length;r++){var i=t[r],s=this._normalizeVertex(i);n.push(s)}return this.set("vertices",n,e)},insertVertex:function(t,e,n){if(!e)throw new Error("dia.Link: no vertex provided");var r=this.vertices(),i=r.length;t=isFinite(t)&&t!==null?t|0:i,t<0&&(t=i+t+1);var s=this._normalizeVertex(e);return r.splice(t,0,s),this.vertices(r,n)},removeVertex:function(t,e){var n=this.vertices();return t=isFinite(t)&&t!==null?t|0:-1,n.splice(t,1),this.vertices(n,e)},_normalizeVertex:function(t){var e=!It(t);return e?{x:t.x,y:t.y}:t},translate:function(t,e,n){return n=n||{},n.translateBy=n.translateBy||this.id,n.tx=t,n.ty=e,this.applyToPoints(function(r){return{x:(r.x||0)+t,y:(r.y||0)+e}},n)},scale:function(t,e,n,r){return this.applyToPoints(function(i){return S(i).scale(t,e,n).toJSON()},r)},applyToPoints:function(t,e){if(!bt(t))throw new TypeError("dia.Link: applyToPoints expects its first parameter to be a function.");var n={},{source:r,target:i}=this.attributes;r.id||(n.source=t(r)),i.id||(n.target=t(i));var s=this.vertices();return s.length>0&&(n.vertices=s.map(t)),this.set(n,e)},getSourcePoint:function(){var t=this.getSourceCell();return t?t.getPointFromConnectedLink(this,"source"):new S(this.source())},getTargetPoint:function(){var t=this.getTargetCell();return t?t.getPointFromConnectedLink(this,"target"):new S(this.target())},getPointFromConnectedLink:function(){return this.getPolyline().pointAt(.5)},getPolyline:function(){const t=[this.getSourcePoint(),...this.vertices().map(S),this.getTargetPoint()];return new Lt(t)},getBBox:function(){return this.getPolyline().bbox()},reparent:function(t){var e;if(this.graph){var n=this.getSourceElement(),r=this.getTargetElement(),i=this.getParentCell();n&&r&&(n===r||n.isEmbeddedIn(r)?e=r:r.isEmbeddedIn(n)?e=n:e=this.graph.getCommonAncestor(n,r)),i&&(!e||e.id!==i.id)&&i.unembed(this,t),e&&e.embed(this,t)}return e},hasLoop:function(t){t=t||{};var{source:e,target:n}=this.attributes,r=e.id,i=n.id;if(!r||!i)return!1;var s=r===i;if(!s&&t.deep&&this.graph){var o=this.getSourceCell(),l=this.getTargetCell();s=o.isEmbeddedIn(l)||l.isEmbeddedIn(o)}return s},getSourceCell:function(){const{graph:t,attributes:e}=this;var n=e.source;return n&&n.id&&t&&t.getCell(n.id)||null},getSourceElement:function(){var t=this,e={};do{if(e[t.id])return null;e[t.id]=!0,t=t.getSourceCell()}while(t&&t.isLink());return t},getTargetCell:function(){const{graph:t,attributes:e}=this;var n=e.target;return n&&n.id&&t&&t.getCell(n.id)||null},getTargetElement:function(){var t=this,e={};do{if(e[t.id])return null;e[t.id]=!0,t=t.getTargetCell()}while(t&&t.isLink());return t},getRelationshipAncestor:function(){var t;if(this.graph){var e=[this,this.getSourceElement(),this.getTargetElement()].filter(function(n){return!!n});t=this.graph.getCommonAncestor.apply(this.graph,e)}return t||null},isRelationshipEmbeddedIn:function(t){var e=Mt(t)||qt(t)?t:t.id,n=this.getRelationshipAncestor();return!!n&&(n.id===e||n.isEmbeddedIn(e))},_getDefaultLabel:function(){var t=this.get("defaultLabel")||this.defaultLabel||{},e={};return e.markup=t.markup||this.get("labelMarkup")||this.labelMarkup,e.position=t.position,e.attrs=t.attrs,e.size=t.size,e}},{endsEqual:function(t,e){var n=t.port===e.port||!t.port&&!e.port;return t.id===e.id&&n}}),Mo={_results:{},_tests:{svgforeignobject:function(){return!!document.createElementNS&&/SVGForeignObject/.test({}.toString.call(document.createElementNS("http://www.w3.org/2000/svg","foreignObject")))},isAppleWebKit:function(){const t=navigator.userAgent,e=/applewebkit/i.test(t),n=/chrome/i.test(t);return e&&!n}},addTest:function(t,e){return this._tests[t]=e},test:function(t){var e=this._tests[t];if(!e)throw new Error('Test not defined ("'+t+'"). Use `joint.env.addTest(name, fn) to add a new test.`');var n=this._results[t];if(typeof n<"u")return n;try{n=e()}catch{n=!1}return this._results[t]=n,n}},Zm=Kt.define("standard.Rectangle",{attrs:{root:{cursor:"move"},body:{width:"calc(w)",height:"calc(h)",strokeWidth:2,stroke:"#000000",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h/2)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"}]}),Jm=Kt.define("standard.Circle",{attrs:{root:{cursor:"move"},body:{cx:"calc(s/2)",cy:"calc(s/2)",r:"calc(s/2)",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h/2)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"circle",selector:"body"},{tagName:"text",selector:"label"}]}),Qm=Kt.define("standard.Ellipse",{attrs:{root:{cursor:"move"},body:{cx:"calc(w/2)",cy:"calc(h/2)",rx:"calc(w/2)",ry:"calc(h/2)",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h/2)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"ellipse",selector:"body"},{tagName:"text",selector:"label"}]}),ty=Kt.define("standard.Path",{attrs:{root:{cursor:"move"},body:{d:"M 0 0 H calc(w) V calc(h) H 0 Z",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h/2)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"path",selector:"body"},{tagName:"text",selector:"label"}]}),ey=Kt.define("standard.Polygon",{attrs:{root:{cursor:"move"},body:{points:"0 0 calc(w) 0 calc(w) calc(h) 0 calc(h)",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h/2)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"polygon",selector:"body"},{tagName:"text",selector:"label"}]}),ny=Kt.define("standard.Polyline",{attrs:{root:{cursor:"move"},body:{points:"0 0 calc(w) 0 calc(w) calc(h) 0 calc(h)",strokeWidth:2,stroke:"#333333",fill:"#FFFFFF"},label:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h/2)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"polyline",selector:"body"},{tagName:"text",selector:"label"}]}),ry=Kt.define("standard.Image",{attrs:{root:{cursor:"move"},image:{width:"calc(w)",height:"calc(h)"},label:{textVerticalAnchor:"top",textAnchor:"middle",x:"calc(w/2)",y:"calc(h+10)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}),iy=Kt.define("standard.BorderedImage",{attrs:{root:{cursor:"move"},border:{width:"calc(w)",height:"calc(h)",stroke:"#333333",strokeWidth:2},background:{width:"calc(w-1)",height:"calc(h-1)",x:.5,y:.5,fill:"#FFFFFF"},image:{width:"calc(w-1)",height:"calc(h-1)",x:.5,y:.5},label:{textVerticalAnchor:"top",textAnchor:"middle",x:"calc(w/2)",y:"calc(h+10)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"background",attributes:{stroke:"none"}},{tagName:"image",selector:"image"},{tagName:"rect",selector:"border",attributes:{fill:"none"}},{tagName:"text",selector:"label"}]}),sy=Kt.define("standard.EmbeddedImage",{attrs:{root:{cursor:"move"},body:{width:"calc(w)",height:"calc(h)",stroke:"#333333",fill:"#FFFFFF",strokeWidth:2},image:{width:"calc(0.3*w)",height:"calc(h-20)",x:10,y:10,preserveAspectRatio:"xMidYMin"},label:{textVerticalAnchor:"top",textAnchor:"left",x:"calc(0.3*w+20)",y:10,fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"image",selector:"image"},{tagName:"text",selector:"label"}]}),oy=Kt.define("standard.InscribedImage",{attrs:{root:{cursor:"move"},border:{rx:"calc(w/2)",ry:"calc(h/2)",cx:"calc(w/2)",cy:"calc(h/2)",stroke:"#333333",strokeWidth:2},background:{rx:"calc(w/2)",ry:"calc(h/2)",cx:"calc(w/2)",cy:"calc(h/2)",fill:"#FFFFFF"},image:{width:"calc(0.68*w)",height:"calc(0.68*h)",x:"calc(0.16*w)",y:"calc(0.16*h)",preserveAspectRatio:"xMidYMid"},label:{textVerticalAnchor:"top",textAnchor:"middle",x:"calc(w/2)",y:"calc(h+10)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"ellipse",selector:"background"},{tagName:"image",selector:"image"},{tagName:"ellipse",selector:"border",attributes:{fill:"none"}},{tagName:"text",selector:"label"}]}),ay=Kt.define("standard.HeaderedRectangle",{attrs:{root:{cursor:"move"},body:{width:"calc(w)",height:"calc(h)",strokeWidth:2,stroke:"#000000",fill:"#FFFFFF"},header:{width:"calc(w)",height:30,strokeWidth:2,stroke:"#000000",fill:"#FFFFFF"},headerText:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:15,fontSize:16,fill:"#333333"},bodyText:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h/2+15)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"rect",selector:"header"},{tagName:"text",selector:"headerText"},{tagName:"text",selector:"bodyText"}]});var Oo=10;const ly=Kt.define("standard.Cylinder",{attrs:{root:{cursor:"move"},body:{lateralArea:Oo,fill:"#FFFFFF",stroke:"#333333",strokeWidth:2},top:{cx:"calc(w/2)",cy:Oo,rx:"calc(w/2)",ry:Oo,fill:"#FFFFFF",stroke:"#333333",strokeWidth:2},label:{textVerticalAnchor:"middle",textAnchor:"middle",x:"calc(w/2)",y:"calc(h+15)",fontSize:14,fill:"#333333"}}},{markup:[{tagName:"path",selector:"body"},{tagName:"ellipse",selector:"top"},{tagName:"text",selector:"label"}],topRy:function(t,e){if(t===void 0)return this.attr("body/lateralArea");var n={lateralArea:t},r=Ut(t),i=r?`calc(${parseFloat(t)/100}*h)`:t,s={cy:i,ry:i};return this.attr({body:n,top:s},e)}},{attributes:{"lateral-area":{set:function(t,e){var n=Ut(t);n&&(t=parseFloat(t)/100);var r=e.x,i=e.y,s=e.width,o=e.height,l=s/2,a=n?o*t:t,c=N.KAPPA,u=c*l,h=c*(n?o*t:t),g=r,d=r+s/2,v=r+s,y=i+a,x=y-a,A=i+o-a,T=i+o,f=["M",g,y,"L",g,A,"C",r,A+h,d-u,T,d,T,"C",d+u,T,v,A+h,v,A,"L",v,y,"C",v,y-h,d+u,x,d,x,"C",d-u,x,g,y-h,g,y,"Z"];return{d:f.join(" ")}},unset:"d"}}});var cy={tagName:"foreignObject",selector:"foreignObject",attributes:{overflow:"hidden"},children:[{tagName:"div",namespaceURI:"http://www.w3.org/1999/xhtml",selector:"label",style:{width:"100%",height:"100%",position:"static",backgroundColor:"transparent",textAlign:"center",margin:0,padding:"0px 5px",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center"}}]},uy={tagName:"text",selector:"label",attributes:{"text-anchor":"middle"}},hy=Mo.test("svgforeignobject")?cy:uy;const fy=Kt.define("standard.TextBlock",{attrs:{root:{cursor:"move"},body:{width:"calc(w)",height:"calc(h)",stroke:"#333333",fill:"#ffffff",strokeWidth:2},foreignObject:{width:"calc(w)",height:"calc(h)"},label:{style:{fontSize:14}}}},{markup:[{tagName:"rect",selector:"body"},hy]},{attributes:{text:{set:function(t,e,n,r){if(n instanceof HTMLElement)n.textContent=t;else{var i=r.style||{},s={text:t,width:-5,height:"100%"},o=j({"text-vertical-anchor":"middle"},i);return To["text-wrap"].set.call(this,s,e,n,o),{fill:i.color||null}}},unset:function(t){if(t.textContent="",t instanceof SVGElement)return"fill"},position:function(t,e,n){if(n instanceof SVGElement)return e.center()}}}}),dy=Pr.define("standard.Link",{attrs:{line:{connection:!0,stroke:"#333333",strokeWidth:2,strokeLinejoin:"round",targetMarker:{type:"path",d:"M 10 -5 0 0 10 5 z"}},wrapper:{connection:!0,strokeWidth:10,strokeLinejoin:"round"}}},{markup:[{tagName:"path",selector:"wrapper",attributes:{fill:"none",cursor:"pointer",stroke:"transparent","stroke-linecap":"round"}},{tagName:"path",selector:"line",attributes:{fill:"none","pointer-events":"none"}}]}),gy=Pr.define("standard.DoubleLink",{attrs:{line:{connection:!0,stroke:"#DDDDDD",strokeWidth:4,strokeLinejoin:"round",targetMarker:{type:"path",stroke:"#000000",d:"M 10 -3 10 -10 -2 0 10 10 10 3"}},outline:{connection:!0,stroke:"#000000",strokeWidth:6,strokeLinejoin:"round"}}},{markup:[{tagName:"path",selector:"outline",attributes:{fill:"none",cursor:"pointer"}},{tagName:"path",selector:"line",attributes:{fill:"none","pointer-events":"none"}}]}),py=Pr.define("standard.ShadowLink",{attrs:{line:{connection:!0,stroke:"#FF0000",strokeWidth:20,strokeLinejoin:"round",targetMarker:{type:"path",stroke:"none",d:"M 0 -10 -10 0 0 10 z"},sourceMarker:{type:"path",stroke:"none",d:"M -10 -10 0 0 -10 10 0 10 0 -10 z"}},shadow:{connection:!0,transform:"translate(3,6)",stroke:"#000000",strokeOpacity:.2,strokeWidth:20,strokeLinejoin:"round",targetMarker:{type:"path",d:"M 0 -10 -10 0 0 10 z",stroke:"none"},sourceMarker:{type:"path",stroke:"none",d:"M -10 -10 0 0 -10 10 0 10 0 -10 z"}}}},{markup:[{tagName:"path",selector:"shadow",attributes:{fill:"none","pointer-events":"none"}},{tagName:"path",selector:"line",attributes:{fill:"none",cursor:"pointer"}}]});var vy={__proto__:null,BorderedImage:iy,Circle:Jm,Cylinder:ly,DoubleLink:gy,Ellipse:Qm,EmbeddedImage:sy,HeaderedRectangle:ay,Image:ry,InscribedImage:oy,Link:dy,Path:ty,Polygon:ey,Polyline:ny,Rectangle:Zm,ShadowLink:py,TextBlock:fy},my={__proto__:null,standard:vy};const $n={POINT:"point",CUBIC:"cubic",LINE:"line",GAP:"gap"},yy=Object.values($n),wy=10,by=1,No=function(t,e,n=[],r={}){const{cornerType:i=$n.POINT,cornerRadius:s=wy,cornerPreserveAspectRatio:o=!1,precision:l=by,raw:a=!1}=r;if(yy.indexOf(i)===-1)throw new Error("Invalid `cornerType` provided to `straight` connector.");let c;if(i===$n.POINT||!s){const u=[t].concat(n).concat([e]),h=new Lt(u);c=new Z(h)}else{c=new Z,c.appendSegment(Z.createSegment("M",t));let u;const h=n.length;for(let g=0;g<h;g++){const d=new S(n[g]),v=n[g-1]||t,y=n[g+1]||e,x=u||d.distance(v)/2;u=d.distance(y)/2;let A,T;o?A=T=-Math.min(s,x,u):(A=-Math.min(s,x),T=-Math.min(s,u));const f=d.clone().move(v,A).round(l),p=d.clone().move(y,T).round(l);switch(c.appendSegment(Z.createSegment("L",f)),i){case $n.CUBIC:{const m=.3333333333333333,w=2/3,b=new S(m*f.x+w*d.x,w*d.y+m*f.y),P=new S(m*p.x+w*d.x,w*d.y+m*p.y);c.appendSegment(Z.createSegment("C",b,P,p));break}case $n.LINE:{c.appendSegment(Z.createSegment("L",p));break}case $n.GAP:{c.appendSegment(Z.createSegment("M",p));break}}}c.appendSegment(Z.createSegment("L",e))}return a?c:c.serialize()};var xy=5,Ju=["arc","gap","cubic"],Ay=0,Qu=1,Py=["smooth"],Ni=1/3,ki=2/3;function th(t,e){let{x:n,y:r}=t,{x:i,y:s}=e;if(n>i){let o=n;n=i,i=o,o=r,r=s,s=o}if(r>s){let o=n;n=i,i=o,o=r,r=s,s=o}return[new S(n,r),new S(i,s)]}function Ty(t,e){const[{x:n,y:r},{x:i,y:s}]=th(t.start,t.end),[{x:o,y:l},{x:a,y:c}]=th(e.start,e.end),u=n<=a&&o<=i,h=r<=c&&l<=s;return u&&h}function ko(t,e,n){var r=[].concat(t,n,e);return r.reduce(function(i,s,o){var l=r[o+1];return l!=null&&(i[o]=fn(s,l)),i},[])}function Sy(t){var e=t.paper,n=e._jumpOverUpdateList;if(n==null){n=e._jumpOverUpdateList=[];var r=e.model;r.on("batch:stop",function(){this.hasActiveBatch()||Ey(e)}),r.on("reset",function(){n=e._jumpOverUpdateList=[]})}n.indexOf(t)<0&&(n.push(t),t.listenToOnce(t.model,"change:connector remove",function(){n.splice(n.indexOf(t),1)}))}function Ey(t){for(var e=t._jumpOverUpdateList,n=0;n<e.length;n++){const r=e[n],i=r.getFlag(r.constructor.Flags.CONNECTOR);r.requestUpdate(i)}}function Cy(t,e){return xt(e).reduce(function(n,r){var i=t.intersection(r);return i&&n.push(i),n},[])}function eh(t,e){return fn(t,e).squaredLength()}function Ly(t,e,n){return e.reduce(function(r,i,s){if(i.skip===!0)return r;var o=r.pop()||t,l=ti(i).move(o.start,-n),a=ti(i).move(o.start,+n),c=e[s+1];if(c!=null){var u=a.distance(c);u<=n&&(a=c.move(o.start,u),c.skip=!0)}else{var h=l.distance(o.end);if(h<n*2+Qu)return r.push(o),r}var g=a.distance(o.start);if(g<n*2+Qu)return r.push(o),r;var d=fn(l,a);return d.isJump=!0,r.push(fn(o.start,l),d,fn(a,o.end)),r},[])}function nh(t,e,n,r){var i=new Z,s;return s=Z.createSegment("M",t[0].start),i.appendSegment(s),xt(t).forEach(function(o,l){if(o.isJump){var a,c,u,h;if(n==="arc"){a=-90,c=o.start.difference(o.end);var g=+(c.x<0||c.x===0&&c.y<0);g&&(a+=180);var d=o.midpoint(),v=new W(d,o.end).rotate(d,a),y;y=new W(o.start,d),u=y.pointAt(2/3).rotate(o.start,a),h=v.pointAt(1/3).rotate(v.end,-a),s=Z.createSegment("C",u,h,v.end),i.appendSegment(s),y=new W(d,o.end),u=v.pointAt(1/3).rotate(v.end,a),h=y.pointAt(1/3).rotate(o.end,-a),s=Z.createSegment("C",u,h,o.end),i.appendSegment(s)}else if(n==="gap")s=Z.createSegment("M",o.end),i.appendSegment(s);else if(n==="cubic"){a=o.start.theta(o.end);var x=e*.6,A=e*1.35;c=o.start.difference(o.end),g=+(c.x<0||c.x===0&&c.y<0),g&&(A*=-1),u=S(o.start.x+x,o.start.y+A).rotate(o.start,a),h=S(o.end.x-x,o.end.y+A).rotate(o.end,a),s=Z.createSegment("C",u,h,o.end),i.appendSegment(s)}}else{var T=t[l+1];r==0||!T||T.isJump?(s=Z.createSegment("L",o.end),i.appendSegment(s)):_y(r,i,o.end,o.start,T.end)}}),i}function _y(t,e,n,r,i){var s=n.distance(r)/2,o=n.distance(i)/2,l=-Math.min(t,s),a=-Math.min(t,o),c=n.clone().move(r,l).round(),u=n.clone().move(i,a).round(),h=new S(Ni*c.x+ki*n.x,ki*n.y+Ni*c.y),g=new S(Ni*u.x+ki*n.x,ki*n.y+Ni*u.y),d;d=Z.createSegment("L",c),e.appendSegment(d),d=Z.createSegment("C",h,g,u),e.appendSegment(d)}const My=function(t,e,n,r){Sy(this);var i=r.raw,s=r.size||xy,o=r.jump&&(""+r.jump).toLowerCase(),l=r.radius||Ay,a=r.ignoreConnectors||Py;Ju.indexOf(o)===-1&&(o=Ju[0]);var c=this.paper,u=c.model,h=u.getLinks();if(h.length===1)return nh(ko(t,e,n),s,o,l);var g=this.model,d=h.indexOf(g),v=c.options.defaultConnector||{},y=h.filter(function(m,w){var b=m.get("connector")||v;return xt(a).includes(b.name)?!1:w>d?b.name!=="jumpover":!0}),x=y.map(function(m){return c.findViewByModel(m)}),A=ko(t,e,n),T=x.map(function(m){return m==null?[]:m===this?A:ko(m.sourcePoint,m.targetPoint,m.route)},this),f=A.reduce(function(m,w){var b=y.reduce(function(P,E,C){if(E!==g){const k=T[C].slice(),I=k.findIndex(H=>Ty(w,H));I>-1&&w.containsPoint(k[I].end)&&k.splice(I+1,1);const D=Cy(w,k);P.push.apply(P,D)}return P},[]).sort(function(P,E){return eh(w.start,P)-eh(w.start,E)});return b.length>0?m.push.apply(m,Ly(w,b,s)):m.push(w),m},[]),p=nh(f,s,o,l);return i?p:p.serialize()},Oy=function(t,e,n=[],r={}){const{raw:i}=r;return No(t,e,n,{cornerType:"point",raw:i})},Ny=10,ky=0,Iy=function(t,e,n=[],r={}){const{radius:i=Ny,raw:s}=r;return No(t,e,n,{cornerType:"cubic",cornerRadius:i,precision:ky,raw:s})},Ry=function(t,e,n,r){var i=r&&r.raw,s;if(n&&n.length!==0){var o=[t].concat(n).concat([e]),l=Pt.throughPoints(o);s=new Z(l)}else{s=new Z;var a;if(a=Z.createSegment("M",t),s.appendSegment(a),Math.abs(t.x-e.x)>=Math.abs(t.y-e.y)){var c=(t.x+e.x)/2;a=Z.createSegment("C",c,t.y,c,e.y,e.x,e.y),s.appendSegment(a)}else{var u=(t.y+e.y)/2;a=Z.createSegment("C",t.x,u,e.x,u,e.x,e.y),s.appendSegment(a)}}return i?s:s.serialize()},we={AUTO:"auto",HORIZONTAL:"horizontal",VERTICAL:"vertical",CLOSEST_POINT:"closest-point",OUTWARDS:"outwards"},Zt={UP:"up",DOWN:"down",LEFT:"left",RIGHT:"right",AUTO:"auto",CLOSEST_POINT:"closest-point",OUTWARDS:"outwards"},Io=function(t,e,n=[],r={},i){const s=!!r.raw,{direction:o=we.AUTO,precision:l=3}=r,a={coeff:r.distanceCoefficient||.6,angleTangentCoefficient:r.angleTangentCoefficient||80,tau:r.tension||.5,sourceTangent:r.sourceTangent?new S(r.sourceTangent):null,targetTangent:r.targetTangent?new S(r.targetTangent):null,rotate:!!r.rotate};typeof r.sourceDirection=="string"?a.sourceDirection=r.sourceDirection:typeof r.sourceDirection=="number"?a.sourceDirection=new S(1,0).rotate(null,r.sourceDirection):a.sourceDirection=r.sourceDirection?new S(r.sourceDirection).normalize():null,typeof r.targetDirection=="string"?a.targetDirection=r.targetDirection:typeof r.targetDirection=="number"?a.targetDirection=new S(1,0).rotate(null,r.targetDirection):a.targetDirection=r.targetDirection?new S(r.targetDirection).normalize():null;const c=[t,...n,e].map(y=>new S(y));let u;if(a.sourceTangent)u=a.sourceTangent;else{const y=Gy(i,c,o,a),x=c[0].distance(c[1])*a.coeff,A=c[1].difference(c[0]).normalize(),T=Ro(y,A);if(T>Math.PI/4){const f=x+(T-Math.PI/4)*a.angleTangentCoefficient;u=y.clone().scale(f,f)}else u=y.clone().scale(x,x)}let h;if(a.targetTangent)h=a.targetTangent;else{const y=zy(i,c,o,a),x=c.length-1,A=c[x-1].distance(c[x])*a.coeff,T=c[x-1].difference(c[x]).normalize(),f=Ro(y,T);if(f>Math.PI/4){const p=A+(f-Math.PI/4)*a.angleTangentCoefficient;h=y.clone().scale(p,p)}else h=y.clone().scale(A,A)}const d=$y(c,u,h,a).map(y=>Hy(y,a)),v=new Z(d).round(l);return s?v:v.serialize()};Io.Directions=we,Io.TangentDirections=Zt;function Vy(t,e,n){const{sourceBBox:r}=t;let i,s;if(!t.sourceView)r.x>e[1].x?i="right":i="left";else if(s=t.sourceView.model.angle(),n.rotate&&s){const l=t.sourceView.getNodeUnrotatedBBox(t.sourceView.el),a=e[0].clone();a.rotate(r.center(),s),i=l.sideNearestToPoint(a)}else i=r.sideNearestToPoint(e[0]);let o;switch(i){case"left":o=new S(-1,0);break;case"right":default:o=new S(1,0);break}return n.rotate&&s&&o.rotate(null,-s),o}function Dy(t,e,n){const{targetBBox:r}=t;let i,s;if(!t.targetView)r.x>e[e.length-2].x?i="left":i="right";else if(s=t.targetView.model.angle(),n.rotate&&s){const l=t.targetView.getNodeUnrotatedBBox(t.targetView.el),a=e[e.length-1].clone();a.rotate(r.center(),s),i=l.sideNearestToPoint(a)}else i=r.sideNearestToPoint(e[e.length-1]);let o;switch(i){case"left":o=new S(-1,0);break;case"right":default:o=new S(1,0);break}return n.rotate&&s&&o.rotate(null,-s),o}function Fy(t,e,n){const{sourceBBox:r}=t;let i,s;if(!t.sourceView)r.y>e[1].y?i="bottom":i="top";else if(s=t.sourceView.model.angle(),n.rotate&&s){const l=t.sourceView.getNodeUnrotatedBBox(t.sourceView.el),a=e[0].clone();a.rotate(r.center(),s),i=l.sideNearestToPoint(a)}else i=r.sideNearestToPoint(e[0]);let o;switch(i){case"top":o=new S(0,-1);break;case"bottom":default:o=new S(0,1);break}return n.rotate&&s&&o.rotate(null,-s),o}function By(t,e,n){const{targetBBox:r}=t;let i,s;if(!t.targetView)r.y>e[e.length-2].y?i="top":i="bottom";else if(s=t.targetView.model.angle(),n.rotate&&s){const l=t.targetView.getNodeUnrotatedBBox(t.targetView.el),a=e[e.length-1].clone();a.rotate(r.center(),s),i=l.sideNearestToPoint(a)}else i=r.sideNearestToPoint(e[e.length-1]);let o;switch(i){case"top":o=new S(0,-1);break;case"bottom":default:o=new S(0,1);break}return n.rotate&&s&&o.rotate(null,-s),o}function rh(t,e,n){const{sourceBBox:r}=t;let i,s;if(!t.sourceView)i=r.sideNearestToPoint(e[1]);else if(s=t.sourceView.model.angle(),n.rotate&&s){const l=t.sourceView.getNodeUnrotatedBBox(t.sourceView.el),a=e[0].clone();a.rotate(r.center(),s),i=l.sideNearestToPoint(a)}else i=r.sideNearestToPoint(e[0]);let o;switch(i){case"top":o=new S(0,-1);break;case"bottom":o=new S(0,1);break;case"right":o=new S(1,0);break;case"left":o=new S(-1,0);break}return n.rotate&&s&&o.rotate(null,-s),o}function ih(t,e,n){const{targetBBox:r}=t;let i,s;if(!t.targetView)i=r.sideNearestToPoint(e[e.length-2]);else if(s=t.targetView.model.angle(),n.rotate&&s){const l=t.targetView.getNodeUnrotatedBBox(t.targetView.el),a=e[e.length-1].clone();a.rotate(r.center(),s),i=l.sideNearestToPoint(a)}else i=r.sideNearestToPoint(e[e.length-1]);let o;switch(i){case"top":o=new S(0,-1);break;case"bottom":o=new S(0,1);break;case"right":o=new S(1,0);break;case"left":o=new S(-1,0);break}return n.rotate&&s&&o.rotate(null,-s),o}function sh(t,e,n){return e[1].difference(e[0]).normalize()}function oh(t,e,n){const r=e.length-1;return e[r-1].difference(e[r]).normalize()}function ah(t,e,n){const{sourceBBox:r}=t,i=r.center();return e[0].difference(i).normalize()}function lh(t,e,n){const{targetBBox:r}=t,i=r.center();return e[e.length-1].difference(i).normalize()}function Gy(t,e,n,r){if(r.sourceDirection)switch(r.sourceDirection){case Zt.UP:return new S(0,-1);case Zt.DOWN:return new S(0,1);case Zt.LEFT:return new S(-1,0);case Zt.RIGHT:return new S(1,0);case Zt.AUTO:return rh(t,e,r);case Zt.CLOSEST_POINT:return sh(t,e);case Zt.OUTWARDS:return ah(t,e);default:return r.sourceDirection}switch(n){case we.HORIZONTAL:return Vy(t,e,r);case we.VERTICAL:return Fy(t,e,r);case we.CLOSEST_POINT:return sh(t,e);case we.OUTWARDS:return ah(t,e);case we.AUTO:default:return rh(t,e,r)}}function zy(t,e,n,r){if(r.targetDirection)switch(r.targetDirection){case Zt.UP:return new S(0,-1);case Zt.DOWN:return new S(0,1);case Zt.LEFT:return new S(-1,0);case Zt.RIGHT:return new S(1,0);case Zt.AUTO:return ih(t,e,r);case Zt.CLOSEST_POINT:return oh(t,e);case Zt.OUTWARDS:return lh(t,e);default:return r.targetDirection}switch(n){case we.HORIZONTAL:return Dy(t,e,r);case we.VERTICAL:return By(t,e,r);case we.CLOSEST_POINT:return oh(t,e);case we.OUTWARDS:return lh(t,e);case we.AUTO:default:return ih(t,e,r)}}function Uy(t,e){const n=Math.cos(e),r=Math.sin(e),i=n*t.x-r*t.y,s=r*t.x+n*t.y;t.x=i,t.y=s}function Ro(t,e){let n=t.dot(e)/(t.magnitude()*e.magnitude());return n<-1&&(n=-1),n>1&&(n=1),Math.acos(n)}function ch(t,e){return t.x*e.y-t.y*e.x}function $y(t,e,n,r){const{tau:i,coeff:s}=r,o=[],l=[],a=[],c=t.length-1;for(let u=0;u<c;u++)o[u]=t[u].distance(t[u+1]);l[0]=e,l[c]=n;for(let u=1;u<c;u++){let h,g;u===1?h=t[u-1].clone().offset(l[u-1].x,l[u-1].y):h=t[u-1].clone(),u===c-1?g=t[u+1].clone().offset(l[u+1].x,l[u+1].y):g=t[u+1].clone();const d=h.difference(t[u]).normalize(),v=g.difference(t[u]).normalize(),y=Ro(d,v);let x=(Math.PI-y)/2,A;const T=ch(d,v);let f;f=ch(t[u].difference(t[u+1]),t[u].difference(t[u-1])),T<0&&(x=-x),y<Math.PI/2&&(x<0&&f<0||x>0&&f>0)&&(x=x-Math.PI),A=v.clone(),Uy(A,x);const p=A.clone(),m=A.clone(),w=o[u-1]*s,b=o[u]*s;p.scale(w,w),m.scale(b,b),l[u]=[p,m]}for(let u=0;u<c;u++){let h,g;u===0?h=t[u+1].difference(l[u].x/i,l[u].y/i):h=t[u+1].difference(l[u][1].x/i,l[u][1].y/i),u===c-1?g=t[u].clone().offset(l[u+1].x/i,l[u+1].y/i):g=t[u].difference(l[u+1][0].x/i,l[u+1][0].y/i),a[u]=[h,t[u],t[u+1],g]}return a}function Hy(t,e){const{tau:n}=e,r=new S;r.x=t[1].x+(t[2].x-t[0].x)/(6*n),r.y=t[1].y+(t[2].y-t[0].y)/(6*n);const i=new S;return i.x=t[2].x+(t[3].x-t[1].x)/(6*n),i.y=t[2].y+(t[3].y-t[1].y)/(6*n),new Pt(t[1],r,i,t[2])}var uh={__proto__:null,curve:Io,jumpover:My,normal:Oy,rounded:Iy,smooth:Ry,straight:No},nn=function(t){this.cid=t&&t.cid||wn("view"),this.preinitialize.apply(this,arguments),j(this,Dc(t,Wy)),this._ensureElement(),this.initialize.apply(this,arguments)},qy=/^(\S+)\s*(.*)$/,Wy=["model","collection","el","id","attributes","className","tagName","events","style"];j(nn.prototype,Gt,{tagName:"div",$:function(t){return this.$el.find(t)},preinitialize:function(){},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(t){return this.undelegateEvents(),this._setElement(t),this.delegateEvents(),this},_setElement:function(t){this.$el=t instanceof z?t:z(t),this.el=this.$el[0]},delegateEvents:function(t){if(t||(t=Ct(this,"events")),!t)return this;this.undelegateEvents();for(var e in t){var n=t[e];if(bt(n)||(n=this[n]),!!n){var r=e.match(qy);this.delegate(r[1],r[2],n.bind(this))}}return this},delegate:function(t,e,n){return this.$el.on(t+".delegateEvents"+this.cid,e,n),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(t,e,n){return this.$el.off(t+".delegateEvents"+this.cid,e,n),this},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if(this.el)this.setElement(Ct(this,"el"));else{var t=j({},Ct(this,"attributes"));this.id&&(t.id=Ct(this,"id")),this.className&&(t.class=Ct(this,"className")),this.setElement(this._createElement(Ct(this,"tagName"))),this._setAttributes(t)}},_setAttributes:function(t){this.$el.attr(t)}}),nn.extend=wo;const Oe={},le=nn.extend({options:{},theme:null,themeClassNamePrefix:me("theme-"),requireSetThemeOverride:!1,defaultTheme:Bt.defaultTheme,children:null,childNodes:null,DETACHABLE:!0,UPDATE_PRIORITY:2,FLAG_INSERT:1<<30,FLAG_REMOVE:1<<29,FLAG_INIT:1<<28,constructor:function(t){this.requireSetThemeOverride=t&&!!t.theme,this.options=j({},this.options,t),nn.call(this,t)},initialize:function(){Oe[this.cid]=this,this.setTheme(this.options.theme||this.defaultTheme),this.init()},unmount:function(){this.svgElement?this.vel.remove():this.$el.remove()},isMounted:function(){return this.el.parentNode!==null},renderChildren:function(t){if(t||(t=Ct(this,"children")),t){var e=this.svgElement,n=N.namespace[e?"svg":"xhtml"],r=pr(t,n);(e?this.vel:this.$el).empty().append(r.fragment),this.childNodes=r.selectors}return this},findAttributeNode:function(t,e){let n=e;for(;n&&n.nodeType===1;){if(n.getAttribute(t))return n;if(n===this.el)return null;n=n.parentNode}return null},findAttribute:function(t,e){const n=this.findAttributeNode(t,e);return n&&n.getAttribute(t)},_ensureElement:function(){if(this.el)this.setElement(Ct(this,"el"));else{var t=Ct(this,"tagName"),e=j({},Ct(this,"attributes")),n=j({},Ct(this,"style"));this.id&&(e.id=Ct(this,"id")),this.setElement(this._createElement(t)),this._setAttributes(e),this._setStyle(n)}this._ensureElClassName()},_setAttributes:function(t){this.svgElement?this.vel.attr(t):this.$el.attr(t)},_setStyle:function(t){this.$el.css(t)},_createElement:function(t){return this.svgElement?document.createElementNS(N.namespace.svg,t):document.createElement(t)},_setElement:function(t){this.$el=t instanceof z?t:z(t),this.el=this.$el[0],this.svgElement&&(this.vel=N(this.el))},_ensureElClassName:function(){var t=Ct(this,"className");if(t){var e=me(t);this.svgElement?this.vel.removeClass(t).addClass(e):this.$el.removeClass(t).addClass(e)}},init:function(){},onRender:function(){},confirmUpdate:function(){return 0},setTheme:function(t,e){return e=e||{},this.theme&&this.requireSetThemeOverride&&!e.override?this:(this.removeThemeClassName(),this.addThemeClassName(t),this.onSetTheme(this.theme,t),this.theme=t,this)},addThemeClassName:function(t){if(t=t||this.theme,!t)return this;var e=this.themeClassNamePrefix+t;return this.svgElement?this.vel.addClass(e):this.$el.addClass(e),this},removeThemeClassName:function(t){t=t||this.theme;var e=this.themeClassNamePrefix+t;return this.svgElement?this.vel.removeClass(e):this.$el.removeClass(e),this},onSetTheme:function(t,e){},remove:function(){return this.onRemove(),this.undelegateDocumentEvents(),Oe[this.cid]=null,nn.prototype.remove.apply(this,arguments),this},onRemove:function(){},getEventNamespace:function(){return".joint-event-ns-"+this.cid},delegateElementEvents:function(t,e,n){if(!e)return this;n||(n={});var r=this.getEventNamespace();for(var i in e){var s=e[i];typeof s!="function"&&(s=this[s]),s&&z(t).on(i+r,n,s.bind(this))}return this},undelegateElementEvents:function(t){return z(t).off(this.getEventNamespace()),this},delegateDocumentEvents:function(t,e){return t||(t=Ct(this,"documentEvents")),this.delegateElementEvents(document,t,e)},undelegateDocumentEvents:function(){return this.undelegateElementEvents(document)},eventData:function(t,e){if(!t)throw new Error("eventData(): event object required.");var n=t.data,r="__"+this.cid+"__";return e===void 0?n?n[r]||{}:{}:(n||(n=t.data={}),n[r]||(n[r]={}),j(n[r],e),this)},stopPropagation:function(t){return this.eventData(t,{propagationStopped:!0}),this},isPropagationStopped:function(t){return!!this.eventData(t).propagationStopped}},{extend:function(){var t=Array.from(arguments),e=t[0]&&j({},t[0])||{},n=t[1]&&j({},t[1])||{},r=e.render||this.prototype&&this.prototype.render||null;return e.render=function(){return typeof r=="function"&&r.apply(this,arguments),this.render.__render__===r&&this.onRender(),this},e.render.__render__=r,nn.extend.call(this,e,n)}});class Ii{constructor(...e){this.callbackArguments=e}listenTo(e,n,...r){const{callbackArguments:i}=this;if(n&&typeof n=="object"){const[s=null]=r;Object.entries(n).forEach(([o,l])=>{typeof l=="function"&&((s||i.length>0)&&(l=l.bind(s,...i)),Gt.listenTo.call(this,e,o,l))})}else if(typeof n=="string"&&typeof r[0]=="function"){let[s,o=null]=r;(o||i.length>0)&&(s=s.bind(o,...i)),Gt.listenTo.call(this,e,n,s)}}stopListening(){Gt.stopListening.call(this)}}var Jt=function(t,e){e||(e={}),this.preinitialize.apply(this,arguments),e.model&&(this.model=e.model),e.comparator!==void 0&&(this.comparator=e.comparator),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,j({silent:!0},e))},jy={add:!0,remove:!0,merge:!0},Yy={add:!0,remove:!1},hh=function(t,e,n){n=Math.min(Math.max(n,0),t.length);var r=Array(t.length-n),i=e.length,s;for(s=0;s<r.length;s++)r[s]=t[s+n];for(s=0;s<i;s++)t[s+n]=e[s];for(s=0;s<r.length;s++)t[s+i+n]=r[s]};j(Jt.prototype,Gt,{model:Ve,preinitialize:function(){},initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},add:function(t,e){return this.set(t,j({merge:!1},e,Yy))},remove:function(t,e){e=j({},e);var n=!Array.isArray(t);t=n?[t]:t.slice();var r=this._removeModels(t,e);return!e.silent&&r.length&&(e.changes={added:[],merged:[],removed:r},this.trigger("update",this,e)),n?r[0]:r},set:function(t,e){if(t!=null){e=j({},jy,e);var n=!Array.isArray(t);t=n?[t]:t.slice();var r=e.at;r!=null&&(r=+r),r>this.length&&(r=this.length),r<0&&(r+=this.length+1);var i=[],s=[],o=[],l=[],a={},c=e.add,u=e.merge,h=e.remove,g=!1,d=this.comparator&&r==null&&e.sort!==!1,v=Mt(this.comparator)?this.comparator:null,y,x;for(x=0;x<t.length;x++){y=t[x];var A=this.get(y);if(A){if(u&&y!==A){var T=this._isModel(y)?y.attributes:y;A.set(T,e),o.push(A),d&&!g&&(g=A.hasChanged(v))}a[A.cid]||(a[A.cid]=!0,i.push(A)),t[x]=A}else c&&(y=t[x]=this._prepareModel(y,e),y&&(s.push(y),this._addReference(y,e),a[y.cid]=!0,i.push(y)))}if(h){for(x=0;x<this.length;x++)y=this.models[x],a[y.cid]||l.push(y);l.length&&this._removeModels(l,e)}var f=!1,p=!d&&c&&h;if(i.length&&p?(f=this.length!==i.length||this.models.some(function(m,w){return m!==i[w]}),this.models.length=0,hh(this.models,i,0),this.length=this.models.length):s.length&&(d&&(g=!0),hh(this.models,s,r??this.length),this.length=this.models.length),g&&this.sort({silent:!0}),!e.silent){for(x=0;x<s.length;x++)r!=null&&(e.index=r+x),y=s[x],y.trigger(y.eventPrefix+"add",y,this,e);(g||f)&&this.trigger("sort",this,e),(s.length||l.length||o.length)&&(e.changes={added:s,removed:l,merged:o},this.trigger("update",this,e))}return n?t[0]:t}},reset:function(t,e){e=e?kt(e):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],e);return e.previousModels=this.models,this._reset(),t=this.add(t,j({silent:!0},e)),e.silent||this.trigger("reset",this,e),t},push:function(t,e){return this.add(t,j({at:this.length},e))},pop:function(t){var e=this.at(this.length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,j({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return Array.prototype.slice.apply(this.models,arguments)},get:function(t){if(t!=null)return this._byId.get(t)||this._byId.get(this.modelId(this._isModel(t)?t.attributes:t,t.idAttribute))||t.cid&&this._byId.get(t.cid)},has:function(t){return this.get(t)!=null},at:function(t){return t<0&&(t+=this.length),this.models[t]},sort:function(t){var e=this.comparator;if(!e)throw new Error("Cannot sort a set without a comparator");t||(t={});var n=e.length;return bt(e)&&(e=e.bind(this)),n===1||Mt(e)?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("sort",this,t),this},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(t,e){var n;return t[e||((n=this.model.prototype)===null||n===void 0?void 0:n.idAttribute)||"id"]},values:function(){return new Tr(this,fh)},keys:function(){return new Tr(this,dh)},entries:function(){return new Tr(this,Xy)},each:function(t,e){this.models.forEach(t,e)},filter:function(t,e){return this.models.filter(t,e)},find:function(t,e){return this.models.find(t,e)},findIndex:function(t,e){return this.models.findIndex(t,e)},first:function(){return this.models[0]},includes:function(t){return this.models.includes(t)},last:function(){return this.models[this.models.length-1]},isEmpty:function(){return!this.models.length},map:function(t,e){return this.models.map(t,e)},reduce:function(t,e=this.first()){return this.models.reduce(t,e)},_reset:function(){this.length=0,this.models=[],this._byId=new Map},_prepareModel:function(t,e){if(this._isModel(t))return!e.dry&&!t.collection&&(t.collection=this),t;e=e?kt(e):{},e.dry||(e.collection=this);var n;return this.model.prototype?n=new this.model(t,e):n=this.model(t,e),n.validationError?(this.trigger("invalid",this,n.validationError,e),!1):n},_removeModels:function(t,e){for(var n=[],r=0;r<t.length;r++){var i=this.get(t[r]);if(i){var s=this.models.indexOf(i);this.models.splice(s,1),this.length--,this._byId.delete(i.cid);var o=this.modelId(i.attributes,i.idAttribute);o!=null&&this._byId.delete(o),e.silent||(e.index=s,i.trigger(i.eventPrefix+"remove",i,this,e)),n.push(i),this._removeReference(i,e)}}return t.length>0&&!e.silent&&delete e.index,n},_isModel:function(t){return t instanceof Ve},_addReference:function(t,e){this._byId.set(t.cid,t);var n=this.modelId(t.attributes,t.idAttribute);n!=null&&this._byId.set(n,t),t.on("all",this._onModelEvent,this)},_removeReference:function(t,e){this._byId.delete(t.cid);var n=this.modelId(t.attributes,t.idAttribute);n!=null&&this._byId.delete(n),!e.dry&&this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,r){if(e){if((t===e.eventPrefix+"add"||t===e.eventPrefix+"remove")&&n!==this)return;if(t==="changeId"){var i=this.modelId(e.previousAttributes(),e.idAttribute),s=this.modelId(e.attributes,e.idAttribute);i!=null&&this._byId.delete(i),s!=null&&this._byId.set(s,e)}}this.trigger.apply(this,arguments)}});var Ri=typeof Symbol=="function"&&Symbol.iterator;Ri&&(Jt.prototype[Ri]=Jt.prototype.values);var Tr=function(t,e){this._collection=t,this._kind=e,this._index=0},fh=1,dh=2,Xy=3;Ri&&(Tr.prototype[Ri]=function(){return this}),Tr.prototype.next=function(){if(this._collection){if(this._index<this._collection.length){var t=this._collection.at(this._index);this._index++;var e;if(this._kind===fh)e=t;else{var n=this._collection.modelId(t.attributes,t.idAttribute);this._kind===dh?e=n:e=[n,t]}return{value:e,done:!1}}this._collection=void 0}return{value:void 0,done:!0}};var Ky={toArray:1,sortBy:3},Zy=[Jt,Ky,"models"];function Jy(t){var e=t[0],n=t[1],r=t[2];Im(e,{sortBy:Gn,toArray:xt},n,r)}Jy(Zy),Jt.extend=wo;var Qy={__proto__:null,$:z,Collection:Jt,Data:oo,Event:Ke,Events:Gt,Listener:Ii,Model:Ve,View:le,ViewBase:nn,views:Oe};function Sr(t){return t?Array.isArray(t)?t:[t]:[]}const ce=le.extend({tagName:"g",svgElement:!0,className:"highlight",HIGHLIGHT_FLAG:1,UPDATE_PRIORITY:3,DETACHABLE:!1,UPDATABLE:!0,MOUNTABLE:!0,cellView:null,nodeSelector:null,node:null,updateRequested:!1,postponedUpdate:!1,transformGroup:null,detachedTransformGroup:null,requestUpdate(t,e){const{paper:n}=t;this.cellView=t,this.nodeSelector=e,n&&(this.updateRequested=!0,n.requestViewUpdate(this,this.HIGHLIGHT_FLAG,this.UPDATE_PRIORITY))},confirmUpdate(){this.updateRequested=!1;const{cellView:t,nodeSelector:e}=this;return t.isMounted()?(this.update(t,e),this.mount(),this.transform()):this.postponedUpdate=!0,0},findNode(t,e=null){let n;if(typeof e=="string")n=t.findNode(e);else if(It(e)){const r=t.model.isLink(),{label:i=null,port:s,selector:o}=e;r&&i!==null?n=t.findLabelNode(i,o):!r&&s?n=t.findPortNode(s,o):n=t.findNode(o)}else e&&(n=N.toNode(e),(!(n instanceof SVGElement)||!t.el.contains(n))&&(n=null));return n||null},getNodeMatrix(t,e){const{options:n}=this,{layer:r}=n,{rotatableNode:i}=t,s=t.getNodeMatrix(e);return i?r?i.contains(e)?s:t.getRootRotateMatrix().inverse().multiply(s):t.getNodeRotateMatrix(e).multiply(s):s},mount(){const{MOUNTABLE:t,cellView:e,el:n,options:r,transformGroup:i,detachedTransformGroup:s,postponedUpdate:o,nodeSelector:l}=this;if(!t||i)return;if(o){this.update(e,l),this.transform();return}const{paper:a}=e,{layer:c,z:u}=r;if(c){let h;s?(h=s,this.detachedTransformGroup=null):h=N("g").addClass("highlight-transform").append(n),this.transformGroup=h,a.getLayerView(c).insertSortedNode(h.node,u)}else{const h=e.el.children,g=Math.max(u,0),d=h[g],v=qt(u)&&d,y=v?n===d:!n.nextElementSibling;if(n.parentNode&&y)return;v?e.el.insertBefore(n,d):e.el.appendChild(n)}},unmount(){const{MOUNTABLE:t,transformGroup:e,vel:n,options:r}=this;if(t)if(r.layer){if(!e)return;this.transformGroup=null,this.detachedTransformGroup=e,e.remove()}else n.remove()},transform(){const{transformGroup:t,cellView:e,updateRequested:n}=this;if(!t||e.model.isLink()||n)return;const r=e.getRootTranslateMatrix(),i=e.getRootRotateMatrix(),s=r.multiply(i);t.attr("transform",N.matrixToTransformString(s))},update(){const{node:t,cellView:e,nodeSelector:n,updateRequested:r,id:i}=this;if(r)return;this.postponedUpdate=!1;const s=this.node=this.findNode(e,n);t&&this.unhighlight(e,t),s?(this.highlight(e,s),this.mount()):(this.unmount(),e.notify("cell:highlight:invalid",i,this))},onRemove(){const{node:t,cellView:e,id:n,constructor:r}=this;t&&this.unhighlight(e,t),this.unmount(),r._removeRef(e,n)},highlight(t,e){},unhighlight(t,e){},listenToUpdateAttributes(t){const e=Ct(this,"UPDATE_ATTRIBUTES");!Array.isArray(e)||e.length===0||this.listenTo(t.model,"change",this.onCellAttributeChange)},onCellAttributeChange(){const{cellView:t}=this;if(!t)return;const{model:e,paper:n}=t;Ct(this,"UPDATE_ATTRIBUTES").some(i=>e.hasChanged(i))&&n.requestViewUpdate(this,this.HIGHLIGHT_FLAG,this.UPDATE_PRIORITY)}},{_views:{},highlight:function(t,e,n){const r=this.uniqueId(e,n);this.add(t,e,r,n)},unhighlight:function(t,e,n){const r=this.uniqueId(e,n);this.remove(t,r)},get(t,e=null){const{cid:n}=t,{_views:r}=this,i=r[n];if(e===null){const s=[];if(!i)return s;for(let o in i){const l=i[o];l instanceof this&&s.push(l)}return s}else{if(!i)return null;if(e in i){const s=i[e];if(s instanceof this)return s}return null}},has(t,e=null){const{cid:n}=t,{_views:r}=this,i=r[n];if(!i)return!1;if(e===null){for(let s in i)if(i[s]instanceof this)return!0;return!1}else return e in i&&i[e]instanceof this},add(t,e,n,r={}){if(!n)throw new Error("dia.HighlighterView: An ID required.");const i=ce.get(t,n);i&&i.remove();const s=new this(r);return s.id=n,this._addRef(t,n,s),s.requestUpdate(t,e),s.listenToUpdateAttributes(t),s},_addRef(t,e,n){const{cid:r}=t,{_views:i}=this;let s=i[r];s||(s=i[r]={}),s[e]=n},_removeRef(t,e){const{cid:n}=t,{_views:r}=this,i=r[n];if(i){e&&delete i[e];for(let s in i)return;delete r[n]}},remove(t,e=null){Sr(this.get(t,e)).forEach(n=>{n.remove()})},getAll(t,e=null){const n=[],{_views:r}=this;for(let i in r)for(let s in r[i]){const o=r[i][s];o.cellView.paper===t&&o instanceof this&&(e===null||s===e)&&n.push(o)}return n},removeAll(t,e=null){this.getAll(t,e).forEach(n=>n.remove())},update(t,e=null,n=!1){Sr(this.get(t,e)).forEach(r=>{(n||r.UPDATABLE)&&r.update()})},transform(t,e=null){Sr(this.get(t,e)).forEach(n=>{n.UPDATABLE&&n.transform()})},unmount(t,e=null){Sr(this.get(t,e)).forEach(n=>n.unmount())},mount(t,e=null){Sr(this.get(t,e)).forEach(n=>n.mount())},uniqueId(t,e=""){return N.ensureId(t)+JSON.stringify(e)}}),tw=ce.extend({tagName:"path",className:"highlight-stroke",attributes:{"pointer-events":"none",fill:"none"},options:{padding:3,rx:0,ry:0,useFirstSubpath:!1,attrs:{"stroke-width":3,stroke:"#FEB663"}},getPathData(t,e){const{options:n}=this,{useFirstSubpath:r}=n;let i;try{const s=N(e);if(i=s.convertToPathData().trim(),s.tagName()==="PATH"&&r){const o=i.search(/.M/i)+1;o>0&&(i=i.substr(0,o))}}catch{const s=t.getNodeBoundingRect(e);i=N.rectToPath(j({},n,s.toJSON()))}return i},highlightConnection(t){this.vel.attr("d",t.getSerializedConnection())},highlightNode(t,e){const{vel:n,options:r}=this,{padding:i,layer:s}=r;let o=this.getNodeMatrix(t,e);if(i){!s&&e===t.el&&n.remove();let l=t.getNodeBoundingRect(e);const a=l.x+l.width/2,c=l.y+l.height/2;l=N.transformRect(l,o);const u=Math.max(l.width,1),h=Math.max(l.height,1),g=(u+i)/u,d=(h+i)/h,v=N.createSVGMatrix({a:g,b:0,c:0,d,e:a-g*a,f:c-d*c});o=o.multiply(v)}n.attr({d:this.getPathData(t,e),transform:N.matrixToTransformString(o)})},highlight(t,e){const{vel:n,options:r}=this;n.attr(r.attrs),r.nonScalingStroke&&n.attr("vector-effect","non-scaling-stroke"),t.isNodeConnection(e)?this.highlightConnection(t):this.highlightNode(t,e)}}),gh=20;function ew(t,e){const n=t.children();for(;n.length>0;){const r=n.shift();e(r)&&n.push(...r.children())}}const nw=ce.extend({tagName:"rect",className:"highlight-mask",attributes:{"pointer-events":"none"},options:{padding:3,maskClip:gh,deep:!1,attrs:{stroke:"#FEB663","stroke-width":3,"stroke-linecap":"butt","stroke-linejoin":"miter"}},VISIBLE:"white",INVISIBLE:"black",MASK_ROOT_ATTRIBUTE_BLACKLIST:["marker-start","marker-end","marker-mid","transform","stroke-dasharray","class"],MASK_CHILD_ATTRIBUTE_BLACKLIST:["stroke","fill","stroke-width","stroke-opacity","stroke-dasharray","fill-opacity","marker-start","marker-end","marker-mid","class"],MASK_REPLACE_TAGS:["FOREIGNOBJECT","IMAGE","USE","TEXT","TSPAN","TEXTPATH"],MASK_REMOVE_TAGS:["TEXT","TSPAN","TEXTPATH"],transformMaskChild(t,e){const{MASK_CHILD_ATTRIBUTE_BLACKLIST:n,MASK_REPLACE_TAGS:r,MASK_REMOVE_TAGS:i}=this,s=e.tagName();if(!N.isSVGGraphicsElement(e)||i.includes(s))return e.remove(),!1;if(r.includes(s)){const o=t.vel.findOne(`#${e.id}`);if(o){const{node:l}=o;let a=t.getNodeBoundingRect(l);t.model.isElement()&&(a=N.transformRect(a,t.getNodeMatrix(l)));const c=N("rect",a.toJSON()),{x:u,y:h}=a.center(),{angle:g,cx:d=u,cy:v=h}=o.rotate();g&&c.rotate(g,d,v),e.parent().append(c)}return e.remove(),!1}return n.forEach(o=>{o==="fill"&&e.attr("fill")==="none"||e.removeAttr(o)}),!0},transformMaskRoot(t,e){const{MASK_ROOT_ATTRIBUTE_BLACKLIST:n}=this;n.forEach(r=>{e.removeAttr(r)})},getMaskShape(t,e){const{options:n,MASK_REPLACE_TAGS:r}=this,{deep:i}=n,s=e.tagName();let o;if(s==="G"){if(!i)return null;o=e.clone(),ew(o,l=>this.transformMaskChild(t,l))}else{if(r.includes(s))return null;o=e.clone()}return this.transformMaskRoot(t,o),o},getMaskId(){return`highlight-mask-${this.cid}`},getMask(t,e){const{VISIBLE:n,INVISIBLE:r,options:i}=this,{padding:s,attrs:o}=i,l=parseFloat(N("g").attr(o).attr("stroke-width")),a=e.attr("fill")!=="none";let c=parseFloat(e.attr("stroke-width"));isNaN(c)&&(c=1);const u=c+s*2,h=u+l*2;let g=this.getMaskShape(t,e);if(!g){const d=t.getNodeBoundingRect(e.node);d.inflate(d.width?0:.5,d.height?0:.5),g=N("rect",d.toJSON())}return g.attr(o),N("mask",{id:this.getMaskId()}).append([g.clone().attr({fill:a?n:"none",stroke:n,"stroke-width":h}),g.clone().attr({fill:a?r:"none",stroke:r,"stroke-width":u})])},removeMask(t){const e=t.svg.getElementById(this.getMaskId());e&&t.defs.removeChild(e)},addMask(t,e){t.defs.appendChild(e.node)},highlight(t,e){const{options:n,vel:r}=this,{padding:i,attrs:s,maskClip:o=gh,layer:l}=n,a="stroke"in s?s.stroke:"#000000";!l&&e===t.el&&r.remove();const c=t.getNodeBoundingRect(e).inflate(i+o),u=this.getNodeMatrix(t,e),h=this.getMask(t,N(e));this.addMask(t.paper,h),r.attr(c.toJSON()),r.attr({transform:N.matrixToTransformString(u),mask:`url(#${h.id})`,fill:a})},unhighlight(t){this.removeMask(t.paper)}}),rw=ce.extend({UPDATABLE:!1,MOUNTABLE:!1,highlight:function(t,e){const{alphaValue:n=.3}=this.options;e.style.opacity=n},unhighlight:function(t,e){e.style.opacity=""}}),ph=me("highlighted"),iw=ce.extend({UPDATABLE:!1,MOUNTABLE:!1,options:{className:ph},highlight:function(t,e){N(e).addClass(this.options.className)},unhighlight:function(t,e){N(e).removeClass(this.options.className)}},{className:ph}),Vo={ROW:"row",COLUMN:"column"},sw=ce.extend({tagName:"g",MOUNTABLE:!0,UPDATE_ATTRIBUTES:function(){return[this.options.attribute]},_prevItems:null,highlight(t,e){const n=t.model,{attribute:r,size:i=20,gap:s=5,direction:o=Vo.ROW}=this.options;if(!r)throw new Error("List: attribute is required");const l=typeof i=="number"?{width:i,height:i}:i,a=o===Vo.ROW,c=a?l.width:l.height;let u=n.get(r);Array.isArray(u)||(u=[]);const h=this._prevItems||[],g=u.map((x,A)=>Re(h[A],u[A]));if(h.length!==u.length||g.some(x=>!x)){const x=this.vel.children(),A=u.map((T,f)=>{const p=f in x?x[f].node:null;if(g[f])return p;const m=this.createListItem(T,l,p);if(!m)return null;if(!(m instanceof SVGElement))throw new Error("List: item must be an SVGElement");m.dataset.index=f,m.dataset.attribute=r;const w=f*(c+s);return m.setAttribute("transform",a?`translate(${w}, 0)`:`translate(0, ${w})`),m});this.vel.empty().append(A),this._prevItems=u}const d=u.length,v=d===0?0:d*c+(d-1)*s,y=a?{width:v,height:l.height}:{width:l.width,height:v};this.position(n,y)},position(t,e){const{vel:n,options:r}=this,{margin:i=5,position:s="top-left"}=r,{width:o,height:l}=t.size(),{left:a,right:c,top:u,bottom:h}=Te(i),g=new U(a,u,o-(a+c),l-(u+h));let{x:d,y:v}=Co(g,s);switch(s){case Rt.CENTER:case Rt.TOP:case Rt.BOTTOM:{d-=e.width/2;break}case Rt.RIGHT:case Rt.BOTTOM_RIGHT:case Rt.TOP_RIGHT:{d-=e.width;break}}switch(s){case Rt.CENTER:case Rt.RIGHT:case Rt.LEFT:{v-=e.height/2;break}case Rt.BOTTOM:case Rt.BOTTOM_RIGHT:case Rt.BOTTOM_LEFT:{v-=e.height;break}}n.attr("transform",`translate(${d}, ${v})`)}},{Directions:Vo,Positions:Rt});var vh={__proto__:null,addClass:iw,list:sw,mask:nw,opacity:rw,stroke:tw};function Vi(t,e,n){if(It(n)){const{x:i,y:s}=n;if(isFinite(s)){const o=new W(e,t),{start:l,end:a}=o.parallel(s);e=l,t=a}n=i}if(!isFinite(n))return t;var r=t.distance(e);return n===0&&r>0?t:t.move(e,-Math.min(n,r-1))}function Do(t){var e=t.getAttribute("stroke-width");return e===null?0:parseFloat(e)||0}function ow(t,e,n=0){let r,i,s,o;const{start:l,end:a}=t;switch(e){case"left":r="x",i=a,s=l,o=-1;break;case"right":r="x",i=l,s=a,o=1;break;case"top":r="y",i=a,s=l,o=-1;break;case"bottom":r="y",i=l,s=a,o=1;break;default:return}l[r]<a[r]?i[r]=s[r]:s[r]=i[r],isFinite(n)&&(i[r]+=o*n,s[r]+=o*n)}function aw(t,e,n,r){let{offset:i,alignOffset:s,align:o}=r;return o&&ow(t,o,s),Vi(t.end,t.start,i)}function mh(t,e,n,r){const i=r.useModelGeometry?yh(e,n,!0):e.getNodeBBox(n);r.stroke&&i.inflate(Do(n)/2);const s=t.intersect(i),o=s?t.start.chooseClosest(s):t.end;return Vi(o,t.start,r.offset)}function lw(t,e,n,r){const i=e.model.angle();if(i===0)return mh(t,e,n,r);const s=r.useModelGeometry?yh(e,n,!1):e.getNodeUnrotatedBBox(n);r.stroke&&s.inflate(Do(n)/2);const o=s.center(),l=t.clone().rotate(o,i),a=l.setLength(1e6).intersect(s),c=a?l.start.chooseClosest(a).rotate(o,-i):t.end;return Vi(c,t.start,r.offset)}function yh(t,e,n){const r=t.model,i=t.findAttribute("port",e);return r.hasPort(i)?r.getPortBBox(i,{rotate:n}):r.getBBox({rotate:n})}function cw(t){if(!t)return null;var e=t;do{var n=e.tagName;if(typeof n!="string")return null;if(n=n.toUpperCase(),n==="G")e=e.firstElementChild;else if(n==="TITLE")e=e.nextElementSibling;else break}while(e);return e}var Fo="segmentSubdivisons",Bo="shapeBBox";function uw(t,e,n,r){var i,s,o=r.selector,l=t.end;if(typeof o=="string"?i=e.findNode(o):o===!1?i=n:Array.isArray(o)?i=Ze(n,o):i=cw(n),!N.isSVGGraphicsElement(i)){if(i===n||!N.isSVGGraphicsElement(n))return l;i=n}var a=e.getNodeShape(i),c=e.getNodeMatrix(i),u=e.getRootTranslateMatrix(),h=e.getRootRotateMatrix(),g=u.multiply(h).multiply(c),d=g.inverse(),v=N.transformLine(t,d),y=v.start.clone(),x=e.getNodeData(i);if(r.insideout===!1){x[Bo]||(x[Bo]=a.bbox());var A=x[Bo];if(A.containsPoint(y))return l}var T;if(a instanceof Z){var f=r.precision||2;x[Fo]||(x[Fo]=a.getSegmentSubdivisions({precision:f})),T={precision:f,segmentSubdivisions:x[Fo]}}r.extrapolate===!0&&v.setLength(1e6),s=v.intersect(a,T),s?N.isArray(s)&&(s=y.chooseClosest(s)):r.sticky===!0&&(a instanceof U?s=a.pointNearestToPoint(y):a instanceof jt?s=a.intersectionWithLineFromCenterToPoint(y):s=a.closestPoint(y,T));var p=s?N.transformPoint(s,g):l,m=r.offset||0;return r.stroke&&(m+=Do(i)/2),Vi(p,t.start,m)}var wh={__proto__:null,anchor:aw,bbox:mh,boundary:uw,rectangle:lw};function bh(t,e){if(e===0)return"0%";const n=1e3;return`${Math.round(t/e*100*n)/n}%`}function xh(t){return function(e,n,r,i){var s=n.isNodeConnection(r)?fw:hw;return s(t,e,n,r,i)}}function hw(t,e,n,r,i){var s=n.model.angle(),o=n.getNodeUnrotatedBBox(r),l=n.model.getCenter();i.rotate(l,s);var a=i.x-o.x,c=i.y-o.y;return t&&(a=bh(a,o.width),c=bh(c,o.height)),e.anchor={name:"topLeft",args:{dx:a,dy:c,rotate:!0}},e}function fw(t,e,n,r,i){var s=n.getConnection();if(!s)return e;var o=s.closestPointLength(i);if(t){var l=s.length();e.anchor={name:"connectionRatio",args:{ratio:o/l}}}else e.anchor={name:"connectionLength",args:{length:o}};return e}const dw=vu,gw=xh(!1),Ah=xh(!0);var pw={__proto__:null,pinAbsolute:gw,pinRelative:Ah,useDefaults:dw};const vw=function(t,e,n){return t},mw=function(t,e,n){var r=e.side||"bottom",i=Te(e.padding||40),s=n.sourceBBox,o=n.targetBBox,l=s.center(),a=o.center(),c,u,h;switch(r){case"bottom":h=1,c="y",u="height";break;case"top":h=-1,c="y",u="height";break;case"left":h=-1,c="x",u="width";break;case"right":h=1,c="x",u="width";break;default:throw new Error("Router: invalid side")}return l[c]+=h*(s[u]/2+i[r]),a[c]+=h*(o[u]/2+i[r]),h*(l[c]-a[c])>0?a[c]=l[c]:l[c]=a[c],[l].concat(t,a)};var yw={N:"S",S:"N",E:"W",W:"E"},ww={N:-Math.PI/2*3,S:-Math.PI/2,E:0,W:Math.PI};function Di(t,e,n){var r=new S(t.x,e.y);return n.containsPoint(r)&&(r=new S(e.x,t.y)),r}function Go(t,e){return t[e==="W"||e==="E"?"width":"height"]}function Qt(t,e){return t.x===e.x?t.y>e.y?"N":"S":t.y===e.y?t.x>e.x?"W":"E":null}function Fi(t){return new U(t.x,t.y,0,0)}function Bi(t){var e=Te(t.padding||t.elementPadding||20);return{x:-e.left,y:-e.top,width:e.left+e.right,height:e.top+e.bottom}}function Ph(t,e){return t.sourceBBox.clone().moveAndExpand(Bi(e))}function Th(t,e){return t.targetBBox.clone().moveAndExpand(Bi(e))}function bw(t,e){if(t.sourceAnchor)return t.sourceAnchor;var n=Ph(t,e);return n.center()}function xw(t,e){if(t.targetAnchor)return t.targetAnchor;var n=Th(t,e);return n.center()}function Sh(t,e,n){var r=new S(t.x,e.y),i=new S(e.x,t.y),s=Qt(t,r),o=Qt(t,i),l=yw[n],a=s===n||s!==l&&(o===l||o!==n)?r:i;return{points:[a],direction:Qt(a,e)}}function Gi(t,e,n){var r=Di(t,e,n);return{points:[r],direction:Qt(r,e)}}function Aw(t,e,n,r){var i={},s=[new S(t.x,e.y),new S(e.x,t.y)],o=s.filter(function(h){return!n.containsPoint(h)}),l=o.filter(function(h){return Qt(h,t)!==r}),a;if(l.length>0)a=l.filter(function(h){return Qt(t,h)===r}).pop(),a=a||l[0],i.points=[a],i.direction=Qt(a,e);else{a=Vc(s,o)[0];var c=new S(e).move(a,-Go(n,r)/2),u=Di(c,t,n);i.points=[u,c],i.direction=Qt(c,e)}return i}function Pw(t,e,n,r){var i=Gi(e,t,r),s=i.points[0];if(n.containsPoint(s)){i=Gi(t,e,n);var o=i.points[0];if(r.containsPoint(o)){var l=new S(t).move(o,-Go(n,Qt(t,o))/2),a=new S(e).move(s,-Go(r,Qt(e,s))/2),c=new W(l,a).midpoint(),u=Gi(t,c,n),h=Sh(c,e,u.direction);i.points=[u.points[0],h.points[0]],i.direction=h.direction}}return i}function zo(t,e,n,r,i){var s={},o=n.union(r).inflate(1),l=o.center().distance(e)>o.center().distance(t),a=l?e:t,c=l?t:e,u,h,g;return i?(u=S.fromPolar(o.width+o.height,ww[i],a),u=o.pointNearestToPoint(u).move(u,-1)):u=o.pointNearestToPoint(a).move(a,1),h=Di(u,c,o),u.round().equals(h.round())?(h=S.fromPolar(o.width+o.height,ee(u.theta(a))+Math.PI/2,c),h=o.pointNearestToPoint(h).move(c,1).round(),g=Di(u,h,o),s.points=l?[h,g,u]:[u,g,h]):s.points=l?[h,u]:[u,h],s.direction=Qt(l?u:h,e),s}function Uo(t,e,n){var r=Ph(n,e),i=Th(n,e),s=bw(n,e),o=xw(n,e);r=r.union(Fi(s)),i=i.union(Fi(o)),t=xt(t).map(S),t.unshift(s),t.push(o);for(var l,a=[],c=0,u=t.length-1;c<u;c++){var h=null,g=t[c],d=t[c+1],v=!!Qt(g,d);if(c===0)c+1===u?r.intersect(i.clone().inflate(1))?h=zo(g,d,r,i):v||(h=Pw(g,d,r,i)):r.containsPoint(d)?h=zo(g,d,r,Fi(d).moveAndExpand(Bi(e))):v||(h=Gi(g,d,r));else if(c+1===u){var y=v&&Qt(d,g)===l;i.containsPoint(g)||y?h=zo(g,d,Fi(g).moveAndExpand(Bi(e)),i,l):v||(h=Aw(g,d,i,l))}else v||(h=Sh(g,d,l));h?(Array.prototype.push.apply(a,h.points),l=h.direction):l=Qt(g,d),c+1<u&&a.push(d)}return a}var Eh={step:10,maximumLoops:2e3,precision:1,maxAllowedDirectionChange:90,perpendicular:!0,excludeEnds:[],excludeTypes:[],startDirections:["top","right","bottom","left"],endDirections:["top","right","bottom","left"],directionMap:{top:{x:0,y:-1},right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0}},cost:function(){return this.step},directions:function(){var t=this.step,e=this.cost();return[{offsetX:t,offsetY:0,cost:e},{offsetX:-t,offsetY:0,cost:e},{offsetX:0,offsetY:t,cost:e},{offsetX:0,offsetY:-t,cost:e}]},penalties:function(){return{0:0,45:this.step/2,90:this.step/2}},paddingBox:function(){var t=this.step;return{x:-t,y:-t,width:2*t,height:2*t}},isPointObstacle:null,fallbackRouter:function(t,e,n){if(!bt(Uo))throw new Error("Manhattan requires the orthogonal router as default fallback.");return Uo(t,j({},Eh,e),n)},fallbackRoute:function(t,e,n){return null},draggingRoute:null};function $o(t){this.map={},this.options=t,this.mapGridSize=100}$o.prototype.build=function(t,e){var n=this.options,r=xt(n.excludeEnds).reduce(function(a,c){var u=e.get(c);if(u){var h=t.getCell(u.id);h&&a.push(h)}return a},[]),i=[],s=t.getCell(e.get("source").id);s&&(i=bi(i,s.getAncestors().map(function(a){return a.id})));var o=t.getCell(e.get("target").id);o&&(i=bi(i,o.getAncestors().map(function(a){return a.id})));var l=this.mapGridSize;return t.getElements().reduce(function(a,c){var u=xt(n.excludeTypes).includes(c.get("type")),h=r.find(function(p){return p.id===c.id}),g=i.includes(c.id),d=u||h||g;if(!d)for(var v=c.getBBox().moveAndExpand(n.paddingBox),y=v.origin().snapToGrid(l),x=v.corner().snapToGrid(l),A=y.x;A<=x.x;A+=l)for(var T=y.y;T<=x.y;T+=l){var f=A+"@"+T;a[f]=a[f]||[],a[f].push(v)}return a},this.map),this},$o.prototype.isPointAccessible=function(t){var e=t.clone().snapToGrid(this.mapGridSize).toString();return xt(this.map[e]).every(function(n){return!n.containsPoint(t)})};function Tn(){this.items=[],this.hash={},this.values={},this.OPEN=1,this.CLOSE=2}Tn.prototype.add=function(t,e){this.hash[t]?this.items.splice(this.items.indexOf(t),1):this.hash[t]=this.OPEN,this.values[t]=e;var n=ro(this.items,t,(function(r){return this.values[r]}).bind(this));this.items.splice(n,0,t)},Tn.prototype.remove=function(t){this.hash[t]=this.CLOSE},Tn.prototype.isOpen=function(t){return this.hash[t]===this.OPEN},Tn.prototype.isClose=function(t){return this.hash[t]===this.CLOSE},Tn.prototype.isEmpty=function(){return this.items.length===0},Tn.prototype.pop=function(){var t=this.items.shift();return this.remove(t),t};function Ch(t,e){return e&&e.paddingBox?t.sourceBBox.clone().moveAndExpand(e.paddingBox):t.sourceBBox.clone()}function Lh(t,e){return e&&e.paddingBox?t.targetBBox.clone().moveAndExpand(e.paddingBox):t.targetBBox.clone()}function _h(t,e){if(t.sourceAnchor)return t.sourceAnchor;var n=Ch(t,e);return n.center()}function Tw(t,e){if(t.targetAnchor)return t.targetAnchor;var n=Lh(t,e);return n.center()}function Ho(t,e,n,r,i){var s=360/n,o=t.theta(Sw(t,e,r,i)),l=de(o+s/2);return s*Math.floor(l/s)}function Sw(t,e,n,r){var i=r.step,s=e.x-t.x,o=e.y-t.y,l=s/n.x,a=o/n.y,c=l*i,u=a*i;return new S(t.x+c,t.y+u)}function Mh(t,e){var n=Math.abs(t-e);return n>180?360-n:n}function Ew(t,e,n){var r=n.step;xt(n.directions).forEach(function(i){i.gridOffsetX=i.offsetX/r*e.x,i.gridOffsetY=i.offsetY/r*e.y})}function Cw(t,e,n){return{source:e.clone(),x:Oh(n.x-e.x,t),y:Oh(n.y-e.y,t)}}function Oh(t,e){if(!t)return e;var n=Math.abs(t),r=Math.round(n/e);if(!r)return n;var i=r*e,s=n-i,o=s/r;return e+o}function Lw(t,e){var n=e.source,r=hn(t.x-n.x,e.x)+n.x,i=hn(t.y-n.y,e.y)+n.y;return new S(r,i)}function Er(t,e){return t.round(e)}function zi(t,e,n){return Er(Lw(t.clone(),e),n)}function Cr(t){return t.clone().toString()}function qo(t){return new S(t.x===0?0:Math.abs(t.x)/t.x,t.y===0?0:Math.abs(t.y)/t.y)}function _w(t,e,n,r,i,s,o){for(var l=[],a=qo(i.difference(n)),c=Cr(n),u=t[c],h;u;){h=e[c];var g=qo(h.difference(u));g.equals(a)||(l.unshift(h),a=g),c=Cr(u),u=t[c]}var d=e[c],v=qo(d.difference(r));return v.equals(a)||l.unshift(d),l}function Nh(t,e){for(var n=1/0,r=0,i=e.length;r<i;r++){var s=t.manhattanDistance(e[r]);s<n&&(n=s)}return n}function kh(t,e,n,r,i){var s=i.precision,o=i.directionMap,l=t.difference(e.center()),a=gt(o)?Object.keys(o):[],c=xt(n),u=a.reduce(function(h,g){if(c.includes(g)){for(var d=o[g],v=new S(t.x+d.x*(Math.abs(l.x)+e.width),t.y+d.y*(Math.abs(l.y)+e.height)),y=new W(t,v),x=y.intersect(e)||[],A=x.length,T,f=null,p=0;p<A;p++){var m=x[p],w=t.squaredDistance(m);(T===void 0||w>T)&&(T=w,f=m)}if(f){var b=zi(f,r,s);e.containsPoint(b)&&(b=zi(b.offset(d.x*r.x,d.y*r.y),r,s)),h.push(b)}}return h},[]);return e.containsPoint(t)||u.push(zi(t,r,s)),u}function Mw(t,e,n,r){var i=r.precision,s,o;t instanceof U?s=Er(_h(this,r).clone(),i):s=Er(t.clone(),i),e instanceof U?o=Er(Tw(this,r).clone(),i):o=Er(e.clone(),i);var l=Cw(r.step,s,o),a,c,u,h;if(t instanceof U?(a=s,u=kh(a,t,r.startDirections,l,r)):(a=s,u=[a]),e instanceof U?(c=o,h=kh(o,e,r.endDirections,l,r)):(c=o,h=[c]),u=u.filter(dt=>!n(dt)),h=h.filter(dt=>!n(dt)),u.length>0&&h.length>0){for(var g=new Tn,d={},v={},y={},x=0,A=u.length;x<A;x++){var T=u[x],f=Cr(T);g.add(f,Nh(T,h)),d[f]=T,y[f]=0}var p=r.previousDirectionAngle,m=p===void 0,w,b,P=r.directions;Ew(P,l,r);for(var E=P.length,C=xt(h).reduce(function(dt,J){var Y=Cr(J);return dt.push(Y),dt},[]),k=r.maximumLoops;!g.isEmpty()&&k>0;){var I=g.pop(),D=d[I],H=v[I],X=y[I],L=H===void 0,_=D.equals(a),M;L?m?_?M=null:M=Ho(a,D,E,l,r):M=p:M=Ho(H,D,E,l,r);var O=u.length===h.length;if(O){for(var K=0;K<u.length;K++)if(!u[K].equals(h[K])){O=!1;break}}var et=L&&O;if(!et&&C.indexOf(I)>=0)return r.previousDirectionAngle=M,_w(v,d,D,a,c);for(x=0;x<E;x++){w=P[x];var Q=w.angle;if(b=Mh(M,Q),!(!(m&&_)&&b>r.maxAllowedDirectionChange)){var tt=zi(D.clone().offset(w.gridOffsetX,w.gridOffsetY),l,i),st=Cr(tt);if(!(g.isClose(st)||n(tt))){if(C.indexOf(st)>=0){var ht=tt.equals(c);if(!ht){var Tt=Ho(tt,c,E,l,r),at=Mh(Q,Tt);if(at>r.maxAllowedDirectionChange)continue}}var rt=w.cost,ot=_?0:r.penalties[b],it=X+rt+ot;(!g.isOpen(st)||it<y[st])&&(d[st]=tt,v[st]=D,y[st]=it,g.add(st,it+Nh(tt,h)))}}}k--}}return r.fallbackRoute.call(this,a,c,r)}function Ow(t){if(t.directions=Ct(t,"directions"),t.penalties=Ct(t,"penalties"),t.paddingBox=Ct(t,"paddingBox"),t.padding=Ct(t,"padding"),t.padding){var e=Te(t.padding);t.paddingBox={x:-e.left,y:-e.top,width:e.left+e.right,height:e.top+e.bottom}}xt(t.directions).forEach(function(n){var r=new S(0,0),i=new S(n.offsetX,n.offsetY);n.angle=de(r.theta(i))})}function Nw(t,e,n){Ow(e),n.options.perpendicular=!!e.perpendicular;var r=Ch(n,e),i=Lh(n,e),s=_h(n,e);let o;if(typeof e.isPointObstacle=="function")o=e.isPointObstacle;else{const f=new $o(e);f.build(n.paper.model,n.model),o=p=>!f.isPointAccessible(p)}for(var l=xt(t).map(S),a=[],c=s,u,h,g=0,d=l.length;g<=d;g++){var v=null;if(h=u||r,u=l[g],!u){u=i;var y=!n.model.get("source").id||!n.model.get("target").id;if(y&&bt(e.draggingRoute)){var x=h===r?s:h,A=u.origin();v=e.draggingRoute.call(n,x,A,e)}}if(v=v||Mw.call(n,h,u,o,e),v===null)return e.fallbackRouter(t,e,n);var T=v[0];T&&T.equals(c)&&v.shift(),c=v[v.length-1]||c,Array.prototype.push.apply(a,v)}return a}const Wo=function(t,e,n){return Nw(t,j({},Eh,e),n)};var kw={maxAllowedDirectionChange:45,diagonalCost:function(){var t=this.step;return Math.ceil(Math.sqrt(t*t<<1))},directions:function(){var t=this.step,e=this.cost(),n=this.diagonalCost();return[{offsetX:t,offsetY:0,cost:e},{offsetX:t,offsetY:t,cost:n},{offsetX:0,offsetY:t,cost:e},{offsetX:-t,offsetY:t,cost:n},{offsetX:-t,offsetY:0,cost:e},{offsetX:-t,offsetY:-t,cost:n},{offsetX:0,offsetY:-t,cost:e},{offsetX:t,offsetY:-t,cost:n}]},fallbackRoute:function(t,e,n){var r=t.theta(e),i=[],s={x:e.x,y:t.y},o={x:t.x,y:e.y};if(r%180>90){var l=s;s=o,o=l}var a=r%90<45?s:o,c=new W(t,a),u=90*Math.ceil(r/90),h=S.fromPolar(c.squaredLength(),ee(u+135),a),g=new W(e,h),d=c.intersection(g),v=d||e,y=d?v:t,x=360/n.directions.length,A=y.theta(e),T=de(A+x/2),f=x*Math.floor(T/x);return n.previousDirectionAngle=f,v&&i.push(v.round()),i.push(e),i}};const Iw=function(t,e,n){if(!bt(Wo))throw new Error("Metro requires the manhattan router.");return Wo(t,j({},kw,e),n)},R={AUTO:"auto",LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom",ANCHOR_SIDE:"anchor-side",MAGNET_SIDE:"magnet-side"},Ih=[R.LEFT,R.RIGHT,R.TOP,R.BOTTOM],Fe={[R.LEFT]:R.RIGHT,[R.RIGHT]:R.LEFT,[R.TOP]:R.BOTTOM,[R.BOTTOM]:R.TOP},Rw=[R.TOP,R.BOTTOM],rn={0:R.RIGHT,180:R.LEFT,270:R.TOP,90:R.BOTTOM};function Ne(t){return t.angle()}function Hn(t){return new Lt(t).simplify({threshold:1}).points}function Lr(t,e){const{point:n,x0:r,y0:i,view:s,bbox:o,direction:l}=t,{point:a,x0:c,y0:u,view:h,bbox:g,direction:d}=e;let v;if(s)s.model.isLink()?v=Rh(a,n,s):l===R.ANCHOR_SIDE?v=o.sideNearestToPoint(n):l===R.MAGNET_SIDE?v=s.model.getBBox().sideNearestToPoint(n):v=l;else{const x=new U(r,i,0,0);v=Ih.includes(l)?l:x.sideNearestToPoint(a)}let y;if(h)h.model.isLink()?y=Rh(n,a,h):d===R.ANCHOR_SIDE?y=g.sideNearestToPoint(a):d===R.MAGNET_SIDE?y=h.model.getBBox().sideNearestToPoint(a):y=d;else{const x=new U(c,u,0,0);y=Ih.includes(d)?d:x.sideNearestToPoint(n)}return[v,y]}function Vw(t,e,n){const{x0:r,y0:i,width:s,height:o,point:l,margin:a}=t,c=r+s,u=i+o,h=r-a,g=c+a,d=i-a,{x:v}=l,{x0:y,y0:x}=e;return y===v&&x<i?R.BOTTOM:y<v&&x<d?n.point.x===v?R.BOTTOM:R.RIGHT:y>v&&x<d?n.point.x===v?R.BOTTOM:R.LEFT:y<h&&x>d||y>g&&x>d?R.TOP:y>=h&&y<=v&&x>u||y<=g&&y>=v&&x>u?n.point.x<y?R.RIGHT:R.LEFT:R.BOTTOM}function Dw(t,e,n){const{x0:r,y0:i,width:s,height:o,point:l,margin:a}=t,c=r+s,u=i+o,h=r-a,g=c+a,d=u+a,{x:v}=l,{x0:y,y0:x}=e;return y===v&&x>u?R.TOP:y<v&&x>d?n.point.x===v?R.TOP:R.RIGHT:y>v&&x>d?n.point.x===v?R.TOP:R.LEFT:y<h&&x<d||y>g&&x<d?R.BOTTOM:y>=h&&y<=v&&x<i||y<=g&&y>=v&&x<i?n.point.x<y?R.RIGHT:R.LEFT:R.TOP}function Fw(t,e,n){const{y0:r,x0:i,width:s,height:o,point:l,margin:a}=t,c=i+s,u=r+o,h=i-a,g=r-a,d=u+a,{x:v,y}=l,{x0:x,y0:A}=e;return x<v&&A===y?R.RIGHT:x<=h&&A<y?R.BOTTOM:x<=h&&A>y?R.TOP:x>=h&&A<g||x>=h&&A>d?R.LEFT:x>c&&A>=g&&A<=y||x>c&&A<=d&&A>=y?n.point.y<A?R.BOTTOM:R.TOP:R.RIGHT}function Bw(t,e,n){const{y0:r,x0:i,width:s,height:o,point:l,margin:a}=t,c=i+s,u=r+o,h=c+a,g=r-a,d=u+a,{x:v,y}=l,{x0:x,y0:A}=e;return x>v&&A===y?R.LEFT:x>=h&&A<y?R.BOTTOM:x>=h&&A>y?R.TOP:x<=h&&A<g||x<=h&&A>d?R.RIGHT:x<i&&A>=g&&A<=y||x<i&&A<=d&&A>=y?n.point.y<A?R.BOTTOM:R.TOP:R.LEFT}function Gw(t,e,n){const[r]=Lr(t,e);switch(r){case R.TOP:return Vw(t,e,n);case R.RIGHT:return Bw(t,e,n);case R.BOTTOM:return Dw(t,e,n);case R.LEFT:return Fw(t,e,n)}}function Rh(t,e,n){const r=n.getTangentAtLength(n.getClosestPointLength(e)),i=Math.round(Ne(r)/90)*90;if(i%180===0&&t.y===e.y)return t.x<e.x?R.LEFT:R.RIGHT;if(t.x===e.x)return t.y<e.y?R.TOP:R.BOTTOM;switch(i){case 0:case 180:case 360:return t.y<e.y?R.TOP:R.BOTTOM;case 90:case 270:return t.x<e.x?R.LEFT:R.RIGHT}}function Vh(t,e,n,r,i,s,o){r===R.AUTO&&(r=i?R.MAGNET_SIDE:R.ANCHOR_SIDE);const l=t&&t.model.isElement(),{x:a,y:c,width:u=0,height:h=0}=l?U.fromRectUnion(n,t.model.getBBox()):s;return{point:e,x0:a,y0:c,view:t,bbox:n,width:u,height:h,direction:r,margin:l?o:0}}function zw({x:t,y:e}){const n=new S(t,e);return{point:n,x0:n.x,y0:n.y,view:null,bbox:new U(t,e,0,0),width:0,height:0,direction:null,margin:0}}function Ui(t,e,n){const r=e.point.clone(),{x0:i,y0:s,width:o,height:l}=e;switch(t){case"left":r.x=i-n;break;case"right":r.x=i+o+n;break;case"top":r.y=s-n;break;case"bottom":r.y=s+l+n;break}return r}function jo(t,e,{dx:n=0,dy:r=0}){const i={x:t.point.x+n,y:t.point.y+r},s={x:e.point.x+n,y:e.point.y+r};return[t.point,i,s,e.point]}function Dh(t,e,n,r){const i=de(n-90);let s=0,o=0;i===90?o=-r:i===180?s=-r:i===270?o=r:i===0&&(s=r);const l=jo(t,e,{dx:s,dy:o}),a=l[2],c=new W(e.point,a),u=rn[Ne(c)];return{loopRoute:l,continueDirection:u}}function Uw(t,e){const{x0:n,x1:r,outsidePoint:i}=t,{x0:s,x1:o,outsidePoint:l}=e;let a=Math.min(n,s),c=Math.max(r,o);if(t.direction===e.direction){const T=t.y0<e.y0?t:e,f=T===t?e:t,p=t.direction===R.TOP?T:f;a=p.x0,c=p.x1}const{x:u}=i,{x:h}=l,g=Math.abs(u-a),d=Math.abs(h-a),v=g+d,y=Math.abs(u-c),x=Math.abs(h-c),A=y+x;return[v,A]}function $w(t,e){const{y0:n,y1:r,outsidePoint:i}=t,{y0:s,y1:o,outsidePoint:l}=e;let a=Math.min(n,s),c=Math.max(r,o);if(t.direction===e.direction){const T=t.x0<e.x0?t:e,f=T===t?e:t,p=t.direction===R.LEFT?T:f;a=p.y0,c=p.y1}const{y:u}=i,{y:h}=l,g=Math.abs(u-a),d=Math.abs(h-a),v=g+d,y=Math.abs(u-c),x=Math.abs(h-c),A=y+x;return[v,A]}function Fh(t,e,n){switch(e){case R.LEFT:t.inflate(0,n).moveAndExpand({x:-n,width:n});break;case R.RIGHT:t.inflate(0,n).moveAndExpand({width:n});break;case R.TOP:t.inflate(n,0).moveAndExpand({y:-n,height:n});break;case R.BOTTOM:t.inflate(n,0).moveAndExpand({height:n});break}return t}function sn(t,e,n={}){const{point:r,x0:i,y0:s,width:o,height:l,margin:a}=t,{point:c,x0:u,y0:h,width:g,height:d,margin:v}=e,{targetInSourceBBox:y=!1}=n,x=u+g,A=h+d,T=i+o,f=s+l,p=i-a,m=T+a,w=s-a,b=f+a,P=u-v,E=x+v,C=h-v,k=A+v,[I,D]=Lr(t,e),H=Ui(I,{point:r,x0:i,y0:s,width:o,height:l},a),X=Ui(D,{point:c,x0:u,y0:h,width:g,height:d},v),{x:L,y:_}=H,{x:M,y:O}=X,K=(u+x)/2,et=(h+A)/2,Q=(i+T)/2,tt=(s+f)/2,st=(Q<K?T+u:x+i)/2,ht=(tt<et?f+h:A+s)/2,Tt=new U(i,s,o,l),at=new U(u,h,g,d),rt=Tt.clone().inflate(a),ot=at.clone().inflate(v),it=Object.assign({},t,{x1:T,y1:f,outsidePoint:H,direction:I}),dt=Object.assign({},e,{x1:x,y1:A,outsidePoint:X,direction:D}),[J,Y]=Uw(it,dt),[Et,_t]=$w(it,dt);if(I==="left"&&D==="right"){const At=rt.containsPoint(X),$=ot.containsPoint(H);if(At||$){const F=(_+O)/2;return[{x:L,y:_},{x:L,y:F},{x:M,y:F},{x:M,y:O}]}if(p<M){let F=ht,lt=L,Ot=M;const ut=Et<_t;return(F>=w&&F<=b||F>=C&&F<=k)&&(b>=C&&ut?F=Math.min(C,w):w<=k&&!ut&&(F=Math.max(k,b)),lt=Math.min(L,P),Ot=Math.max(M,m),ut&&_<h||!ut&&_>A?lt=L:(ut&&O<s||!ut&&O>f)&&(Ot=M)),[{x:lt,y:_},{x:lt,y:F},{x:Ot,y:F},{x:Ot,y:O}]}const B=(L+M)/2;return[{x:B,y:_},{x:B,y:O}]}else if(I==="right"&&D==="left"){const At=rt.containsPoint(X),$=ot.containsPoint(H);if(At||$){const F=(_+O)/2;return[{x:L,y:_},{x:L,y:F},{x:M,y:F},{x:M,y:O}]}if(m>M){let F=ht,lt=L,Ot=M;const ut=Et<_t;return(F>=w&&F<=b||F>=C&&F<=k)&&(b>=C&&ut?F=Math.min(C,w):w<=k&&!ut&&(F=Math.max(k,b)),lt=Math.max(L,E),Ot=Math.min(M,p),ut&&_<h||!ut&&_>A?lt=L:(ut&&O<s||!ut&&O>f)&&(Ot=M)),[{x:lt,y:_},{x:lt,y:F},{x:Ot,y:F},{x:Ot,y:O}]}const B=(L+M)/2;return[{x:B,y:_},{x:B,y:O}]}else if(I==="top"&&D==="bottom"){const At=rt.containsPoint(X),$=ot.containsPoint(H);if(At||$){const F=(L+M)/2;return[{x:L,y:_},{x:F,y:_},{x:F,y:O},{x:M,y:O}]}if(w<O){let F=st,lt=_,Ot=O;const ut=J<Y;return(F>=p&&F<=m||F>=P&&F<=E)&&(m>=P&&ut?F=Math.min(P,p):p<=E&&!ut&&(F=Math.max(E,m)),lt=Math.min(_,C),Ot=Math.max(O,b),ut&&L<u||!ut&&L>x?lt=_:(ut&&M<i||!ut&&M>T)&&(Ot=O)),[{x:L,y:lt},{x:F,y:lt},{x:F,y:Ot},{x:M,y:Ot}]}const B=(_+O)/2;return[{x:L,y:B},{x:M,y:B}]}else if(I==="bottom"&&D==="top"){const At=rt.containsPoint(X),$=ot.containsPoint(H);if(At||$){const F=(L+M)/2;return[{x:L,y:_},{x:F,y:_},{x:F,y:O},{x:M,y:O}]}if(b>O){let F=st,lt=_,Ot=O;const ut=J<Y;return(F>=p&&F<=m||F>=P&&F<=E)&&(m>=P&&ut?F=Math.min(P,p):p<=E&&!ut&&(F=Math.max(E,m)),lt=Math.max(_,k),Ot=Math.min(O,w),ut&&L<u||!ut&&L>x?lt=_:(ut&&M<i||!ut&&M>T)&&(Ot=O)),[{x:L,y:lt},{x:F,y:lt},{x:F,y:Ot},{x:M,y:Ot}]}const B=(_+O)/2;return[{x:L,y:B},{x:M,y:B}]}else if(I==="top"&&D==="top"){if((y||vn.rectWithRect(rt,at)||_<=h&&(rt.bottomRight().x<=M||rt.bottomLeft().x>=M)||_>=h&&(ot.bottomRight().x<=L||ot.bottomLeft().x>=L))&&L!==M)return[{x:L,y:Math.min(_,O)},{x:M,y:Math.min(_,O)}];let $,B=Math.min((f+h)/2,O),F=Math.min((s+A)/2,_);return O<_?Y>J?$=Math.min(L,P):$=Math.max(L,E):Y>J?$=Math.min(M,p):$=Math.max(M,m),[{x:L,y:F},{x:$,y:F},{x:$,y:B},{x:M,y:B}]}else if(I==="bottom"&&D==="bottom"){if((y||vn.rectWithRect(rt,at)||_>=O&&(rt.topRight().x<=M||rt.topLeft().x>=M)||_<=O&&(ot.topRight().x<=L||ot.topLeft().x>=L))&&L!==M)return[{x:L,y:Math.max(_,O)},{x:M,y:Math.max(_,O)}];let $,B=Math.max((s+A)/2,O),F=Math.max((f+h)/2,_);return O>_?Y>J?$=Math.min(L,P):$=Math.max(L,E):Y>J?$=Math.min(M,p):$=Math.max(M,m),[{x:L,y:F},{x:$,y:F},{x:$,y:B},{x:M,y:B}]}else if(I==="left"&&D==="left"){if((y||vn.rectWithRect(rt,at)||L<=M&&(rt.bottomRight().y<=O||rt.topRight().y>=O)||L>=M&&(ot.bottomRight().y<=_||ot.topRight().y>=_))&&_!==O)return[{x:Math.min(L,M),y:_},{x:Math.min(L,M),y:O}];let $,B=Math.min((T+u)/2,M),F=Math.min((i+x)/2,L);return M>L?Et<=_t?$=Math.min(w,O):$=Math.max(b,O):Et<=_t?$=Math.min(C,_):$=Math.max(k,_),[{x:F,y:_},{x:F,y:$},{x:B,y:$},{x:B,y:O}]}else if(I==="right"&&D==="right"){if((y||vn.rectWithRect(rt,at)||L>=M&&(rt.bottomLeft().y<=O||rt.topLeft().y>=O)||L<=M&&(ot.bottomLeft().y<=_||ot.topLeft().y>=_))&&_!==O)return[{x:Math.max(L,M),y:_},{x:Math.max(L,M),y:O}];let $,B=Math.max((i+x)/2,M),F=Math.max((T+u)/2,L);return M<=L?Et<=_t?$=Math.min(w,O):$=Math.max(b,O):Et<=_t?$=Math.min(C,_):$=Math.max(k,_),[{x:F,y:_},{x:F,y:$},{x:B,y:$},{x:B,y:O}]}else if(I==="top"&&D==="right"){if(rt.containsPoint(c)){if(L<=E){const F=Math.max(L+a,M),lt=Math.min(w,C);return[{x:L,y:lt},{x:F,y:lt},{x:F,y:O}]}const B=(L-a+M)/2;return[{x:L,y:_},{x:B,y:_},{x:B,y:O}]}if(w>O){if(L<M){let B=C;return k<=w&&E>=L&&(B=ht),[{x:L,y:B},{x:M,y:B},{x:M,y:O}]}return[{x:L,y:O}]}const $=Math.max(st,E);if(L>M&&f>=O)return[{x:L,y:_},{x:$,y:_},{x:$,y:O}];if($>p&&_<A){const B=Math.min(w,C),F=Math.max(m,E);return[{x:L,y:B},{x:F,y:B},{x:F,y:O}]}return[{x:L,y:_},{x:$,y:_},{x:$,y:O}]}else if(I==="top"&&D==="left"){if(rt.containsPoint(c)){if(L>=P){const F=Math.min(L-a,M),lt=Math.min(w,C);return[{x:L,y:lt},{x:F,y:lt},{x:F,y:O}]}const B=(L+a+M)/2;return[{x:L,y:_},{x:B,y:_},{x:B,y:O}]}if(w>O){if(L>M){let B=C;return k<=w&&P<=L&&(B=ht),[{x:L,y:B},{x:M,y:B},{x:M,y:O}]}return[{x:L,y:O}]}const $=Math.min(P,st);if(L<M&&f>=O)return[{x:L,y:_},{x:$,y:_},{x:$,y:O}];if($<m&&_<A){const B=Math.min(w,C),F=Math.min(p,P);return[{x:L,y:B},{x:F,y:B},{x:F,y:O}]}return[{x:L,y:_},{x:$,y:_},{x:$,y:O}]}else if(I==="bottom"&&D==="right"){if(rt.containsPoint(c)){if(L<=E){const F=Math.max(L+a,M),lt=Math.max(b,k);return[{x:L,y:lt},{x:F,y:lt},{x:F,y:O}]}const B=(L-a+M)/2;return[{x:L,y:_},{x:B,y:_},{x:B,y:O}]}if(b<O){if(L<M){let B=k;return C>=b&&E>=L&&(B=ht),[{x:L,y:B},{x:M,y:B},{x:M,y:O}]}return[{x:L,y:O}]}const $=Math.max(st,E);if(L>M&&s<=O)return[{x:L,y:_},{x:$,y:_},{x:$,y:O}];if($>p&&_>h){const B=Math.max(b,k),F=Math.max(m,E);return[{x:L,y:B},{x:F,y:B},{x:F,y:O}]}return[{x:L,y:_},{x:$,y:_},{x:$,y:O}]}else if(I==="bottom"&&D==="left"){if(rt.containsPoint(c)){if(L>=P){const F=Math.min(L-a,M),lt=Math.max(b,k);return[{x:L,y:lt},{x:F,y:lt},{x:F,y:O}]}const B=(L+a+M)/2;return[{x:L,y:_},{x:B,y:_},{x:B,y:O}]}if(b<O){if(L>M){let B=k;return C>=b&&P<=L&&(B=ht),[{x:L,y:B},{x:M,y:B},{x:M,y:O}]}return[{x:L,y:O}]}const $=Math.min(P,st);if(L<M&&s<=O)return[{x:L,y:_},{x:$,y:_},{x:$,y:O}];if($<m&&_>h){const B=Math.max(b,k),F=Math.min(p,P);return[{x:L,y:B},{x:F,y:B},{x:F,y:O}]}return[{x:L,y:_},{x:$,y:_},{x:$,y:O}]}else if(I==="left"&&D==="bottom"){if(rt.containsPoint(c)){if(_<=k){const F=Math.min(p,P),lt=Math.max(_+a,O);return[{x:F,y:_},{x:F,y:lt},{x:M,y:lt}]}const B=(_-a+O)/2;return[{x:L,y:_},{x:L,y:B},{x:M,y:B}]}if(p>M){if(_<O){let B=P;return E<=p&&k>=_&&(B=st),[{x:B,y:_},{x:B,y:O},{x:M,y:O}]}return[{x:M,y:_}]}const $=Math.max(k,ht);if(_>O&&T>=M)return[{x:L,y:_},{x:L,y:$},{x:M,y:$}];if($>w&&L<x){const B=Math.min(p,P),F=Math.max(b,k);return[{x:B,y:_},{x:B,y:F},{x:M,y:F}]}return[{x:L,y:_},{x:L,y:$},{x:M,y:$}]}else if(I==="left"&&D==="top"){if(rt.containsPoint(c)){if(_>=C){const F=Math.min(_-a,O),lt=Math.min(p,P);return[{x:lt,y:_},{x:lt,y:F},{x:M,y:F}]}const B=(_+a+O)/2;return[{x:L,y:_},{x:L,y:B},{x:M,y:B}]}if(p>M){if(_>O){let B=P;return E<=p&&C<=_&&(B=st),[{x:B,y:_},{x:B,y:O},{x:M,y:O}]}return[{x:M,y:_}]}const $=Math.min(C,ht);if(_<O&&T>=M)return[{x:L,y:_},{x:L,y:$},{x:M,y:$}];if($<b&&L<x){const B=Math.min(p,P),F=Math.min(w,C);return[{x:B,y:_},{x:B,y:F},{x:M,y:F}]}return[{x:L,y:_},{x:L,y:$},{x:M,y:$}]}else if(I==="right"&&D==="top"){if(rt.containsPoint(c)){if(_>=C){const F=Math.max(m,E),lt=Math.min(_-a,O);return[{x:F,y:_},{x:F,y:lt},{x:M,y:lt}]}const B=(_+a+O)/2;return[{x:L,y:_},{x:L,y:B},{x:M,y:B}]}if(m<M){if(_>O){let B=E;return P>=m&&C<=_&&(B=st),[{x:B,y:_},{x:B,y:O},{x:M,y:O}]}return[{x:M,y:_}]}const $=Math.min(C,ht);if(_<O&&i<=M)return[{x:L,y:_},{x:L,y:$},{x:M,y:$}];if($<b&&L>u){const B=Math.max(m,E),F=Math.min(w,C);return[{x:B,y:_},{x:B,y:F},{x:M,y:F}]}return[{x:L,y:_},{x:L,y:$},{x:M,y:$}]}else if(I==="right"&&D==="bottom"){if(rt.containsPoint(c)){if(_<=k){const F=Math.max(m,E),lt=Math.max(_+a,O);return[{x:F,y:_},{x:F,y:lt},{x:M,y:lt}]}const B=(_-a+O)/2;return[{x:L,y:_},{x:L,y:B},{x:M,y:B}]}if(m<M){if(_<O){let B=E;return P>=m&&k>=_&&(B=st),[{x:B,y:_},{x:B,y:O},{x:M,y:O}]}return[{x:M,y:_}]}const $=Math.max(k,ht);if(_>O&&i<=M)return[{x:L,y:_},{x:L,y:$},{x:M,y:$}];if($>w&&L>u){const B=Math.max(m,E),F=Math.max(b,k);return[{x:B,y:_},{x:B,y:F},{x:M,y:F}]}return[{x:L,y:_},{x:L,y:$},{x:M,y:$}]}}function Bh(t,e,n){const r=t===R.LEFT||t===R.RIGHT;let i=0,s=0;switch(de(Math.round(e))){case 0:case 90:i=r?0:n,s=r?n:0;break;case 180:case 270:i=r?0:-n,s=r?-n:0;break}return{dx:i,dy:s}}function Gh(t,e,n){const{sourceDirection:r=R.AUTO,targetDirection:i=R.AUTO}=e,s=e.margin||20,o=e.useVertices||!1,l=!!n.model.source().port,a=Vh(n.sourceView,n.sourceAnchor,n.sourceBBox,r,l,n.sourceAnchor,s),c=!!n.model.target().port,u=Vh(n.targetView,n.targetAnchor,n.targetBBox,i,c,n.targetAnchor,s);let h=[];if(!o||t.length===0)return Hn(sn(a,u));const g=t.map(f=>zw(f)),[d]=g,[v]=Lr(a,d),y=a.view&&a.view.model.isElement(),x=y?Fh(a.view.model.getBBox(),v,s):null,A=y?x.containsPoint(d.point):!1;if(A){const f=Ui(v,a,s),p=f.equals(d.point),m=a.point.x===d.point.x,w=a.point.y===d.point.y,b=m&&(v===R.TOP||v===R.BOTTOM),P=w&&(v===R.LEFT||v===R.RIGHT),E=new W(a.point,f),C=E.containsPoint(d.point),k=A&&(P||b);if(p)h.push(a.point,d.point),d.direction=Fe[v];else if(C||k){const I=Ne(C?E:new W(a.point,d.point)),{dx:D,dy:H}=Bh(v,I,s),X=jo({point:f},d,{dx:D,dy:H}),L=X[2],_=new W(d.point,L),M=rn[Ne(_)];d.direction=M,h.push(...X)}else d.direction=v,d.margin=s,h.push(...sn(a,d,{targetInSourceBBox:!0}),d.point)}else{const f=g[1]||u,p=Gw(a,d,f);d.direction=p,h.push(...sn(a,d),d.point)}for(let f=0;f<g.length-1;f++){const p=g[f],m=g[f+1],w=new W(p.point,m.point),b=Ne(w);if(b%90===0){const C=rn[b],k=Hn([...h,p.point]),I=new W(k[k.length-2],k[k.length-1]),D=rn[Math.round(Ne(I))];if(C!==Fe[D]){h.push(p.point,m.point);const[,H]=Lr(p,m);m.direction=H}else{const{loopRoute:H,continueDirection:X}=Dh(p,m,b,s);m.direction=X,h.push(...H)}continue}const[P,E]=zh(p,m);p.direction=P,m.direction=E,h.push(...sn(p,m),m.point)}const T=g[g.length-1];if(u.view&&u.view.model.isElement()){const[,f]=Lr(T,u),p=Ui(f,u,s),m=Hn([...h,T.point]),w=new W(m[m.length-2],m[m.length-1]),b=Math.round(Ne(w)),P=rn[b],E=p.equals(T.point);if(!E||E&&P===f){T.direction=P;let C=sn(T,u);const[k,I]=Hn([...C,u.point]),D=new W(k,I),H=Math.round(Ne(D)),X=rn[H],L=Fh(u.view.model.getBBox(),f,s),_=T.point.x===u.point.x,M=T.point.y===u.point.y,O=L.containsPoint(T.point),K=_&&(f===R.TOP||f===R.BOTTOM),et=M&&(f===R.LEFT||f===R.RIGHT);if(!E&&O&&(et||K)){const{dx:Q,dy:tt}=Bh(f,b,s);C=jo(T,{point:p},{dx:Q,dy:tt})}else O&&f!==Fe[P]?(T.margin=s,T.direction=f,C=sn(T,u)):X!==P&&P===Fe[X]&&(T.margin=s,C=sn(T,u));h.push(...C)}}else{const f=T,p=u,m=new W(f.point,p.point),w=Ne(m);if(w%90===0){const b=rn[w],P=Hn(h),E=new W(P[P.length-2],f.point),C=rn[Math.round(Ne(E))];if(b!==Fe[C])h.push(f.point);else{const{loopRoute:k}=Dh(f,p,w,s);k.pop(),h.push(...k)}}else{const[b,P]=zh(f,p);f.direction=b,p.direction=P,h.push(...sn(f,p))}}return Hn(h)}function zh(t,e){const n=t.direction,r=Rw.includes(n);let i=t.direction,s=e.direction;if(r){const o=t.point.y>e.point.y,l=e.point.x-t.point.x;n===R.BOTTOM?(i=o?Fe[n]:l>=0?R.RIGHT:R.LEFT,l>0?s=o?R.LEFT:R.TOP:l<0&&(s=o?R.RIGHT:R.TOP)):(i=o?l>=0?R.RIGHT:R.LEFT:Fe[n],l>0?s=o?R.BOTTOM:R.LEFT:l<0&&(s=o?R.BOTTOM:R.RIGHT))}else{const o=t.point.x>e.point.x,l=e.point.y-t.point.y;n===R.RIGHT?(i=o?Fe[n]:l>=0?R.BOTTOM:R.TOP,l>0?s=o?R.TOP:R.LEFT:l<0&&(s=o?R.BOTTOM:R.LEFT)):(i=o?l>=0?R.BOTTOM:R.TOP:Fe[n],l>0?s=o?R.RIGHT:R.TOP:l<0&&(s=o?R.RIGHT:R.BOTTOM))}return[i,s]}Gh.Directions=R;var Uh={__proto__:null,manhattan:Wo,metro:Iw,normal:vw,oneSide:mw,orthogonal:Uo,rightAngle:Gh};function Hw(t,e,n,r){var i="ratio"in r?r.ratio:.5;return t.getPointAtRatio(i)}function qw(t,e,n,r){var i="length"in r?r.length:20;return t.getPointAtLength(i)}function Ww(t,e,n,r){var i=1e6,s=t.getConnection(),o=t.getConnectionSubdivisions(),l=new W(n.clone().offset(0,i),n.clone().offset(0,-i)),a=new W(n.clone().offset(i,0),n.clone().offset(-i,0)),c=l.intersect(s,{segmentSubdivisions:o}),u=a.intersect(s,{segmentSubdivisions:o}),h=[];return c&&Array.prototype.push.apply(h,c),u&&Array.prototype.push.apply(h,u),h.length>0?n.chooseClosest(h):"fallbackAt"in r?$h(t,r.fallbackAt):Hh(t,e,n,r)}function jw(t,e,n,r){var i=t.getClosestPoint(n);return i||new S}function _r(t){return function(e,n,r,i,s,o){if(r instanceof Element){var l=this.paper.findView(r),a;if(l)if(l.isNodeConnection(r)){var c="fixedAt"in i?i.fixedAt:"50%";a=$h(l,c)}else a=l.getNodeBBox(r).center();else a=new S;return t.call(this,e,n,a,i,s,o)}return t.apply(this,arguments)}}function $h(t,e){var n=parseFloat(e);return Ut(e)?t.getPointAtRatio(n/100):t.getPointAtLength(n)}const Yw=_r(Ww),Hh=_r(jw);var qh={__proto__:null,connectionClosest:Hh,connectionLength:qw,connectionPerpendicular:Yw,connectionRatio:Hw,resolveRef:_r};const be={LEFT:"left",RIGHT:"right",TOP:"top",BOTTOM:"bottom"},Mr={PREFER_HORIZONTAL:"prefer-horizontal",PREFER_VERTICAL:"prefer-vertical",HORIZONTAL:"horizontal",VERTICAL:"vertical",AUTO:"auto"};function Yo(t,e,n,r){const i=e.get(n).port;return t.hasPort(i)?t.getPortBBox(i,{rotate:r}):t.getBBox({rotate:r})}function Xw(t,e,n){const{preferenceThreshold:r=0,mode:i}=n,{x:s,y:o}=e,{x:l,y:a,width:c,height:u}=t;switch(i){case Mr.PREFER_VERTICAL:{const{top:h,bottom:g}=Te(r),d=a+u;if(o>a-h&&o<d+g){const v=l+c/2;return s<v?be.LEFT:be.RIGHT}}case Mr.VERTICAL:{const h=a+u/2;return o<h?be.TOP:be.BOTTOM}case Mr.PREFER_HORIZONTAL:{const{left:h,right:g}=Te(r),d=l+c;if(s>l-h&&s<d+g){const v=a+u/2;return o<v?be.TOP:be.BOTTOM}}case Mr.HORIZONTAL:{const h=l+c/2;return s<h?be.LEFT:be.RIGHT}case Mr.AUTO:default:return t.sideNearestToPoint(e)}}function Be(t){return function(e,n,r,i,s,o){const l=!!i.rotate,a=e.model,c=o.model,u=a.angle();let h,g;i.useModelGeometry?(h=Yo(a,c,s,!l),g=h.center()):(g=a.getCenter(),h=l?e.getNodeUnrotatedBBox(n):e.getNodeBBox(n));const d=h[t]();let v=i.dx;if(v){const x=Ut(v);!x&&Se(v)?v=Number(Ee(v,h)):v=parseFloat(v),isFinite(v)&&(x&&(v/=100,v*=h.width),d.x+=v)}let y=i.dy;if(y){const x=Ut(y);!x&&Se(y)?y=Number(Ee(y,h)):y=parseFloat(y),isFinite(y)&&(x&&(y/=100,y*=h.height),d.y+=y)}return l?d.rotate(g,-u):d}}function Kw(t,e,n,r,i,s){const o=t.model,l=o.angle();let a;r.useModelGeometry?a=Yo(o,s.model,i,!0):a=t.getNodeBBox(e);const c=a.center(),u=a.origin(),h=a.corner();let g=r.padding;if(isFinite(g)||(g=0),u.y+g<=n.y&&n.y<=h.y-g){var d=n.y-c.y;c.x+=l===0||l===180?0:d*1/Math.tan(ee(l)),c.y+=d}else if(u.x+g<=n.x&&n.x<=h.x-g){var v=n.x-c.x;c.y+=l===90||l===270?0:v*Math.tan(ee(l)),c.x+=v}return c}function Zw(t,e,n,r,i,s){var o=!!r.rotate,l=t.model.angle(),a=t.model.getCenter(),c;r.useModelGeometry?(c=Yo(t.model,s.model,i,!o),a=c.center()):c=o?t.getNodeUnrotatedBBox(e):t.getNodeBBox(e);var u=r.padding;isFinite(u)&&c.inflate(u),o&&n.rotate(a,l);var h=Xw(c,n,r),g;switch(h){case be.LEFT:g=c.leftMiddle();break;case be.RIGHT:g=c.rightMiddle();break;case be.TOP:g=c.topMiddle();break;case be.BOTTOM:g=c.bottomMiddle();break}return o?g.rotate(a,-l):g}function Jw(t,e,n,r,i){return t.model.getPointFromConnectedLink(this.model,i).offset(r.dx,r.dy)}const Qw=Be("center"),t0=Be("topMiddle"),e0=Be("bottomMiddle"),n0=Be("leftMiddle"),r0=Be("rightMiddle"),i0=Be("origin"),s0=Be("topRight"),o0=Be("bottomLeft"),a0=Be("corner"),l0=_r(Kw),c0=_r(Zw);var Wh={__proto__:null,bottom:e0,bottomLeft:o0,bottomRight:a0,center:Qw,left:n0,midSide:c0,modelCenter:Jw,perpendicular:l0,right:r0,top:t0,topLeft:i0,topRight:s0};class u0 extends Ii{constructor(e){super(e),this.callbackArguments=[];const n=e.graph;if(!n)throw new Error('GraphLayersController: "graph" option is required.');this.graph=n,this.layerCollection=n.layerCollection,this.startListening()}startListening(){this.listenTo(this.layerCollection,"all",this.onLayerCollectionEvent)}onCellChange(e,n){if(!e.hasChanged(Bt.layerAttribute))return;const r=this.graph.getCellLayerId(e);this.layerCollection.moveCellBetweenLayers(e,r,n)}onCellRemove(e,n){if(n.fromLayer||n.replace)return;const r=e.getParentCell();r&&r.unembed(e,n);const i=e.getEmbeddedCells();for(let s=0,o=i.length;s<o;s++){const l=i[s];l&&this.layerCollection.removeCell(l,n)}n.clear||(n.disconnectLinks?this.graph.disconnectLinks(e,n):this.graph.removeLinks(e,n))}onLayerCollectionEvent(e,n){if(n){if(n[ae]){switch(e){case"change":this.onCellChange.call(this,n,arguments[2]);break;case"remove":this.onCellRemove.call(this,n,arguments[3]);break}this.forwardCellEvent.apply(this,arguments);return}if(n[Iu]){this.forwardCellCollectionEvent.apply(this,arguments);return}if(n[So]){this.forwardLayerEvent.apply(this,arguments);return}if(n[Ru]){this.forwardLayerCollectionEvent.apply(this,arguments);return}}}forwardLayerEvent(){this.graph.trigger.apply(this.graph,arguments)}forwardCellEvent(e,n){var r;(e==="remove"||e==="add")&&(r=arguments[3])!==null&&r!==void 0&&r.fromLayer||this.graph.trigger.apply(this.graph,arguments)}forwardCellCollectionEvent(e){e==="sort"&&this.graph.trigger.apply(this.graph,arguments)}forwardLayerCollectionEvent(e){e!=="reset"&&(arguments[0]="layers:"+arguments[0],this.graph.trigger.apply(this.graph,arguments))}}class jh extends Jt{[Iu]=!0;initialize(e,n){this.layer=n.layer}_isModel(e){return!!e[ae]}model(e,n){const r=this.cellNamespace;if(!r)throw new Error("dia.CellCollection: cellNamespace is required to instantiate a Cell from JSON.");const{type:i}=e,s=Ze(r,i,".");if(!s)throw new Error(`dia.Graph: Could not find cell constructor for type: '${i}'. Make sure to add the constructor to 'cellNamespace'.`);return new s(e,n)}_addReference(e,n){super._addReference(e,n),!n.dry&&!e.graph&&(e.graph=this.layer.graph)}_removeReference(e,n){super._removeReference(e,n),!n.dry&&e.graph===this.layer.graph&&(e.graph=null)}_removeReferenceFast(e,n){e.off("all",this._onModelEvent,this),n.dry||(this===e.collection&&delete e.collection,e.graph===this.layer.graph&&(e.graph=null))}comparator(e){return e.get("z")||0}reset(e,n){n=j({},{add:!0,remove:!1,merge:!1},n);for(let i=0;i<this.models.length;i++)this._removeReferenceFast(this.models[i],n);n.previousModels=this.models,this._reset();for(let i=0;i<e.length;i++){const s=this._prepareModel(e[i],n);s&&(this.models.push(s),this._addReference(s,n))}return this.length=this.models.length,this.comparator&&n.sort!==!1&&this.sort({silent:!0}),n.silent||this.trigger("reset",this,n),this.models}minZIndex(){var e;return((e=this.first())===null||e===void 0?void 0:e.get("z"))||0}maxZIndex(){var e;return((e=this.last())===null||e===void 0?void 0:e.get("z"))||0}}const Xo="GraphLayer";class Yh extends Ve{[So]=!0;preinitialize(){this.eventPrefix="layer:"}defaults(){return{type:Xo}}initialize(e,n={}){super.initialize(e,n),this.cellCollection=new jh([],{layer:this}),this.cellCollection.on("all",this.trigger,this),this.cellCollection.on("change",this.onCellChange,this)}onCellChange(e,n){n.sort===!1||!e.hasChanged("z")||this.cellCollection.sort()}getCells(){return this.cellCollection.toArray()}}const Ko=Jt.extend({defaultLayerNamespace:{GraphLayer:Yh},initialize:function(t,e={}){const{layerNamespace:n,cellNamespace:r,graph:i}=e;this.layerNamespace=j({},this.defaultLayerNamespace,n),r?this.cellNamespace=r:this.cellNamespace=typeof joint<"u"&&ve(joint,"shapes")?joint.shapes:null,this.graph=i},model:function(t,e){const r=e.collection.layerNamespace,{type:i}=t,s=Ze(r,i,".");if(!s)throw new Error(`dia.Graph: Could not find layer constructor for type: '${i}'. Make sure to add the constructor to 'layerNamespace'.`);return new s(t,e)},_addReference(t,e){Jt.prototype._addReference.call(this,t,e),t.graph=this.graph,t.cellCollection.cellNamespace=this.cellNamespace},_removeReference(t,e){Jt.prototype._removeReference.call(this,t,e),t.graph=null,t.cellCollection.cellNamespace=null},_prepareModel:function(t,e){if(!t[So]&&!t.type){const n=kt(t);n.type=Xo,arguments[0]=n}return Jt.prototype._prepareModel.apply(this,arguments)},reset(t,e){return this._assertInternalCall(e),Jt.prototype.reset.apply(this,arguments)},add(t,e){return this._assertInternalCall(e),Jt.prototype.add.apply(this,arguments)},remove(t,e){return this._assertInternalCall(e),Jt.prototype.remove.apply(this,arguments)},_onModelEvent(t,e){if(e&&e[ae]){this.trigger.apply(this,arguments);return}Jt.prototype._onModelEvent.apply(this,arguments)},_assertInternalCall(t){if(t&&!t.graph&&!t.silent)throw new Error("dia.GraphLayerCollection: direct manipulation of the collection is not supported, use graph methods instead.")},insert(t,e=null,n={}){const r=t.id;if(r===e)return;if(e&&!this.has(e))throw new Error(`dia.GraphLayerCollection: Layer "${e}" does not exist`);let i=-1;if(this.has(r)){if(i=this.findIndex(o=>o.id===r),i===this.length-1&&!e)return;this.remove(r,{silent:!0})}let s;e?s=this.findIndex(o=>o.id===e):s=this.length,i!==-1?(this.add(t,{at:s,silent:!0}),this.trigger("sort",this,n)):this.add(t,{...n,at:s})},getCell(t){for(const e of this.models){const n=e.cellCollection.get(t);if(n)return n}},getCells(){const t=this.models;if(t.length===1)return t[0].getCells();const e=[];for(const n of t)Array.prototype.push.apply(e,n.cellCollection.models);return e},removeCell(t,e={}){var n;const r=(n=t.collection)===null||n===void 0||(n=n.layer)===null||n===void 0?void 0:n.cellCollection;r&&r.remove(t,e)},moveCellBetweenLayers(t,e,n={}){var r;const i=(r=t.collection)===null||r===void 0?void 0:r.layer;if(!i)throw new Error("dia.GraphLayerCollection: cannot move a cell that is not part of any layer.");const s=this.get(e);if(!s)throw new Error(`dia.GraphLayerCollection: cannot move cell to layer '${e}' because such layer does not exist.`);if(i===s)return;const o={...n,fromLayer:i.id,toLayer:s.id};i.cellCollection.remove(t,o),s.cellCollection.add(t,o),t.trigger("move",t,o)},addCellToLayer(t,e,n={}){const r=this.get(e);if(!r)throw new Error(`dia.GraphLayerCollection: layer "${e}" does not exist.`);const i={...n,toLayer:r.id};r.cellCollection.add(t,i)}});Object.defineProperty(Ko.prototype,Ru,{value:!0});class h0 extends Ii{constructor(e){if(super(e),this.callbackArguments=[],this.layerCollection=e.layerCollection,!this.layerCollection)throw new Error('GraphTopologyIndex: "layerCollection" option is required.');this.initializeIndex(),this.startListening()}startListening(){this.listenTo(this.layerCollection.graph,{add:this._restructureOnAdd,remove:this._restructureOnRemove,reset:this._restructureOnReset}),this.listenTo(this.layerCollection,{"change:source":this._restructureOnChangeSource,"change:target":this._restructureOnChangeTarget})}initializeIndex(){this._out={},this._in={},this._nodes={},this._edges={}}_restructureOnReset(){this.initializeIndex(),this.layerCollection.getCells().forEach(this._restructureOnAdd,this)}_restructureOnAdd(e){if(e.isLink()){this._edges[e.id]=!0;const{source:n,target:r}=e.attributes;n.id&&((this._out[n.id]||(this._out[n.id]={}))[e.id]=!0),r.id&&((this._in[r.id]||(this._in[r.id]={}))[e.id]=!0)}else this._nodes[e.id]=!0}_restructureOnRemove(e){if(e.isLink()){delete this._edges[e.id];const{source:n,target:r}=e.attributes;n.id&&this._out[n.id]&&this._out[n.id][e.id]&&delete this._out[n.id][e.id],r.id&&this._in[r.id]&&this._in[r.id][e.id]&&delete this._in[r.id][e.id]}else delete this._nodes[e.id]}_restructureOnChangeSource(e){const n=e.previous("source");n.id&&this._out[n.id]&&delete this._out[n.id][e.id];const r=e.attributes.source;r.id&&((this._out[r.id]||(this._out[r.id]={}))[e.id]=!0)}_restructureOnChangeTarget(e){const n=e.previous("target");n.id&&this._in[n.id]&&delete this._in[n.id][e.id];const r=e.get("target");r.id&&((this._in[r.id]||(this._in[r.id]={}))[e.id]=!0)}getOutboundEdges(e){return this._out[e]||{}}getInboundEdges(e){return this._in[e]||{}}getSinkNodes(){const e=[];for(const n in this._nodes)(!this._out[n]||re(this._out[n]))&&e.push(n);return e}getSourceNodes(){const e=[];for(const n in this._nodes)(!this._in[n]||re(this._in[n]))&&e.push(n);return e}isSourceNode(e){return!this._in[e]||re(this._in[e])}isSinkNode(e){return!this._out[e]||re(this._out[e])}}const Zo="cells",Jo=Ve.extend({legacyMode:!0,defaultLayerId:Zo,initialize:function(t,e={}){const n=this.layerCollection=new Ko([],{layerNamespace:e.layerNamespace,cellNamespace:e.cellNamespace,graph:this,model:e.cellModel});n.add({id:Zo},{graph:this.cid}),this.attributes.cells=this.getLayer(Zo).cellCollection,this.layersController=new u0({graph:this}),this.topologyIndex=new h0({layerCollection:n}),this._batches={}},toJSON:function(t={}){const{layerCollection:e}=this,n=Ve.prototype.toJSON.apply(this,arguments);return n.cells=this.getCells().map(r=>r.toJSON(t.cellAttributes)),this.legacyMode||(n.layers=e.toJSON(),n.defaultLayer=this.defaultLayerId),n},fromJSON:function(t,e){const{cells:n,layers:r,defaultLayer:i,...s}=t;if(!n)throw new Error("Graph JSON must contain cells array.");return this.set(s,{silent:!0}),r&&this._resetLayers(r,i,e),n&&this.resetCells(n,e),this},clear:function(t){t=j({},t,{clear:!0});const e=this.getCells();if(e.length===0)return this;this.startBatch("clear",t);const n=Gn(e,r=>r.isLink()?1:2);do this.layerCollection.removeCell(n.shift(),t);while(n.length>0);return this.stopBatch("clear"),this},_prepareCell:function(t,e){let n;if(t[ae]?n=t.attributes:n=t,!Mt(n.type))throw new TypeError("dia.Graph: cell type must be a string.");if(e&&e.ensureZIndex&&n.z===void 0){const r=n[Bt.layerAttribute]||this.defaultLayerId,i=this.maxZIndex(r)+1;t[ae]?t.set("z",i,e):n.z=i}return t},minZIndex:function(t=this.defaultLayerId){return this.getLayer(t).cellCollection.minZIndex()},maxZIndex:function(t=this.defaultLayerId){return this.getLayer(t).cellCollection.maxZIndex()},addCell:function(t,e){return Array.isArray(t)?this.addCells(t,e):(this._prepareCell(t,{...e,ensureZIndex:!0}),this.layerCollection.addCellToLayer(t,this.getCellLayerId(t),e),this)},addCells:function(t,e){return t.length===0?this:(t=Rc(t),e.maxPosition=e.position=t.length-1,this.startBatch("add",e),t.forEach(n=>{this.addCell(n,e),e.position--}),this.stopBatch("add",e),this)},resetCells:function(t,e){const{layerCollection:n}=this,r={...e,ensureZIndex:!1},i=n.reduce((s,o)=>(s[o.id]=[],s),{});for(let s=0;s<t.length;s++){const o=t[s],l=this.getCellLayerId(o);if(l in i)this._prepareCell(o,r),i[l].push(o);else throw new Error(`dia.Graph: Layer "${l}" does not exist.`)}return n.each(s=>{s.cellCollection.reset(i[s.id],e)}),this.trigger("reset",this.getDefaultLayer().cellCollection,e),this},getCellLayerId:function(t){if(!t)throw new Error("dia.Graph: No cell provided.");return(t[ae]?t.attributes:t)[Bt.layerAttribute]||this.defaultLayerId},_resetLayers:function(t,e,n={}){if(!Array.isArray(t)||t.length===0)throw new Error("dia.Graph: At least one layer must be defined.");if(this.legacyMode=!1,this.layerCollection.reset(t,{...n,graph:this.cid}),e){if(!this.hasLayer(e))throw new Error(`dia.Graph: default layer "${e}" does not exist.`);this.defaultLayerId=e}else this.defaultLayerId=this.layerCollection.at(0).id;return this},removeCells:function(t,e){if(!t.length)return this;this.startBatch("remove");for(const n of t){if(!n)continue;let r;if(n[ae])r=n;else if(r=this.getCell(n),!r)continue;this.layerCollection.removeCell(r,e)}return this.stopBatch("remove"),this},_replaceCell:function(t,e,n={}){const r="replace-cell",i={...n,replace:!0};this.startBatch(r,n),this.layerCollection.removeCell(t,i);const s=e[ae]?e.attributes:e,o=Object.assign({},t.attributes,s);let l;e[ae]?(e.set(o,i),l=e):l=o,this.addCell(l,i),this.stopBatch(r)},_syncCell:function(t,e={}){const n=t[ae]?t.attributes:t,r=this.getCell(t.id);r?"type"in n&&r.get("type")!==n.type?this._replaceCell(r,t,e):r.set(n,e):this.addCell(t,e)},syncCells:function(t,e={}){const n="sync-cells",{remove:r=!1,...i}=e;let s,o;r&&(s=this.getCells(),o=new Map);let l,a;const c=e.sort!==!1;c&&(l=new Ii,a=new Set,l.listenTo(this,{add:u=>{a.add(this.getCellLayerId(u))},change:u=>{(u.hasChanged(Bt.layerAttribute)||u.hasChanged("z"))&&a.add(this.getCellLayerId(u))}})),this.startBatch(n,e),i.sort=!1;for(const u of t)r&&o.set(u.id,!0),this._syncCell(u,i);if(r)for(const u of s)o.has(u.id)||this.layerCollection.removeCell(u,i);if(c){l.stopListening();for(const u of a)this.getLayer(u).cellCollection.sort(e)}this.stopBatch(n)},removeCell:function(t,e){if(!t)throw new Error("dia.Graph: no cell provided.");const n=t[ae]?t:this.getCell(t);if(!n)throw new Error("dia.Graph: cell to remove does not exist in the graph.");n.graph===this&&(this.startBatch("remove"),n.collection.remove(n,e),this.stopBatch("remove"))},transferCellEmbeds:function(t,e,n={}){const r="transfer-embeds";this.startBatch(r);const i=t.getEmbeddedCells();e.embed(i,{...n,reparent:!0}),this.stopBatch(r)},transferCellConnectedLinks:function(t,e,n={}){const r="transfer-connected-links";this.startBatch(r),this.getConnectedLinks(t,n).forEach(s=>{s.getSourceCell()===t&&s.prop(["source","id"],e.id,n),s.getTargetCell()===t&&s.prop(["target","id"],e.id,n)}),this.stopBatch(r)},_getBeforeLayerIdFromOptions(t,e=null){let{before:n=null,index:r}=t;if(n&&r!==void 0)throw new Error('dia.Graph: Options "before" and "index" are mutually exclusive.');let i;if(r!==void 0){const o=this.getLayers();if(r>=o.length)i=null;else if(r<0)i=o[0].id;else{var s;const l=o.indexOf(e);l!==-1&&r>l&&(r+=1),i=((s=o[r])===null||s===void 0?void 0:s.id)||null}}else i=n;return i},addLayer(t,e={}){if(!t||!t.id)throw new Error("dia.Graph: Layer to add is invalid.");if(this.hasLayer(t.id))throw new Error(`dia.Graph: Layer "${t.id}" already exists.`);const{before:n=null,index:r,...i}=e;i.graph=this.cid,this.legacyMode=!1;const s=this._getBeforeLayerIdFromOptions({before:n,index:r});this.layerCollection.insert(t,s,i)},moveLayer(t,e={}){if(!t||!this.hasLayer(t))throw new Error("dia.Graph: Layer to move does not exist.");const n=this.getLayer(t),{before:r=null,index:i,...s}=e;s.graph=this.cid,this.legacyMode=!1;const o=this._getBeforeLayerIdFromOptions({before:r,index:i},n);this.layerCollection.insert(n,o,s)},removeLayer(t,e={}){if(!t)throw new Error("dia.Graph: No layer provided.");const n=t.id?t.id:t,r=this.getLayer(n),{id:i}=this.getDefaultLayer();if(n===i)throw new Error("dia.Graph: default layer cannot be removed.");if(r.cellCollection.length>0)throw new Error(`dia.Graph: Layer "${n}" cannot be removed because it is not empty.`);this.layerCollection.remove(n,{...e,graph:this.cid})},getDefaultLayer(){return this.layerCollection.get(this.defaultLayerId)},setDefaultLayer(t,e={}){if(!t)throw new Error("dia.Graph: No default layer ID provided.");const n=t.id?t.id:t,r=this.getLayer(n),i=this.defaultLayerId;if(n===i)return;const s=this.getImplicitLayerCells();this.defaultLayerId=n;const o="default-layer-change";if(this.startBatch(o,e),s.length>0){const l={...e,sort:!1};for(const a of s)this.layerCollection.moveCellBetweenLayers(a,n,l);e.sort!==!1&&r.cellCollection.sort(e)}r.trigger(r.eventPrefix+"default",r,{...e,previousDefaultLayerId:i}),this.stopBatch(o,e)},getImplicitLayerCells(){return this.getDefaultLayer().cellCollection.filter(t=>t.get(Bt.layerAttribute)==null)},getLayer(t){if(!this.hasLayer(t))throw new Error(`dia.Graph: Layer "${t}" does not exist.`);return this.layerCollection.get(t)},hasLayer(t){return this.layerCollection.has(t)},getLayers(){return this.layerCollection.toArray()},getCell:function(t){return this.layerCollection.getCell(t)},getCells:function(){return this.layerCollection.getCells()},getElements:function(){return this.getCells().filter(t=>t.isElement())},getLinks:function(){return this.getCells().filter(t=>t.isLink())},getFirstCell:function(t){let e;return t?e=this.getLayer(t):e=this.getLayers().at(0),e.cellCollection.models.at(0)},getLastCell:function(t){let e;return t?e=this.getLayer(t):e=this.getLayers().at(-1),e.cellCollection.models.at(-1)},getConnectedLinks:function(t,e){e=e||{};var n=e.indirect,r=e.inbound,i=e.outbound;r===void 0&&i===void 0&&(r=i=!0);var s=[],o={};i&&l(this,t),r&&a(this,t);function l(h,g){if(_e(h.topologyIndex.getOutboundEdges(g.id),(function(v,y){if(!o[y]){var x=h.getCell(y);x&&(s.push(x),o[y]=!0,n&&(r&&a(h,x),i&&l(h,x)))}}).bind(h)),n&&g.isLink()){var d=g.getTargetCell();d&&d.isLink()&&(o[d.id]||(s.push(d),l(h,d)))}}function a(h,g){if(_e(h.topologyIndex.getInboundEdges(g.id),(function(v,y){if(!o[y]){var x=h.getCell(y);x&&(s.push(x),o[y]=!0,n&&(r&&a(h,x),i&&l(h,x)))}}).bind(h)),n&&g.isLink()){var d=g.getSourceCell();d&&d.isLink()&&(o[d.id]||(s.push(d),a(h,d)))}}if(e.deep){var c=t.getEmbeddedCells({deep:!0}),u={};c.forEach(function(h){h.isElement()&&(u[h.id]=!0)}),c.forEach(function(h){h.isLink()||(i&&_e(this.topologyIndex.getOutboundEdges(h.id),(function(g,d){if(!o[d]){var v=this.getCell(d),{source:y,target:x}=v.attributes,A=y.id,T=x.id;if(!e.includeEnclosed&&A&&u[A]&&T&&u[T])return;s.push(this.getCell(d)),o[d]=!0}}).bind(this)),r&&_e(this.topologyIndex.getInboundEdges(h.id),(function(g,d){if(!o[d]){var v=this.getCell(d),{source:y,target:x}=v.attributes,A=y.id,T=x.id;if(!e.includeEnclosed&&A&&u[A]&&T&&u[T])return;s.push(this.getCell(d)),o[d]=!0}}).bind(this)))},this)}return s},getNeighbors:function(t,e){e||(e={});var n=e.inbound,r=e.outbound;n===void 0&&r===void 0&&(n=r=!0);var i=this.getConnectedLinks(t,e).reduce((function(l,a){var{source:c,target:u}=a.attributes,h=a.hasLoop(e);if(n&&ve(c,"id")&&!l[c.id]){var g=this.getCell(c.id);g.isElement()&&(h||g&&g!==t&&(!e.deep||!g.isEmbeddedIn(t)))&&(l[c.id]=g)}if(r&&ve(u,"id")&&!l[u.id]){var d=this.getCell(u.id);d.isElement()&&(h||d&&d!==t&&(!e.deep||!d.isEmbeddedIn(t)))&&(l[u.id]=d)}return l}).bind(this),{});if(t.isLink()){if(n){var s=t.getSourceCell();s&&s.isElement()&&!i[s.id]&&(i[s.id]=s)}if(r){var o=t.getTargetCell();o&&o.isElement()&&!i[o.id]&&(i[o.id]=o)}}return xt(i)},getCommonAncestor:function(){var t=Array.from(arguments).map(function(n){for(var r=[],i=n.get("parent");i;)r.push(i),i=this.getCell(i).get("parent");return r},this);t=t.sort(function(n,r){return n.length-r.length});var e=xt(t.shift()).find(function(n){return t.every(function(r){return r.includes(n)})});return this.getCell(e)},getSuccessors:function(t,e){e=e||{};var n=[];return this.search(t,function(r){r!==t&&n.push(r)},j({},e,{outbound:!0})),n},cloneCells:bo,cloneSubgraph:function(t,e){var n=this.getSubgraph(t,e);return this.cloneCells(n)},getSubgraph:function(t,e){e=e||{};var n=[],r={},i=[],s=[];return xt(t).forEach(function(o){if(r[o.id]||(n.push(o),r[o.id]=o,o.isLink()?s.push(o):i.push(o)),e.deep){var l=o.getEmbeddedCells({deep:!0});l.forEach(function(a){r[a.id]||(n.push(a),r[a.id]=a,a.isLink()?s.push(a):i.push(a))})}}),s.forEach(function(o){var{source:l,target:a}=o.attributes;if(l.id&&!r[l.id]){var c=this.getCell(l.id);n.push(c),r[c.id]=c,i.push(c)}if(a.id&&!r[a.id]){var u=this.getCell(a.id);n.push(this.getCell(a.id)),r[u.id]=u,i.push(u)}},this),i.forEach(function(o){var l=this.getConnectedLinks(o,e);l.forEach(function(a){var{source:c,target:u}=a.attributes;!r[a.id]&&c.id&&r[c.id]&&u.id&&r[u.id]&&(n.push(a),r[a.id]=a)})},this),n},getPredecessors:function(t,e){e=e||{};var n=[];return this.search(t,function(r){r!==t&&n.push(r)},j({},e,{inbound:!0})),n},search:function(t,e,n){n=n||{},n.breadthFirst?this.bfs(t,e,n):this.dfs(t,e,n)},bfs:function(t,e,n={}){const r={},i={},s=[];for(s.push(t),i[t.id]=0;s.length>0;){var o=s.shift();if(r[o.id]||(r[o.id]=!0,e.call(this,o,i[o.id])===!1))continue;const l=this.getNeighbors(o,n);for(let a=0,c=l.length;a<c;a++){const u=l[a];i[u.id]=i[o.id]+1,s.push(u)}}},dfs:function(t,e,n={}){const r={},i={},s=[];for(s.push(t),i[t.id]=0;s.length>0;){const o=s.pop();if(r[o.id]||(r[o.id]=!0,e.call(this,o,i[o.id])===!1))continue;const l=this.getNeighbors(o,n),a=s.length;for(let c=0,u=l.length;c<u;c++){const h=l[c];i[h.id]=i[o.id]+1,s.splice(a,0,h)}}},getSources:function(){return this.topologyIndex.getSourceNodes().map(t=>this.getCell(t))},getSinks:function(){return this.topologyIndex.getSinkNodes().map(t=>this.getCell(t))},isSource:function(t){return this.topologyIndex.isSourceNode(t.id)},isSink:function(t){return this.topologyIndex.isSinkNode(t.id)},isSuccessor:function(t,e){var n=!1;return this.search(t,function(r){if(r===e&&r!==t)return n=!0,!1},{outbound:!0}),n},isPredecessor:function(t,e){var n=!1;return this.search(t,function(r){if(r===e&&r!==t)return n=!0,!1},{inbound:!0}),n},isNeighbor:function(t,e,n){n=n||{};var r=n.inbound,i=n.outbound;r===void 0&&i===void 0&&(r=i=!0);var s=!1;return this.getConnectedLinks(t,n).forEach(function(o){var{source:l,target:a}=o.attributes;if(r&&ve(l,"id")&&l.id===e.id||i&&ve(a,"id")&&a.id===e.id)return s=!0,!1}),s},disconnectLinks:function(t,e){this.getConnectedLinks(t).forEach(function(n){n.set(n.attributes.source.id===t.id?"source":"target",{x:0,y:0},e)})},removeLinks:function(t,e){this.getConnectedLinks(t).forEach(n=>{this.layerCollection.removeCell(n,e)})},findElementsAtPoint:function(t,e){return this._filterAtPoint(this.getElements(),t,e)},findLinksAtPoint:function(t,e){return this._filterAtPoint(this.getLinks(),t,e)},findCellsAtPoint:function(t,e){return this._filterAtPoint(this.getCells(),t,e)},_filterAtPoint:function(t,e,n={}){return t.filter(r=>r.getBBox({rotate:!0}).containsPoint(e,n))},findElementsInArea:function(t,e={}){return this._filterInArea(this.getElements(),t,e)},findLinksInArea:function(t,e={}){return this._filterInArea(this.getLinks(),t,e)},findCellsInArea:function(t,e={}){return this._filterInArea(this.getCells(),t,e)},_filterInArea:function(t,e,n={}){const r=new U(e),{strict:i=!1}=n,s=i?"containsRect":"intersect";return t.filter(o=>r[s](o.getBBox({rotate:!0})))},findElementsUnderElement:function(t,e){return this._filterCellsUnderElement(this.getElements(),t,e)},findLinksUnderElement:function(t,e){return this._filterCellsUnderElement(this.getLinks(),t,e)},findCellsUnderElement:function(t,e){return this._filterCellsUnderElement(this.getCells(),t,e)},_isValidElementUnderElement:function(t,e){return t.id!==e.id&&!t.isEmbeddedIn(e)},_isValidLinkUnderElement:function(t,e){return t.source().id!==e.id&&t.target().id!==e.id&&!t.isEmbeddedIn(e)},_validateCellsUnderElement:function(t,e){return t.filter(n=>n.isLink()?this._isValidLinkUnderElement(n,e):this._isValidElementUnderElement(n,e))},_getFindUnderElementGeometry:function(t,e="bbox"){const n=t.getBBox({rotate:!0});return e!=="bbox"?Co(n,e):n},_filterCellsUnderElement:function(t,e,n={}){const r=this._getFindUnderElementGeometry(e,n.searchBy),i=r.type===ft.Point?this._filterAtPoint(t,r):this._filterInArea(t,r,n);return this._validateCellsUnderElement(i,e)},findModelsInArea:function(t,e){return this.findElementsInArea(t,e)},findModelsFromPoint:function(t){return this.findElementsAtPoint(t)},findModelsUnderElement:function(t,e){return this.findElementsUnderElement(t,e)},getBBox:function(){return this.getCellsBBox(this.getCells())},getCellsBBox:function(t,e={}){const{rotate:n=!0}=e;return xt(t).reduce(function(r,i){const s=i.getBBox({rotate:n});return s?r?r.union(s):s:r},null)},translate:function(t,e,n){var r=this.getCells().filter(function(i){return!i.isEmbedded()});return Ie(r,"translate",t,e,n),this},resize:function(t,e,n){return this.resizeCells(t,e,this.getCells(),n)},resizeCells:function(t,e,n,r){var i=this.getCellsBBox(n);if(i){var s=Math.max(t/i.width,0),o=Math.max(e/i.height,0);Ie(n,"scale",s,o,i.origin(),r)}return this},startBatch:function(t,e){return e=e||{},this._batches[t]=(this._batches[t]||0)+1,this.trigger("batch:start",j({},e,{batchName:t}))},stopBatch:function(t,e){return e=e||{},this._batches[t]=(this._batches[t]||0)-1,this.trigger("batch:stop",j({},e,{batchName:t}))},hasActiveBatch:function(t){const e=this._batches;let n;return arguments.length===0?n=Object.keys(e):Array.isArray(t)?n=t:n=[t],n.some(r=>e[r]>0)}},{validations:{multiLinks:function(t,e){var{source:n,target:r}=e.attributes;if(n.id&&r.id){var i=e.getSourceCell();if(i){var s=t.getConnectedLinks(i,{outbound:!0}),o=s.filter(function(l){var{source:a,target:c}=l.attributes;return a&&a.id===n.id&&(!a.port||a.port===n.port)&&c&&c.id===r.id&&(!c.port||c.port===r.port)});if(o.length>1)return!1}}return!0},linkPinning:function(t,e){var{source:n,target:r}=e.attributes;return n.id&&r.id}}});Fu(Jo.prototype,["resetCells","addCells","removeCells"],Oi.cells);const f0=["transform","x","y","cx","cy","dx","dy","x1","y1","x2","y2","points","d","r","rx","ry","width","height","stroke-width","font-size"],d0=["r","rx","ry","width","height","stroke-width","font-size"],g0=f0.reduce((t,e)=>(t[e]=!0,t),{}),p0=d0.reduce((t,e)=>(t[e]=!0,t),{});function Xh(t,e){const n={};for(let r in t)t.hasOwnProperty(r)&&(n[r]=Kh(r,t[r],e));return n}function Kh(t,e,n){if(t in g0&&Se(e)){let r=Ee(e,n);return t in p0&&(r=Math.max(0,r)),r}return e}const qn={DEFAULT:"default",EMBEDDING:"embedding",CONNECTING:"connecting",MAGNET_AVAILABILITY:"magnetAvailability",ELEMENT_AVAILABILITY:"elementAvailability"},v0={TOOLS:"TOOLS"},vt=le.extend({tagName:"g",svgElement:!0,selector:"root",metrics:null,className:function(){var t=["cell"],e=this.model.get("type");return e&&e.toLowerCase().split(".").forEach(function(n,r,i){t.push("type-"+i.slice(0,r+1).join("-"))}),t.join(" ")},_presentationAttributes:null,_flags:null,setFlags:function(){var t={},e={},n=0,r,i,s,o=Ct(this,"presentationAttributes");for(var l in o)if(o.hasOwnProperty(l)){var a=o[l];for(Array.isArray(a)||(a=[a]),r=0,i=a.length;r<i;r++){s=a[r];var c=t[s];c||(c=t[s]=1<<n++),e[l]|=c}}var u=Ct(this,"initFlag");for(Array.isArray(u)||(u=[u]),r=0,i=u.length;r<i;r++)s=u[r],t[s]||(t[s]=1<<n++);if(n>25)throw new Error("dia.CellView: Maximum number of flags exceeded.");this._flags=t,this._presentationAttributes=e},hasFlag:function(t,e){return t&this.getFlag(e)},removeFlag:function(t,e){return t^t&this.getFlag(e)},getFlag:function(t){var e=this._flags;if(!e)return 0;var n=0;if(Array.isArray(t))for(var r=0,i=t.length;r<i;r++)n|=e[t[r]];else n|=e[t];return n},attributes:function(){var t=this.model;return{"model-id":t.id,"data-type":t.attributes.type}},constructor:function(t){t.id=t.id||xn(this),le.call(this,t)},initialize:function(){this.setFlags(),le.prototype.initialize.apply(this,arguments),this.cleanNodesCache(),this.startListening()},startListening:function(){this.listenTo(this.model,"change",this.onAttributesChange)},onAttributesChange:function(t,e){var n=t.getChangeFlag(this._presentationAttributes);e.updateHandled||!n||(e.dirty&&this.hasFlag(n,"UPDATE")&&(n|=this.getFlag("RENDER")),e.tool&&(e.async=!1),this.requestUpdate(n,e))},requestUpdate:function(t,e){const{paper:n}=this;n&&t>0&&n.requestViewUpdate(this,t,this.UPDATE_PRIORITY,e)},parseDOMJSON:function(t,e){var n=pr(t),r=n.selectors,i=n.groupSelectors;for(var s in i){if(r[s])throw new Error("dia.CellView: ambiguous group selector");r[s]=i[s]}if(e){var o=this.selector;if(r[o])throw new Error("dia.CellView: ambiguous root selector.");r[o]=e}return{fragment:n.fragment,selectors:r}},can:function(t){var e=bt(this.options.interactive)?this.options.interactive(this):this.options.interactive;return gt(e)&&e[t]!==!1||Lc(e)&&e!==!1},findBySelector:function(t,e,n){if(!t||t===".")return[e];if(n){var r=n[t];if(r)return Array.isArray(r)?r:[r]}return this.useCSSSelectors?z(e).find(t).toArray():[]},findNodes:function(t){return this.findBySelector(t,this.el,this.selectors)},findNode:function(t){const[e=null]=this.findNodes(t);return e},notify:function(t){if(this.paper){var e=Array.prototype.slice.call(arguments,1);this.trigger.apply(this,[t].concat(e)),this.paper.trigger.apply(this.paper,[t,this].concat(e))}},getBBox:function(t){var e;if(t&&t.useModelGeometry){var n=this.model;e=n.getBBox().bbox(n.angle())}else e=this.getNodeBBox(this.el);return this.paper.localToPaperRect(e)},getNodeBBox:function(t){const e=this.getNodeBoundingRect(t),n=this.getRootTranslateMatrix().multiply(this.getNodeRotateMatrix(t)),r=this.getNodeMatrix(t);return N.transformRect(e,n.multiply(r))},getNodeRotateMatrix(t){return!this.rotatableNode||this.rotatableNode.contains(t)?this.getRootRotateMatrix():N.createSVGMatrix()},getNodeUnrotatedBBox:function(t){var e=this.getNodeBoundingRect(t),n=this.getNodeMatrix(t),r=this.getRootTranslateMatrix();return N.transformRect(e,r.multiply(n))},getRootTranslateMatrix:function(){var t=this.model,e=t.position(),n=N.createSVGMatrix().translate(e.x,e.y);return n},getRootRotateMatrix:function(){var t=N.createSVGMatrix(),e=this.model,n=e.angle();if(n){var r=e.getBBox(),i=r.width/2,s=r.height/2;t=t.translate(i,s).rotate(n).translate(-i,-s)}return t},_notifyHighlight:function(t,e,n={}){const{el:r}=this;let i;if(typeof e=="string"?i=this.findNode(e)||r:[i=r]=this.$(e),n.partial=i!==r,n.type===void 0){let s;switch(!0){case n.embedding:s=qn.EMBEDDING;break;case n.connecting:s=qn.CONNECTING;break;case n.magnetAvailability:s=qn.MAGNET_AVAILABILITY;break;case n.elementAvailability:s=qn.ELEMENT_AVAILABILITY;break;default:s=qn.DEFAULT;break}n.type=s}return this.notify(t,i,n),this},highlight:function(t,e){return this._notifyHighlight("cell:highlight",t,e)},unhighlight:function(t,e={}){return this._notifyHighlight("cell:unhighlight",t,e)},findMagnet:function(t){const e=this.el;let n=this.$(t)[0];n||(n=e);do{const r=n.getAttribute("magnet"),i=n===e;if((r||i)&&r!=="false")return n;if(i)return;n=n.parentNode}while(n)},findProxyNode:function(t,e){t||(t=this.el);const n=t.getAttribute(`${e}-selector`);if(n){const r=this.findNode(n);if(r)return r}return t},getSelector:function(t,e){var n;if(t===this.el)return typeof e=="string"&&(n=":scope > "+e),n;if(t){var r=N(t).index()+1;n=t.tagName+":nth-child("+r+")",e&&(n+=" > "+e),n=this.getSelector(t.parentNode,n)}return n},addLinkFromMagnet:function(t,e,n){var r=this.paper,i=r.model,s=r.getDefaultLink(this,t);return s.set({source:this.getLinkEnd(t,e,n,s,"source"),target:{x:e,y:n}}).addTo(i,{async:!1,ui:!0}),s.findView(r)},getLinkEnd:function(t,...e){const n=this.model,r=n.id,i=this.findAttributeNode("port",t),s=t.getAttribute("joint-selector"),o={id:r};if(s!=null&&(o.magnet=s),i!=null){let l=i.getAttribute("port");i.getAttribute("port-id-type")==="number"&&(l=parseInt(l,10)),o.port=l,!n.hasPort(l)&&!s&&(o.selector=this.getSelector(t))}else s==null&&this.el!==t&&(o.selector=this.getSelector(t));return this.customizeLinkEnd(o,t,...e)},customizeLinkEnd:function(t,e,n,r,i,s){const{paper:o}=this,{connectionStrategy:l}=o.options;if(typeof l=="function"){var a=l.call(o,t,this,e,new S(n,r),i,s,o);if(a)return a}return t},getMagnetFromLinkEnd:function(t){var e=t.port,n=t.magnet,r=this.model,i;return e!=null&&r.isElement()&&r.hasPort(e)?i=this.findPortNode(e,n)||this.el:(n||(n=t.selector),!n&&e!=null&&(n='[port="'+e+'"]'),i=this.findNode(n)),this.findProxyNode(i,"magnet")},dragLinkStart:function(t,e,n,r){this.model.startBatch("add-link");const i=this.addLinkFromMagnet(e,n,r);i.notifyPointerdown(t,n,r),i.eventData(t,i.startArrowheadMove("target",{whenNotAllowed:"remove"})),this.eventData(t,{linkView:i})},dragLink:function(t,e,n){var r=this.eventData(t),i=r.linkView;if(i)i.pointermove(t,e,n);else{var s=this.paper,o=s.options.magnetThreshold,l=this.getEventTarget(t),a=r.targetMagnet;if(o==="onleave"){if(a===l||N(a).contains(l))return}else if(s.eventData(t).mousemoved<=o)return;this.dragLinkStart(t,a,e,n)}},dragLinkEnd:function(t,e,n){var r=this.eventData(t),i=r.linkView;i&&(i.pointerup(t,e,n),this.model.stopBatch("add-link"))},getAttributeDefinition:function(t){return this.model.constructor.getAttributeDefinition(t)},setNodeAttributes:function(t,e){re(e)||(t instanceof SVGElement?N(t).attr(e):z(t).attr(e))},processNodeAttributes:function(t,e){var n,r,i,s,o,l,a,c,u,h=[];const g={};for(n in e)e.hasOwnProperty(n)&&(g[N.attributeNames[n]]=e[n]);for(n in g)if(g.hasOwnProperty(n))if(r=g[n],i=this.getAttributeDefinition(n),i)if(r===null){let d;if(bt(i.unset)?d=i.unset.call(this,t,g,this):d=i.unset,!d&&Mt(i.set)&&(d=i.set),d||(d=n),Mt(d)&&d){if(l||(l={}),d in l)continue;l[d]=r}else if(Array.isArray(d)&&d.length>0)for(l||(l={}),s=0,o=d.length;s<o;s++){const v=d[s];v in l||(l[v]=r)}}else!bt(i.qualify)||i.qualify.call(this,r,t,g,this)?(Mt(i.set)&&(l||(l={}),l[i.set]=r),h.push(n,i)):(l||(l={}),l[n]=r);else l||(l={}),l[n]=r;for(s=0,o=h.length;s<o;s+=2)n=h[s],i=h[s+1],r=e[n],bt(i.set)&&(a||(a={}),a[n]=r),bt(i.position)&&(c||(c={}),c[n]=r),bt(i.offset)&&(u||(u={}),u[n]=r);return{raw:g,normal:l,set:a,position:c,offset:u}},updateRelativeAttributes:function(t,e,n,r){r||(r={});var i,s,o,l=Xh(e.raw||{},n),a=e.normal||{};for(const P in a)a[P]=l[P];var c=e.set,u=e.position,h=e.offset;for(i in c){s=l[i],o=this.getAttributeDefinition(i);var g=o.set.call(this,s,n.clone(),t,l,this);gt(g)?j(a,g):g!==void 0&&(a[i]=g)}if(t instanceof HTMLElement){this.setNodeAttributes(t,a);return}var d=a.transform,v=N.transformStringToMatrix(d),y=S(v.e,v.f);d&&(a=Xe(a,"transform"),v.e=v.f=0);var x,A,T;if(u||h){var f=this.getNodeScale(t,r.scalableNode);x=f.sx,A=f.sy}var p=!1;for(i in u)s=l[i],o=this.getAttributeDefinition(i),T=o.position.call(this,s,n.clone(),t,l,this),T&&(y.offset(S(T).scale(x,A)),p||(p=!0));this.setNodeAttributes(t,a);var m=!1;if(h){var w=this.getNodeBoundingRect(t);if(w.width>0&&w.height>0){var b=N.transformRect(w,v).scale(1/x,1/A);for(i in h)s=l[i],o=this.getAttributeDefinition(i),T=o.offset.call(this,s,b,t,l,this),T&&(y.offset(S(T).scale(x,A)),m||(m=!0))}}(d!==void 0||p||m)&&(y.round(1),v.e=y.x,v.f=y.y,t.setAttribute("transform",N.matrixToTransformString(v)))},getNodeScale:function(t,e){var n,r;if(e&&e.contains(t)){var i=e.scale();n=1/i.sx,r=1/i.sy}else n=1,r=1;return{sx:n,sy:r}},cleanNodesCache:function(){this.metrics={}},cleanNodeCache:function(t){const e=t.id;e&&delete this.metrics[e]},nodeCache:function(t){var e=this.metrics;if(!e)return{};var n=N.ensureId(t),r=e[n];return r||(r=e[n]={}),r},getNodeData:function(t){var e=this.nodeCache(t);return e.data||(e.data={}),e.data},getNodeBoundingRect:function(t){var e=this.nodeCache(t);if(e.boundingRect===void 0){const{measureNode:n}=this.paper.options;typeof n=="function"?e.boundingRect=n(t,this):e.boundingRect=N(t).getBBox()}return new U(e.boundingRect)},getNodeMatrix:function(t){const e=this.nodeCache(t);if(e.magnetMatrix===void 0){const{rotatableNode:n,el:r}=this;let i;n&&n.contains(t)?i=n:i=r,e.magnetMatrix=N(t).getTransformToElement(i,{safe:!t.checkVisibility()})}return N.createSVGMatrix(e.magnetMatrix)},getNodeShape:function(t){var e=this.nodeCache(t);return e.geometryShape===void 0&&(e.geometryShape=N(t).toGeometryShape()),e.geometryShape.clone()},isNodeConnection:function(t){return this.model.isLink()&&(!t||t===this.el)},findNodesAttributes:function(t,e,n,r){var i,s,o,l,a={},c=[];for(var u in t)if(t.hasOwnProperty(u)&&(o=t[u],!!It(o))){var h=n[u]=this.findBySelector(u,e,r);for(i=0,s=h.length;i<s;i++){var g=h[i];l=N.ensureId(g);var d=r&&r[u]===g,v=a[l];if(v){v.array||(c.push(l),v.array=!0,v.attributes=[v.attributes],v.selectedLength=[v.selectedLength]);var y=v.attributes,x=v.selectedLength;if(d)y.unshift(o),x.unshift(-1);else{var A=ro(x,s);y.splice(A,0,o),x.splice(A,0,s)}}else a[l]={attributes:o,selectedLength:d?-1:s,node:g,array:!1}}}for(i=0,s=c.length;i<s;i++)l=c[i],o=a[l],o.attributes=Nt({},...o.attributes.reverse());return a},getEventTarget:function(t,e={}){const{target:n,type:r,clientX:i=0,clientY:s=0}=t;return e.fromPoint||r==="touchmove"||r==="touchend"||"pointerId"in t&&n.hasPointerCapture(t.pointerId)?document.elementFromPoint(i,s):n},updateDOMSubtreeAttributes:function(t,e,n){n||(n={}),n.rootBBox||(n.rootBBox=U()),n.selectors||(n.selectors=this.selectors);var r={},i={},s=[],o=[],l,a,c,u,h,g=n.roAttributes,d=this.findNodesAttributes(g||e,t,r,n.selectors),v=g?this.findNodesAttributes(e,t,r,n.selectors):d;for(var y in d)if(u=d[y],c=u.attributes,a=u.node,h=this.processNodeAttributes(a,c),!h.set&&!h.position&&!h.offset&&!h.raw.ref)this.setNodeAttributes(a,Xh(h.normal,n.rootBBox));else{var x=v[y]&&v[y].attributes,A=x&&c.ref===void 0?x.ref:c.ref,T;if(A){if(T=(r[A]||this.findBySelector(A,t,n.selectors))[0],!T)throw new Error('dia.CellView: "'+A+'" reference does not exist.')}else T=null;if(l={node:a,refNode:T,processedAttributes:h,allAttributes:x},T){var f=o.findIndex(function(p){return p.refNode===a});f>-1?o.splice(f,0,l):o.push(l)}else s.push(l)}s.push(...o);for(let p=0,m=s.length;p<m;p++){l=s[p],a=l.node,T=l.refNode;const w=T?N.ensureId(T):"";let b=i[w];if(!b){if(T){const P=this.getNodeBoundingRect(T),E=N(T).getTransformToElement(N.getCommonAncestor(a,T));b=N.transformRect(P,E)}else b=n.rootBBox;i[w]=b}g?(h=this.processNodeAttributes(a,l.allAttributes),this.mergeProcessedAttributes(h,l.processedAttributes)):h=l.processedAttributes,this.updateRelativeAttributes(a,h,b,n)}},mergeProcessedAttributes:function(t,e){t.set||(t.set={}),t.position||(t.position={}),t.offset||(t.offset={}),j(t.set,e.set),j(t.position,e.position),j(t.offset,e.offset);var n=t.normal&&t.normal.transform;n!==void 0&&e.normal&&(e.normal.transform=n),t.normal=e.normal},onMount(t){t||(this.mountTools(),ce.mount(this))},onDetach(){this.unmountTools(),ce.unmount(this)},onRemove:function(){this.removeTools(),this.removeHighlighters()},_toolsView:null,hasTools:function(t){var e=this._toolsView;return e?t?e.getName()===t:!0:!1},addTools:function(t){return this.removeTools(),t&&(this._toolsView=t,t.configure({relatedView:this}),t.listenTo(this.paper,"tools:event",this.onToolEvent.bind(this))),this},unmountTools(){const t=this._toolsView;return t&&t.unmount(),this},mountTools(){const t=this._toolsView;return t&&!t.isMounted()&&t.mount(),this},updateTools:function(t){var e=this._toolsView;return e&&e.update(t),this},removeTools:function(){var t=this._toolsView;return t&&(t.remove(),this._toolsView=null),this},hideTools:function(){var t=this._toolsView;return t&&t.hide(),this},showTools:function(){var t=this._toolsView;return t&&t.show(),this},onToolEvent:function(t){switch(t){case"remove":this.removeTools();break;case"hide":this.hideTools();break;case"show":this.showTools();break}},removeHighlighters:function(){ce.remove(this)},updateHighlighters:function(t=!1){ce.update(this,null,t)},transformHighlighters:function(){ce.transform(this)},preventDefaultInteraction(t){this.eventData(t,{defaultInteractionPrevented:!0})},isDefaultInteractionPrevented(t){const{defaultInteractionPrevented:e=!1}=this.eventData(t);return e},pointerdblclick:function(t,e,n){this.notify("cell:pointerdblclick",t,e,n)},pointerclick:function(t,e,n){this.notify("cell:pointerclick",t,e,n)},contextmenu:function(t,e,n){this.notify("cell:contextmenu",t,e,n)},pointerdown:function(t,e,n){const{model:r}=this,{graph:i}=r;i&&(r.startBatch("pointer"),this.eventData(t,{graph:i})),this.notify("cell:pointerdown",t,e,n)},pointermove:function(t,e,n){this.notify("cell:pointermove",t,e,n)},pointerup:function(t,e,n){const{graph:r}=this.eventData(t);this.notify("cell:pointerup",t,e,n),r&&r.stopBatch("pointer",{cell:this.model})},mouseover:function(t){this.notify("cell:mouseover",t)},mouseout:function(t){this.notify("cell:mouseout",t)},mouseenter:function(t){this.notify("cell:mouseenter",t)},mouseleave:function(t){this.notify("cell:mouseleave",t)},mousewheel:function(t,e,n,r){this.notify("cell:mousewheel",t,e,n,r)},onevent:function(t,e,n,r){this.notify(e,t,n,r)},onmagnet:function(){},magnetpointerdblclick:function(){},magnetcontextmenu:function(){},checkMouseleave(t){const{paper:e,model:n}=this;if(e.isAsync()){if(n.isLink()){const s=n.getSourceElement();if(s){const l=e.findViewByModel(s);l&&(e.dumpView(l),e.checkViewVisibility(l))}const o=n.getTargetElement();if(o){const l=e.findViewByModel(o);l&&(e.dumpView(l),e.checkViewVisibility(l))}}e.dumpView(this),e.checkViewVisibility(this)}const r=this.getEventTarget(t,{fromPoint:!0}),i=e.findView(r);i!==this&&(this.mouseleave(t),i&&i.mouseenter(t))},setInteractivity:function(t){this.options.interactive=t},isIntersecting:function(t,e){return vn.exists(t,this.getNodeBBox(this.el),e)},isEnclosedIn:function(t){return t.containsRect(this.getNodeBBox(this.el))},isInArea:function(t,e={}){return e.strict?this.isEnclosedIn(t):this.isIntersecting(t)},isAtPoint:function(t,e){return this.getNodeBBox(this.el).containsPoint(t,e)}},{Flags:v0,Highlighting:qn,addPresentationAttributes:function(t){return Nt({},Ct(this.prototype,"presentationAttributes"),t,function(e,n){if(!(!e||!n)&&(typeof e=="string"&&(e=[e]),typeof n=="string"&&(n=[n]),Array.isArray(e)&&Array.isArray(n)))return Ye(e.concat(n))})},evalAttribute:Kh});Object.defineProperty(vt.prototype,"useCSSSelectors",{get(){const t=this.model.useCSSSelectors;return t!==void 0?t:Bt.useCSSSelectors}}),Object.defineProperty(vt.prototype,tn,{value:!0});const wt={TOOLS:vt.Flags.TOOLS,UPDATE:"UPDATE",TRANSLATE:"TRANSLATE",RESIZE:"RESIZE",PORTS:"PORTS",ROTATE:"ROTATE",RENDER:"RENDER"},Wn={MOVE:"move",MAGNET:"magnet"},Or=vt.extend({_removePorts:function(){},_renderPorts:function(){},className:function(){var t=vt.prototype.className.apply(this).split(" ");return t.push("element"),t.join(" ")},initialize:function(){vt.prototype.initialize.apply(this,arguments),this._initializePorts()},presentationAttributes:{attrs:[wt.UPDATE],position:[wt.TRANSLATE,wt.TOOLS],size:[wt.RESIZE,wt.PORTS,wt.TOOLS],angle:[wt.ROTATE,wt.TOOLS],markup:[wt.RENDER],ports:[wt.PORTS]},initFlag:[wt.RENDER],UPDATE_PRIORITY:0,confirmUpdate:function(t,e){const{useCSSSelectors:n}=this;this.hasFlag(t,wt.PORTS)&&(this._removePorts(),this._cleanPortsCache());let r=!1;if(this.hasFlag(t,wt.RENDER))this.render(),this.updateTools(e),this.updateHighlighters(!0),r=!0,t=this.removeFlag(t,[wt.RENDER,wt.UPDATE,wt.RESIZE,wt.TRANSLATE,wt.ROTATE,wt.PORTS,wt.TOOLS]);else{let i=!1;this.hasFlag(t,wt.RESIZE)&&(this.resize(e),i=!0,t=this.removeFlag(t,[wt.RESIZE,wt.UPDATE]),n&&(t=this.removeFlag(t,wt.PORTS))),this.hasFlag(t,wt.UPDATE)&&(this.update(this.model,null,e),t=this.removeFlag(t,wt.UPDATE),i=!0,n&&(t=this.removeFlag(t,wt.PORTS))),this.hasFlag(t,wt.TRANSLATE)&&(this.translate(),t=this.removeFlag(t,wt.TRANSLATE),r=!0),this.hasFlag(t,wt.ROTATE)&&(this.rotate(),t=this.removeFlag(t,wt.ROTATE),r=!0),this.hasFlag(t,wt.PORTS)&&(this._renderPorts(),i=!0,t=this.removeFlag(t,wt.PORTS)),i&&this.updateHighlighters(!1)}return r&&this.transformHighlighters(),this.hasFlag(t,wt.TOOLS)&&(this.updateTools(e),t=this.removeFlag(t,wt.TOOLS)),t},_initializePorts:function(){},update:function(t,e){this.cleanNodesCache();const{useCSSSelectors:n}=this;n&&this._removePorts();var r=this.model,i=r.attr();this.updateDOMSubtreeAttributes(this.el,i,{rootBBox:new U(r.size()),selectors:this.selectors,scalableNode:this.scalableNode,rotatableNode:this.rotatableNode,roAttributes:e===i?null:e}),n&&this._renderPorts()},rotatableSelector:"rotatable",scalableSelector:"scalable",scalableNode:null,rotatableNode:null,renderMarkup:function(){var t=this.model,e=t.get("markup")||t.markup;if(!e)throw new Error("dia.ElementView: markup required");if(Array.isArray(e))return this.renderJSONMarkup(e);if(typeof e=="string")return this.renderStringMarkup(e);throw new Error("dia.ElementView: invalid markup")},renderJSONMarkup:function(t){var e=this.parseDOMJSON(t,this.el),n=this.selectors=e.selectors;this.rotatableNode=N(n[this.rotatableSelector])||null,this.scalableNode=N(n[this.scalableSelector])||null,this.vel.append(e.fragment)},renderStringMarkup:function(t){var e=this.vel;e.append(N(t)),this.rotatableNode=e.findOne(".rotatable"),this.scalableNode=e.findOne(".scalable");var n=this.selectors={};n[this.selector]=this.el},render:function(){return this.vel.empty(),this.renderMarkup(),this.scalableNode&&this.update(),this.resize(),this.rotatableNode?(this.rotate(),this.translate()):this.updateTransformation(),this.useCSSSelectors||this._renderPorts(),this},resize:function(t){if(this.scalableNode)return this.sgResize(t);this.model.attributes.angle&&this.rotate(),this.update()},translate:function(){if(this.rotatableNode)return this.rgTranslate();this.updateTransformation()},rotate:function(){if(this.rotatableNode){this.rgRotate(),this.update();return}this.updateTransformation()},updateTransformation:function(){var t=this.getTranslateString(),e=this.getRotateString();e&&(t+=" "+e),this.vel.attr("transform",t)},getTranslateString:function(){const{x:t,y:e}=this.model.position();return`translate(${t},${e})`},getRotateString:function(){const t=this.model.angle();if(!t)return null;const{width:e,height:n}=this.model.size();return`rotate(${t},${e/2},${n/2})`},rgRotate:function(){this.rotatableNode.attr("transform",this.getRotateString())},rgTranslate:function(){this.vel.attr("transform",this.getTranslateString())},sgResize:function(t){var e=this.model,n=e.angle(),r=e.size(),i=this.scalableNode,s=!1;i.node.getElementsByTagName("path").length>0&&(s=!0);var o=i.getBBox({recursive:s}),l=r.width/(o.width||1),a=r.height/(o.height||1);i.attr("transform","scale("+l+","+a+")");var c=this.rotatableNode,u=c&&c.attr("transform");if(u){c.attr("transform",u+" rotate("+-n+","+r.width/2+","+r.height/2+")");var h=i.getBBox({target:this.paper.cells});e.set("position",{x:h.x,y:h.y},j({updateHandled:!0},t)),this.translate(),this.rotate()}this.update()},prepareEmbedding:function(t={}){const e=t.model||this.model,r=(t.paper||this.paper).model,i=t.initialZIndices={},s=e.getEmbeddedCells({deep:!0}),o=r.getConnectedLinks(e,{deep:!0,includeEnclosed:!0});[e,...s,...o].forEach(c=>i[c.id]=c.attributes.z),e.startBatch("to-front"),e.toFront({deep:!0,ui:!0});const l=r.getElements().reduce((c,u)=>Math.max(c,u.attributes.z||0),0);o.forEach(c=>{c.attributes.z<=l&&c.set("z",l+1,{ui:!0})}),e.stopBatch("to-front");const a=e.parent();a?(r.getCell(a).unembed(e,{ui:!0}),t.initialParentId=a):t.initialParentId=t.initialParentId||null},processEmbedding:function(t={},e,n,r){const i=t.model||this.model,s=t.paper||this.paper,o=s.model,{findParentBy:l,frontParentOnly:a,validateEmbedding:c}=s.options;let u;bt(l)?u=xt(l.call(o,this,e,n,r)):l==="pointer"?u=o.findElementsAtPoint({x:n,y:r}):u=o.findElementsUnderElement(i,{searchBy:l}),u=u.filter(d=>d instanceof Ce&&i.id!==d.id&&!d.isEmbeddedIn(i)),a&&(u=u.slice(-1));let h=null;const g=t.candidateEmbedView;for(let d=u.length-1;d>=0;d--){const v=u[d];if(g&&g.model.id==v.id){h=g;break}else{const y=v.findView(s);if(!bt(c)||c.call(s,this,y)){h=y;break}}}h&&h!=g&&(this.clearEmbedding(t),t.candidateEmbedView=h.highlight(h.findProxyNode(null,"container"),{embedding:!0})),!h&&g&&this.clearEmbedding(t)},clearEmbedding:function(t){t||(t={});var e=t.candidateEmbedView;e&&(e.unhighlight(e.findProxyNode(null,"container"),{embedding:!0}),t.candidateEmbedView=null)},finalizeEmbedding:function(t={}){const e=t.candidateEmbedView,n=t.model||this.model,r=t.paper||this.paper;if(e)e.model.embed(n,{ui:!0}),e.unhighlight(e.findProxyNode(null,"container"),{embedding:!0}),t.candidateEmbedView=null;else{const{validateUnembedding:i}=r.options,{initialParentId:s}=t;if(s&&typeof i=="function"&&!i.call(r,this)){this._disallowUnembed(t);return}}r.model.getConnectedLinks(n,{deep:!0}).forEach(i=>{i.reparent({ui:!0})})},_disallowUnembed:function(t){const{model:e,whenNotAllowed:n="revert"}=t,r=e||this.model,s=(t.paper||this.paper).model;switch(n){case"remove":{r.remove({ui:!0});break}case"revert":{const{initialParentId:o,initialPosition:l,initialZIndices:a}=t;if(l){const{x:u,y:h}=l;r.position(u,h,{deep:!0,ui:!0})}a&&Object.keys(a).forEach(u=>{const h=s.getCell(u);h&&h.set("z",a[u],{ui:!0})});const c=s.getCell(o);c&&c.embed(r,{ui:!0});break}}},getTargetParentView:function(t){const{candidateEmbedView:e=null}=this.eventData(t);return e},getDelegatedView:function(){for(var t=this,e=t.model,n=t.paper;t&&!e.isLink();){if(!e.isEmbedded()||t.can("stopDelegation"))return t;e=e.getParentCell(),t=n.findViewByModel(e)}return null},findProxyNode:function(t,e){t||(t=this.el);const n=t.getAttribute(`${e}-selector`);if(n){const r=this.findAttribute("port",t);if(r){const i=this.findPortNode(r,n);if(i)return i}else{const i=this.findNode(n);if(i)return i}}return t},notifyPointerdown(t,e,n){vt.prototype.pointerdown.call(this,t,e,n),this.notify("element:pointerdown",t,e,n)},notifyPointermove(t,e,n){vt.prototype.pointermove.call(this,t,e,n),this.notify("element:pointermove",t,e,n)},notifyPointerup(t,e,n){this.notify("element:pointerup",t,e,n),vt.prototype.pointerup.call(this,t,e,n)},pointerdblclick:function(t,e,n){vt.prototype.pointerdblclick.apply(this,arguments),this.notify("element:pointerdblclick",t,e,n)},pointerclick:function(t,e,n){vt.prototype.pointerclick.apply(this,arguments),this.notify("element:pointerclick",t,e,n)},contextmenu:function(t,e,n){vt.prototype.contextmenu.apply(this,arguments),this.notify("element:contextmenu",t,e,n)},pointerdown:function(t,e,n){this.notifyPointerdown(t,e,n),this.dragStart(t,e,n)},pointermove:function(t,e,n){const r=this.eventData(t),{targetMagnet:i,action:s,delegatedView:o}=r;switch(i&&this.magnetpointermove(t,i,e,n),s){case Wn.MAGNET:this.dragMagnet(t,e,n);break;case Wn.MOVE:(o||this).drag(t,e,n);default:if(r.preventPointerEvents)break;this.notifyPointermove(t,e,n);break}this.eventData(t,r)},pointerup:function(t,e,n){const r=this.eventData(t),{targetMagnet:i,action:s,delegatedView:o}=r;switch(i&&this.magnetpointerup(t,i,e,n),s){case Wn.MAGNET:this.dragMagnetEnd(t,e,n);break;case Wn.MOVE:(o||this).dragEnd(t,e,n);default:if(r.preventPointerEvents)break;this.notifyPointerup(t,e,n)}i&&this.magnetpointerclick(t,i,e,n),this.checkMouseleave(t)},mouseover:function(t){vt.prototype.mouseover.apply(this,arguments),this.notify("element:mouseover",t)},mouseout:function(t){vt.prototype.mouseout.apply(this,arguments),this.notify("element:mouseout",t)},mouseenter:function(t){vt.prototype.mouseenter.apply(this,arguments),this.notify("element:mouseenter",t)},mouseleave:function(t){vt.prototype.mouseleave.apply(this,arguments),this.notify("element:mouseleave",t)},mousewheel:function(t,e,n,r){vt.prototype.mousewheel.apply(this,arguments),this.notify("element:mousewheel",t,e,n,r)},onmagnet:function(t,e,n){const{currentTarget:r}=t;this.magnetpointerdown(t,r,e,n),this.eventData(t,{targetMagnet:r}),this.dragMagnetStart(t,e,n)},magnetpointerdown:function(t,e,n,r){this.notify("element:magnet:pointerdown",t,e,n,r)},magnetpointermove:function(t,e,n,r){this.notify("element:magnet:pointermove",t,e,n,r)},magnetpointerup:function(t,e,n,r){this.notify("element:magnet:pointerup",t,e,n,r)},magnetpointerdblclick:function(t,e,n,r){this.notify("element:magnet:pointerdblclick",t,e,n,r)},magnetcontextmenu:function(t,e,n,r){this.notify("element:magnet:contextmenu",t,e,n,r)},dragStart:function(t,e,n){if(this.isDefaultInteractionPrevented(t))return;var r=this.getDelegatedView();if(!r||!r.can("elementMove"))return;this.eventData(t,{action:Wn.MOVE,delegatedView:r});const i=r.model.position();r.eventData(t,{initialPosition:i,pointerOffset:i.difference(e,n),restrictedArea:this.paper.getRestrictedArea(r,e,n)})},dragMagnetStart:function(t,e,n){const{paper:r}=this,i=t.isPropagationStopped();if(i&&this.eventData(t,{preventPointerEvents:!0}),this.isDefaultInteractionPrevented(t)||!this.can("addLinkFromMagnet"))return;const{targetMagnet:s=t.currentTarget}=this.eventData(t);if(t.stopPropagation(),!r.options.validateMagnet.call(r,this,s,t)){i?this.dragStart(t,e,n):this.pointerdown(t,e,n);return}r.options.magnetThreshold<=0&&this.dragLinkStart(t,s,e,n),this.eventData(t,{action:Wn.MAGNET})},snapToGrid:function(t,e,n){const r=this.paper.options.gridSize;return{x:hn(e,r),y:hn(n,r)}},drag:function(t,e,n){var r=this.paper,i=this.model,s=this.eventData(t),{pointerOffset:o,restrictedArea:l,embedding:a}=s;const{x:c,y:u}=this.snapToGrid(t,e+o.x,n+o.y);i.position(c,u,{restrictedArea:l,deep:!0,ui:!0}),r.options.embeddingMode&&(a||(this.prepareEmbedding(s),a=!0),this.processEmbedding(s,t,e,n)),this.eventData(t,{embedding:a})},dragMagnet:function(t,e,n){this.dragLink(t,e,n)},dragEnd:function(t,e,n){var r=this.eventData(t);r.embedding&&this.finalizeEmbedding(r)},dragMagnetEnd:function(t,e,n){this.dragLinkEnd(t,e,n)},magnetpointerclick:function(t,e,n,r){var i=this.paper;i.eventData(t).mousemoved>i.options.clickThreshold||this.notify("element:magnet:pointerclick",t,e,n,r)}},{Flags:wt});j(Or.prototype,Km);const yt={TOOLS:vt.Flags.TOOLS,RENDER:"RENDER",UPDATE:"UPDATE",LABELS:"LABELS",SOURCE:"SOURCE",TARGET:"TARGET",CONNECTOR:"CONNECTOR"},ue=vt.extend({className:function(){var t=vt.prototype.className.apply(this).split(" ");return t.push("link"),t.join(" ")},_labelCache:null,_labelSelectors:null,_V:null,_sourceMagnet:null,_targetMagnet:null,_dragData:null,metrics:null,decimalsRounding:2,initialize:function(){vt.prototype.initialize.apply(this,arguments),this._labelCache={},this._labelSelectors={},this._V={},this.cleanNodesCache()},presentationAttributes:{markup:[yt.RENDER],attrs:[yt.UPDATE],router:[yt.UPDATE],connector:[yt.CONNECTOR],labels:[yt.LABELS,yt.TOOLS],labelMarkup:[yt.LABELS],vertices:[yt.UPDATE],source:[yt.SOURCE,yt.UPDATE],target:[yt.TARGET,yt.UPDATE]},initFlag:[yt.RENDER,yt.SOURCE,yt.TARGET,yt.TOOLS],UPDATE_PRIORITY:1,EPSILON:1e-6,confirmUpdate:function(t,e={}){const{paper:n,model:r}=this,{attributes:i}=r,{source:{id:s},target:{id:o}}=i;if(this.hasFlag(t,yt.SOURCE)&&(this._sourceMagnet=null,this.checkEndModel("source",s),t=this.removeFlag(t,yt.SOURCE)),this.hasFlag(t,yt.TARGET)&&(this._targetMagnet=null,this.checkEndModel("target",o),t=this.removeFlag(t,yt.TARGET)),n&&(s&&!n.isCellVisible(s)||o&&!n.isCellVisible(o)))return t;if(this.hasFlag(t,yt.RENDER))return this.render(),this.updateHighlighters(!0),this.updateTools(e),t=this.removeFlag(t,[yt.RENDER,yt.UPDATE,yt.LABELS,yt.TOOLS,yt.CONNECTOR]),Mo.test("isAppleWebKit")&&this.__fixWebKitBug268376(),t;let l=!1,a=this.hasFlag(t,yt.LABELS);a&&(this.onLabelsChange(r,i.labels,e),t=this.removeFlag(t,yt.LABELS),l=!0);const c=this.hasFlag(t,yt.UPDATE),u=this.hasFlag(t,yt.CONNECTOR);return(c||u)&&(c?e.translateBy&&r.isRelationshipEmbeddedIn(e.translateBy)?this.translate(e.tx,e.ty):this.update():(this.updatePath(),this.updateDOM()),this.updateTools(e),t=this.removeFlag(t,[yt.UPDATE,yt.TOOLS,yt.CONNECTOR]),a=!1,l=!0),a&&this.updateLabelPositions(),l&&this.updateHighlighters(),this.hasFlag(t,yt.TOOLS)&&(this.updateTools(e),t=this.removeFlag(t,yt.TOOLS)),t},__fixWebKitBug268376:function(){const{el:t}=this,e=Array.from(t.childNodes),n=document.createDocumentFragment();for(let r=0,i=e.length;r<i;r++)t.removeChild(e[r]),n.appendChild(e[r]);t.appendChild(n)},requestConnectionUpdate:function(t){this.requestUpdate(this.getFlag(yt.UPDATE),t)},isLabelsRenderRequired:function(t={}){const e=this.model.previous("labels");if(!e)return!0;if("propertyPathArray"in t&&"propertyValue"in t){var n=t.propertyPathArray||[],r=n.length;if(r>1){var i=!!e[n[1]];if(i){if(r===2)return"markup"in Object(t.propertyValue);if(n[2]!=="markup")return!1}}}return!0},onLabelsChange:function(t,e,n){this.isLabelsRenderRequired(n)?this.renderLabels():this.updateLabels()},render:function(){return this.vel.empty(),this.unmountLabels(),this._V={},this.renderMarkup(),this.renderLabels(),this.update(),this},renderMarkup:function(){var t=this.model,e=t.get("markup")||t.markup;if(!e)throw new Error("dia.LinkView: markup required");if(Array.isArray(e))return this.renderJSONMarkup(e);if(typeof e=="string")return this.renderStringMarkup(e);throw new Error("dia.LinkView: invalid markup")},renderJSONMarkup:function(t){var e=this.parseDOMJSON(t,this.el);this.selectors=e.selectors,this.vel.append(e.fragment)},renderStringMarkup:function(t){var e=N(t);Array.isArray(e)||(e=[e]),this.vel.append(e)},_getLabelMarkup:function(t){if(t){if(Array.isArray(t))return this.parseDOMJSON(t,null);if(typeof t=="string")return this._getLabelStringMarkup(t);throw new Error("dia.linkView: invalid label markup")}},_getLabelStringMarkup:function(t){var e=N(t),n=document.createDocumentFragment();if(!Array.isArray(e))n.appendChild(e.node);else for(var r=0,i=e.length;r<i;r++){var s=e[r].node;n.appendChild(s)}return{fragment:n,selectors:{}}},_normalizeLabelMarkup:function(t){if(t){var e=t.fragment;if(!(t.fragment instanceof DocumentFragment)||!t.fragment.hasChildNodes())throw new Error("dia.LinkView: invalid label markup.");var n,r=e.childNodes;return r.length>1||r[0].nodeName.toUpperCase()!=="G"?n=N("g").append(e):n=N(r[0]),n.addClass("label"),{node:n.node,selectors:t.selectors}}},renderLabels:function(){var t=this._V,e=t.labels,n=this._labelCache={},r=this._labelSelectors={},i=this.model,s=i.attributes.labels||[],o=s.length;if(o===0)return e&&e.remove(),this;e?e.empty():(e=t.labels=N("g").addClass("labels"),this.options.labelsLayer&&(e.addClass(me(Ct(this,"className"))),e.attr("model-id",i.id)));for(var l=0;l<o;l++){var a=s[l],c=this._normalizeLabelMarkup(this._getLabelMarkup(a.markup)),u,h;if(c)u=c.node,h=c.selectors;else{var g=i._builtins.defaultLabel,d=this._normalizeLabelMarkup(this._getLabelMarkup(g.markup)),v=i._getDefaultLabel(),y=this._normalizeLabelMarkup(this._getLabelMarkup(v.markup)),x=y||d;u=x.node,h=x.selectors}u.setAttribute("label-idx",l),e.append(u),n[l]=u;var A=this.selector;if(h[A])throw new Error("dia.LinkView: ambiguous label root selector.");h[A]=u,r[l]=h}return e.parent()||this.mountLabels(),this.updateLabels(),this},mountLabels:function(){const{el:t,paper:e,model:n,_V:r,options:i}=this,{labels:s}=r;if(!s||!n.hasLabels())return;const{node:o}=s;i.labelsLayer?e.getLayerView(i.labelsLayer).insertSortedNode(o,n.get("z")):o.parentNode!==t&&t.appendChild(o)},unmountLabels:function(){const{options:t,_V:e}=this;if(!e)return;const{labels:n}=e;n&&t.labelsLayer&&n.remove()},findLabelNodes:function(t,e){const n=this._labelCache[t];if(!n)return[];const r=this._labelSelectors[t];return this.findBySelector(e,n,r)},findLabelNode:function(t,e){const[n=null]=this.findLabelNodes(t,e);return n},_mergeLabelAttrs:function(t,e,n,r){return e===null?null:e===void 0?n===null?null:n===void 0?t?void 0:r:t?n:Nt({},r,n):t?Nt({},n,e):Nt({},r,n,e)},_mergeLabelSize:function(t,e){return t===null?null:t===void 0?e===null?null:e===void 0?void 0:e:Nt({},e,t)},updateLabels:function(){if(!this._V.labels)return this;this.paper.options.labelLayer||this.cleanNodeCache(this.el);for(var t=this.model,e=t.get("labels")||[],n=this.can("labelMove"),r=t._builtins.defaultLabel,i=r.attrs,s=t._getDefaultLabel(),o=s.markup,l=s.attrs,a=s.size,c=0,u=e.length;c<u;c++){var h=this._labelCache[c];h.setAttribute("cursor",n?"move":"default");var g=this._labelSelectors[c],d=e[c],v=d.markup,y=d.attrs,x=d.size,A=this._mergeLabelAttrs(v||o,y,l,i),T=this._mergeLabelSize(x,a);this.updateDOMSubtreeAttributes(h,A,{rootBBox:new U(T),selectors:g})}return this},removeRedundantLinearVertices:function(t){const n=this.model,r=n.vertices(),i=[this.sourceAnchor,...r,this.targetAnchor],s=i.length,o=new Lt(i);o.simplify({threshold:.001});const l=o.points.map(c=>c.toJSON()),a=l.length;return s===a?0:(n.vertices(l.slice(1,a-1),t),s-a)},getEndView:function(t){switch(t){case"source":return this.sourceView||null;case"target":return this.targetView||null;default:throw new Error("dia.LinkView: type parameter required.")}},getEndAnchor:function(t){switch(t){case"source":return new S(this.sourceAnchor);case"target":return new S(this.targetAnchor);default:throw new Error("dia.LinkView: type parameter required.")}},getEndConnectionPoint:function(t){switch(t){case"source":return new S(this.sourcePoint);case"target":return new S(this.targetPoint);default:throw new Error("dia.LinkView: type parameter required.")}},getEndMagnet:function(t){switch(t){case"source":var e=this.sourceView;if(!e)break;return this.sourceMagnet||e.el;case"target":var n=this.targetView;if(!n)break;return this.targetMagnet||n.el;default:throw new Error("dia.LinkView: type parameter required.")}return null},update:function(){return this.updateRoute(),this.updatePath(),this.updateDOM(),this},translate:function(t=0,e=0){const{route:n,path:r}=this;if(!n||!r)return;const i=new Lt(n);i.translate(t,e),this.route=i.points,this.sourcePoint.offset(t,e),this.targetPoint.offset(t,e),this.sourceAnchor.offset(t,e),this.targetAnchor.offset(t,e),r.translate(t,e),this.updateDOM()},updateDOM(){const{el:t,model:e,selectors:n}=this;this.cleanNodesCache(),this.updateDOMSubtreeAttributes(t,e.attr(),{selectors:n}),this.updateLabelPositions(),this.options.perpendicular=null},updateRoute:function(){const{model:t}=this,e=t.vertices(),n=this.findAnchors(e),r=this.sourceAnchor=n.source,i=this.targetAnchor=n.target,s=this.findRoute(e);this.route=s;var o=this.findConnectionPoints(s,r,i);this.sourcePoint=o.source,this.targetPoint=o.target},updatePath:function(){const{route:t,sourcePoint:e,targetPoint:n}=this,r=this.findPath(t,e.clone(),n.clone());this.path=r},findAnchorsOrdered:function(t,e,n,r){var i,s,o,l,a=this.model,c=a.get(t),u=a.get(n),h=this.getEndView(t),g=this.getEndView(n),d=this.getEndMagnet(t),v=this.getEndMagnet(n);h?(e?o=new S(e):g?o=v:o=new S(u),i=this.getAnchor(c.anchor,h,d,o,t)):i=new S(c),g?(l=new S(r||i),s=this.getAnchor(u.anchor,g,v,l,n)):s=new S(u);var y={};return y[t]=i,y[n]=s,y},findAnchors:function(t){var e=this.model,n=t[0],r=t[t.length-1];return e.target().priority&&!e.source().priority?this.findAnchorsOrdered("target",r,"source",n):this.findAnchorsOrdered("source",n,"target",r)},findConnectionPoints:function(t,e,n){var r=t[0],i=t[t.length-1],s=this.model,o=s.get("source"),l=s.get("target"),a=this.sourceView,c=this.targetView,u=this.paper.options,h,g,d;if(a&&!a.isNodeConnection(this.sourceMagnet)){h=this.sourceMagnet||a.el;var v=o.connectionPoint||u.defaultConnectionPoint,y=r||n,x=new W(y,e);d=this.getConnectionPoint(v,a,h,x,"source")}else d=e;var A;if(c&&!c.isNodeConnection(this.targetMagnet)){g=this.targetMagnet||c.el;var T=l.connectionPoint||u.defaultConnectionPoint,f=i||e,p=new W(f,n);A=this.getConnectionPoint(T,c,g,p,"target")}else A=n;return{source:d,target:A}},getAnchor:function(t,e,n,r,i){var s=e.isNodeConnection(n),o=this.paper.options;if(t||(s?t=o.defaultLinkAnchor:this.options.perpendicular?t={name:"perpendicular"}:t=o.defaultAnchor),!t)throw new Error("Anchor required.");var l;if(typeof t=="function")l=t;else{var a=t.name,c=s?"linkAnchorNamespace":"anchorNamespace";if(l=o[c][a],typeof l!="function")throw new Error("Unknown anchor: "+a)}var u=l.call(this,e,n,r,t.args||{},i,this);return u?u.round(this.decimalsRounding):new S},getConnectionPoint:function(t,e,n,r,i){var s,o=r.end,l=this.paper.options;if(!t)return o;var a;if(typeof t=="function")a=t;else{var c=t.name;if(a=l.connectionPointNamespace[c],typeof a!="function")throw new Error("Unknown connection point: "+c)}return s=a.call(this,r,e,n,t.args||{},i,this),s?s.round(this.decimalsRounding):o},isIntersecting:function(t,e){const n=this.getConnection();return n?vn.exists(t,n,e,{segmentSubdivisions:this.getConnectionSubdivisions()}):!1},isEnclosedIn:function(t){const e=this.getConnection();if(!e)return!1;const n=e.bbox();return n?t.containsRect(n):!1},isAtPoint:function(t){const e=new U(t);return e.inflate(this.EPSILON),this.isIntersecting(e)},_getDefaultLabelPositionProperty:function(){var t=this.model,e=t._builtins.defaultLabel,n=e.position,r=t._getDefaultLabel(),i=this._normalizeLabelPosition(r.position);return Nt({},n,i)},_normalizeLabelPosition:function(t){return typeof t=="number"?{distance:t,offset:null,angle:0,args:null}:t},_mergeLabelPositionProperty:function(t,e){return t===null?null:t===void 0?e===null?null:e:Nt({},e,t)},updateLabelPositions:function(){if(!this._V.labels)return this;var t=this.path;if(!t)return this;var e=this.model,n=e.get("labels")||[];if(!n.length)return this;for(var r=this._getDefaultLabelPositionProperty(),i=0,s=n.length;i<s;i++){var o=this._labelCache[i];if(o){var l=n[i],a=this._normalizeLabelPosition(l.position),c=this._mergeLabelPositionProperty(a,r),u=this._getLabelTransformationMatrix(c);o.setAttribute("transform",N.matrixToTransformString(u)),this._cleanLabelMatrices(i)}}return this},_cleanLabelMatrices:function(t){const{metrics:e,_labelSelectors:n}=this,r=n[t];if(r)for(let i in r){const{id:s}=r[i];s&&s in e&&delete e[s].magnetMatrix}},checkEndModel:function(t,e){if(!e)return;if(!this.paper.getModelById(e))throw new Error(`LinkView: invalid ${t} cell.`)},_getLabelPositionProperty:function(t){return this.model.label(t).position||{}},_getLabelPositionAngle:function(t){var e=this._getLabelPositionProperty(t);return e.angle||0},_getLabelPositionArgs:function(t){var e=this._getLabelPositionProperty(t);return e.args},_getDefaultLabelPositionArgs:function(){var t=this.model._getDefaultLabel(),e=t.position||{};return e.args},_mergeLabelPositionArgs:function(t,e){return t===null?null:t===void 0?e===null?null:e:Nt({},e,t)},addLabel:function(t,e,n,r){var i,s,o=0,l;typeof t!="number"?(i=t.x,s=t.y,typeof e=="number"?(o=e,l=n):l=e):(i=t,s=e,typeof n=="number"?(o=n,l=r):l=n);var a=this._getDefaultLabelPositionArgs(),c=l,u=this._mergeLabelPositionArgs(c,a),h={position:this.getLabelPosition(i,s,o,u)},g=-1;return this.model.insertLabel(g,h,l),g},addVertex:function(t,e,n){var r=typeof t!="number",i=r?t.x:t,s=r?t.y:e,o=r?e:n,l={x:i,y:s},a=this.getVertexIndex(i,s);return this.model.insertVertex(a,l,o),a},sendToken:function(t,e,n){function r(h,g){return function(){h.remove(),typeof g=="function"&&g()}}var i,s,o;gt(e)?(i=e.duration,s=e.direction==="reverse",o=e.connection):(i=e,s=!1,o=null),i=i||1e3;var l={dur:i+"ms",repeatCount:1,calcMode:"linear",fill:"freeze"};s&&(l.keyPoints="1;0",l.keyTimes="0;1");var a=N(t),c;if(typeof o=="string")c=this.findNode(o);else{var u=this._V;c=u.connection?u.connection.node:this.el.querySelector("path")}if(!(c instanceof SVGPathElement))throw new Error("dia.LinkView: token animation requires a valid connection path.");a.appendTo(this.paper.cells).animateAlongPath(l,c),setTimeout(r(a,n),i)},findRoute:function(t){t||(t=[]);var e=this.paper.options.routerNamespace||Uh,n=this.model.router(),r=this.paper.options.defaultRouter;if(!n)if(r)n=r;else return t.map(S);var i=bt(n)?n:e[n.name];if(!bt(i))throw new Error('dia.LinkView: unknown router: "'+n.name+'".');var s=n.args||{},o=i.call(this,t,s,this);return o||t.map(S)},findPath:function(t,e,n){var r=this.paper.options.connectorNamespace||uh,i=this.model.connector(),s=this.paper.options.defaultConnector;i||(i=s||{});var o=bt(i)?i:r[i.name];if(!bt(o))throw new Error('dia.LinkView: unknown connector: "'+i.name+'".');var l=kt(i.args||{});l.raw=!0;var a=o.call(this,e,n,t,l,this);return typeof a=="string"&&(a=new Z(N.normalizePathData(a))),a},getConnection:function(){var t=this.path;return t?t.clone():null},getSerializedConnection:function(){var t=this.path;if(!t)return null;var e=this.metrics;if(e.hasOwnProperty("data"))return e.data;var n=t.serialize();return e.data=n,n},getConnectionSubdivisions:function(){var t=this.path;if(!t)return null;var e=this.metrics;if(e.hasOwnProperty("segmentSubdivisions"))return e.segmentSubdivisions;var n=t.getSegmentSubdivisions();return e.segmentSubdivisions=n,n},getConnectionLength:function(){var t=this.path;if(!t)return 0;var e=this.metrics;if(e.hasOwnProperty("length"))return e.length;var n=t.length({segmentSubdivisions:this.getConnectionSubdivisions()});return e.length=n,n},getPointAtLength:function(t){var e=this.path;return e?e.pointAtLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getPointAtRatio:function(t){var e=this.path;return e?(Ut(t)&&(t=parseFloat(t)/100),e.pointAt(t,{segmentSubdivisions:this.getConnectionSubdivisions()})):null},getTangentAtLength:function(t){var e=this.path;return e?e.tangentAtLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getTangentAtRatio:function(t){var e=this.path;return e?e.tangentAt(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getClosestPoint:function(t){var e=this.path;return e?e.closestPoint(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getClosestPointLength:function(t){var e=this.path;return e?e.closestPointLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getClosestPointRatio:function(t){var e=this.path;return e?e.closestPointNormalizedLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()}):null},getLabelPosition:function(t,e,n,r){var i={},s=0,o;typeof n=="number"?(s=n,o=r):o=n,o&&(i.args=o);var l=!(o&&o.absoluteDistance),a=o&&o.absoluteDistance&&o.reverseDistance,c=o&&o.absoluteOffset,u=this.path,h={segmentSubdivisions:this.getConnectionSubdivisions()},g=new S(t,e),d=u.closestPointT(g,h),v=u.lengthAtT(d,h);l&&(v=v/this.getConnectionLength()||0),a&&(v=-1*(this.getConnectionLength()-v)||1),i.distance=v;var y;c||(y=u.tangentAtT(d));var x;if(y)x=y.pointOffset(g);else{var A=u.pointAtT(d),T=g.difference(A);x={x:T.x,y:T.y}}return i.offset=x,i.angle=s,i},_getLabelTransformationMatrix:function(t){var e,n=0,r={};if(typeof t=="number")e=t;else if(typeof t.distance=="number")r=t.args||{},e=t.distance,n=t.angle||0;else throw new Error("dia.LinkView: invalid label position distance.");var i=e>0&&e<=1,s=0,o={x:0,y:0};if(t.offset){var l=t.offset;typeof l=="number"&&(s=l),l.x&&(o.x=l.x),l.y&&(o.y=l.y)}var a=o.x!==0||o.y!==0||s===0,c=r.keepGradient,u=r.ensureLegibility,h=this.path,g={segmentSubdivisions:this.getConnectionSubdivisions()},d=i?e*this.getConnectionLength():e,v=h.tangentAtLength(d,g),y,x=n;if(v){if(a)y=v.start.clone(),y.offset(o);else{var A=v.clone();A.rotate(v.start,-90),A.setLength(s),y=A.end}c&&(x=v.angle()+n,u&&(x=de((x+90)%180-90)))}else y=h.start.clone(),a&&y.offset(o);return N.createSVGMatrix().translate(y.x,y.y).rotate(x)},getLabelCoordinates:function(t){var e=this._getLabelTransformationMatrix(t);return new S(e.e,e.f)},getVertexIndex:function(t,e){for(var n=this.model,r=n.vertices(),i=this.getClosestPointLength(new S(t,e)),s=0,o=r.length;s<o;s++){var l=r[s],a=this.getClosestPointLength(l);if(i<a)break}return s},notifyPointerdown(t,e,n){vt.prototype.pointerdown.call(this,t,e,n),this.notify("link:pointerdown",t,e,n)},notifyPointermove(t,e,n){vt.prototype.pointermove.call(this,t,e,n),this.notify("link:pointermove",t,e,n)},notifyPointerup(t,e,n){this.notify("link:pointerup",t,e,n),vt.prototype.pointerup.call(this,t,e,n)},pointerdblclick:function(t,e,n){vt.prototype.pointerdblclick.apply(this,arguments),this.notify("link:pointerdblclick",t,e,n)},pointerclick:function(t,e,n){vt.prototype.pointerclick.apply(this,arguments),this.notify("link:pointerclick",t,e,n)},contextmenu:function(t,e,n){vt.prototype.contextmenu.apply(this,arguments),this.notify("link:contextmenu",t,e,n)},pointerdown:function(t,e,n){this.notifyPointerdown(t,e,n),this.dragStart(t,e,n)},pointermove:function(t,e,n){var r=this._dragData;r&&this.eventData(t,r);var i=this.eventData(t);switch(i.action){case"label-move":this.dragLabel(t,e,n);break;case"arrowhead-move":this.dragArrowhead(t,e,n);break;case"move":this.drag(t,e,n);break}r&&j(r,this.eventData(t)),this.notifyPointermove(t,e,n)},pointerup:function(t,e,n){var r=this._dragData;r&&(this.eventData(t,r),this._dragData=null);var i=this.eventData(t);switch(i.action){case"label-move":this.dragLabelEnd(t,e,n);break;case"arrowhead-move":this.dragArrowheadEnd(t,e,n);break;case"move":this.dragEnd(t,e,n)}this.notifyPointerup(t,e,n),this.checkMouseleave(t)},mouseover:function(t){vt.prototype.mouseover.apply(this,arguments),this.notify("link:mouseover",t)},mouseout:function(t){vt.prototype.mouseout.apply(this,arguments),this.notify("link:mouseout",t)},mouseenter:function(t){vt.prototype.mouseenter.apply(this,arguments),this.notify("link:mouseenter",t)},mouseleave:function(t){vt.prototype.mouseleave.apply(this,arguments),this.notify("link:mouseleave",t)},mousewheel:function(t,e,n,r){vt.prototype.mousewheel.apply(this,arguments),this.notify("link:mousewheel",t,e,n,r)},onlabel:function(t,e,n){this.notifyPointerdown(t,e,n),this.dragLabelStart(t,e,n);var r=this.eventData(t).stopPropagation;r&&t.stopPropagation()},dragLabelStart:function(t,e,n){if(this.can("labelMove")){if(this.isDefaultInteractionPrevented(t))return;var r=t.currentTarget,i=parseInt(r.getAttribute("label-idx"),10),s=this._getDefaultLabelPositionProperty(),o=this._normalizeLabelPosition(this._getLabelPositionProperty(i)),l=this._mergeLabelPositionProperty(o,s),a=this.getLabelCoordinates(l),c=a.x-e,u=a.y-n,h=this._getLabelPositionAngle(i),g=this._getLabelPositionArgs(i),d=this._getDefaultLabelPositionArgs(),v=this._mergeLabelPositionArgs(g,d);this.eventData(t,{action:"label-move",labelIdx:i,dx:c,dy:u,positionAngle:h,positionArgs:v,stopPropagation:!0})}else this.eventData(t,{stopPropagation:!0});this.paper.delegateDragEvents(this,t.data)},dragArrowheadStart:function(t,e,n){if(this.can("arrowheadMove")){var r=t.target,i=r.getAttribute("end"),s=this.startArrowheadMove(i,{ignoreBackwardsCompatibility:!0});this.eventData(t,s)}},dragStart:function(t,e,n){this.isDefaultInteractionPrevented(t)||this.can("linkMove")&&this.eventData(t,{action:"move",dx:e,dy:n})},dragLabel:function(t,e,n){var r=this.eventData(t),i={position:this.getLabelPosition(e+r.dx,n+r.dy,r.positionAngle,r.positionArgs)};this.paper.options.snapLabels&&delete i.position.offset;const s={ui:!0};this.paper.isAsync()&&t.type==="touchmove"&&(s.async=!1),this.model.label(r.labelIdx,i,s)},dragArrowhead:function(t,e,n){this.paper.options.snapLinks?!this._snapArrowhead(t,e,n)&&this.paper.options.snapLinksSelf&&this._snapArrowheadSelf(t,e,n):this.paper.options.snapLinksSelf?this._snapArrowheadSelf(t,e,n):this._connectArrowhead(this.getEventTarget(t),e,n,this.eventData(t))},drag:function(t,e,n){var r=this.eventData(t);this.model.translate(e-r.dx,n-r.dy,{ui:!0}),this.eventData(t,{dx:e,dy:n})},dragLabelEnd:function(){},dragArrowheadEnd:function(t,e,n){var r=this.eventData(t),i=this.paper;i.options.snapLinks?this._snapArrowheadEnd(r):this._connectArrowheadEnd(r,e,n),i.linkAllowed(this)?(this._finishEmbedding(r),this._notifyConnectEvent(r,t)):this._disallow(r),this._afterArrowheadMove(r)},dragEnd:function(){},_disallow:function(t){switch(t.whenNotAllowed){case"remove":this.model.remove({ui:!0});break;case"revert":default:this.model.set(t.arrowhead,t.initialEnd,{ui:!0});break}},_finishEmbedding:function(t){this.paper.options.embeddingMode&&this.model.reparent()&&(t.z=null)},_notifyConnectEvent:function(t,e){var n=t.arrowhead,r=t.initialEnd,i=this.model.prop(n),s=i&&!Pr.endsEqual(r,i);if(s){var o=this.paper;r.id&&this.notify("link:disconnect",e,o.findViewByModel(r.id),t.initialMagnet,n),i.id&&this.notify("link:connect",e,o.findViewByModel(i.id),t.magnetUnderPointer,n)}},_snapToPoints:function(t,e,n){let r=null,i=1/0,s=null,o=1/0,l=t.x,a=t.y;for(let c=0;c<e.length;c++){const u=Math.abs(e[c].x-t.x);u<i&&(i=u,r=e[c]);const h=Math.abs(e[c].y-t.y);h<o&&(o=h,s=e[c])}return i<n&&(l=r.x),o<n&&(a=s.y),{x:l,y:a}},_snapArrowheadSelf:function(t,e,n){const{paper:r,model:i}=this,{snapLinksSelf:s}=r.options,o=this.eventData(t),l=s.radius||20,a=this.getEndAnchor(o.arrowhead==="source"?"target":"source"),c=i.vertices(),u=[a,...c],h=this._snapToPoints({x:e,y:n},u,l),g=r.localToClientPoint(h);this._connectArrowhead(document.elementFromPoint(g.x,g.y),h.x,h.y,this.eventData(t))},_snapArrowhead:function(t,e,n){const{paper:r}=this,{snapLinks:i,connectionStrategy:s}=r.options,o=this.eventData(t);let l=!1;const a=i.radius||50,c=i.findInAreaOptions,u=o.closestView||null,h=o.closestMagnet||null,g=o.magnetProxy||null;o.closestView=o.closestMagnet=o.magnetProxy=null;const d=(m,w)=>m===this?!1:h===w||r.options.validateConnection.apply(r,o.validateConnectionArgs(m,m.el===w?null:w)),v=r.findClosestMagnetToPoint({x:e,y:n},{radius:a,findInAreaOptions:c,filter:d});o.closestView=v?v.view:null,o.closestMagnet=v?v.magnet:null;var y,x=null,A=o.closestView,T=o.closestMagnet;T&&(x=o.magnetProxy=A.findProxyNode(T,"highlighter"));var f=o.arrowhead,p=h!==T;if(u&&p&&u.unhighlight(g,{connecting:!0,snapping:!0}),A){const{prevEnd:m,prevX:w,prevY:b}=o;if(o.prevX=e,o.prevY=n,l=!0,!p&&(typeof s!="function"||w===e&&b===n)||(y=A.getLinkEnd(T,e,n,this.model,f),!p&&Re(m,y)))return l;o.prevEnd=y,p&&A.highlight(x,{connecting:!0,snapping:!0})}else y={x:e,y:n};return this.model.set(f,y||{x:e,y:n},{ui:!0}),u&&this.notify("link:snap:disconnect",t,u,h,f),A&&this.notify("link:snap:connect",t,A,T,f),l},_snapArrowheadEnd:function(t){var e=t.closestView,n=t.closestMagnet;e&&n&&(e.unhighlight(t.magnetProxy,{connecting:!0,snapping:!0}),t.magnetUnderPointer=e.findMagnet(n)),t.closestView=t.closestMagnet=null},_connectArrowhead:function(t,e,n,r){const{paper:i,model:s}=this;if(r.eventTarget!==t){r.magnetProxy&&r.viewUnderPointer.unhighlight(r.magnetProxy,{connecting:!0});const o=r.viewUnderPointer=i.findView(t);if(o){const l=r.magnetUnderPointer=o.findMagnet(t),a=r.magnetProxy=o.findProxyNode(l,"highlighter");l&&this.paper.options.validateConnection.apply(i,r.validateConnectionArgs(o,l))?a&&o.highlight(a,{connecting:!0}):(r.magnetUnderPointer=null,r.magnetProxy=null)}else r.magnetUnderPointer=null,r.magnetProxy=null}r.eventTarget=t,s.set(r.arrowhead,{x:e,y:n},{ui:!0})},_connectArrowheadEnd:function(t={},e,n){const{model:r}=this,{viewUnderPointer:i,magnetUnderPointer:s,magnetProxy:o,arrowhead:l}=t;if(!s||!o||!i)return;i.unhighlight(o,{connecting:!0});const a=i.getLinkEnd(s,e,n,r,l);r.set(l,a,{ui:!0})},_beforeArrowheadMove:function(t){t.z=this.model.get("z"),this.model.toFront();var e=this.el.style;t.pointerEvents=e.pointerEvents,e.pointerEvents="none",this.paper.options.markAvailable&&this._markAvailableMagnets(t)},_afterArrowheadMove:function(t){t.z!==null&&(this.model.set("z",t.z,{ui:!0}),t.z=null),this.el.style.pointerEvents=t.pointerEvents,this.paper.options.markAvailable&&this._unmarkAvailableMagnets(t)},_createValidateConnectionArgs:function(t){var e=[];e[4]=t,e[5]=this;var n,r=0,i=0;t==="source"?(r=2,n="target"):(i=2,n="source");var s=this.model.get(n);if(s.id){var o=e[r]=this.paper.findViewByModel(s.id),l=o.getMagnetFromLinkEnd(s);l===o.el&&(l=void 0),e[r+1]=l}function a(c,u){return e[i]=c,e[i+1]=c.el===u?void 0:u,e}return a},_markAvailableMagnets:function(t){function e(h,g){var d=h.paper,v=d.options.validateConnection;return v.apply(d,this.validateConnectionArgs(h,g))}var n=this.paper,r=n.model.getCells();t.marked={};for(var i=0,s=r.length;i<s;i++){var o=r[i].findView(n);if(o){var l=Array.prototype.slice.call(o.el.querySelectorAll("[magnet]"));o.el.getAttribute("magnet")!=="false"&&l.push(o.el);var a=l.filter(e.bind(t,o));if(a.length>0){for(var c=0,u=a.length;c<u;c++)o.highlight(a[c],{magnetAvailability:!0});o.highlight(null,{elementAvailability:!0}),t.marked[o.model.id]=a}}}},_unmarkAvailableMagnets:function(t){for(var e=Object.keys(t.marked),n,r,i=0,s=e.length;i<s;i++){n=e[i],r=t.marked[n];var o=this.paper.findViewByModel(n);if(o){for(var l=0,a=r.length;l<a;l++)o.unhighlight(r[l],{magnetAvailability:!0});o.unhighlight(null,{elementAvailability:!0})}}t.marked=null},startArrowheadMove:function(t,e){e||(e={});var n={action:"arrowhead-move",arrowhead:t,whenNotAllowed:e.whenNotAllowed||"revert",initialMagnet:this[t+"Magnet"]||(this[t+"View"]?this[t+"View"].el:null),initialEnd:kt(this.model.get(t)),validateConnectionArgs:this._createValidateConnectionArgs(t)};return this._beforeArrowheadMove(n),e.ignoreBackwardsCompatibility!==!0&&(this._dragData=n),n},onMount:function(){vt.prototype.onMount.apply(this,arguments),this.mountLabels()},onDetach:function(){vt.prototype.onDetach.apply(this,arguments),this.unmountLabels()},onRemove:function(){vt.prototype.onRemove.apply(this,arguments),this.unmountLabels()}},{Flags:yt});Object.defineProperty(ue.prototype,"sourceView",{enumerable:!0,get:function(){const t=this.model.attributes.source;return t.id&&this.paper?this.paper.findViewByModel(t.id):null}}),Object.defineProperty(ue.prototype,"targetView",{enumerable:!0,get:function(){const t=this.model.attributes.target;return t.id&&this.paper?this.paper.findViewByModel(t.id):null}}),Object.defineProperty(ue.prototype,"sourceMagnet",{enumerable:!0,get:function(){const t=this.sourceView;if(!t)return null;let e=null;const n=this._sourceMagnet;return n&&t.el.contains(n)?e=n:e=t.getMagnetFromLinkEnd(this.model.attributes.source),this._sourceMagnet=e,e===t.el?null:e}}),Object.defineProperty(ue.prototype,"targetMagnet",{enumerable:!0,get:function(){const t=this.targetView;if(!t)return null;let e=null;const n=this._targetMagnet;return n&&t.el.contains(n)?e=n:e=t.getMagnetFromLinkEnd(this.model.attributes.target),this._targetMagnet=e,e===t.el?null:e}}),Object.defineProperty(ue.prototype,"sourceBBox",{enumerable:!0,get:function(){var t=this.sourceView;if(!t){var e=this.model.source();return new U(e.x,e.y)}var n=this.sourceMagnet;return t.isNodeConnection(n)?new U(this.sourceAnchor):t.getNodeBBox(n||t.el)}}),Object.defineProperty(ue.prototype,"targetBBox",{enumerable:!0,get:function(){var t=this.targetView;if(!t){var e=this.model.target();return new U(e.x,e.y)}var n=this.targetMagnet;return t.isNodeConnection(n)?new U(this.targetAnchor):t.getNodeBBox(n||t.el)}});const Ge=le.extend({tagName:"g",svgElement:!0,pivotNodes:null,defaultTheme:null,UPDATE_PRIORITY:4,options:{id:""},paper:null,init:function(){this.pivotNodes={},this.id=this.options.id||this.cid},setPaperReference:function(t){this.paper=t,this.afterPaperReferenceSet(t)},unsetPaperReference:function(){this.paper&&(this.beforePaperReferenceUnset(this.paper),this.paper=null)},assertPaperReference(){if(!this.paper)throw new Error("LayerView: paper reference is not set.")},afterPaperReferenceSet:function(){},beforePaperReferenceUnset:function(){},_setAttributes:function(t){const e=kt(t);delete e.id,le.prototype._setAttributes.call(this,e)},className:function(){const{id:t}=this.options;return me(`${t}-layer`)},insertSortedNode:function(t,e){this.el.insertBefore(t,this.insertPivot(e))},insertNode:function(t){const{el:e}=this;t.parentNode!==e&&e.appendChild(t)},insertPivot:function(t){const{el:e,pivotNodes:n}=this;t=+t,t||(t=0);let r=n[t];if(r)return r;r=n[t]=document.createComment("z-index:"+(t+1));let i=-1/0;for(let s in n)s=+s,s<t&&s>i&&(i=s,t-1);if(i!==-1/0){const s=n[i];e.insertBefore(r,s.nextSibling)}else e.insertBefore(r,e.firstChild);return r},removePivots:function(){const{el:t,pivotNodes:e}=this;for(let n in e)t.removeChild(e[n]);this.pivotNodes={}},isEmpty:function(){return this.el.children.length===0},reset:function(){this.removePivots()}});Object.defineProperty(Ge.prototype,Vu,{value:!0});const Nr=Ge.extend({SORT_DELAYING_BATCHES:["add","to-front","to-back"],style:{webkitUserSelect:"none",userSelect:"none"},graph:null,init(){Ge.prototype.init.apply(this,arguments),this.graph=this.model.graph},className:function(){const{id:t}=this.options;return[me(`${t}-layer`),me("cells")].join(" ")},afterPaperReferenceSet(t){this.listenTo(this.model,"sort",this.onCellCollectionSort),this.listenTo(this.model,"change",this.onCellChange),this.listenTo(this.model,"move",this.onCellMove),this.listenTo(this.graph,"batch:stop",this.onGraphBatchStop)},beforePaperReferenceUnset(){this.stopListening(this.model),this.stopListening(this.graph)},onCellCollectionSort(){this.graph.hasActiveBatch(this.SORT_DELAYING_BATCHES)||this.sort()},onCellMove(t,e={}){this.paper.requestCellViewInsertion(t,e)},onCellChange(t,e){t.hasChanged("z")&&this.paper.options.sorting===Sn.APPROX&&this.paper.requestCellViewInsertion(t,e)},onGraphBatchStop(t){const e=t&&t.batchName,n=this.SORT_DELAYING_BATCHES;n.includes(e)&&!this.graph.hasActiveBatch(n)&&this.sort()},sort(){this.assertPaperReference();const{paper:t}=this;if(t.isExactSorting()){if(t.isFrozen()){t._updates.sort=!0;return}this.sortExact()}},sortExact(){const t=Array.from(this.el.children).filter(n=>n.getAttribute("model-id")),e=this.model.cellCollection;hu(t,function(n,r){const i=e.get(n.getAttribute("model-id")),s=e.get(r.getAttribute("model-id")),o=i.attributes.z||0,l=s.attributes.z||0;return o===l?0:o<l?-1:1})},insertCellView(t){this.assertPaperReference();const{paper:e}=this,{el:n,model:r}=t;switch(e.options.sorting){case Sn.APPROX:this.insertSortedNode(n,r.get("z"));break;case Sn.EXACT:default:this.insertNode(n);break}}});Object.defineProperty(Nr.prototype,Eo,{value:!0});const m0=Nr.extend({className:function(){return Nr.prototype.className.apply(this,arguments)+" "+me("viewport")}});class Zh{constructor(){this.head=null,this.tail=null,this.map=new Map}keys(){let e=this.head;const n=[];for(;e;)n.push(e.key),e=e.next;return n}popHead(){if(!this.head)return null;const e=this.head;return this.map.delete(e.key),this.head=e.next,this.head?this.head.prev=null:this.tail=null,e}pushTail(e,n){if(this.map.has(e))throw new Error(`Key "${e}" already exists in the deque.`);const r={key:e,value:n,prev:null,next:null};this.map.set(e,r),this.tail?(this.tail.next=r,r.prev=this.tail,this.tail=r):this.head=this.tail=r}moveToHead(e){const n=this.map.get(e);n&&n!==this.head&&(n.prev&&(n.prev.next=n.next),n.next&&(n.next.prev=n.prev),n===this.tail&&(this.tail=n.prev),n===this.head&&(this.head=n.next),n.prev=null,n.next=this.head,this.head&&(this.head.prev=n),this.head=n,this.tail||(this.tail=n))}peekHead(){return this.head||null}rotate(){!this.head||!this.head.next||(this.tail.next=this.head,this.head.prev=this.tail,this.tail=this.head,this.head=this.head.next,this.tail.next=null,this.head.prev=null)}delete(e){const n=this.map.get(e);n&&(n.prev?n.prev.next=n.next:this.head=n.next,n.next?n.next.prev=n.prev:this.tail=n.prev,this.map.delete(e))}has(e){return this.map.has(e)}get(e){return this.map.get(e)||null}get length(){return this.map.size}}const Jh=Ge.extend({style:{"pointer-events":"none"},_gridCache:null,_gridSettings:null,init(){Ge.prototype.init.apply(this,arguments),this.paper=this.options.paper,this._gridCache=null,this._gridSettings=[]},afterPaperReferenceSet(t){this.listenTo(t,"transform resize",this.updateGrid)},beforePaperReferenceUnset(t){this.stopListening(t)},setGrid(t){this._gridSettings=this.getGridSettings(t),this.renderGrid()},getGridSettings(t){const e=[];return t&&(Array.isArray(t)?t:[t||{}]).forEach(r=>{e.push(...this._resolveDrawGridOption(r))}),e},removeGrid(){const{_gridCache:t}=this;t&&(t.root.remove(),this._gridCache=null)},renderGrid(){const{paper:t}=this,{_gridSettings:e}=this;if(this.removeGrid(),e.length===0)return;const n=t.options.drawGridSize||t.options.gridSize;if(n<=1)return;const r=this._getGridRefs();e.forEach((i,s)=>{const o=this._getPatternId(s),l=Nt({},i),{scaleFactor:a=1}=l;l.width=n*a||1,l.height=n*a||1;let c;r.exist(o)?c=r.get(o):(c=N("pattern",{id:o,patternUnits:"userSpaceOnUse"},N(l.markup)),r.add(o,c)),bt(l.render)&&l.render(c.node.firstChild,l,t),c.attr({width:l.width,height:l.height})}),r.root.appendTo(this.el),this.updateGrid()},updateGrid(){const{_gridCache:t,_gridSettings:e,paper:n}=this;if(!t)return;const{root:r,patterns:i}=t,{x:s,y:o,width:l,height:a}=n.getArea();r.attr({x:s,y:o,width:l,height:a});for(const c in i)i[c].attr({x:-s,y:-o});e.forEach((c,u)=>{if(bt(c.update)){const h=i[this._getPatternId(u)];c.update(h.node.firstChild,c,n)}})},_getPatternId(t){return`pattern_${this.paper.cid}_${t}`},_getGridRefs(){let{_gridCache:t}=this;if(t)return t;const e=N("defs"),n=N("svg",{width:"100%",height:"100%"},[e]);return t=this._gridCache={root:n,patterns:{},add:function(r,i){const s=N("rect",{width:"100%",height:"100%",fill:`url(#${r})`});e.append(i),n.append(s),this.patterns[r]=i},get:function(r){return this.patterns[r]},exist:function(r){return this.patterns[r]!==void 0}},t},_resolveDrawGridOption(t){const e=this.options.patterns;if(Mt(t)&&Array.isArray(e[t]))return e[t].map(function(s){return j({},s)});const n=t||{args:[{}]},r=Array.isArray(n);let i=n.name;if(!r&&!i&&!n.markup&&(i="dot"),i&&Array.isArray(e[i])){const s=e[i].map(function(l){return j({},l)}),o=Array.isArray(n.args)?n.args:[n.args||{}];Yt(o[0],Xe(t,"args"));for(let l=0;l<o.length;l++)s[l]&&j(s[l],o[l]);return s}return r?n:[n]},isEmpty(){const{_gridCache:t}=this;return this.el.children.length===(t?1:0)}}),he={GRID:"grid",BACK:"back",CELLS:"cells",FRONT:"front",TOOLS:"tools",LABELS:"labels"},Sn={NONE:"sorting-none",APPROX:"sorting-approximate",EXACT:"sorting-exact"},y0=50,Qh=20,tf=1e3,w0=1/0,Qo=9007199254740991,ta=vt.Highlighting,ef={[ta.DEFAULT]:{name:"stroke",options:{padding:3}},[ta.MAGNET_AVAILABILITY]:{name:"addClass",options:{className:"available-magnet"}},[ta.ELEMENT_AVAILABILITY]:{name:"addClass",options:{className:"available-cell"}}},nf={dot:[{color:"#AAAAAA",thickness:1,markup:"rect",render:function(t,e){N(t).attr({width:e.thickness,height:e.thickness,fill:e.color})}}],fixedDot:[{color:"#AAAAAA",thickness:1,markup:"rect",render:function(t,e){N(t).attr({fill:e.color})},update:function(t,e,n){const{sx:r,sy:i}=n.scale(),s=r<=1?e.thickness:e.thickness/r,o=i<=1?e.thickness:e.thickness/i;N(t).attr({width:s,height:o})}}],mesh:[{color:"#AAAAAA",thickness:1,markup:"path",render:function(t,e){var n,r=e.width,i=e.height,s=e.thickness;r-s>=0&&i-s>=0?n=["M",r,0,"H0 M0 0 V0",i].join(" "):n="M 0 0 0 0",N(t).attr({d:n,stroke:e.color,"stroke-width":e.thickness})}}],doubleMesh:[{color:"#AAAAAA",thickness:1,markup:"path",render:function(t,e){var n,r=e.width,i=e.height,s=e.thickness;r-s>=0&&i-s>=0?n=["M",r,0,"H0 M0 0 V0",i].join(" "):n="M 0 0 0 0",N(t).attr({d:n,stroke:e.color,"stroke-width":e.thickness})}},{color:"#000000",thickness:3,scaleFactor:4,markup:"path",render:function(t,e){var n,r=e.width,i=e.height,s=e.thickness;r-s>=0&&i-s>=0?n=["M",r,0,"H0 M0 0 V0",i].join(" "):n="M 0 0 0 0",N(t).attr({d:n,stroke:e.color,"stroke-width":e.thickness})}}]},b0={flipXy:function(t){var e=document.createElement("canvas"),n=t.width,r=t.height;e.width=2*n,e.height=2*r;var i=e.getContext("2d");return i.drawImage(t,0,0,n,r),i.setTransform(-1,0,0,-1,e.width,e.height),i.drawImage(t,0,0,n,r),i.setTransform(-1,0,0,1,e.width,0),i.drawImage(t,0,0,n,r),i.setTransform(1,0,0,-1,0,e.height),i.drawImage(t,0,0,n,r),e},flipX:function(t){var e=document.createElement("canvas"),n=t.width,r=t.height;e.width=n*2,e.height=r;var i=e.getContext("2d");return i.drawImage(t,0,0,n,r),i.translate(2*n,0),i.scale(-1,1),i.drawImage(t,0,0,n,r),e},flipY:function(t){var e=document.createElement("canvas"),n=t.width,r=t.height;e.width=n,e.height=r*2;var i=e.getContext("2d");return i.drawImage(t,0,0,n,r),i.translate(0,2*r),i.scale(1,-1),i.drawImage(t,0,0,n,r),e},watermark:function(t,e){e=e||{};var n=t.width,r=t.height,i=document.createElement("canvas");i.width=n*3,i.height=r*3;for(var s=i.getContext("2d"),o=qt(e.watermarkAngle)?-e.watermarkAngle:-20,l=ee(o),a=i.width/4,c=i.height/4,u=0;u<4;u++)for(var h=0;h<4;h++)(u+h)%2>0&&(s.setTransform(1,0,0,1,(2*u-1)*a,(2*h-1)*c),s.rotate(l),s.drawImage(t,-n/2,-r/2,n,r));return i}},x0=[{id:he.GRID,type:"GridLayerView",patterns:nf},{id:he.BACK},{id:he.LABELS},{id:he.FRONT},{id:he.TOOLS}],on=Symbol("joint.cellViewPlaceholderMarker"),rf=le.extend({className:"paper",options:{width:800,height:600,gridSize:1,drawGrid:!1,drawGridSize:null,background:!1,elementView:Or,linkView:ue,snapLabels:!1,snapLinks:!1,snapLinksSelf:!1,labelsLayer:!1,multiLinks:!0,guard:function(t,e){return!1},highlighting:ef,preventContextMenu:!0,preventDefaultBlankAction:!0,preventDefaultViewAction:!0,restrictTranslate:!1,markAvailable:!1,defaultLink:function(){const{cellNamespace:t}=this.model.layerCollection,e=Ze(t,["standard","Link"]);if(!e)throw new Error("dia.Paper: no default link model found. Use `options.defaultLink` to specify a default link model.");return new e},defaultConnector:{name:"normal"},defaultRouter:{name:"normal"},defaultAnchor:{name:"center"},defaultLinkAnchor:{name:"connectionRatio"},defaultConnectionPoint:{name:"boundary"},connectionStrategy:null,validateMagnet:function(t,e,n){return e.getAttribute("magnet")!=="passive"},validateConnection:function(t,e,n,r,i,s){return(i==="target"?n:t)instanceof Or},embeddingMode:!1,validateEmbedding:function(t,e){return!0},validateUnembedding:function(t){return!0},findParentBy:"bbox",frontParentOnly:!0,interactive:{labelMove:!1},linkPinning:!0,allowLink:null,clickThreshold:0,moveThreshold:0,magnetThreshold:0,sorting:Sn.APPROX,frozen:!1,autoFreeze:!1,viewManagement:!1,onViewUpdate:function(t,e,n,r,i){r.mounting||r.isolate||!(r.replace&&r.add)&&e&(i.FLAG_INSERT|i.FLAG_REMOVE)||i.requestConnectedLinksUpdate(t,n,r)},onViewPostponed:function(t,e,n){return n.forcePostponedViewUpdate(t,e)},beforeRender:null,afterRender:null,viewport:null,cellViewNamespace:null,layerViewNamespace:null,routerNamespace:null,connectorNamespace:null,highlighterNamespace:vh,anchorNamespace:Wh,linkAnchorNamespace:qh,connectionPointNamespace:wh,overflow:!1},events:{dblclick:"pointerdblclick",dbltap:"pointerdblclick",contextmenu:"contextmenu",mousedown:"pointerdown",touchstart:"pointerdown",mouseover:"mouseover",mouseout:"mouseout",mouseenter:"mouseenter",mouseleave:"mouseleave",wheel:"mousewheel","mouseenter .joint-cell":"mouseenter","mouseleave .joint-cell":"mouseleave","mouseenter .joint-tools":"mouseenter","mouseleave .joint-tools":"mouseleave","dblclick .joint-cell [magnet]":"magnetpointerdblclick","contextmenu .joint-cell [magnet]":"magnetcontextmenu","mousedown .joint-link .label":"onlabel","touchstart .joint-link .label":"onlabel","dragstart .joint-cell image":"onImageDragStart"},documentEvents:{mousemove:"pointermove",touchmove:"pointermove",mouseup:"pointerup",touchend:"pointerup",touchcancel:"pointerup"},stylesheet:`
        .joint-element .scalable * {
            vector-effect: non-scaling-stroke;
        }
    `,svg:null,defs:null,tools:null,layers:null,viewport:null,_viewportMatrix:null,_viewportTransformString:null,_updates:null,_layers:null,UPDATE_DELAYING_BATCHES:["translate"],FORM_CONTROL_TAG_NAMES:["TEXTAREA","INPUT","BUTTON","SELECT","OPTION"],GUARDED_TAG_NAMES:["SELECT"],MIN_SCALE:1e-6,DEFAULT_FIND_BUFFER:200,FLAG_INSERT:1<<30,FLAG_REMOVE:1<<29,FLAG_INIT:1<<28,implicitLayers:x0,graphLayerRefId:he.LABELS,init:function(){const{options:t}=this;t.cellViewNamespace||(t.cellViewNamespace=typeof joint<"u"&&ve(joint,"shapes")?joint.shapes:null);const e={LayerView:Ge,GraphLayerView:Nr,GridLayerView:Jh};this.layerViewNamespace=dr({},t.layerViewNamespace||{},e);const n=this.model=t.model||new Jo;this.legacyMode=!t.viewManagement,this._layers={viewsMap:{},order:[]},this._views={},this._viewPlaceholders={},this._idToCid={},this.cloneOptions(),this.render(),this._setDimensions(),this.startListening(),this._mw_evt_buffer={event:null,deltas:[]},this.resetViews(n.getCells())},_resetUpdates:function(){return this._updates&&this._updates.id&&mr(this._updates.id),this._updates={id:null,priorities:[{},{},{}],unmountedList:new Zh,mountedList:new Zh,count:0,keyFrozen:!1,freezeKey:null,sort:!1,disabled:!1,idle:!1,freshAfterReset:!0}},startListening:function(){var t=this.model;this.listenTo(t,"add",this.onCellAdded).listenTo(t,"remove",this.onCellRemoved).listenTo(t,"reset",this.onGraphReset).listenTo(t,"batch:stop",this.onGraphBatchStop),this.listenTo(t,"layer:add",this.onGraphLayerAdd).listenTo(t,"layer:remove",this.onGraphLayerRemove).listenTo(t,"layers:sort",this.onGraphLayerCollectionSort),this.on("cell:highlight",this.onCellHighlight).on("cell:unhighlight",this.onCellUnhighlight).on("transform",this.update)},onCellAdded:function(t,e,n){var r=n.position;this.isAsync()||!qt(r)?this.renderView(t,n):(n.maxPosition===r&&this.freeze({key:"addCells"}),this.renderView(t,n),r===0&&this.unfreeze({key:"addCells"}))},onCellRemoved:function(t,e,n){const r=this._getCellViewLike(t);r&&(r[on]?(this._updates.unmountedList.delete(r.cid),this._unregisterCellViewPlaceholder(r)):this.requestViewUpdate(r,this.FLAG_REMOVE,r.UPDATE_PRIORITY,n))},onGraphReset:function(t,e){this.renderGraphLayerViews(),this.resetLayerViews(),this.assertLayerViews(),this.resetViews(this.model.getCells(),e)},onGraphBatchStop:function(t){if(!(this.isFrozen()||this.isIdle())){var e=t&&t.batchName,n=this.model;if(!this.isAsync()){var r=this.UPDATE_DELAYING_BATCHES;r.includes(e)&&!n.hasActiveBatch(r)&&this.updateViews(t)}}},onGraphLayerAdd:function(t,e,n){if(this.hasLayerView(t.id))return;const r=this.createLayerView({id:t.id,model:t}),i=this.model.getLayers();let s;if(i[i.length-1]===t)s=he.LABELS;else{const o=i.indexOf(t);s=i[o+1].id}this.addLayerView(r,{before:s})},onGraphLayerRemove:function(t,e,n){this.hasLayerView(t)&&this.requestLayerViewRemoval(t)},onGraphLayerCollectionSort:function(t){t.each(e=>{this.hasLayerView(e)&&this.moveLayerView(e,{before:this.graphLayerRefId})})},renderGraphLayerViews:function(){this.getLayerViews().forEach(t=>{t[Eo]&&this._removeLayerView(t)}),this.model.getLayers().forEach(t=>{const e=this.createLayerView({id:t.id,model:t});this.addLayerView(e,{before:this.graphLayerRefId})})},renderImplicitLayerViews:function(){this.implicitLayers.forEach(t=>{const e=this.createLayerView(t);this.addLayerView(e)})},cloneOptions:function(){const{options:t}=this,{defaultConnector:e,defaultRouter:n,defaultConnectionPoint:r,defaultAnchor:i,defaultLinkAnchor:s,highlighting:o,cellViewNamespace:l,interactive:a}=t;!l&&typeof joint<"u"&&ve(joint,"shapes")&&(t.cellViewNamespace=joint.shapes),bt(e)||(t.defaultConnector=zt(e)),bt(n)||(t.defaultRouter=zt(n)),bt(r)||(t.defaultConnectionPoint=zt(r)),bt(i)||(t.defaultAnchor=zt(i)),bt(s)||(t.defaultLinkAnchor=zt(s)),It(a)&&(t.interactive=j({},a)),It(o)&&(t.highlighting=dr({},o,ef)),t.viewManagement=Yt({},t.viewManagement,{lazyInitialize:!!t.viewManagement,initializeUnmounted:!1,disposeHidden:!1})},children:function(){var t=N.namespace;return[{namespaceURI:t.xhtml,tagName:"div",className:me("paper-background"),selector:"background",style:{position:"absolute",inset:0}},{namespaceURI:t.svg,tagName:"svg",attributes:{width:"100%",height:"100%","xmlns:xlink":t.xlink},selector:"svg",style:{position:"absolute",inset:0},children:[{tagName:"defs",selector:"defs"},{tagName:"g",className:me("layers"),selector:"layers"}]}]},hasLayerView(t){let e;if(Mt(t))e=t;else if(t)e=t.id;else return!1;return e in this._layers.viewsMap},getLayerView(t){let e;if(Mt(t))e=t;else if(t)e=t.id;else throw new Error("dia.Paper: No layer provided.");const n=this._layers.viewsMap[e];if(!n)throw new Error(`dia.Paper: Unknown layer view "${e}".`);return n},getLayerNode(t){return this.getLayerView(t).el},_removeLayerView(t){this._unregisterLayerView(t),t.remove()},_removeLayerViews:function(){Object.values(this._layers.viewsMap).forEach(t=>{this._removeLayerView(t)})},_unregisterLayerView(t){const{_layers:{viewsMap:e,order:n}}=this,r=t.id,i=n.indexOf(r);i!==-1&&n.splice(i,1),t.unsetPaperReference(),delete e[r]},_registerLayerView(t){if(!t||!t[Vu])throw new Error("dia.Paper: The layer view must be an instance of dia.LayerView.");if(this.hasLayerView(t.id))throw new Error(`dia.Paper: The layer view "${t.id}" already exists.`);t.setPaperReference(this),this._layers.viewsMap[t.id]=t},removeLayerView(t){const e=this.getLayerView(t);if(!e.isEmpty())throw new Error("dia.Paper: The layer view is not empty.");this._removeLayerView(e)},requestLayerViewRemoval(t,e){const n=this.getLayerView(t),{FLAG_REMOVE:r}=this,{UPDATE_PRIORITY:i}=n;this.requestViewUpdate(n,r,i,e)},requestCellViewInsertion(t,e){const n=this._getCellViewLike(t);n&&this.requestViewUpdate(n,this.FLAG_INSERT,n.UPDATE_PRIORITY,e)},_getBeforeLayerViewFromOptions(t,e){let{before:n=null,index:r}=e;if(n&&r!==void 0)throw new Error('dia.Paper: Options "before" and "index" are mutually exclusive.');let i;if(r!==void 0){const{_layers:{order:s}}=this;if(r>=s.length)i=null;else if(r<0)i=s[0];else{const o=s.indexOf(t.id);o!==-1&&r>o&&(r+=1),i=s[r]||null}}else i=n;return i?this.getLayerView(i):null},addLayerView(t,e={}){this._registerLayerView(t);const n=this._getBeforeLayerViewFromOptions(t,e);this.insertLayerView(t,n)},moveLayerView(t,e={}){const n=this.getLayerView(t),r=this._getBeforeLayerViewFromOptions(n,e);this.insertLayerView(n,r)},insertLayerView(t,e){const n=t.id,{_layers:{order:r}}=this,i=r.indexOf(n);if(e){const s=e.id;if(n===s)return;let o=r.indexOf(s);i!==-1&&(i<o&&(o-=1),r.splice(i,1)),r.splice(o,0,n),this.layers.insertBefore(t.el,e.el);return}i!==-1&&r.splice(i,1),r.push(n),this.layers.appendChild(t.el)},getLayerViewOrder(){return this._layers.order.slice()},getLayerViews(){return this.getLayerViewOrder().map(t=>this.getLayerView(t))},getGraphLayerViews(){const{_layers:{viewsMap:t}}=this;return this.model.getLayers().map(e=>t[e.id])},render:function(){this.renderChildren();const{el:t,childNodes:e,options:n,stylesheet:r}=this,{svg:i,defs:s,layers:o}=e;return t.style.position="relative",i.style.overflow=n.overflow?"visible":"hidden",this.svg=i,this.defs=s,this.layers=o,this.renderLayerViews(),N.ensureId(i),this.addStylesheet(r),n.background&&this.drawBackground(n.background),n.drawGrid&&this.setGrid(n.drawGrid),this},addStylesheet:function(t){t&&N(this.svg).prepend(N.createSVGStyle(t))},createLayerView(t){if(t==null)throw new Error("dia.Paper: Layer view options are required.");if(t.id==null)throw new Error("dia.Paper: Layer view id is required.");const e=kt(t);let n;if(e.model){const i=(e.model.get("type")||e.model.constructor.name)+"View";this.model.legacyMode?n=m0:n=this.layerViewNamespace[i]||Ge}else{const r=e.type;n=this.layerViewNamespace[r]||Ge}return new n(e)},renderLayerViews:function(){this._removeLayerViews(),this.renderImplicitLayerViews(),this.renderGraphLayerViews(),this.assertLayerViews()},assertLayerViews:function(){const t=this.getLayerView(this.model.getDefaultLayer().id),e=this.getLayerView(he.TOOLS),n=this.getLayerView(he.LABELS);this.tools=e.el,this.cells=this.viewport=t.el,n.vel.addClass(me("viewport")),n.el.style.webkitUserSelect="none",n.el.style.userSelect="none"},resetLayerViews:function(){this.getLayerViews().forEach(t=>t.reset())},update:function(){return this._background&&this.updateBackgroundImage(this._background),this},scale:function(t,e,n){const r=this.matrix();return t===void 0?N.matrixToScale(r):(e===void 0&&(e=t),t=Math.max(t||0,this.MIN_SCALE),e=Math.max(e||0,this.MIN_SCALE),r.a=t,r.d=e,this.matrix(r,n),this)},scaleUniformAtPoint:function(t,e,n){const{a:r,d:i,e:s,f:o}=this.matrix();if(t=Math.max(t||0,this.MIN_SCALE),t===r&&t===i)return this;const l=N.createSVGMatrix().translate(s-e.x*(t-r),o-e.y*(t-i)).scale(t,t);return this.matrix(l,n),this},translate:function(t,e,n){const r=this.matrix();return t===void 0?N.matrixToTranslate(r):(t||(t=0),e||(e=0),r.e===t&&r.f===e?this:(r.e=t,r.f=e,this.matrix(r,n),this))},matrix:function(t,e={}){var n=this.layers;if(t===void 0){var r=n.getAttribute("transform");return(this._viewportTransformString||null)===r?t=this._viewportMatrix:(t=n.getCTM(),this._viewportMatrix=t,this._viewportTransformString=r),N.createSVGMatrix(t)}const i=this.matrix(),s=N.createSVGMatrix(t),o=this._viewportTransformString,l=N.matrixToTransformString(s);if(l===o)return this;if(!o&&N.matrixToTransformString()===l)return this;const{a,d:c,e:u,f:h}=s;return n.setAttribute("transform",l),this._viewportMatrix=s,this._viewportTransformString=n.getAttribute("transform"),(a!==i.a||c!==i.d)&&this.trigger("scale",a,c,e),(u!==i.e||h!==i.f)&&this.trigger("translate",u,h,e),this.trigger("transform",s,e),this},clientMatrix:function(){return N.createSVGMatrix(this.layers.getScreenCTM())},requestConnectedLinksUpdate:function(t,e,n){if(!t||!t[tn])return;const r=t.model,i=this.model.getConnectedLinks(r);for(let s=0,o=i.length;s<o;s++){const l=i[s],a=this._getCellViewLike(l);if(!a||a[on])continue;const c=[ue.Flags.UPDATE];l.getTargetCell()===r&&c.push(ue.Flags.TARGET),l.getSourceCell()===r&&c.push(ue.Flags.SOURCE);const u=Math.max(e+1,a.UPDATE_PRIORITY);this.scheduleViewUpdate(a,a.getFlag(c),u,n)}},forcePostponedViewUpdate:function(t,e){if(!t||!t[tn])return!1;const n=t.model;if(n.isElement())return!1;const r={silent:!0};let i=0;const s=n.getSourceCell();if(s&&!this.isCellVisible(s)){const a=this.findViewByModel(s);i=this.dumpView(a,r)}let o=0;const l=n.getTargetCell();if(l&&!this.isCellVisible(l)){const a=this.findViewByModel(l);o=this.dumpView(a,r)}return i===0&&o===0?!this.dumpView(t,r):!1},requestViewUpdate:function(t,e,n,r){r||(r={}),this.scheduleViewUpdate(t,e,n,r);var i=this.isAsync();if(!(this.isFrozen()||i&&r.async!==!1)&&!this.model.hasActiveBatch(this.UPDATE_DELAYING_BATCHES)){var s=this.updateViews(r);i&&this.notifyAfterRender(s,r)}},scheduleViewUpdate:function(t,e,n,r){const{_updates:i,options:s}=this;i.idle&&s.autoFreeze&&(this.legacyMode?this.unfreeze():this.wakeUp());const{FLAG_REMOVE:o,FLAG_INSERT:l}=this,{UPDATE_PRIORITY:a,cid:c}=t;let u=i.priorities[n];if(u||(u=i.priorities[n]={}),n>a)for(let d=n-1;d>=a;d--){const v=i.priorities[d];!v||!(c in v)||(u[c]|=v[c],delete v[c])}let h=u[c]||0;if((h&e)===e)return;h||i.count++,e&o&&h&l?u[c]^=l:e&l&&h&o&&(u[c]^=o),u[c]|=e;const g=s.onViewUpdate;typeof g=="function"&&g.call(this,t,e,n,r||{},this)},dumpViewUpdate:function(t){if(!t)return 0;var e=this._updates,n=t.cid,r=e.priorities[t.UPDATE_PRIORITY],i=this.registerMountedView(t)|r[n];return delete r[n],i},dumpView:function(t,e={}){const n=this.dumpViewUpdate(t);if(!n)return 0;this.notifyBeforeRender(e);const r=this.updateView(t,n,e),i={updated:1,priority:t.UPDATE_PRIORITY};return this.notifyAfterRender(i,e),r},updateView:function(t,e,n){if(!t)return 0;const{FLAG_REMOVE:r,FLAG_INSERT:i,FLAG_INIT:s}=this,{model:o}=t;if(t[Eo]&&e&r)return this.removeLayerView(t),0;if(t[tn]){if(e&r)return this.removeView(o),0;if(e&i){const l=!!(e&s);l&&(e^=s),this.insertView(t,l),e^=i}}return e?t.confirmUpdate(e,n||{}):0},requireView:function(t,e){var n=this.findViewByModel(t);return n?(this.dumpView(n,e),n):null},registerUnmountedView:function(t){var e=t.cid,n=this._updates;if(n.unmountedList.has(e))return 0;const r=this.FLAG_INSERT;return n.unmountedList.pushTail(e,r),n.mountedList.delete(e),r},registerMountedView:function(t){var e=t.cid,n=this._updates;if(n.mountedList.has(e))return 0;const r=n.unmountedList.get(e),i=r?r.value:0;return n.unmountedList.delete(e),n.mountedList.pushTail(e),i},isCellVisible:function(t){const e=t&&this._idToCid[t.id||t];return e?this.isViewMounted(e):!1},isViewMounted:function(t){if(!t)return!1;let e;return t[tn]||t[on]?e=t.cid:e=t,this._updates.mountedList.has(e)},dumpViews:function(t){const e=Yt({},t,{cellVisibility:null,viewport:null});this.updateCellsVisibility(e)},updateViews:function(t={}){this.notifyBeforeRender(t);const e=this.updateViewsBatch({...t,batchSize:1/0}),n={updated:e.updated,priority:e.priority,batches:Number.isFinite(t.batchSize)?Math.ceil(e.updated/t.batchSize):1};return this.notifyAfterRender(n,t),n},hasScheduledUpdates:function(){const e=this._updates.priorities,n=Object.keys(e);let r=n.length;for(;r>0&&r--;)for(let i in e[n[r]])return!0;return!1},updateViewsAsync:function(t,e){t||(t={}),e||(e={processed:0,priority:Qo,checkedUnmounted:0,checkedMounted:0});const{_updates:n,options:r}=this,{id:i,mountedList:s,unmountedList:o,freshAfterReset:l}=n;let a=!0;if(i?(mr(i),l&&(n.freshAfterReset=!1,!this.legacyMode&&s.length===0&&o.length===0&&(this.updateViews(),a=!1))):a=!1,a){e.processed===0&&this.hasScheduledUpdates()&&this.notifyBeforeRender(t);const c=this.updateViewsBatch(t),u=Yt({},t,{mountBatchSize:tf-c.mounted,unmountBatchSize:tf-c.unmounted}),h=this.scheduleCellsVisibilityUpdate(u),g=h.unmounted,d=h.mounted;let v=e.processed;const y=n.count;c.updated>0?(v+=c.updated+c.unmounted,c.processed=v,e.priority=Math.min(c.priority,e.priority),c.empty&&d===0?(c.unmounted+=g,c.mounted+=d,c.priority=e.priority,this.notifyAfterRender(c,t),e.processed=0,e.priority=Qo,n.count=0):e.processed=v,e.checkedUnmounted=0,e.checkedMounted=0):(e.checkedUnmounted+=Math.max(u.mountBatchSize,0),e.checkedMounted+=Math.max(u.unmountBatchSize,0),r.autoFreeze&&!this.hasScheduledUpdates()&&e.checkedUnmounted>=o.length&&e.checkedMounted>=s.length&&(this.freeze(),n.idle={wakeUpOptions:t},this.trigger("render:idle",t)));const x=t.progress;if(y&&typeof x=="function"&&x.call(this,c.empty,v,y,c,this),n.id!==i)return}if(n.disabled)throw new Error("dia.Paper: can not unfreeze the paper after it was removed");n.id=Ci(this.updateViewsAsync,this,t,e)},notifyBeforeRender:function(t={}){if(t.silent)return;let e=t.beforeRender;typeof e!="function"&&(e=this.options.beforeRender,typeof e!="function")||e.call(this,t,this)},notifyAfterRender:function(t,e={}){if(e.silent)return;let n=e.afterRender;typeof n!="function"&&(n=this.options.afterRender),typeof n=="function"&&n.call(this,t,e,this),this.trigger("render:done",t,e)},prioritizeCellViewMount:function(t){if(!t)return!1;const e=this._idToCid[t.id||t];if(!e)return!1;const{unmountedList:n}=this._updates;return n.has(e)?(n.moveToHead(e),!0):!1},prioritizeCellViewUnmount:function(t){if(!t)return!1;const e=this._idToCid[t.id||t];if(!e)return!1;const{mountedList:n}=this._updates;return n.has(e)?(n.moveToHead(e),!0):!1},_evalCellVisibility:function(t,e,n){return!n||!t.DETACHABLE?!0:this.legacyMode?n.call(this,t,e,this):!t[tn]&&!t[on]?!0:t.model.graph!==this.model?e:n.call(this,t.model,e,this)},_getCellVisibilityCallback:function(t){const{options:e}=this;if(this.legacyMode){const n="viewport"in t?t.viewport:e.viewport;if(typeof n=="function")return n}else{const n="cellVisibility"in t?t.cellVisibility:e.cellVisibility;if(typeof n=="function")return n}return null},updateViewsBatch:function(t){t||(t={});var e=t.batchSize||w0,n=this._updates,r=0,i=0,s=0,o=0,l=Qo,a=!0,c=this.options,u=n.priorities;const h=this._getCellVisibilityCallback(t);var g=c.onViewPostponed;typeof g!="function"&&(g=null);var d=Object.keys(u);t:for(var v=0,y=d.length;v<y;v++){var x=+d[v],A=u[x];for(var T in A){if(r>=e){a=!1;break t}var f=Oe[T];if(!f&&(f=this._viewPlaceholders[T],!f)){delete A[T];continue}var p=A[T];if((p&this.FLAG_REMOVE)===0){const w=!n.unmountedList.has(T);if(!this._evalCellVisibility(f,w,h)){w?(this.registerUnmountedView(f),this._hideView(f)):this._mergeUnmountedViewScheduledUpdates(T,p),delete A[T],s++;continue}f[on]&&(f=this._resolveCellViewPlaceholder(f),p|=this.getCellViewInitFlag(f)),w||(p|=this.FLAG_INSERT,o++),p|=this.registerMountedView(f)}else if(f[on])continue;var m=this.updateView(f,p,t);if(m>0&&(A[T]=m,!g||!g.call(this,f,m,this)||A[T])){i++,a=!1;continue}l>x&&(l=x),r++,delete A[T]}}return{priority:l,updated:r,postponed:i,unmounted:s,mounted:o,empty:a}},getCellViewInitFlag:function(t){return this.FLAG_INIT|t.getFlag(Ct(t,"initFlag"))},getUnmountedViews:function(){const t=this._updates,e=new Array(t.unmountedList.length),n=t.unmountedList.keys();let r=0;for(const i of n)e[r++]=Oe[i]||this._viewPlaceholders[i];return e},getMountedViews:function(){const t=this._updates,e=new Array(t.mountedList.length),n=t.mountedList.keys();let r=0;for(const i of n)e[r++]=Oe[i]||this._viewPlaceholders[i];return e},checkUnmountedViews:function(t,e){e||(e={});var n=0;typeof t!="function"&&(t=null);for(var r=("mountBatchSize"in e)?e.mountBatchSize:1/0,i=this._updates,s=i.unmountedList,o=0,l=Math.min(s.length,r);o<l;o++){const{key:a}=s.peekHead();let c=Oe[a]||this._viewPlaceholders[a];if(!c){s.popHead();continue}if(!this._evalCellVisibility(c,!1,t)){s.rotate();continue}const{value:u}=s.popHead();n++;const h=this.registerMountedView(c)|u;h&&this.scheduleViewUpdate(c,h,c.UPDATE_PRIORITY,{mounting:!0})}return n},checkMountedViews:function(t,e){e||(e={});var n=0;if(typeof t!="function")return n;var r="unmountBatchSize"in e?e.unmountBatchSize:1/0,i=this._updates;const s=i.mountedList;for(var o=0,l=Math.min(s.length,r);o<l;o++){const{key:c}=s.peekHead(),u=Oe[c];if(!u){s.popHead();continue}if(this._evalCellVisibility(u,!0,t)){s.rotate();continue}s.popHead(),n++;var a=this.registerUnmountedView(u);a&&this._hideView(u)}return n},checkViewVisibility:function(t,e={}){const n=this._getCellVisibilityCallback(e),r=this._updates,{mountedList:i,unmountedList:s}=r,o=this._evalCellVisibility(t,!1,n);let l=!1,a=!1;if(i.has(t.cid)&&!o&&(this.registerUnmountedView(t)&&this._hideView(t),i.delete(t.cid),l=!0),!l&&s.has(t.cid)&&o){const c=s.get(t.cid);s.delete(t.cid);const u=c.value|this.registerMountedView(t);u&&this.scheduleViewUpdate(t,u,t.UPDATE_PRIORITY,{mounting:!0}),a=!0}return{mounted:a?1:0,unmounted:l?1:0}},updateCellVisibility:function(t,e={}){const n=this._getCellViewLike(t);if(!n)return;this.checkViewVisibility(n,e).mounted>0&&this.requireView(t,e)},updateCellsVisibility:function(t={}){this.scheduleCellsVisibilityUpdate(t);const e=(n,r)=>r;this.updateViews({...t,cellVisibility:e})},scheduleCellsVisibilityUpdate(t){const e=Yt({},t,{mountBatchSize:1/0,unmountBatchSize:1/0}),n=this._getCellVisibilityCallback(e),r=this.checkMountedViews(n,e);if(r>0){var i=this._updates.unmountedList;e.mountBatchSize=Math.min(i.length-r,e.mountBatchSize)}return{mounted:this.checkUnmountedViews(n,e),unmounted:r}},checkViewport:function(t){return this.scheduleCellsVisibilityUpdate(t)},freeze:function(t){t||(t={});var e=this._updates,n=t.key,r=this.options.frozen,i=e.freezeKey;if(n&&n!==i){if(r&&i)return;e.freezeKey=n,e.keyFrozen=r}this.options.frozen=!0;var s=e.id;e.id=null,this.legacyMode||(e.idle=!1),this.isAsync()&&s&&mr(s)},unfreeze:function(t){t||(t={});var e=this._updates,n=t.key,r=e.freezeKey;n&&r&&n!==r||(e.freezeKey=null,!(n&&n===r&&e.keyFrozen)&&(e.idle=!1,this.isAsync()?(this.freeze(),this.updateViewsAsync(t)):this.updateViews(t),this.options.frozen=e.keyFrozen=!1,e.sort&&(this.sortLayerViews(),e.sort=!1)))},wakeUp:function(){this.isIdle()&&this.unfreeze(this._updates.idle.wakeUpOptions)},isAsync:function(){return!!this.options.async},isFrozen:function(){return!!this.options.frozen&&!this.isIdle()},isIdle:function(){return this.legacyMode?!1:!!(this._updates&&this._updates.idle)},isExactSorting:function(){return this.options.sorting===Sn.EXACT},onRemove:function(){this.freeze(),this._updates.disabled=!0,this.removeViews(),this._removeLayerViews()},getComputedSize:function(){var t=this.options,e=t.width,n=t.height;return qt(e)||(e=this.el.clientWidth),qt(n)||(n=this.el.clientHeight),{width:e,height:n}},setDimensions:function(t,e,n={}){const{options:r}=this,{width:i,height:s}=r;let o=t===void 0?i:t,l=e===void 0?s:e;if(i===o&&s===l)return;r.width=o,r.height=l,this._setDimensions();const a=this.getComputedSize();this.trigger("resize",a.width,a.height,n)},_setDimensions:function(){const{options:t}=this;let e=t.width,n=t.height;qt(e)&&(e=`${Math.round(e)}px`),qt(n)&&(n=`${Math.round(n)}px`),this.$el.css({width:e===null?"":e,height:n===null?"":n})},fitToContent:function(t,e,n,r){gt(t)?r=t:r=j({gridWidth:t,gridHeight:e,padding:n},r);const{x:i,y:s,width:o,height:l}=this.getFitToContentArea(r),{sx:a,sy:c}=this.scale();return this.translate(-i*a,-s*c,r),this.setDimensions(o*a,l*c,r),new U(i,s,o,l)},getFitToContentArea:function(t={}){const e=t.gridWidth||1,n=t.gridHeight||1,r=Te(t.padding||0),i=Math.max(t.minWidth||0,e),s=Math.max(t.minHeight||0,n),o=t.maxWidth||Number.MAX_VALUE,l=t.maxHeight||Number.MAX_VALUE,a=t.allowNewOrigin,c="contentArea"in t?new U(t.contentArea):this.getContentArea(t),{sx:u,sy:h}=this.scale();c.x*=u,c.y*=h,c.width*=u,c.height*=h;let g=Math.ceil((c.width+c.x)/e),d=Math.ceil((c.height+c.y)/n);t.allowNegativeBottomRight||(g=Math.max(g,1),d=Math.max(d,1)),g*=e,d*=n;let v=0;(a==="negative"&&c.x<0||a==="positive"&&c.x>=0||a==="any")&&(v=Math.ceil(-c.x/e)*e,v+=r.left,g+=v);let y=0;return(a==="negative"&&c.y<0||a==="positive"&&c.y>=0||a==="any")&&(y=Math.ceil(-c.y/n)*n,y+=r.top,d+=y),g+=r.right,d+=r.bottom,g=Math.max(g,i),d=Math.max(d,s),g=Math.min(g,o),d=Math.min(d,l),new U(-v/u,-y/h,g/u,d/h)},transformToFitContent:function(t){t||(t={});let e,n;if("contentArea"in t){const f=t.contentArea;e=this.localToPaperRect(f),n=new S(f)}else e=this.getContentBBox(t),n=this.paperToLocalPoint(e);if(!e.width||!e.height)return;Yt(t,{padding:0,preserveAspectRatio:!0,scaleGrid:null,minScale:0,maxScale:Number.MAX_VALUE,verticalAlign:"top",horizontalAlign:"left"});const r=Te(t.padding),i=t.minScaleX||t.minScale,s=t.maxScaleX||t.maxScale,o=t.minScaleY||t.minScale,l=t.maxScaleY||t.maxScale;let a;if(t.fittingBBox)a=t.fittingBBox;else{const f=this.translate(),p=this.getComputedSize();a={x:f.tx,y:f.ty,width:p.width,height:p.height}}a=new U(a).moveAndExpand({x:r.left,y:r.top,width:-r.left-r.right,height:-r.top-r.bottom});const c=this.matrix(),{a:u,d:h,e:g,f:d}=c;let v=a.width/e.width*u,y=a.height/e.height*h;if(t.preserveAspectRatio&&(v=y=Math.min(v,y)),t.scaleGrid){const f=t.scaleGrid;v=f*Math.floor(v/f),y=f*Math.floor(y/f)}v=Math.min(s,Math.max(i,v)),y=Math.min(l,Math.max(o,y));const x={x:v/u,y:y/h};let A=a.x-n.x*v-g,T=a.y-n.y*y-d;switch(t.verticalAlign){case"middle":T=T+(a.height-e.height*x.y)/2;break;case"bottom":T=T+(a.height-e.height*x.y);break}switch(t.horizontalAlign){case"middle":A=A+(a.width-e.width*x.x)/2;break;case"right":A=A+(a.width-e.width*x.x);break}c.a=v,c.d=y,c.e=A,c.f=T,this.matrix(c,t)},scaleContentToFit:function(t){this.transformToFitContent(t)},getContentArea:function(t){if(t&&t.useModelGeometry)return this.model.getBBox()||new U;const e=this.getGraphLayerViews();return e.length===0?new U:U.fromRectUnion(...e.map(r=>r.vel.getBBox()))},getContentBBox:function(t){return this.localToPaperRect(this.getContentArea(t))},getArea:function(){return this.paperToLocalRect(this.getComputedSize())},getRestrictedArea:function(...t){const{restrictTranslate:e}=this.options;let n;return bt(e)?n=e.apply(this,t):e===!0?n=this.getArea():e?n=new U(e):n=null,n},_resolveCellViewPlaceholder:function(t){const{model:e,viewClass:n,cid:r}=t,i=this._initializeCellView(n,e,r);return this._registerCellView(i),this._unregisterCellViewPlaceholder(t),i},_registerCellViewPlaceholder:function(t,e=wn("view")){const n=this._resolveCellViewClass(t),r={[on]:!0,cid:e,model:t,DETACHABLE:!0,viewClass:n,UPDATE_PRIORITY:n.prototype.UPDATE_PRIORITY};return this._viewPlaceholders[e]=r,r},_registerCellView:function(t){t.paper=this,this._views[t.model.id]=t},_unregisterCellViewPlaceholder:function(t){delete this._viewPlaceholders[t.cid]},_initializeCellView:function(t,e,n){const{options:r}=this,{interactive:i,labelsLayer:s}=r;return new t({cid:n,model:e,interactive:i,labelsLayer:s===!0?he.LABELS:s})},_resolveCellViewClass:function(t){const{options:e}=this,{cellViewNamespace:n}=e,r=t.get("type")+"View",i=Ze(n,r,".");let s,o;return t.isLink()?(s=e.linkView,o=ue):(s=e.elementView,o=Or),s.prototype instanceof nn?i||s:s.call(this,t)||i||o},_getCellViewLike:function(t){let e;if(Mt(t)||qt(t))e=t;else if(t)e=t.id;else return null;const n=this._views[e];if(n)return n;const r=this._idToCid[e];return r?this._viewPlaceholders[r]:null},createViewForModel:function(t,e){return this._initializeCellView(this._resolveCellViewClass(t),t,e)},removeView:function(t){const{id:e}=t,{_views:n,_updates:r}=this,i=n[e];if(i){var{cid:s}=i;const{mountedList:o,unmountedList:l}=r;i.remove(),delete n[e],delete this._idToCid[e],o.delete(s),l.delete(s)}return i},renderView:function(t,e){const{id:n}=t,r=this._views;let i,s,o=!0;if(n in r&&(i=r[n],i.model===t?(s=this.FLAG_INSERT,o=!1):this.removeView(t)),o){const{viewManagement:l}=this.options,a=wn("view");if(this._idToCid[t.id]=a,l.lazyInitialize?(i=this._registerCellViewPlaceholder(t,a),s=this.registerUnmountedView(i)):(i=this.createViewForModel(t,a),this._registerCellView(i),s=this.registerUnmountedView(i),s|=this.getCellViewInitFlag(i)),l.initializeUnmounted)return this._mergeUnmountedViewScheduledUpdates(a,s),i}return this.requestViewUpdate(i,s,i.UPDATE_PRIORITY,e),i},_mergeUnmountedViewScheduledUpdates:function(t,e){const{unmountedList:n}=this._updates,r=n.get(t);r&&(r.value|=e)},onImageDragStart:function(){return!1},resetViews:function(t,e){e||(e={}),t||(t=[]);const n=(this.legacyMode?this.options.autoFreeze:this.isIdle())?null:"reset";this._resetUpdates(),this.removeViews(),this.freeze({key:n});for(var r=0,i=t.length;r<i;r++)this.renderView(t[r],e);this.unfreeze({key:n}),this.sortLayerViews()},removeViews:function(){for(const t in this._views){const e=this._views[t];e&&e.remove()}this._views={},this._viewPlaceholders={},this._idToCid={}},sortLayerViews:function(){if(this.isExactSorting()){if(this.isFrozen()||this.isIdle()){this._updates.sort=!0;return}this.sortLayerViewsExact()}},sortLayerViewsExact:function(){this.getGraphLayerViews().forEach(t=>t.sortExact())},insertView:function(t,e){const n=this.model.getCellLayerId(t.model);this.getLayerView(n).insertCellView(t),t.onMount(e)},_hideView:function(t){!t||t[on]||(t[tn]?this._hideCellView(t):t.unmount())},_hideCellView:function(t){this.options.viewManagement.disposeHidden&&this._disposeCellView(t)||this._detachCellView(t)},_disposeCellView:function(t){if(ce.has(t)||t.hasTools())return!1;const e=t.model;return t.remove(),delete this._views[e.id],this._registerCellViewPlaceholder(e,t.cid),!0},disposeHiddenCellViews:function(){if(this.legacyMode)return;const t=this._updates.unmountedList.keys();for(const e of t){const n=Oe[e];n&&this._disposeCellView(n)}},_detachCellView(t){t.unmount(),t.onDetach()},findView:function(t){var e=Mt(t)?this.layers.querySelector(t):t instanceof z?t[0]:t,n=this.findAttribute("model-id",e);if(n)return this._views[n]},findViewByModel:function(t){const e=this._getCellViewLike(t);if(!e)return;if(e[tn])return e;const n=this._resolveCellViewPlaceholder(e),r=this.getCellViewInitFlag(n);return this.isViewMounted(n)?this.scheduleViewUpdate(n,r,n.UPDATE_PRIORITY,{isolate:!0}):this._mergeUnmountedViewScheduledUpdates(n.cid,r),n},findViewsFromPoint:function(t){t=new S(t);var e=this.model.getElements().map(this.findViewByModel,this);return e.filter(function(n){return n&&n.vel.getBBox({target:this.layers}).containsPoint(t)},this)},findViewsInArea:function(t,e){e=Yt(e||{},{strict:!1}),t=new U(t);var n=this.model.getElements().map(this.findViewByModel,this),r=e.strict?"containsRect":"intersect";return n.filter(function(i){return i&&t[r](i.vel.getBBox({target:this.layers}))},this)},findElementViewsInArea(t,e){return this._filterViewsInArea(t,(n,r)=>this.model.findElementsInArea(n,r),e)},findLinkViewsInArea:function(t,e){return this._filterViewsInArea(t,(n,r)=>this.model.findLinksInArea(n,r),e)},findCellViewsInArea:function(t,e){return this._filterViewsInArea(t,(n,r)=>this.model.findCellsInArea(n,r),e)},findElementViewsAtPoint:function(t,e){return this._filterViewsAtPoint(t,n=>this.model.findElementsInArea(n),e)},findLinkViewsAtPoint:function(t,e){return this._filterViewsAtPoint(t,n=>this.model.findLinksInArea(n),e)},findCellViewsAtPoint:function(t,e){return this._filterViewsAtPoint(t,n=>this.model.findCellsInArea(n),e)},findClosestMagnetToPoint:function(t,e={}){let n=Number.MAX_SAFE_INTEGER,r=-1/0;const i=new S(t),s=e.radius||Number.MAX_SAFE_INTEGER,o=this.findCellViewsInArea({x:i.x-s,y:i.y-s,width:2*s,height:2*s},e.findInAreaOptions),l=typeof e.filter=="function"?e.filter:null;let a=null,c=null;return o.forEach(u=>{const h=[],{model:g}=u;if(u.el.getAttribute("magnet")!=="false")if(g.isLink()){const d=u.getConnection();h.push({priority:0,distance:d.closestPoint(i).squaredDistance(i),magnet:u.el})}else h.push({priority:g.getAncestors().length,distance:g.getBBox().center().squaredDistance(i),magnet:u.el});u.$("[magnet]").toArray().forEach(d=>{const v=u.getNodeBBox(d);let y=v.pointNearestToPoint(i).squaredDistance(i);v.containsPoint(i)&&(y=-Number.MAX_SAFE_INTEGER+y),y<=s*s&&h.push({priority:Number.MAX_SAFE_INTEGER,distance:y,magnet:d})}),h.forEach(d=>{const{magnet:v,distance:y,priority:x}=d;(x>r||x===r&&y<n)&&(!l||l(u,v))&&(r=x,n=y,a=u,c=v)})}),a?{view:a,magnet:c}:null},_findInExtendedArea:function(t,e,n={}){const{buffer:r=this.DEFAULT_FIND_BUFFER}=n,i=new U(t).inflate(r);return e(i,n).map(o=>this.findViewByModel(o))},_filterViewsInArea:function(t,e,n={}){const r=new U(t);return this._findInExtendedArea(r,e,n).filter(o=>o?o.isInArea(r,n):!1)},_filterViewsAtPoint:function(t,e,n={}){const r=new U(t);return this._findInExtendedArea(r,e,n).filter(o=>o?o.isAtPoint(t,n):!1)},removeTools:function(){return this.dispatchToolsEvent("remove"),this},hideTools:function(){return this.dispatchToolsEvent("hide"),this},showTools:function(){return this.dispatchToolsEvent("show"),this},dispatchToolsEvent:function(t,...e){typeof t=="string"&&this.trigger("tools:event",t,...e)},getModelById:function(t){return this.model.getCell(t)},snapToGrid:function(t,e){return this.clientToLocalPoint(t,e).snapToGrid(this.options.gridSize)},localToPaperPoint:function(t,e){var n=new S(t,e),r=N.transformPoint(n,this.matrix());return r},localToPaperRect:function(t,e,n,r){var i=new U(t,e,n,r),s=N.transformRect(i,this.matrix());return s},paperToLocalPoint:function(t,e){var n=new S(t,e),r=N.transformPoint(n,this.matrix().inverse());return r},paperToLocalRect:function(t,e,n,r){var i=new U(t,e,n,r),s=N.transformRect(i,this.matrix().inverse());return s},localToClientPoint:function(t,e){var n=new S(t,e),r=N.transformPoint(n,this.clientMatrix());return r},localToClientRect:function(t,e,n,r){var i=new U(t,e,n,r),s=N.transformRect(i,this.clientMatrix());return s},clientToLocalPoint:function(t,e){var n=new S(t,e),r=N.transformPoint(n,this.clientMatrix().inverse());return r},clientToLocalRect:function(t,e,n,r){var i=new U(t,e,n,r),s=N.transformRect(i,this.clientMatrix().inverse());return s},localToPagePoint:function(t,e){return this.localToPaperPoint(t,e).offset(this.pageOffset())},localToPageRect:function(t,e,n,r){return this.localToPaperRect(t,e,n,r).offset(this.pageOffset())},pageToLocalPoint:function(t,e){var n=new S(t,e),r=n.difference(this.pageOffset());return this.paperToLocalPoint(r)},pageToLocalRect:function(t,e,n,r){var i=this.pageOffset(),s=new U(t,e,n,r);return s.x-=i.x,s.y-=i.y,this.paperToLocalRect(s)},clientOffset:function(){var t=this.svg.getBoundingClientRect();return new S(t.left,t.top)},pageOffset:function(){return this.clientOffset().offset(window.scrollX,window.scrollY)},linkAllowed:function(t){if(!(t instanceof ue))throw new Error("Must provide a linkView.");var e=t.model,n=this.options,r=this.model,i=r.constructor.validations;return!(!n.multiLinks&&!i.multiLinks.call(this,r,e)||!n.linkPinning&&!i.linkPinning.call(this,r,e)||typeof n.allowLink=="function"&&!n.allowLink.call(this,t,this))},getDefaultLink:function(t,e){return bt(this.options.defaultLink)?this.options.defaultLink.call(this,t,e):this.options.defaultLink.clone()},resolveHighlighter:function(t={}){let{highlighter:e,type:n}=t;const{highlighting:r,highlighterNamespace:i}=this.options;if(e===void 0){if(!r||n&&(e=r[n],e===!1))return!1;e||(e=r.default)}if(!e)return!1;Mt(e)&&(e={name:e});const s=e.name,o=i[s];if(!o)throw new Error('Unknown highlighter ("'+s+'")');if(typeof o.highlight!="function")throw new Error('Highlighter ("'+s+'") is missing required highlight() method');if(typeof o.unhighlight!="function")throw new Error('Highlighter ("'+s+'") is missing required unhighlight() method');return{highlighter:o,options:e.options||{},name:s}},onCellHighlight:function(t,e,n){const r=this.resolveHighlighter(n);if(!r)return;const{highlighter:i,options:s}=r;i.highlight(t,e,s)},onCellUnhighlight:function(t,e,n){const r=this.resolveHighlighter(n);if(!r)return;const{highlighter:i,options:s}=r;i.unhighlight(t,e,s)},pointerdblclick:function(t){t.preventDefault(),t=St(t);var e=this.findView(t.target);if(!this.guard(t,e)){var n=this.snapToGrid(t.clientX,t.clientY);e?e.pointerdblclick(t,n.x,n.y):this.trigger("blank:pointerdblclick",t,n.x,n.y)}},pointerclick:function(t){var e=this.eventData(t);if(e.mousemoved<=this.options.clickThreshold){t=St(t);var n=this.findView(t.target);if(this.guard(t,n))return;var r=this.snapToGrid(t.clientX,t.clientY);n?n.pointerclick(t,r.x,r.y):this.trigger("blank:pointerclick",t,r.x,r.y)}},contextmenu:function(t){if(this.options.preventContextMenu&&t.preventDefault(),this.contextMenuFired){this.contextMenuFired=!1;return}t=St(t),this.contextMenuTrigger(t)},contextMenuTrigger:function(t){var e=this.findView(t.target);if(!this.guard(t,e)){var n=this.snapToGrid(t.clientX,t.clientY);e?e.contextmenu(t,n.x,n.y):this.trigger("blank:contextmenu",t,n.x,n.y)}},pointerdown:function(t){t=St(t);const{target:e,button:n}=t,r=this.findView(e),i=n===2;if(r){if(!i&&this.guard(t,r))return;const s=this.FORM_CONTROL_TAG_NAMES.includes(e.tagName);this.options.preventDefaultViewAction&&!s&&t.preventDefault(),s&&r.preventDefaultInteraction(t);const o=this.customEventTrigger(t,r);if(o){if(o.isPropagationStopped())return;t.data=o.data}const l=e.closest("[magnet]");if(l&&r.el!==l&&r.el.contains(l)){const a=St(new z.Event(t.originalEvent,{data:t.data,currentTarget:l}));if(this.onmagnet(a),a.isDefaultPrevented()&&t.preventDefault(),a.isPropagationStopped()){if(i)return;this.delegateDragEvents(r,a.data);return}t.data=a.data}}if(i){this.contextMenuFired=!0;const s=new z.Event(t.originalEvent,{type:"contextmenu",data:t.data});this.contextMenuTrigger(s)}else{const s=this.snapToGrid(t.clientX,t.clientY);r?r.pointerdown(t,s.x,s.y):(this.options.preventDefaultBlankAction&&t.preventDefault(),this.trigger("blank:pointerdown",t,s.x,s.y)),this.delegateDragEvents(r,t.data)}},pointermove:function(t){var e=this.eventData(t);e.mousemoved||(e.mousemoved=0,this.undelegateEvents());var n=++e.mousemoved;if(n<=this.options.moveThreshold)return;t=St(t);var r=this.snapToGrid(t.clientX,t.clientY);let i=e.sourceView;i?(i=this.findViewByModel(i.model),i.pointermove(t,r.x,r.y)):this.trigger("blank:pointermove",t,r.x,r.y),this.eventData(t,e)},pointerup:function(t){this.undelegateDocumentEvents();var e=St(t),n=this.snapToGrid(e.clientX,e.clientY);let r=this.eventData(t).sourceView;r?(r=this.findViewByModel(r.model),r.pointerup(e,n.x,n.y)):this.trigger("blank:pointerup",e,n.x,n.y),e.isPropagationStopped()||this.pointerclick(new z.Event(t.originalEvent,{type:"click",data:t.data})),this.delegateEvents()},mouseover:function(t){t=St(t);var e=this.findView(t.target);if(!this.guard(t,e))if(e)e.mouseover(t);else{if(this.el===t.target)return;this.trigger("blank:mouseover",t)}},mouseout:function(t){t=St(t);var e=this.findView(t.target);if(!this.guard(t,e))if(e)e.mouseout(t);else{if(this.el===t.target)return;this.trigger("blank:mouseout",t)}},mouseenter:function(t){t=St(t);const{target:e,relatedTarget:n,currentTarget:r}=t,i=this.findView(e);if(this.guard(t,i))return;const s=this.findView(n);i&&(s===i||(i.mouseenter(t),this.el.contains(n)))||s||r===this.el&&this.trigger("paper:mouseenter",t)},mouseleave:function(t){t=St(t);const{target:e,relatedTarget:n,currentTarget:r}=t,i=this.findView(e);if(this.guard(t,i))return;const s=this.findView(n);i&&(s===i||(i.mouseleave(t),this.el.contains(n)))||s||r===this.el&&this.trigger("paper:mouseleave",t)},_processMouseWheelEvtBuf:kc(function(){const{event:t,deltas:e}=this._mw_evt_buffer,n=e.reduce((o,l)=>o+su(l,y0),0),r=Math.pow(.995,n),{x:i,y:s}=this.clientToLocalPoint(t.clientX,t.clientY);this.trigger("paper:pinch",t,i,s,r),this._mw_evt_buffer={event:null,deltas:[]}},Qh,{maxWait:Qh}),mousewheel:function(t){t=St(t);const e=this.findView(t.target);if(this.guard(t,e))return;const n=t.originalEvent,r=this.snapToGrid(n.clientX,n.clientY),{deltaX:i,deltaY:s}=iu(n),o=this._events["paper:pinch"];if(t.ctrlKey&&o&&o.length>0)n.preventDefault(),this._mw_evt_buffer.event=t,this._mw_evt_buffer.deltas.push(s),this._processMouseWheelEvtBuf();else{const l=Math.max(-1,Math.min(1,n.wheelDelta));e?e.mousewheel(t,r.x,r.y,l):this.trigger("blank:mousewheel",t,r.x,r.y,l),this.trigger("paper:pan",t,i,s)}},onevent:function(t){var e=t.currentTarget,n=e.getAttribute("event");if(n){var r=this.findView(e);if(r){if(t=St(t),this.guard(t,r))return;var i=this.snapToGrid(t.clientX,t.clientY);r.onevent(t,n,i.x,i.y)}}},magnetEvent:function(t,e){var n=t.currentTarget,r=n.getAttribute("magnet");if(r){var i=this.findView(n);if(i){if(t=St(t),this.guard(t,i))return;var s=this.snapToGrid(t.clientX,t.clientY);e.call(this,i,t,n,s.x,s.y)}}},onmagnet:function(t){if(t.button===2){this.contextMenuFired=!0,this.magnetContextMenuFired=!0;const e=new z.Event(t.originalEvent,{type:"contextmenu",data:t.data,currentTarget:t.currentTarget});this.magnetContextMenuTrigger(e),e.isPropagationStopped()&&t.stopPropagation()}else this.magnetEvent(t,function(e,n,r,i,s){e.onmagnet(n,i,s)})},magnetpointerdblclick:function(t){this.magnetEvent(t,function(e,n,r,i,s){e.magnetpointerdblclick(n,r,i,s)})},magnetcontextmenu:function(t){if(this.options.preventContextMenu&&t.preventDefault(),this.magnetContextMenuFired){this.magnetContextMenuFired=!1;return}this.magnetContextMenuTrigger(t)},magnetContextMenuTrigger:function(t){this.magnetEvent(t,function(e,n,r,i,s){e.magnetcontextmenu(n,r,i,s)})},onlabel:function(t){var e=t.currentTarget,n=this.findView(e);if(!n||(t=St(t),this.guard(t,n)))return;const r=this.customEventTrigger(t,n,e);if(r){if(r.isPropagationStopped())return;t.data=r.data}var i=this.snapToGrid(t.clientX,t.clientY);n.onlabel(t,i.x,i.y)},getPointerArgs(t){const e=St(t),{x:n,y:r}=this.snapToGrid(e.clientX,e.clientY);return[e,n,r]},delegateDragEvents:function(t,e){e||(e={}),this.eventData({data:e},{sourceView:t||null,mousemoved:0}),this.delegateDocumentEvents(null,e)},guard:function(t,e){if(t.type==="mousedown"&&t.button===2||this.options.guard&&this.options.guard(t,e))return!0;if(t.data&&t.data.guarded!==void 0)return t.data.guarded;const{target:n}=t;return this.GUARDED_TAG_NAMES.includes(n.tagName)?!0:!(e&&e.model&&e.model[ae]||this.el===n||this.svg.contains(n))},setGridSize:function(t){const{options:e}=this;return e.gridSize=t,e.drawGrid&&!e.drawGridSize&&this.getLayerView(he.GRID).renderGrid(),this},setGrid:function(t){return this.getLayerView(he.GRID).setGrid(t),this},updateBackgroundImage:function(t){t=t||{};var e=t.position||"center",n=t.size||"auto auto",r=this.scale(),i=this.translate();if(gt(e)){var s=i.tx+r.sx*(e.x||0),o=i.ty+r.sy*(e.y||0);e=s+"px "+o+"px"}gt(n)&&(n=new U(n).scale(r.sx,r.sy),n=n.width+"px "+n.height+"px");const{background:l}=this.childNodes;l.style.backgroundSize=n,l.style.backgroundPosition=e},drawBackgroundImage:function(t,e){if(!(t instanceof HTMLImageElement)){this.childNodes.background.style.backgroundImage="";return}if(!(!this._background||this._background.id!==e.id)){e=e||{};var n,r=e.size,i=e.repeat||"no-repeat",s=e.opacity||1,o=Math.abs(e.quality)||1,l=this.constructor.backgroundPatterns[so(i)];if(bt(l)){t.width*=o,t.height*=o;var a=l(t,e);if(!(a instanceof HTMLCanvasElement))throw new Error("dia.Paper: background pattern must return an HTML Canvas instance");n=a.toDataURL("image/png"),i="repeat",gt(r)?(r.width*=a.width/t.width,r.height*=a.height/t.height):r===void 0&&(e.size={width:a.width/o,height:a.height/o})}else n=t.src,r===void 0&&(e.size={width:t.width,height:t.height});this.childNodes.background.style.opacity=s,this.childNodes.background.style.backgroundRepeat=i,this.childNodes.background.style.backgroundImage=`url(${n})`,this.updateBackgroundImage(e)}},updateBackgroundColor:function(t){this.$el.css("backgroundColor",t||"")},drawBackground:function(t){if(t=t||{},this.updateBackgroundColor(t.color),t.image){t=this._background=zt(t),xn(t);var e=document.createElement("img");e.onload=this.drawBackgroundImage.bind(this,e,t),e.src=t.image}else this.drawBackgroundImage(null),this._background=null;return this},setInteractivity:function(t){this.options.interactive=t,Ie(this._views,"setInteractivity",t)},isDefined:function(t){return!!this.svg.getElementById(t)},defineFilter:function(t){if(!gt(t))throw new TypeError("dia.Paper: defineFilter() requires 1. argument to be an object.");var e=t.id,n=t.name;if(e||(e=n+this.svg.id+vr(JSON.stringify(t))),!this.isDefined(e)){var r=du,i=r[n]&&r[n](t.args||{});if(!i)throw new Error("Non-existing filter "+n);var s=j({filterUnits:"userSpaceOnUse"},t.attrs,{id:e});N(i,s).appendTo(this.defs)}return e},defineGradient:function(t){if(!gt(t))throw new TypeError("dia.Paper: defineGradient() requires 1. argument to be an object.");const{svg:e,defs:n}=this,{type:r,id:i=r+e.id+vr(JSON.stringify(t)),stops:s,attrs:o={}}=t;if(this.isDefined(i))return i;const l=xt(s).map(({offset:c,color:u,opacity:h})=>N("stop").attr({offset:c,"stop-color":u,"stop-opacity":Number.isFinite(h)?h:1})),a=N(r,o,l);return a.id=i,a.appendTo(n),i},definePattern:function(t){if(!gt(t))throw new TypeError("dia.Paper: definePattern() requires 1. argument to be an object.");const{svg:e,defs:n}=this,{id:r=e.id+vr(JSON.stringify(t)),markup:i,attrs:s={}}=t;if(!i)throw new TypeError("dia.Paper: definePattern() requires markup.");if(this.isDefined(r))return r;const o=N("pattern",{patternUnits:"userSpaceOnUse"});if(o.id=r,o.attr(s),typeof i=="string")o.append(N(i));else{const{fragment:l}=pr(i);o.append(l)}return o.appendTo(n),r},defineMarker:function(t){if(!gt(t))throw new TypeError("dia.Paper: defineMarker() requires the first argument to be an object.");const{svg:e,defs:n}=this,{id:r=e.id+vr(JSON.stringify(t)),markup:i,attrs:s={},markerUnits:o="userSpaceOnUse"}=t;if(this.isDefined(r))return r;const l=N("marker",{orient:"auto",overflow:"visible",markerUnits:o});l.id=r,l.attr(s);let a;if(i){let h;if(typeof i=="string")h=N(i),h=Array.isArray(h)?h:[h];else{const{fragment:g}=pr(i);h=N(g).children()}h.length>1?a=N("g").append(h):a=h[0]}else{const{type:h="path"}=t;a=N(h)}const c=Xe(t,"type","id","markup","attrs","markerUnits");return Object.keys(c).forEach(h=>{const g=c[h],d=a.attr(h);if(d==null)a.attr(h,g);else switch(h){case"transform":a.attr(h,g+" "+d);break}}),a.appendTo(l),l.appendTo(n),r},customEventTrigger:function(t,e,n=e.el){const r=t.target.closest("[event]");if(r&&n!==r&&e.el.contains(r)){const i=St(new z.Event(t.originalEvent,{data:t.data,currentTarget:r}));return this.onevent(i),i.isDefaultPrevented()&&t.preventDefault(),i}return null}},{sorting:Sn,Layers:he,backgroundPatterns:b0,gridPatterns:nf}),ze=le.extend({name:null,tagName:"g",className:"tool",svgElement:!0,_visible:!0,_visibleExplicit:!0,init:function(){var t=this.name;t&&this.vel.attr("data-tool-name",t)},configure:function(t,e){return this.relatedView=t,this.paper=t.paper,this.parentView=e,this.simulateRelatedView(this.el),this.delegateEvents(),this},simulateRelatedView:function(t){t&&t.setAttribute("model-id",this.relatedView.model.id)},getName:function(){return this.name},updateVisibility:function(){const t=this.computeVisibility();this.el.style.display=t?"":"none",this._visible=t},computeVisibility(){if(!this.isExplicitlyVisible())return!1;const{visibility:t}=this.options;return typeof t!="function"?!0:!!t.call(this,this.relatedView,this)},show:function(){this._visibleExplicit=!0,this.updateVisibility()},hide:function(){this._visibleExplicit=!1,this.updateVisibility()},isExplicitlyVisible:function(){return!!this._visibleExplicit},isVisible:function(){return!!this._visible},isOverlay:function(){return!!this.parentView&&this.parentView.hasLayer()},focus:function(){var t=this.options.focusOpacity;isFinite(t)&&(this.el.style.opacity=t),this.parentView.focusTool(this)},blur:function(){this.el.style.opacity="",this.parentView.blurTool(this)},update:function(){},guard:function(t){const{paper:e,relatedView:n}=this;return!e||!n?!0:e.guard(t,n)}}),A0=le.extend({tagName:"g",className:"tools",svgElement:!0,tools:null,isRendered:!1,options:{tools:null,relatedView:null,name:null},configure:function(t){t=j(this.options,t);var e=t.tools;if(!Array.isArray(e))return this;var n=t.relatedView;if(!(n instanceof vt))return this;for(var r=this.tools=[],i=0,s=e.length;i<s;i++){var o=e[i];o instanceof ze&&(o.configure(n,this),this.vel.append(o.el),r.push(o))}return this.isRendered=!1,n.requestUpdate(n.getFlag("TOOLS")),this},getName:function(){return this.options.name},update:function(t){t||(t={});const e=this.tools;if(!e)return this;const n=e.length,r=this.isRendered;for(let i=0;i<n;i++){const s=e[i];s.updateVisibility(),s.isVisible()&&this.ensureToolRendered(e,i)&&t.tool!==s.cid&&s.update()}return!this.isRendered&&n>0?this:(this.isMounted()||this.mount(),r||this.blurTool(),this)},ensureToolRendered(t,e){return this.isRendered||(this.isRendered=Array(t.length).fill(!1)),this.isRendered[e]?!0:(t[e].render(),this.isRendered[e]=!0,!1)},focusTool:function(t){var e=this.tools;if(!e)return this;for(var n=0,r=e.length;n<r;n++){var i=e[n];t===i?i.show():i.hide()}return this},blurTool:function(t){var e=this.tools;if(!e)return this;for(var n=0,r=e.length;n<r;n++){var i=e[n];i!==t&&!i.isExplicitlyVisible()&&(i.show(),i.isVisible()&&this.ensureToolRendered(e,n)&&i.update())}return this},hide:function(){return this.focusTool(null)},show:function(){return this.blurTool(null),this.isMounted()||this.mount(),this},onRemove:function(){var t=this.tools;if(!t)return this;for(var e=0,n=t.length;e<n;e++)t[e].remove();this.tools=null},getLayer(){const{layer:t=rf.Layers.TOOLS}=this.options;return t},hasLayer(){return!!this.getLayer()},mount:function(){const{options:t,el:e}=this,{relatedView:n,z:r}=t;return n&&(this.hasLayer()?n.paper.getLayerView(this.getLayer()).insertSortedNode(e,r):n.el.appendChild(e)),this}});var P0={__proto__:null,Cell:Ce,CellCollection:jh,CellView:vt,DEFAULT_GRAPH_LAYER_TYPE:Xo,Element:Kt,ElementView:Or,Graph:Jo,GraphLayer:Yh,GraphLayerCollection:Ko,GraphLayerView:Nr,GridLayerView:Jh,HighlighterView:ce,LayerView:Ge,Link:Pr,LinkView:ue,Paper:rf,ToolView:ze,ToolsView:A0,attributes:To,sortingTypes:Sn},sf=le.extend({tagName:"circle",svgElement:!0,className:"marker-vertex",events:{mousedown:"onPointerDown",touchstart:"onPointerDown",dblclick:"onDoubleClick",dbltap:"onDoubleClick"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},attributes:{r:6,fill:"#33334F",stroke:"#FFFFFF","stroke-width":2,cursor:"move"},position:function(t,e){const{vel:n,options:r}=this,{scale:i}=r;let s=N.createSVGMatrix().translate(t,e);i&&(s=s.scale(i)),n.transform(s,{absolute:!0})},onPointerDown:function(t){this.options.guard(t)||(t.stopPropagation(),t.preventDefault(),this.options.paper.undelegateEvents(),this.delegateDocumentEvents(null,t.data),this.trigger("will-change",this,t))},onPointerMove:function(t){this.trigger("changing",this,t)},onDoubleClick:function(t){this.trigger("remove",this,t)},onPointerUp:function(t){this.trigger("changed",this,t),this.undelegateDocumentEvents(),this.options.paper.delegateEvents()}});const T0=ze.extend({name:"vertices",options:{handleClass:sf,snapRadius:20,redundancyRemoval:!0,vertexAdding:!0,stopPropagation:!0,scale:null},children:[{tagName:"path",selector:"connection",className:"joint-vertices-path",attributes:{fill:"none",stroke:"transparent","stroke-width":10,cursor:"cell"}}],handles:null,interactiveLinkNode:null,events:{"mousedown .joint-vertices-path":"onPathPointerDown","touchstart .joint-vertices-path":"onPathPointerDown"},linkEvents:{mousedown:"onLinkPointerDown",touchstart:"onLinkPointerDown"},onRender:function(){const{vertexAdding:t}=this.options;if(t){const{interactiveLinkNode:e=null}=t;e?this.delegateLinkEvents(e):(this.renderChildren(),this.updatePath())}return this.resetHandles(),this.renderHandles(),this},delegateLinkEvents:function(t){this.undelegateLinkEvents();const e=this.relatedView.findNode(t);if(!e){console.warn(`Interactive link node "${t}" not found.`);return}e.classList.add("joint-vertices-path"),this.interactiveLinkNode=e,this.delegateElementEvents(e,this.linkEvents)},undelegateLinkEvents:function(){const t=this.interactiveLinkNode;t&&(this.undelegateElementEvents(t),t.classList.remove("joint-vertices-path"),this.interactiveLinkNode=null)},update:function(){var t=this.relatedView,e=t.model.vertices();return e.length===this.handles.length?this.updateHandles():(this.resetHandles(),this.renderHandles()),this.options.vertexAdding&&this.updatePath(),this},resetHandles:function(){var t=this.handles;if(this.handles=[],this.stopListening(),!!Array.isArray(t))for(var e=0,n=t.length;e<n;e++)t[e].remove()},renderHandles:function(){for(var t=this.relatedView,e=t.model.vertices(),n=0,r=e.length;n<r;n++){var i=e[n],s=new this.options.handleClass({index:n,paper:this.paper,scale:this.options.scale,guard:o=>this.guard(o)});s.render(),s.position(i.x,i.y),this.simulateRelatedView(s.el),s.vel.appendTo(this.el),this.handles.push(s),this.startHandleListening(s)}},updateHandles:function(){for(var t=this.relatedView,e=t.model.vertices(),n=0,r=e.length;n<r;n++){var i=e[n],s=this.handles[n];if(!s)return;s.position(i.x,i.y)}},updatePath:function(){if(this.interactiveLinkNode)return;const t=this.childNodes.connection;t&&t.setAttribute("d",this.relatedView.getSerializedConnection())},startHandleListening:function(t){const{vertexRemoving:e=!0,vertexMoving:n=!0}=this.options;n&&(this.listenTo(t,"will-change",this.onHandleWillChange),this.listenTo(t,"changing",this.onHandleChanging),this.listenTo(t,"changed",this.onHandleChanged)),e&&this.listenTo(t,"remove",this.onHandleRemove)},getNeighborPoints:function(t){var e=this.relatedView,n=e.model.vertices(),r=t>0?n[t-1]:e.sourceAnchor,i=t<n.length-1?n[t+1]:e.targetAnchor;return{prev:new S(r),next:new S(i)}},onHandleWillChange:function(t,e){this.focus();const{relatedView:n,options:r}=this;n.model.startBatch("vertex-move",{ui:!0,tool:this.cid}),r.stopPropagation||n.notifyPointerdown(...n.paper.getPointerArgs(e))},onHandleChanging:function(t,e){const{options:n,relatedView:r}=this;var i=t.options.index,[s,o,l]=r.paper.getPointerArgs(e),a={x:o,y:l};this.snapVertex(a,i),r.model.vertex(i,a,{ui:!0,tool:this.cid}),t.position(a.x,a.y),n.stopPropagation||r.notifyPointermove(s,o,l)},onHandleChanged:function(t,e){const{options:n,relatedView:r}=this;n.vertexAdding&&this.updatePath(),n.redundancyRemoval&&r.removeRedundantLinearVertices({ui:!0,tool:this.cid})&&this.render(),this.blur(),r.model.stopBatch("vertex-move",{ui:!0,tool:this.cid}),this.eventData(e).vertexAdded&&r.model.stopBatch("vertex-add",{ui:!0,tool:this.cid});const[i,s,o]=r.paper.getPointerArgs(e);n.stopPropagation||r.notifyPointerup(i,s,o),r.checkMouseleave(i)},snapVertex:function(t,e){var n=this.options.snapRadius;if(n>0){var r=this.getNeighborPoints(e),i=r.prev,s=r.next;Math.abs(t.x-i.x)<n?t.x=i.x:Math.abs(t.x-s.x)<n&&(t.x=s.x),Math.abs(t.y-i.y)<n?t.y=r.prev.y:Math.abs(t.y-s.y)<n&&(t.y=s.y)}},onHandleRemove:function(t,e){var n=t.options.index,r=this.relatedView;r.model.removeVertex(n,{ui:!0}),this.options.vertexAdding&&this.updatePath(),r.checkMouseleave(St(e))},onPathPointerDown:function(t){if(!this.guard(t)){t.stopPropagation(),t.preventDefault();var e=St(t),n=this.paper.snapToGrid(e.clientX,e.clientY).toJSON(),r=this.relatedView;r.model.startBatch("vertex-add",{ui:!0,tool:this.cid});var i=r.getVertexIndex(n.x,n.y);this.snapVertex(n,i),r.model.insertVertex(i,n,{ui:!0,tool:this.cid}),this.update();var s=this.handles[i];this.eventData(e,{vertexAdded:!0}),s.onPointerDown(e)}},onLinkPointerDown:function(t){this.relatedView.preventDefaultInteraction(t),this.onPathPointerDown(t)},onRemove:function(){this.resetHandles(),this.undelegateLinkEvents()}},{VertexHandle:sf});function jn(t,{useModelGeometry:e=!1,relative:n=!1,el:r=t.el}={}){const{model:i}=t;let s;if(e?s=i.getBBox():i.isLink()?s=t.getConnection().bbox():s=t.getNodeUnrotatedBBox(r),n){const o=i.position();s.x-=o.x,s.y-=o.y}return s}function kr(t){const e=!t.isOverlay(),{useModelGeometry:n,rotate:r,...i}=t.options;return{...i,useModelGeometry:n||e,rotate:r||e,relative:e}}function of(t,e,n){var r=Ah.call(this.paper,{},e,n,t,this.model);return r.anchor}function S0(t,e,n,r,i,s){var o=s.options.snapRadius,l=r==="source",a=l?0:-1,c=this.model.vertex(a)||this.getEndAnchor(l?"target":"source");return c&&(Math.abs(c.x-t.x)<o&&(t.x=c.x),Math.abs(c.y-t.y)<o&&(t.y=c.y)),t}var af=le.extend({tagName:"g",svgElement:!0,className:"marker-segment",events:{mousedown:"onPointerDown",touchstart:"onPointerDown"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},children:[{tagName:"line",selector:"line",attributes:{stroke:"#33334F","stroke-width":2,fill:"none","pointer-events":"none"}},{tagName:"rect",selector:"handle",attributes:{width:20,height:8,x:-10,y:-4,rx:4,ry:4,fill:"#33334F",stroke:"#FFFFFF","stroke-width":2}}],onRender:function(){this.renderChildren()},position:function(t,e,n,r){const{scale:i}=this.options;let s=N.createSVGMatrix().translate(t,e).rotate(n);i&&(s=s.scale(i));var o=this.childNodes.handle;o.setAttribute("transform",N.matrixToTransformString(s)),o.setAttribute("cursor",n%180===0?"row-resize":"col-resize");var l=r.getClosestPoint(new S(t,e)),a=this.childNodes.line;a.setAttribute("x1",t),a.setAttribute("y1",e),a.setAttribute("x2",l.x),a.setAttribute("y2",l.y)},onPointerDown:function(t){this.options.guard(t)||(this.trigger("change:start",this,t),t.stopPropagation(),t.preventDefault(),this.options.paper.undelegateEvents(),this.delegateDocumentEvents(null,t.data))},onPointerMove:function(t){this.trigger("changing",this,t)},onPointerUp:function(t){this.undelegateDocumentEvents(),this.options.paper.delegateEvents(),this.trigger("change:end",this,t)},show:function(){this.el.style.display=""},hide:function(){this.el.style.display="none"}});const E0=ze.extend({name:"segments",precision:.5,options:{handleClass:af,segmentLengthThreshold:40,redundancyRemoval:!0,anchor:of,snapRadius:10,snapHandle:!0,stopPropagation:!0},handles:null,onRender:function(){this.resetHandles();var t=this.relatedView,e=t.model.vertices();e.unshift(t.sourcePoint),e.push(t.targetPoint);for(var n=0,r=e.length;n<r-1;n++){var i=e[n],s=e[n+1],o=this.renderHandle(i,s);this.simulateRelatedView(o.el),this.handles.push(o),o.options.index=n}return this},renderHandle:function(t,e){var n=new this.options.handleClass({paper:this.paper,scale:this.options.scale,guard:r=>this.guard(r)});return n.render(),this.updateHandle(n,t,e),n.vel.appendTo(this.el),this.startHandleListening(n),n},update:function(){return this.render(),this},startHandleListening:function(t){this.listenTo(t,"change:start",this.onHandleChangeStart),this.listenTo(t,"changing",this.onHandleChanging),this.listenTo(t,"change:end",this.onHandleChangeEnd)},resetHandles:function(){var t=this.handles;if(this.handles=[],this.stopListening(),!!Array.isArray(t))for(var e=0,n=t.length;e<n;e++)t[e].remove()},shiftHandleIndexes:function(t){for(var e=this.handles,n=0,r=e.length;n<r;n++)e[n].options.index+=t},resetAnchor:function(t,e){var n=this.relatedView.model;e?n.prop([t,"anchor"],e,{rewrite:!0,ui:!0,tool:this.cid}):n.removeProp([t,"anchor"],{ui:!0,tool:this.cid})},snapHandle:function(t,e,n){var r=t.options.index,i=this.relatedView,s=i.model,o=s.vertices(),l=t.options.axis,a=o[r-2]||n.sourceAnchor,c=o[r+1]||n.targetAnchor,u=this.options.snapRadius;return Math.abs(e[l]-a[l])<u?e[l]=a[l]:Math.abs(e[l]-c[l])<u&&(e[l]=c[l]),e},onHandleChanging:function(t,e){const{options:n}=this;var r=this.eventData(e),i=this.relatedView,s=i.paper,o=t.options.index-1,l=St(e),a=s.snapToGrid(l.clientX,l.clientY),c=this.snapHandle(t,a.clone(),r),u=t.options.axis,h=this.options.snapHandle?0:a[u]-c[u],g=i.model,d=zt(g.vertices()),v=this.options.anchor;typeof v!="function"&&(v=null);const y=t.options.index,x=[i.sourcePoint.clone(),...d,i.targetPoint.clone()];let A=0;if(y-1>=0){const L=x[y-1],_=x[y];new W(L,_).vector().theta()%90!==0&&(d.splice(y-1,0,r.originalVertices[y-1]),A++,this.shiftHandleIndexes(1))}var T=d[o+A],f=d[o+1+A];if(y+2<x.length){const L=x[y+1],_=x[y+2];if(new W(L,_).vector().theta()%90!==0){const O=r.originalVertices.length===1,K=O?0:y,et=r.firstHandleShifted&&!O?1:0;let Q=1+A;d.splice(y+Q,0,r.originalVertices[K-et])}}var p=i.sourceView,m=i.sourceBBox,w=!1,b=!1;if(T?o===0?m.containsPoint(T)?(d.shift(),this.shiftHandleIndexes(-1),w=!0):(T[u]=c[u],b=!0):T[u]=c[u]:(T=i.sourceAnchor.toJSON(),T[u]=c[u],m.containsPoint(T)?(T[u]=c[u],w=!0):(d.unshift(T),this.shiftHandleIndexes(1),r.firstHandleShifted=!0,b=!0)),v&&p){if(w){var P=r.sourceAnchor.clone();P[u]=c[u];var E=v.call(i,P,p,i.sourceMagnet||p.el,"source",i);this.resetAnchor("source",E)}b&&this.resetAnchor("source",r.sourceAnchorDef)}var C=i.targetView,k=i.targetBBox,I=!1,D=!1;if(f?o===d.length-2?k.containsPoint(f)?(d.pop(),I=!0):(f[u]=c[u],D=!0):f[u]=c[u]:(f=i.targetAnchor.toJSON(),f[u]=c[u],k.containsPoint(f)?I=!0:(d.push(f),D=!0)),v&&C){if(I){var H=r.targetAnchor.clone();H[u]=c[u];var X=v.call(i,H,C,i.targetMagnet||C.el,"target",i);this.resetAnchor("target",X)}D&&this.resetAnchor("target",r.targetAnchorDef)}if(d.some(L=>!L))throw new Error("Segments: incompatible router in use");g.vertices(d,{ui:!0,tool:this.cid}),this.updateHandle(t,T,f,h),n.stopPropagation||i.notifyPointermove(l,a.x,a.y)},onHandleChangeStart:function(t,e){const{options:n,handles:r,relatedView:i}=this,{model:s,paper:o}=i;var l=t.options.index;if(Array.isArray(r)){for(var a=0,c=r.length;a<c;a++)a!==l&&r[a].hide();this.focus(),this.eventData(e,{sourceAnchor:i.sourceAnchor.clone(),targetAnchor:i.targetAnchor.clone(),sourceAnchorDef:kt(s.prop(["source","anchor"])),targetAnchorDef:kt(s.prop(["target","anchor"])),originalVertices:zt(s.vertices()),firstHandleShifted:!1}),s.startBatch("segment-move",{ui:!0,tool:this.cid}),n.stopPropagation||i.notifyPointerdown(...o.getPointerArgs(e))}},onHandleChangeEnd:function(t,e){const{options:n,relatedView:r}=this,{paper:i,model:s}=r;n.redundancyRemoval&&r.removeRedundantLinearVertices({ui:!0,tool:this.cid});const o=St(e),l=i.snapToGrid(o.clientX,o.clientY);this.render(),this.blur(),s.stopBatch("segment-move",{ui:!0,tool:this.cid}),n.stopPropagation||r.notifyPointerup(o,l.x,l.y),r.checkMouseleave(o)},updateHandle:function(t,e,n,r){var i=Math.abs(e.x-n.x)<this.precision,s=Math.abs(e.y-n.y)<this.precision;if(i||s){var o=new W(e,n),l=o.length();if(l<this.options.segmentLengthThreshold)t.hide();else{var a=o.midpoint(),c=i?"x":"y";a[c]+=r||0;var u=o.vector().vectorAngle(new S(1,0));t.position(a.x,a.y,u,this.relatedView),t.show(),t.options.axis=c}}else t.hide()},onRemove:function(){this.resetHandles()}},{SegmentHandle:af}),lf=ze.extend({tagName:"path",xAxisVector:new S(1,0),events:{mousedown:"onPointerDown",touchstart:"onPointerDown"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},options:{scale:null},onRender:function(){this.update()},update:function(){var t=this.ratio,e=this.relatedView,n=e.getTangentAtRatio(t),r,i;if(n?(r=n.start,i=n.vector().vectorAngle(this.xAxisVector)||0):(r=e.getPointAtRatio(t),i=0),!r)return this;var s=N.createSVGMatrix().translate(r.x,r.y).rotate(i);const{scale:o}=this.options;return o&&(s=s.scale(o)),this.vel.transform(s,{absolute:!0}),this},onPointerDown:function(t){if(this.guard(t))return;t.stopPropagation(),t.preventDefault();var e=this.relatedView,n=e.paper;e.model.startBatch("arrowhead-move",{ui:!0,tool:this.cid}),e.startArrowheadMove(this.arrowheadType);const r=t.data||(t.data={});this.delegateDocumentEvents(null,r),n.undelegateEvents(),this.focus(),this.el.style.pointerEvents="none",e.notifyPointerdown(...n.getPointerArgs(t))},onPointerMove:function(t){var e=St(t),n=this.paper.snapToGrid(e.clientX,e.clientY);this.relatedView.pointermove(e,n.x,n.y)},onPointerUp:function(t){this.undelegateDocumentEvents();var e=this.relatedView,n=e.paper,r=St(t),i=n.snapToGrid(r.clientX,r.clientY);e.pointerup(r,i.x,i.y),n.delegateEvents(),this.blur(),this.el.style.pointerEvents="",e.model.stopBatch("arrowhead-move",{ui:!0,tool:this.cid})}}),C0=lf.extend({name:"target-arrowhead",ratio:1,arrowheadType:"target",attributes:{d:"M -10 -8 10 0 -10 8 Z",fill:"#33334F",stroke:"#FFFFFF","stroke-width":2,cursor:"move",class:"target-arrowhead"}}),L0=lf.extend({name:"source-arrowhead",ratio:0,arrowheadType:"source",attributes:{d:"M 10 -8 -10 0 10 8 Z",fill:"#33334F",stroke:"#FFFFFF","stroke-width":2,cursor:"move",class:"source-arrowhead"}}),cf=ze.extend({tagName:"g",type:null,children:[{tagName:"circle",selector:"anchor",attributes:{cursor:"pointer"}},{tagName:"rect",selector:"area",attributes:{"pointer-events":"none",fill:"none",stroke:"#33334F","stroke-dasharray":"2,4",rx:5,ry:5}}],events:{mousedown:"onPointerDown",touchstart:"onPointerDown",dblclick:"onPointerDblClick",dbltap:"onPointerDblClick"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},options:{snap:S0,anchor:of,scale:null,resetAnchor:!0,customAnchorAttributes:{"stroke-width":4,stroke:"#33334F",fill:"#FFFFFF",r:5},defaultAnchorAttributes:{"stroke-width":2,stroke:"#FFFFFF",fill:"#33334F",r:6},areaPadding:6,snapRadius:10,restrictArea:!0,redundancyRemoval:!0},onRender:function(){this.renderChildren(),this.toggleArea(!1),this.update()},update:function(){var t=this.type,e=this.relatedView,n=e.getEndView(t);return n?(this.updateAnchor(),this.updateArea(),this.el.style.display=""):this.el.style.display="none",this},updateAnchor:function(){var t=this.childNodes;if(!t)return;var e=t.anchor;if(!e)return;var n=this.relatedView,r=this.type,i=n.getEndAnchor(r),s=this.options,o=n.model.prop([r,"anchor"]);let l=`translate(${i.x},${i.y})`;s.scale&&(l+=` scale(${s.scale})`),e.setAttribute("transform",l);var a=o?s.customAnchorAttributes:s.defaultAnchorAttributes;for(var c in a)e.setAttribute(c,a[c])},updateArea:function(){var t=this.childNodes;if(t){var e=t.area;if(e){var n=this.relatedView,r=this.type,i=n.getEndView(r),s=i.model,o=n.getEndMagnet(r),l=this.options.areaPadding;isFinite(l)||(l=0);var a,c,u;i.isNodeConnection(o)?(a=i.getNodeBBox(o),c=0,u=a.center()):(a=i.getNodeUnrotatedBBox(o),c=s.angle(),u=a.center(),c&&u.rotate(s.getCenter(),-c)),a.inflate(l),e.setAttribute("x",-a.width/2),e.setAttribute("y",-a.height/2),e.setAttribute("width",a.width),e.setAttribute("height",a.height),e.setAttribute("transform","translate("+u.x+","+u.y+") rotate("+c+")")}}},toggleArea:function(t){var e=this.childNodes;if(e){var n=e.area;n&&(n.style.display=t?"":"none")}},onPointerDown:function(t){this.guard(t)||(t.stopPropagation(),t.preventDefault(),this.paper.undelegateEvents(),this.delegateDocumentEvents(),this.focus(),this.toggleArea(this.options.restrictArea),this.relatedView.model.startBatch("anchor-move",{ui:!0,tool:this.cid}))},resetAnchor:function(t){var e=this.type,n=this.relatedView.model;t?n.prop([e,"anchor"],t,{rewrite:!0,ui:!0,tool:this.cid}):n.removeProp([e,"anchor"],{ui:!0,tool:this.cid})},onPointerMove:function(t){var e=this.relatedView,n=this.type,r=e.getEndView(n),i=r.model,s=e.getEndMagnet(n),o=St(t),l=this.paper.clientToLocalPoint(o.clientX,o.clientY),a=this.options.snap;if(typeof a=="function"&&(l=a.call(e,l,r,s,n,e,this),l=new S(l)),this.options.restrictArea)if(r.isNodeConnection(s)){var c=r.getClosestPoint(l);c&&(l=c)}else{var u=r.getNodeUnrotatedBBox(s),h=i.angle(),g=i.getCenter(),d=l.clone().rotate(g,h);u.containsPoint(d)||(l=u.pointNearestToPoint(d).rotate(g,-h))}var v,y=this.options.anchor;typeof y=="function"&&(v=y.call(e,l,r,s,n,e)),this.resetAnchor(v),this.update()},onPointerUp:function(t){const e=St(t);this.paper.delegateEvents(),this.undelegateDocumentEvents(),this.blur(),this.toggleArea(!1);var n=this.relatedView;this.options.redundancyRemoval&&n.removeRedundantLinearVertices({ui:!0,tool:this.cid}),n.checkMouseleave(e),n.model.stopBatch("anchor-move",{ui:!0,tool:this.cid})},onPointerDblClick:function(){var t=this.options.resetAnchor;t!==!1&&(t===!0&&(t=null),this.resetAnchor(zt(t)),this.update())}}),_0=cf.extend({name:"source-anchor",type:"source"}),M0=cf.extend({name:"target-anchor",type:"target"}),$i=ze.extend({tagName:"g",children:[{tagName:"circle",selector:"handle",attributes:{cursor:"pointer","stroke-width":2,stroke:"#FFFFFF",fill:"#33334F",r:6}},{tagName:"rect",selector:"extras",attributes:{"pointer-events":"none",fill:"none",stroke:"#33334F","stroke-dasharray":"2,4",rx:5,ry:5}}],events:{mousedown:"onPointerDown",touchstart:"onPointerDown",dblclick:"onPointerDblClick",dbltap:"onPointerDblClick"},documentEvents:{mousemove:"onPointerMove",touchmove:"onPointerMove",mouseup:"onPointerUp",touchend:"onPointerUp",touchcancel:"onPointerUp"},options:{handleAttributes:null,selector:"root",padding:6,scale:null},getPosition:function(){},setPosition:function(){},resetPosition:function(){},onRender:function(){this.renderChildren(),this.toggleExtras(!1),this.update()},update:function(){const{handle:t,extras:e}=this.childNodes;if(t)this.updateHandle(t);else throw new Error("Control: markup selector `handle` is required");return e&&this.updateExtras(e),this},updateHandle:function(t){const{options:{handleAttributes:e}}=this;if(t.setAttribute("transform",this.getHandleTransformString()),e)for(let n in e)t.setAttribute(n,e[n])},getHandleTransformString(){const{relatedView:t,options:e}=this,{scale:n}=e,{model:r}=t,i=this.getPosition(t,this),s=this.isOverlay()?r.getAbsolutePointFromRelative(i):i;let o=`translate(${s.x},${s.y})`;return n&&(o+=` scale(${n})`),o},updateExtras:function(t){const{relatedView:e,options:n}=this,{selector:r,relative:i,useModelGeometry:s}=kr(this);if(!r){this.toggleExtras(!1);return}let o;if(s)r!=="root"&&console.warn("Control: selector will be ignored when `useModelGeometry` is used."),o=jn(e,{useModelGeometry:s,relative:i});else{const h=e.findNode(r);if(!h)throw new Error("Control: invalid selector.");o=jn(e,{el:h})}let l=n.padding;isFinite(l)||(l=0);const a=e.model,c=i?0:a.angle(),u=o.center();c&&u.rotate(a.getCenter(),-c),o.inflate(l),t.setAttribute("x",-o.width/2),t.setAttribute("y",-o.height/2),t.setAttribute("width",o.width),t.setAttribute("height",o.height),t.setAttribute("transform",`translate(${u.x},${u.y}) rotate(${c})`)},toggleExtras:function(t){const{extras:e}=this.childNodes;e&&(e.style.display=t?"":"none")},onPointerDown:function(t){const{relatedView:e,paper:n}=this;this.guard(t)||(t.stopPropagation(),t.preventDefault(),n.undelegateEvents(),this.delegateDocumentEvents(),this.focus(),this.toggleExtras(!0),e.model.startBatch("control-move",{ui:!0,tool:this.cid}))},onPointerMove:function(t){const{relatedView:e,paper:n}=this,{model:r}=e,{clientX:i,clientY:s}=St(t),o=n.clientToLocalPoint(i,s),l=r.getRelativePointFromAbsolute(o);this.setPosition(e,l,t),this.update()},onPointerUp:function(t){const{relatedView:e,paper:n}=this;n.delegateEvents(),this.undelegateDocumentEvents(),this.blur(),this.toggleExtras(!1),e.model.stopBatch("control-move",{ui:!0,tool:this.cid})},onPointerDblClick:function(t){const{relatedView:e}=this;this.resetPosition(e,t),this.update()}}),O0=$i.extend({xAxisVector:new S(1,0),children(){const{buttonColor:t="#333",iconColor:e="#fff",outlineColor:n="#fff"}=this.options;return[{selector:"handle",tagName:"g",attributes:{cursor:"grab"},children:[{tagName:"circle",attributes:{r:10,fill:t,stroke:n}},{tagName:"path",attributes:{d:"M -5 0 A 5 5 0 1 1 0 5",fill:"transparent",stroke:e,strokeWidth:2,strokeLinecap:"round"}},{tagName:"path",attributes:{d:"M -3 5 L 0 2.5 0 7.5 Z",fill:e,stroke:e,strokeWidth:1,transform:"rotate(-5, -3, 5)"}}]}]},getPosition(t){const{offset:e=0}=this.options,{x:n=0,y:r=0}=typeof e=="number"?{x:0,y:e}:e,i=this.getLabel(),s=this.getLabelPosition(i),o=t.getLabelCoordinates(s);let{angle:l=0,args:a={}}=s;if(a.keepGradient){const h=t.getTangentAtRatio(t.getClosestPointRatio(o));h&&(l+=h.vector().vectorAngle(this.xAxisVector)||0)}const u=new DOMMatrix().translate(o.x,o.y).rotate(l).translate(n,r);return new S(u.e,u.f)},computeVisibility(){return $i.prototype.computeVisibility.apply(this,arguments)&&!!this.getLabel()},setPosition(t,e){const n=t.model,r=this.getLabel();if(!r)return;const i=this.getLabelPosition(r),o=90-t.getLabelCoordinates(i).theta(e),l=this.getLabelIndex();n.prop(["labels",l,"position","angle"],o)},resetPosition(t){const e=t.model,n=this.getLabelIndex();e.prop(["labels",n,"position","angle"],0)},getLabelIndex(){return this.options.labelIndex||0},getLabel(){return this.relatedView.model.label(this.getLabelIndex())||null},getLabelPosition(t){const e=this.relatedView,n=e._normalizeLabelPosition(t.position);return e._mergeLabelPositionProperty(n,e._getDefaultLabelPositionProperty())}}),Hi=ze.extend({name:"button",events:{mousedown:"onPointerDown",touchstart:"onPointerDown"},options:{distance:0,offset:0,scale:null,rotate:!1},onRender:function(){this.renderChildren(this.options.markup),this.update()},update:function(){return this.position(),this},position:function(){const{vel:t}=this;t.transform(this.getCellMatrix(),{absolute:!0})},getCellMatrix(){return this.relatedView.model.isLink()?this.getLinkMatrix():this.getElementMatrix()},getElementMatrix(){const{relatedView:t}=this;let{x:e=0,y:n=0,offset:r={},useModelGeometry:i,rotate:s,scale:o,relative:l}=kr(this),a=jn(t,{useModelGeometry:i,relative:l});const c=t.model.angle();s||(a=a.bbox(c));const{x:u=0,y:h=0}=r;Ut(e)?e=parseFloat(e)/100*a.width:Se(e)&&(e=Number(Ee(e,a))),Ut(n)?n=parseFloat(n)/100*a.height:Se(n)&&(n=Number(Ee(n,a)));let g=N.createSVGMatrix().translate(a.x+a.width/2,a.y+a.height/2);return s&&!l&&(g=g.rotate(c)),g=g.translate(e+u-a.width/2,n+h-a.height/2),o&&(g=g.scale(o)),g},getLinkMatrix(){const{relatedView:t,options:e}=this,{offset:n=0,distance:r=0,rotate:i,scale:s}=e,o=typeof r=="function"?r.call(this,t,this):r;let l,a,c;Ut(o)?l=t.getTangentAtRatio(parseFloat(o)/100):l=t.getTangentAtLength(o),l?(a=l.start,c=l.vector().vectorAngle(new S(1,0))||0):(a=t.getConnection().start,c=0);let u=N.createSVGMatrix().translate(a.x,a.y).rotate(c).translate(0,n);return i||(u=u.rotate(-c)),s&&(u=u.scale(s)),u},onPointerDown:function(t){if(!this.guard(t)){t.stopPropagation(),t.preventDefault();var e=this.options.action;typeof e=="function"&&e.call(this.relatedView,t,this.relatedView,this)}}}),uf=Hi.extend({name:"remove",children:[{tagName:"circle",selector:"button",attributes:{r:7,fill:"#FF1D00",cursor:"pointer"}},{tagName:"path",selector:"icon",attributes:{d:"M -3 -3 3 3 M -3 3 3 -3",fill:"none",stroke:"#FFFFFF","stroke-width":2,"pointer-events":"none"}}],options:{distance:60,offset:0,action:function(t,e,n){e.model.remove({ui:!0,tool:n.cid})}}}),hf=ze.extend({name:"boundary",tagName:"rect",options:{padding:10,useModelGeometry:!1},attributes:{fill:"none",stroke:"#33334F","stroke-width":.5,"stroke-dasharray":"5, 5","pointer-events":"none"},onRender:function(){this.update()},update:function(){const{relatedView:t,vel:e}=this,{useModelGeometry:n,rotate:r,relative:i,padding:s}=kr(this),o=Te(s);let l=jn(t,{useModelGeometry:n,relative:i}).moveAndExpand({x:-o.left,y:-o.top,width:o.left+o.right,height:o.top+o.bottom});const a=t.model;if(a.isElement()&&!i){const c=a.angle();if(c)if(r){const u=a.getCenter();e.rotate(c,u.x,u.y,{absolute:!0})}else l=l.bbox(c)}return e.attr(l.toJSON()),this}}),Ir=Hi.extend({name:"connect",documentEvents:{mousemove:"drag",touchmove:"drag",mouseup:"dragend",touchend:"dragend",touchcancel:"dragend"},children:[{tagName:"circle",selector:"button",attributes:{r:7,fill:"#333333",cursor:"pointer"}},{tagName:"path",selector:"icon",attributes:{d:"M -4 -1 L 0 -1 L 0 -4 L 4 0 L 0 4 0 1 -4 1 z",fill:"#FFFFFF",stroke:"none","stroke-width":2,"pointer-events":"none"}}],options:{distance:80,offset:0,magnet:t=>t.el,action:(t,e,n)=>n.dragstart(t)},getMagnetNode:function(){const{options:t,relatedView:e}=this,{magnet:n}=t;let r;switch(typeof n){case"function":{r=n.call(this,e,this);break}case"string":{r=e.findNode(n);break}default:{r=n;break}}if(r||(r=e.el),r instanceof SVGElement)return r;throw new Error("Connect: magnet must be an SVGElement")},dragstart:function(t){const{paper:e,relatedView:n}=this,r=St(t),{x:i,y:s}=e.clientToLocalPoint(r.clientX,r.clientY);n.dragLinkStart(r,this.getMagnetNode(),i,s),e.undelegateEvents(),this.delegateDocumentEvents(null,r.data),this.focus()},drag:function(t){const{paper:e,relatedView:n}=this,r=St(t),{x:i,y:s}=e.snapToGrid(r.clientX,r.clientY);n.dragLink(r,i,s)},dragend:function(t){const{paper:e,relatedView:n}=this,r=St(t),{x:i,y:s}=e.snapToGrid(r.clientX,r.clientY);n.dragLinkEnd(r,i,s),this.undelegateDocumentEvents(),e.delegateEvents(),this.blur(),n.checkMouseleave(r)}}),ff=Ir.extend({name:"hover-connect",defaultMarkup:[{tagName:"circle",attributes:{r:7,fill:"#333333",cursor:"pointer"}},{tagName:"path",attributes:{d:"M -4 -1 L 0 -1 L 0 -4 L 4 0 L 0 4 0 1 -4 1 z",fill:"#FFFFFF",stroke:"none","stroke-width":2}}],children(){const{options:t,defaultMarkup:e}=this;return[{tagName:"path",selector:"track",attributes:{fill:"none",stroke:"transparent","stroke-width":t.trackWidth||15,cursor:"pointer"}},{tagName:"g",selector:"button",attributes:{"pointer-events":"none",display:"none"},children:t.markup||e}]},events:Object.assign({mousemove:"onMousemove",mouseenter:"onMouseenter",mouseleave:"onMouseleave"},Ir.prototype.events),onRender:function(){this.renderChildren(),this.update()},trackPath:null,update(){const{childNodes:t}=this;this.trackPath=this.getTrackPath(),Ir.prototype.update.apply(this,arguments),t.track.setAttribute("d",this.trackPath.serialize())},position(){const{el:t,childNodes:e}=this;e.button.setAttribute("transform",N.matrixToTransformString(this.getButtonMatrix())),t.setAttribute("transform",N.matrixToTransformString(this.getTrackMatrix()))},getButtonMatrix(){const{options:t,trackPath:e}=this,{offset:n=0,distance:r=0,rotate:i,scale:s}=t;let o,l,a;Ut(r)?o=e.tangentAtRatio(parseFloat(r)/100):o=e.tangentAtLength(r),o?(l=o.start,a=o.vector().vectorAngle(new S(1,0))||0):(l=e.start,a=0);let c=N.createSVGMatrix().translate(l.x,l.y).rotate(a).translate(0,n);return i||(c=c.rotate(-a)),s&&(c=c.scale(s)),c},getTrackPath(){return this.relatedView.getConnection()},getTrackMatrix(){return N.createSVGMatrix()},getTrackMatrixAbsolute(){return this.getTrackMatrix()},getTrackRatioFromEvent(t){const{relatedView:e,trackPath:n}=this,r=e.paper.clientToLocalPoint(t.clientX,t.clientY),i=N.transformPoint(r,this.getTrackMatrixAbsolute().inverse());return n.closestPointLength(i)},canShowButton(){return z.event.has(this.paper.el)},showButton(){this.childNodes.button.style.display="block"},hideButton(){this.childNodes.button.style.display=""},onMousemove(t){const{trackPath:e}=this;if(!e)return;const{options:n}=this;n.distance=this.getTrackRatioFromEvent(t),this.position()},onMouseenter(){this.canShowButton()&&this.showButton()},onMouseleave(){this.hideButton()}});var N0={__proto__:null,Boundary:hf,Button:Hi,Connect:Ir,Control:$i,HoverConnect:ff,Remove:uf,RotateLabel:O0,Segments:E0,SourceAnchor:_0,SourceArrowhead:L0,TargetAnchor:M0,TargetArrowhead:C0,Vertices:T0};const k0=ff.extend({getTrackPath(){const{relatedView:t}=this;let{useModelGeometry:e,relative:n,trackPath:r="M 0 0 H calc(w) V calc(h) H 0 Z"}=kr(this);if(typeof r=="function"&&(r=r.call(this,t)),Se(r)){const i=jn(t,{useModelGeometry:e,relative:n});r=Ee(r,i)}return new Z(N.normalizePathData(r))},getTrackMatrix(){return this.isOverlay()?this.getTrackMatrixAbsolute():N.createSVGMatrix()},getTrackMatrixAbsolute(){const{relatedView:t}=this;let{useModelGeometry:e,rotate:n}=kr(this),r=jn(t,{useModelGeometry:e});const i=t.model.angle();n||(r=r.bbox(i));let s=N.createSVGMatrix().translate(r.x+r.width/2,r.y+r.height/2);return n&&(s=s.rotate(i)),s=s.translate(-r.width/2,-r.height/2),s}});var I0={__proto__:null,Boundary:hf,Button:Hi,Connect:Ir,Control:$i,HoverConnect:k0,Remove:uf},R0="4.2.0";const V0=N,D0=function(t,e){e=e||{},Ie(Oe,"setTheme",t,e),le.prototype.defaultTheme=t},F0={PortLabel:Yu,Port:$u},B0={},G0={};q.V=N,q.Vectorizer=V0,q.anchors=Wh,q.config=Bt,q.connectionPoints=wh,q.connectionStrategies=pw,q.connectors=uh,q.dia=P0,q.elementTools=I0,q.env=Mo,q.format=B0,q.g=Ol,q.highlighters=vh,q.layout=F0,q.linkAnchors=qh,q.linkTools=N0,q.mvc=Qy,q.routers=Uh,q.setTheme=D0,q.shapes=my,q.ui=G0,q.util=jm,q.version=R0})),typeof joint<"u"&&(joint.g,joint.V,joint.V)})(Vr,Vr.exports)),Vr.exports}var Ue=K0();const Z0=document.querySelector("#app");Z0.innerHTML=`
  <div class="app-shell">
    <div class="paper-wrapper">
      <div id="paper"></div>
      <button id="new-node-btn" class="floating-button primary">+ New instruction</button>
      <aside class="control-panel">
        <div class="panel-header">
          <h1>NonLinear GPT</h1>
          <p>Branch out prompts, remix context, and compare ideas side-by-side.</p>
          <button id="reset-canvas-btn" class="ghost small">Reset workspace</button>
        </div>
        <section>
          <h2>ChatGPT API Key</h2>
          <input id="api-key-input" name="openai-key" type="password" placeholder="sk-..." />
          <p class="muted">Key stays in your browser only. Leave empty to use the offline mock model.</p>
        </section>
        <section>
          <h2>Quick actions</h2>
          <div class="quick-actions">
            <button data-template="bread">Bread explainer</button>
            <button data-template="science">Science branch</button>
            <button data-template="blank">Blank trio</button>
          </div>
        </section>
        <section>
          <h2>How to use</h2>
          <ul>
            <li>Double-click empty space to create a node. Drag to pan, pinch/scroll to zoom.</li>
            <li>Connect nodes to pass the parent's answers into the child's prompt.</li>
            <li>When a parent changes, children show "Needs refresh" until you resend.</li>
          </ul>
        </section>
      </aside>
    </div>
  </div>
`;const xe=new Map;class J0{constructor(){this.apiKey=""}setApiKey(G){this.apiKey=G?.trim()??""}async ask({prompt:G,contextEntries:q}){const ct=q.length?q.map((Wt,Xn)=>{const Fr=Wt.prompt&&Wt.prompt.trim()?Wt.prompt.trim():`Parent #${Xn+1}`,Yi=Wt.response&&Wt.response.trim()?Wt.response.trim():"No response yet.";return`[${Xn+1}] ${Fr}
${Yi}`}).join(`

`):"No parent context provided.";if(!this.apiKey)return["Mock assistant response. Provide an OpenAI API key to talk to the real model.",`Prompt: ${G}`,`Context digest: ${ct.slice(0,280)}`].join(`

`);const nt={model:"gpt-4o-mini",messages:[{role:"system",content:"You are a helpful research assistant embedded in a node-based graph. Respond concisely and include lists when needed."},{role:"user",content:`Context:
${ct}

Prompt:
${G}`}],temperature:.4},pt=await fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:JSON.stringify(nt)});if(!pt.ok){const Wt=await pt.text();throw new Error(`OpenAI request failed: ${Wt}`)}const Dt=(await pt.json())?.choices?.[0]?.message?.content;if(!Dt)throw new Error("No content returned from OpenAI.");return Dt.trim()}}const ra=new J0,Sf=document.querySelector("#api-key-input"),Q0=document.getElementById("new-node-btn"),tb=document.getElementById("reset-canvas-btn"),na=window.localStorage.getItem("gptgraph.openaiKey");na&&(Sf.value=na,ra.setApiKey(na));Sf.addEventListener("input",V=>{const G=V.target.value??"";ra.setApiKey(G),G?window.localStorage.setItem("gptgraph.openaiKey",G):window.localStorage.removeItem("gptgraph.openaiKey")});const Vt=new Ue.dia.Graph({},{cellNamespace:Ue.shapes}),_n=document.getElementById("paper"),eb=Ue.dia.Link.define("app.StyledLink",{router:{name:"orthogonal"},connector:{name:"smooth"},attrs:{line:{connection:!0,fill:"none","pointer-events":"none",stroke:"#334155",strokeWidth:2.2,targetMarker:{type:"path",d:"M 10 -5 0 0 10 5 z",fill:"#334155"}}},markup:[{tagName:"path",selector:"line"}]});function En(){return new eb}const ie=new Ue.dia.Paper({el:_n,model:Vt,width:_n.clientWidth,height:_n.clientHeight,gridSize:24,drawGrid:{name:"fixedDot",args:{color:"#d2dbea",thickness:3}},background:{color:"#f8f9fb"},snapLinks:!0,linkPinning:!1,defaultLink:()=>En(),cellViewNamespace:Ue.shapes}),Af=10,nb=16,rb=11,ib=Ue.elementTools.Control.extend({children(){return[{tagName:"image",selector:"handle",attributes:{cursor:"pointer",width:20,height:20,"xlink:href":"https://assets.codepen.io/7589991/8725981_image_resize_square_icon.svg"}},{tagName:"rect",selector:"extras",attributes:{"pointer-events":"none",fill:"none",stroke:"#33334F","stroke-dasharray":"2,4",rx:5,ry:5}}]},getPosition(V){const{width:G,height:q}=V.model.size();return{x:G,y:q}},setPosition(V,G){const q=Math.max(G.x-Af,1),ct=Math.max(G.y-Af,1);V.model.resize(q,ct)}}),sb=[{tagName:"circle",selector:"button",attributes:{r:rb,fill:"#0f172a",stroke:"#fff","stroke-width":2,cursor:"pointer"}},{tagName:"path",selector:"icon",attributes:{d:"M -4 0 L 4 0 M 0 -4 L 0 4",stroke:"#fff","stroke-width":2,"stroke-linecap":"round","pointer-events":"none"}}];function Pf(){return new Ue.dia.ToolsView({tools:[new Ue.elementTools.Connect({selector:"body",x:"calc(w)",y:"calc(h / 2)",offset:{x:nb,y:0},useModelGeometry:!0,magnet:"body",distance:0,markup:sb}),new ib({selector:"body"})]})}function ob(V){const G=V.findView(ie);if(G){G.addTools(Pf());return}const q=()=>{const ct=V.findView(ie);ct&&(ct.addTools(Pf()),ie.off("render:done",q))};ie.on("render:done",q)}let qi=!1,Wi={x:0,y:0},ji={x:0,y:0},Cn=1;function Ef(){Wi={x:0,y:0},ji={x:0,y:0},Cn=1,ie.translate(0,0),ie.scale(1,1)}function Cf(){const V=ie.translate();if(Array.isArray(V)){const[G=0,q=0]=V;return{tx:G,ty:q}}if(V&&typeof V=="object"){const{tx:G=0,ty:q=0}=V;return{tx:G,ty:q}}return{tx:0,ty:0}}const ab=Ue.dia.Element.define("app.ConversationNode",{size:{width:220,height:160},attrs:{body:{width:"calc(w)",height:"calc(h)",fill:"#ffffff",stroke:"#64748b",strokeWidth:1.6,rx:8,ry:8,filter:{name:"dropShadow",args:{dx:0,dy:3,blur:10,color:"rgba(15, 23, 42, 0.12)"}},magnet:!0},fo:{width:"calc(w)",height:"calc(h)",x:0,y:0,style:{overflow:"hidden"}},foBody:{style:{width:"100%",height:"100%"}}}},{markup:[{tagName:"rect",selector:"body"},{tagName:"foreignObject",selector:"fo",attributes:{width:"100%",height:"100%"},children:[{tagName:"div",namespaceURI:"http://www.w3.org/1999/xhtml",selector:"foBody",style:{width:"100%",height:"100%"}}]}]});function Rr(V=""){return V.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function lb(V){const G=Vt.getCell(V);return G?Vt.getConnectedLinks(G,{inbound:!0}).map(ct=>{const nt=ct.get("source")?.id;if(!nt)return null;const pt=xe.get(nt)??{};return{id:nt,prompt:pt.prompt??"",response:pt.response??""}}).filter(Boolean):[]}function cb(V){return lb(V).map(G=>G.prompt?G.prompt.slice(0,42):"Untitled").filter(Boolean)}function ub(V){const G=xe.get(V);if(!G)return"";const q=cb(V),ct=q.length?q.join(" | "):"No parents yet";let nt="Ready",pt="status";G.status==="loading"?(nt="Thinking...",pt="status loading"):G.status==="error"?(nt="Error",pt="status error"):G.contextDirty&&(nt="Needs refresh",pt="status stale");const mt=G.response?`<pre>${Rr(G.response)}</pre>`:'<p class="placeholder">LLM answers appear here.</p>',Dt=G.error?`<div class="error-banner">${Rr(G.error)}</div>`:"";return`
    <div class="conversation-node" data-node-id="${V}">
      <div class="node-meta">
        <span class="parents" title="${Rr(ct)}">${Rr(ct)}</span>
        <span class="${pt}">${nt}</span>
      </div>
      <div class="prompt-row">
        <input class="prompt-input" id="prompt-input-${V}" name="prompt-${V}" type="text" value="${Rr(G.prompt)}" placeholder="Ask something..." aria-label="Prompt input" />
        <button class="send-btn" ${G.status==="loading"?"disabled":""}>${G.status==="loading"?"...":"Send"}</button>
      </div>
      ${Dt}
      <div class="response-pane">${mt}</div>
      <div class="node-footer">
        <button class="child-btn">Add child</button>
        <button class="duplicate-btn">Duplicate</button>
      </div>
    </div>
  `}function hb(V){const G=_n.querySelector(`.conversation-node[data-node-id="${V}"]`);if(!G)return;const q=G.querySelector(".prompt-input"),ct=G.querySelector(".send-btn"),nt=G.querySelector(".child-btn"),pt=G.querySelector(".duplicate-btn");q?.addEventListener("input",mt=>{const Dt=mt.target.value;Ln(V,{prompt:Dt},{skipRender:!0}),xe.get(V)?.response&&ia(V)}),q?.addEventListener("keydown",mt=>{mt.key==="Enter"&&!mt.shiftKey&&(mt.preventDefault(),Tf(V))}),ct?.addEventListener("click",()=>Tf(V)),nt?.addEventListener("click",()=>fb(V)),pt?.addEventListener("click",()=>db(V))}function Ln(V,G,{skipRender:q=!1}={}){const nt={...xe.get(V)||{prompt:"",response:"",status:"idle",contextDirty:!1,error:null},...G};xe.set(V,nt),q||Dr(V)}function Dr(V){const G=Vt.getCell(V);if(!G)return;const q=ub(V);G.attr("foBody/html",q),requestAnimationFrame(()=>hb(V))}function te(V={x:120,y:120},G=""){const q=new ab({position:V});return Vt.addCell(q),ob(q),xe.set(q.id,{prompt:G,response:"",status:"idle",contextDirty:!1,error:null}),Dr(q.id),q}function Lf(V,G=new Set){if(G.has(V))return[];G.add(V);const q=Vt.getCell(V);if(!q)return[];const ct=Vt.getConnectedLinks(q,{inbound:!0}),nt=[];return ct.forEach(pt=>{const mt=pt.get("source")?.id;if(!mt||G.has(mt))return;const Dt=xe.get(mt);Dt&&(nt.push({id:mt,prompt:Dt.prompt,response:Dt.response}),nt.push(...Lf(mt,G)))}),nt}async function Tf(V){const G=xe.get(V);if(!G)return;const q=G.prompt?.trim();if(!q){Ln(V,{error:"Enter a prompt before sending."});return}Ln(V,{status:"loading",error:null,contextDirty:!1});try{const ct=Lf(V),nt=await ra.ask({prompt:q,contextEntries:ct});Ln(V,{response:nt,status:"ready",error:null}),ia(V)}catch(ct){Ln(V,{status:"error",error:ct.message})}}function ia(V,G=new Set){if(G.has(V))return;G.add(V);const q=Vt.getCell(V);if(!q)return;Vt.getConnectedLinks(q,{outbound:!0}).forEach(nt=>{const pt=nt.get("target")?.id;if(!pt||G.has(pt))return;const Dt=(xe.get(pt)??{}).status==="loading"?"loading":"stale";Ln(pt,{contextDirty:!0,status:Dt}),ia(pt,G)})}function fb(V){const G=Vt.getCell(V);if(!G)return;const q=G.position(),ct={x:q.x+420,y:q.y+20},nt=te(ct,"");Vt.addCell(En().set({source:{id:V},target:{id:nt.id}}))}function db(V){const G=Vt.getCell(V);if(!G)return;const q=xe.get(V)??{},ct={x:G.position().x+20,y:G.position().y+220},nt=te(ct,q.prompt??"");Ln(nt.id,{response:q.response??"",status:"idle",contextDirty:!1})}function _f(V="Explain how bread is made."){Ef(),Vt.clear(),xe.clear(),te({x:200,y:140},V)}function Mf(){const V=_n.getBoundingClientRect();ie.setDimensions(V.width,V.height)}window.addEventListener("resize",Mf);Mf();ie.on("blank:pointerdown",V=>{qi=!0,Wi={x:V.clientX,y:V.clientY};const{tx:G,ty:q}=Cf();ji={x:G,y:q},document.body.style.cursor="grabbing"});window.addEventListener("pointermove",V=>{if(!qi)return;const G=V.clientX-Wi.x,q=V.clientY-Wi.y;ie.translate(ji.x+G,ji.y+q)});window.addEventListener("pointerup",()=>{qi&&(qi=!1,document.body.style.cursor="")});_n.addEventListener("wheel",V=>{if(!V.ctrlKey&&!V.metaKey)return;V.preventDefault();const G=V.deltaY>0?-.1:.1;Cn=Math.min(1.6,Math.max(.5,Cn+G)),ie.scale(Cn,Cn)},{passive:!1});ie.on("blank:pointerdblclick",(V,G,q)=>{te({x:G,y:q})});Q0?.addEventListener("click",()=>{const V=_n.getBoundingClientRect(),{tx:G,ty:q}=Cf(),ct=(V.width/2-G)/Cn,nt=(V.height/2-q)/Cn;te({x:ct,y:nt})});tb?.addEventListener("click",()=>_f());function gb(V){if(Ef(),Vt.clear(),xe.clear(),V==="bread"){const G=te({x:40,y:80},"Explain how bread is made."),q=te({x:440,y:40},"What happens during baking chemically?"),ct=te({x:440,y:220},"I want a really soft bread. Give me a recipe.");Vt.addCell(En().set({source:{id:G.id},target:{id:q.id}})),Vt.addCell(En().set({source:{id:G.id},target:{id:ct.id}}))}else if(V==="science"){const G=te({x:40,y:60},"Summarize quantum entanglement."),q=te({x:460,y:0},"Explain it like I am five."),ct=te({x:460,y:140},"Compare entanglement to classical correlation."),nt=te({x:460,y:280},"List real-world systems where entanglement is useful.");Vt.addCell(En().set({source:{id:G.id},target:{id:q.id}})),Vt.addCell(En().set({source:{id:G.id},target:{id:ct.id}})),Vt.addCell(En().set({source:{id:G.id},target:{id:nt.id}}))}else te({x:80,y:60},"New root idea"),te({x:420,y:60},"Another branch"),te({x:420,y:220},"Third branch")}Array.from(document.querySelectorAll(".quick-actions button")).forEach(V=>{V.addEventListener("click",()=>gb(V.dataset.template))});_f();Vt.on("add",V=>{if(V.isLink()){console.debug("[Graph] Link added",V.id,"source:",V.get("source"),"target:",V.get("target")),console.debug("[Graph] Link attrs",V.get("attrs")),requestAnimationFrame(()=>{const ct=ie.findViewByModel(V)?.el?.querySelector("path");if(ct){const nt=window.getComputedStyle(ct);console.debug("[Graph] Path d:",ct.getAttribute("d"),"stroke:",nt.stroke,"stroke-width:",nt.strokeWidth)}else console.warn("[Graph] No path element found for link",V.id)});const G=V.get("target")?.id;G&&Dr(G)}});Vt.on("change:target",V=>{console.debug("[Graph] Link target changed",V.id,"new target:",V.get("target")),requestAnimationFrame(()=>{const ct=ie.findViewByModel(V)?.el?.querySelector("path");ct&&console.debug("[Graph] Target change path d:",ct.getAttribute("d"))});const G=V.get("target")?.id;G&&Dr(G)});Vt.on("remove",V=>{if(V.isLink()){console.debug("[Graph] Link removed",V.id,"last target:",V.previous("target"));const G=V.previous("target")?.id;G&&Dr(G)}});
